<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="165">
  <HTTPTask id="852" hostname="10.100.22.24:8181" path="/signal/assets/app/pvs/alerts_review/ad_hoc_alert_list-dad397ffd1d22dc10b06da34bad07873.js" url="http://10.100.22.24:8181/signal/assets/app/pvs/alerts_review/ad_hoc_alert_list-dad397ffd1d22dc10b06da34bad07873.js" ip="10.100.22.24" port="8181" connectionId="41" origin="Primary" frame="1" startDateTime="2020-07-08T19:03:02.881+05:30" startTime="195762843" endTime="195765265">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0OjgxODE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgzLjAuNDEwMy4xMTYgU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC9hZEhvY0FsZXJ0L2luZGV4</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj05MDUwNWQ2OS1iMjIwLTQ0NDMtODllMS01ZWQyYzBmZjUxMDU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9zaWduYWwvYXNzZXRzL2FwcC9wdnMvYWxlcnRzX3Jldmlldy9hZF9ob2NfYWxlcnRfbGlzdC1kYWQzOTdmZmQxZDIyZGMxMGIwNmRhMzRiYWQwNzg3My5qcyBIVFRQLzEuMQ0KSG9zdDogMTAuMTAwLjIyLjI0OjgxODENCkNvbm5lY3Rpb246IGtlZXAtYWxpdmUNClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84My4wLjQxMDMuMTE2IFNhZmFyaS81MzcuMzYNCkFjY2VwdDogKi8qDQpSZWZlcmVyOiBodHRwOi8vMTAuMTAwLjIyLjI0OjgxODEvc2lnbmFsL2FkSG9jQWxlcnQvaW5kZXgNCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZQ0KQWNjZXB0LUxhbmd1YWdlOiBlbi1VUyxlbjtxPTAuOQ0KQ29va2llOiBTRVNTSU9OPTkwNTA1ZDY5LWIyMjAtNDQ0My04OWUxLTVlZDJjMGZmNTEwNQ0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>OTA1MDVkNjktYjIyMC00NDQzLTg5ZTEtNWVkMmMwZmY1MTA1</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>27055</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Last-Modified" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAwNiBKdWwgMjAyMCAwMDozMjozNiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ImFwcC9wdnMvYWxlcnRzX3Jldmlldy9hZF9ob2NfYWxlcnRfbGlzdC1kYWQzOTdmZmQxZDIyZGMxMGIwNmRhMzRiYWQwNzg3My5qcyI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MjcwNTU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>V2VkLCAwOCBKdWwgMjAyMCAxMzoxODo1MCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KTGFzdC1Nb2RpZmllZDogTW9uLCAwNiBKdWwgMjAyMCAwMDozMjozNiBHTVQNCkVUYWc6ICJhcHAvcHZzL2FsZXJ0c19yZXZpZXcvYWRfaG9jX2FsZXJ0X2xpc3QtZGFkMzk3ZmZkMWQyMmRjMTBiMDZkYTM0YmFkMDc4NzMuanMiDQpWYXJ5OiBBY2NlcHQtRW5jb2RpbmcNCkNhY2hlLUNvbnRyb2w6IHB1YmxpYywgbWF4LWFnZT0zMTUzNjAwMA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0O2NoYXJzZXQ9VVRGLTgNCkNvbnRlbnQtTGVuZ3RoOiAyNzA1NQ0KRGF0ZTogV2VkLCAwOCBKdWwgMjAyMCAxMzoxODo1MCBHTVQNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCi8vIGEgY29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHBhcnNpbmcgc3RyaW5nIG5hbWVzcGFjZXMgYW5kCi8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGluZyBuZXN0ZWQgbmFtZXNwYWNlcwpmdW5jdGlvbiBleHRlbmQoIG5zLCBuc19zdHJpbmcgKSB7CiAgICB2YXIgcGFydHMgPSBuc19zdHJpbmcuc3BsaXQoJy4nKSwKICAgICAgICBwYXJlbnQgPSBucywKICAgICAgICBwbCwgaTsKICAgIGlmIChwYXJ0c1swXSA9PSAic2lnbmFsIikgewogICAgICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7CiAgICB9CiAgICBwbCA9IHBhcnRzLmxlbmd0aDsKICAgIGZvciAoaSA9IDA7IGkgPCBwbDsgaSsrKSB7CiAgICAgICAgLy9jcmVhdGUgYSBwcm9wZXJ0eSBpZiBpdCBkb2VzbnQgZXhpc3QKICAgICAgICBpZiAodHlwZW9mIHBhcmVudFtwYXJ0c1tpXV0gPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcGFyZW50W3BhcnRzW2ldXSA9IHt9OwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbcGFydHNbaV1dOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKfQoKLy9Qcm90b3R5cGUgbWV0aG9kcwpEYXRlLnByb3RvdHlwZS5hZGREYXlzID0gZnVuY3Rpb24oZGF5cykgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTsKICAgIHJldHVybiBkYXRlOwp9OwoKQXJyYXkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGYpe2YgIT0gdmFsdWV9KTsKfTsKClNDQV9XT1JLRkxPV19TVEFUVVNfRU5VTSA9IHsgTkVXOiAnTmV3JywKICAgIEFTU09DSUFURV9SRVZJRVdFRDogJ0Fzc29jaWF0ZVJldmlld2VkJywKICAgIFBIWVNJQ0lBTl9SRVZJRVdFRDogJ1BoeXNpY2lhblJldmlld2VkJywKICAgIFJFUVVJUkVEX0VWQUxVQVRJT046ICdSZXF1aXJlZEV2YWx1YXRpb24nLAogICAgQ09OVElOVUVEX01PTklUT1JJTkc6ICdDb250aW51ZWRNb25pdG9yaW5nJwp9OwoKU0NBX0RJU1BPU0lUSU9OX0VOVU0gPSB7CiAgICBWQUxJREFURURfU0lHTkFMIDogJ1ZhbGlkYXRlZFNpZ25hbCcsCiAgICBWQUxJREFURURfTk9OX0NPTkZJUk1FRF9TSUdOQUwgOiAnVmFsaWRhdGVkTm9uQ29uZmlybWVkU2lnbmFsJywKICAgIFZBTElEQVRFRF9VTkRFUl9JTlZFU1RJR0FUSU9OIDogJ1ZhbGlkYXRlZFVuZGVySW52ZXN0aWdhdGlvbicsCiAgICBDT01NVU5JQ0FURURfU0lHTkFMIDogJ0NvbW11bmljYXRlZFNpZ25hbCcsCiAgICBOT05fVkFMSUQ6ICdOb25WYWxpZCcKfTsKClNDQV9QUklPUklUWV9FTlVNID0gewogICAgSElHSDogIkhpZ2giLAogICAgTUVESVVNOiAiTWVkaXVtIiwKICAgIExPVzogIkxPVyIKfTsKCkRBVEVfRk1UX1RaID0gIllZWVktTU0tREQiOwoKc2lnbmFsLnV0aWxzID0gKGZ1bmN0aW9uKCkgewoKICAgIHZhciBzdGFja2VkID0gZnVuY3Rpb24odG9wVmFsdWUsIGJvdHRvbVZhbHVlKSB7CiAgICAgICAgdmFyIHRvcENvbXAgPSAiIjsKICAgICAgICB2YXIgYm90dG9tQ29tcCA9ICIiOwoKICAgICAgICBpZihfLmlzRnVuY3Rpb24odG9wVmFsdWUpKSB7CiAgICAgICAgICAgIHRvcENvbXAgPSB0b3BWYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9wQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLXRvcCI+JyArIHRvcFZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oYm90dG9tVmFsdWUpKSB7CiAgICAgICAgICAgIGJvdHRvbUNvbXAgPSBib3R0b21WYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm90dG9tQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLWJvdHRvbSI+JyArIGJvdHRvbVZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3BDb21wICsgYm90dG9tQ29tcAogICAgfTsKCiAgICAvLyBBbmQgdGhpcyBpcyB0aGUgZGVmaW5pdGlvbiBvZiB0aGUgY3VzdG9tIGZ1bmN0aW9uIOKAiwogICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRtcGxfbmFtZSwgdG1wbF9kYXRhKSB7CgogICAgICAgIGlmICggIXJlbmRlci50bXBsX2NhY2hlICkgewoKCgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZSA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoIXJlbmRlci50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgdmFyIHRtcGxfZGlyID0gJy9zaWduYWwvYXNzZXRzL2FwcC9wdnMvaGJzLXRlbXBsYXRlcyc7CiAgICAgICAgICAgIHZhciB0bXBsX3VybCA9IHRtcGxfZGlyICsgJy8nICsgdG1wbF9uYW1lICsgJy5oYnMnOwoKICAgICAgICAgICAgdmFyIHRtcGxfc3RyaW5nID0gIiI7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHRtcGxfdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0bXBsX3N0cmluZyA9IGRhdGEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKHRtcGxfc3RyaW5nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdKHRtcGxfZGF0YSkKICAgIH07CgogICAgdmFyIGhic19wYXJ0aWFsID0gZnVuY3Rpb24odG1wbF9uYW1lKSB7CiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlKSB7CiAgICAgICAgICAgIGhic19wYXJ0aWFsLnRtcGxfY2FjaGUgPSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgIHZhciB0bXBsX2RpciA9ICcvc2lnbmFsL2Fzc2V0cy9hcHAvcHZzL2hicy10ZW1wbGF0ZXMnOwogICAgICAgICAgICB2YXIgdG1wbF91cmwgPSB0bXBsX2RpciArICcvJyArIHRtcGxfbmFtZSArICcuaGJzJzsKCiAgICAgICAgICAgIHZhciB0bXBsX3N0cmluZyA9ICIiOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB0bXBsX3VybCwKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdG1wbF9zdHJpbmcgPSBkYXRhCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaGJzX3BhcnRpYWwudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gdG1wbF9zdHJpbmcKICAgICAgICB9CgogICAgICAgIHJldHVybiBoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0KICAgIH07CgogICAgdmFyIGNvbXBvc2VVcmwgPSBmdW5jdGlvbihjb250cm9sbGVyLCBhY3Rpb24sIHBhcmFtcykgewogICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC8iICsgY29udHJvbGxlciArICIvIiArIGFjdGlvbiArIChfLmlzTnVsbChwYXJhbXMpID8gJycgOiAnPycgKyBjb21wb3NlUGFyYW1zKHBhcmFtcykpOwoKICAgICAgICByZXR1cm4gdXJsCiAgICB9OwoKICAgIC8vVE9ETyA6IE5lZWQgdG8gY2hhbmdlIHRoaXMgdG8gaGFuZGxlYmFyIGZvcm0sIFdpbGwgYmUgZG9uZSBsYXRlcgogICAgdmFyIHBvc3RVcmwgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBuZXdXaW5kb3cpIHsKCiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKICAgICAgICBmb3JtLm1ldGhvZCA9ICJwb3N0IjsKICAgICAgICBmb3JtLmFjdGlvbiA9IHBhdGg7CiAgICAgICAgZm9ybS5lbmN0eXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgaWYgKG5ld1dpbmRvdykgZm9ybS50YXJnZXQgPSAiX2JsYW5rIjsKCiAgICAgICAgdmFyIHRva2VuID0gJCgibWV0YVtuYW1lPSdfY3NyZiddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHZhciBwYXJhbWV0ZXIgPSAkKCJtZXRhW25hbWU9J19jc3JmX3BhcmFtZXRlciddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHBhcmFtc1twYXJhbWV0ZXJdID0gdG9rZW47CiAgICAgICAgZm9yIChsZXQga2V5IGluIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLnR5cGUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLm5hbWUgPSBrZXk7CiAgICAgICAgICAgICAgICBoaWRkZW5GaWVsZC52YWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChoaWRkZW5GaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmb3JtKTsKICAgICAgICBmb3JtLnN1Ym1pdCgpOwogICAgfQoKICAgIHZhciBjb21wb3NlUGFyYW1zID0gZnVuY3Rpb24obykgewogICAgICAgIHJldHVybiBfLm1hcChfLnBhaXJzKG8pLCBmdW5jdGlvbihwKXtyZXR1cm4gcC5qb2luKCc9Jyl9ICkuam9pbignJicpCiAgICB9OwoKICAgIHZhciBjYXBpdGFsSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgJiYgc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKTsKICAgIH07CgogICAgdmFyIGJyZWFrSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgPyBzLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCcgJykgOiBzCiAgICB9OwoKICAgIHZhciBlbmFibGVfbG9hZF9idXR0b24gPSBmdW5jdGlvbihlbGUsIGVuYWJsZWQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXRFbGUgPSBlbGUuZmluZCgnLmdseXBoaWNvbicpOwogICAgICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgICAgICAgJCh0YXJnZXRFbGUpLmFkZENsYXNzKCdyZWZyZXNoLWFuaW1hdGUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQodGFyZ2V0RWxlKS5yZW1vdmVDbGFzcygncmVmcmVzaC1hbmltYXRlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNldEluTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24ocHJvcCwgZGF0YSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHByb3AsIGRhdGEpOwogICAgfTsKCiAgICB2YXIgZ2V0RnJvbUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKHByb3ApIHsKICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvcCk7CiAgICB9OwoKICAgIHZhciBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbihwcm9wLCBkYXRhKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvcCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgfTsKCiAgICB2YXIgZ2V0SlNPTkZyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb3ApKTsKICAgIH07CgogICAgdmFyIGxvY2FsU3RvcmFnZVV0aWwgPSB7CiAgICAgICAgc2V0UHJvcCA6IHNldEluTG9jYWxTdG9yYWdlLAogICAgICAgIGdldFByb3AgOiBnZXRGcm9tTG9jYWxTdG9yYWdlLAogICAgICAgIHNldEpTT04gOiBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UsCiAgICAgICAgZ2V0SlNPTiA6IGdldEpTT05Gcm9tTG9jYWxTdG9yYWdlCiAgICB9OwoKICAgIHZhciBnZXRRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBrZXkgPSBmYWxzZSwgcmVzID0ge30sIGl0bSA9IG51bGw7CiAgICAgICAgLy8gZ2V0IHRoZSBxdWVyeSBzdHJpbmcgd2l0aG91dCB0aGUgPwogICAgICAgIHZhciBxcyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgLy8gY2hlY2sgZm9yIHRoZSBrZXkgYXMgYW4gYXJndW1lbnQKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIGtleSA9IGFyZ3VtZW50c1swXTsKICAgICAgICAvLyBtYWtlIGEgcmVnZXggcGF0dGVybiB0byBncmFiIGtleS92YWx1ZQogICAgICAgIHZhciBwYXR0ZXJuID0gLyhbXiY9XSspPShbXiZdKikvZzsKICAgICAgICAvLyBsb29wIHRoZSBpdGVtcyBpbiB0aGUgcXVlcnkgc3RyaW5nLCBlaXRoZXIKICAgICAgICAvLyBmaW5kIGEgbWF0Y2ggdG8gdGhlIGFyZ3VtZW50LCBvciBidWlsZCBhbiBvYmplY3QKICAgICAgICAvLyB3aXRoIGtleS92YWx1ZSBwYWlycwogICAgICAgIHdoaWxlIChpdG0gPSBwYXR0ZXJuLmV4ZWMocXMpKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09IGZhbHNlICYmIGRlY29kZVVSSUNvbXBvbmVudChpdG1bMV0pID09PSBrZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICByZXNbZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ga2V5ID09PSBmYWxzZSA/IHJlcyA6IG51bGw7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgcmVuZGVyIDogcmVuZGVyLAogICAgICAgIHN0YWNrZWQ6IHN0YWNrZWQsCiAgICAgICAgY29tcG9zZVVybDogY29tcG9zZVVybCwKICAgICAgICBwb3N0VXJsOiBwb3N0VXJsLAogICAgICAgIGNvbXBvc2VQYXJhbXM6IGNvbXBvc2VQYXJhbXMsCiAgICAgICAgY2FwaXRhbEl0OiBjYXBpdGFsSXQsCiAgICAgICAgYnJlYWtJdDogYnJlYWtJdCwKICAgICAgICBoYnNfcGFydGlhbDogaGJzX3BhcnRpYWwsCiAgICAgICAgZW5hYmxlX2xvYWRfYnV0dG9uOiBlbmFibGVfbG9hZF9idXR0b24sCiAgICAgICAgbG9jYWxTdG9yYWdlVXRpbDogbG9jYWxTdG9yYWdlVXRpbCwKICAgICAgICBnZXRRdWVyeVN0cmluZzogZ2V0UXVlcnlTdHJpbmcKICAgIH0KfSkoKTsKCnZhciBmZXRjaEFjY2VwdGVkRmlsZUZvcm1hdHMgPSBmdW5jdGlvbigpIHsKICAgICQuYWpheCh7CiAgICAgICAgdXJsOiAnL3NpZ25hbC9hdHRhY2htZW50YWJsZS9mZXRjaEFjY2VwdGVkRmlsZUZvcm1hdHMnICwKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICQoIi5hdHRhY2htZW50LWZpbGUiKS5hdHRyKCJhY2NlcHQiICwgcmVzdWx0LmpvaW4oIiwiKSkKICAgICAgICB9LAogICAgfSk7Cn07CgoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaTE4bicsCiAgICBmdW5jdGlvbihzdHIpewogICAgICAgIHJldHVybiAoICh0eXBlb2YgaTE4bikgIT09ICd1bmRlZmluZWQnID8gc3RyIDogc3RyKQogICAgfQopOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2VsZWN0JywgZnVuY3Rpb24obmFtZSwgc2VsZWN0ZWRWYWx1ZSwgb3B0aW9ucywgZGlzcF9maWVsZCwgdmFsdWVfZmllbGQpIHsKICAgIHZhciBvdXQgPSAiPHNlbGVjdCBjbGFzcz0nZm9ybS1jb250cm9sIHNlbGVjdEJveCcgaWQ9XCciICsgbmFtZSArICJcJyBuYW1lPSIgKyBuYW1lICsgIj5cbiI7CiAgICBfLmVhY2gob3B0aW9ucywgZnVuY3Rpb24odikgewogICAgICAgIG91dCArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIHZbdmFsdWVfZmllbGRdICsgIiciICsKICAgICAgICAgICAgKHZbdmFsdWVfZmllbGRdID09IHNlbGVjdGVkVmFsdWVbdmFsdWVfZmllbGRdID8gIiBzZWxlY3RlZCAiIDogIiIpICsgIiA+IiArCiAgICAgICAgICAgIGVzY2FwZUhUTUwodltkaXNwX2ZpZWxkXSkgKyAiPC9vcHRpb24+XG4iCiAgICB9KTsKICAgIG91dCArPSAiPC9zZWxlY3Q+IjsKCiAgICByZXR1cm4gbmV3IEhhbmRsZWJhcnMuU2FmZVN0cmluZyhvdXQpCn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlclBhcnRpYWwoJ2RhdGVfcGlja2VyX3RlbXBsYXRlJywgc2lnbmFsLnV0aWxzLmhic19wYXJ0aWFsKCdkYXRlX3BpY2tlcl90ZW1wbGF0ZScpKTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZiBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2VxJywgZnVuY3Rpb24oYSwgYiwgb3B0cykgewogICAgaWYgKGEgPT0gYikgewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfQp9KTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZi4uZWxzZSBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2Vsc2VfZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSA9PSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfdGFnX2V4aXN0JywgZnVuY3Rpb24oa2V5LCB2YWx1ZSx0YWdzLCBvcHRzKSB7CiAgICBpZih2YWx1ZS50YWdUZXh0ID09IHRhZ3Nba2V5LTFdLnRhZ1RleHQgJiYgdmFsdWUuc3ViVGFnVGV4dCE9bnVsbCAmJiB2YWx1ZS5zdWJUYWdUZXh0ICE9IHRhZ3Nba2V5LTFdLnN1YlRhZ1RleHQpewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfSBlbHNlewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfZWxzZV9uZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSAhPSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfaGFuZGxlYmFyX2V4dC5qcwoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCnNpZ25hbC5hbGVydHNfdXRpbHMgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgcHJpb3JpdGllczsKICAgIHZhciB3b3JrZmxvd1N0YXRlczsKCiAgICB2YXIgZ2V0X3ByaW9yaXRpZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL3dvcmtmbG93L3ByaW9yaXRpZXMiLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgcHJpb3JpdGllcyA9IHJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBwcmlvcml0aWVzCiAgICB9OwoKICAgIHZhciBnZXRfd29ya2Zsb3dTdGF0ZXMgPSBmdW5jdGlvbihpbml0RGF0YSkgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvd29ya2Zsb3cvd29ya2Zsb3dTdGF0ZSIsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgZGF0YTogaW5pdERhdGEsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgd29ya2Zsb3dTdGF0ZXMgPSByZXN1bHQKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gd29ya2Zsb3dTdGF0ZXMKICAgIH07CgogICAgdmFyIHByaW9yaXRpZXNfc2VsZWN0aW9ucyA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgIHZhciBuZXdfc2VsZWN0ID0gJzxkaXY+PHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGFkZC1jdXJzb3IiICcgKwogICAgICAgICAgICAnc3R5bGU9ImhlaWdodDogMzBweDsiIG9uY2hhbmdlPSJ1cGRhdGVQcmlvcml0eSh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgcHJpb3JpdHkgPSByb3cucHJpb3JpdHk7CgogICAgICAgIHZhciB0aGVfc2VsZWN0ID0gXy5yZWR1Y2UocHJpb3JpdGllcywgZnVuY3Rpb24obSwgcCl7CiAgICAgICAgICAgIGlmIChwLnZhbHVlID09IHByaW9yaXR5KQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIiBzZWxlY3RlZD4gJyArIHAuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIj4nICsgcC5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nCiAgICAgICAgfSwgbmV3X3NlbGVjdCk7CiAgICAgICAgdGhlX3NlbGVjdCA9IHRoZV9zZWxlY3QgKyAnPC9zZWxlY3Q+PC9kaXY+JzsKICAgICAgICByZXR1cm4gdGhlX3NlbGVjdDsKICAgIH07CgogICAgdmFyIHdvcmtmbG93X3NlbGVjdGlvbnMgPSBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICB2YXIgbmV3X3NlbGVjdCA9ICc8ZGl2PjxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBhZGQtY3Vyc29yIiBzdHlsZT0iaGVpZ2h0OiAzMHB4OyIgb25jaGFuZ2U9InVwZGF0ZVN0YXR1cyh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgd29ya2Zsb3dTdGF0ZSA9IHJvdy53b3JrZmxvd1N0YXRlOwoKICAgICAgICB2YXIgdGhlX3NlbGVjdCA9IF8ucmVkdWNlKHdvcmtmbG93U3RhdGVzLCBmdW5jdGlvbihtLCB3cyl7CiAgICAgICAgICAgIGlmICh3cy52YWx1ZSA9PSB3b3JrZmxvd1N0YXRlKQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHdzLnZhbHVlICsgJyIgc2VsZWN0ZWQ+ICcgKyB3cy5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbSArICc8b3B0aW9uIHZhbHVlPSInICsgd3MudmFsdWUgKyAnIj4nICsgd3MuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JwogICAgICAgIH0sIG5ld19zZWxlY3QpOwogICAgICAgIHRoZV9zZWxlY3QgPSB0aGVfc2VsZWN0ICsgJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIHRoZV9zZWxlY3Q7CiAgICB9OwoKICAgIHZhciBjb21wb3NlX2VkaXRfc3RhdGVfbGluayA9IGZ1bmN0aW9uKHZhbHVlLCByb3dJZCwgZmlsZWROYW1lKSB7CiAgICAgICAgcmV0dXJuICI8c3Bhbj4iICsgdmFsdWUgKyAiPC9zcGFuPiIgKyAiPGEgaHJlZj0nIycgY2xhc3M9J2VkaXQtc3RhdGUnID4iICsKICAgICAgICAgICAgIjxpIGNsYXNzPSdmYSBmYS1zaGFyZS1hbHQgcHVsbC1yaWdodCcgZGF0YS1maWVsZD0nIiAgKyBmaWxlZE5hbWUgKwogICAgICAgICAgICAiJyBkYXRhLWlkPSciICsgcm93SWQgKyAiJy8+PC9hPiIKICAgIH07CgogICAgdmFyIHN0YXRlX2NoYW5nZWQgPSBmdW5jdGlvbihleHRyYV92YWx1ZXMpIHsKICAgICAgICAkKCIjdmFsdWVTZWxlY3QiKS5jaGFuZ2UoZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciBhdmFpbGFibGVfZXh0cmFfdmFsdWVzID0gZXh0cmFfdmFsdWVzWyQodmFsdWVTZWxlY3QpLnZhbCgpXQogICAgICAgIH0pCiAgICB9OwoKICAgIC8vVE9ETyB0aGlzIGlzIGEgdGVtcCBzb2x1dGlvbiBmb3IgdGhlIEpTT04gZm9ybWF0LiBJdCBzaG91bGQgY29tZSBmcm9tIHNlcnZlciBzaWRlCiAgICAvL0Z1bmN0aW9uIHRoYXQgY29udmVydHMgdGhlIGpzb24gaW5uZXJodG1sIHRvIHRoZSBjc3YgdmFsdWVzLgogICAgLy9JdCBjb252ZXJ0cyB0aGUgcHJvcGVydGllcyB3aGljaCBhcmUgbm90IGlkLgogICAgdmFyIHNob3dfanNvbl9hc19jc3YgPSBmdW5jdGlvbiAoZWxlbWVudENsYXNzKSB7CiAgICAgICAgJCgiLiIgKyBlbGVtZW50Q2xhc3MpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKGlzTmFOKCQodGhpcykuaHRtbCgpKSkgewogICAgICAgICAgICAgICAgICB2YXIgbW9kaWZpZWRWYWwgPSAiIjsKICAgICAgICAgICAgICAgICAgdmFyIGpzb25WYWwgPSBKU09OLnBhcnNlKCQodGhpcykuaHRtbCgpKTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgb2JqIGluIGpzb25WYWwpIHsKICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb25WYWwuaGFzT3duUHJvcGVydHkob2JqKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGpzb25WYWxbb2JqXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvblZhbFtvYmpdLmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wICE9ICdpZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRWYWwgPSBtb2RpZmllZFZhbCArIGpzb25WYWxbb2JqXVtwcm9wXSArICIsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgJCh0aGlzKS5odG1sKG1vZGlmaWVkVmFsLnNsaWNlKDAsIC0xKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgLy9EbyBub3RoaW5nCiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhlcnIpCiAgICAgICAgICAgfQogICAgICAgICAgICQodGhpcykuaHRtbCgpCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRfbWF0Y2hlZF9hbGVydHNfdGFibGUgPSBmdW5jdGlvbih0YWJsZUVsZSwgdXJsKSB7CiAgICAgICAgdmFyIHRhYmxlID0gdGFibGVFbGUuRGF0YVRhYmxlKHsKICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgInVybCI6ICIvc2lnbmFsL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhamF4OiB7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGFTcmM6ICcnLAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHhocixzdGF0dXMsZXJyb3Ipe30KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFvQ29sdW1uczpbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICduYW1lJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ3Byb2R1Y3RTZWxlY3Rpb24nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAndG9waWMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAnZGV0ZWN0ZWREYXRlJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ2Rpc3Bvc2l0aW9uJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBkb206ICcnCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YWJsZQogICAgfTsKCiAgICB2YXIgZ2V0U2lnbmFsTmFtZUxpc3QgPSBmdW5jdGlvbihzaWduYWxzQW5kVG9waWNzKSB7CiAgICAgICAgdmFyIHNpZ25hbEFuZFRvcGljcyA9ICcnOwogICAgICAgICQuZWFjaChzaWduYWxzQW5kVG9waWNzLCBmdW5jdGlvbihpLCBvYmopewogICAgICAgICAgICB2YXIgdXJsID0gc2lnbmFsRGV0YWlsVXJsICsgJz9pZD0nICsgb2JqWydzaWduYWxJZCddOwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAnPHNwYW4gY2xhc3M9ImNsaWNrIj48YSBocmVmPSInICsgdXJsICsgJyI+JyArIG9ialsnbmFtZSddICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAiLCIKICAgICAgICB9KTsKICAgICAgICBpZihzaWduYWxBbmRUb3BpY3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgcmV0dXJuICc8ZGl2PicgKyBzaWduYWxBbmRUb3BpY3Muc3Vic3RyaW5nKDAsIHNpZ25hbEFuZFRvcGljcy5sZW5ndGggLSAxKSArICc8L2Rpdj4nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuICctJzsKICAgIH07CgogICAgLy8gRm9yIHNoYXJlZCB3aXRoIG1vZGFsCiAgICB2YXIgaW5pdGlhbGl6ZVNoYXJlV2l0aFNlbGVjdDIgPSBmdW5jdGlvbigpewogICAgICAgICQoJyNzaGFyZVdpdGgnKS5zZWxlY3QyKCkub24oImNoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICQoJyNzaGFyZVdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBpbml0aWFsaXplU2hhcmVXaXRoVmFsdWVzID0gZnVuY3Rpb24oKXsKICAgICAgICAkKCcjc2hhcmVkV2l0aE1vZGFsJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gZS5yZWxhdGVkVGFyZ2V0LmlkOwogICAgICAgICAgICAkKCcjZXhlY3V0ZWRDb25maWdJZCcpLnZhbChleGVjdXRlZENvbmZpZ0lkKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsCiAgICAgICAgICAgICAgICB1cmw6IGdldFNoYXJlZFdpdGggKyAnP2lkPScgKyBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJlc3VsdC51c2VycywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzICs9IHRoaXMubmFtZSArICc8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhVc2VyTGlzdCcpLmh0bWwodXNlcnMpOwogICAgICAgICAgICAgICAgICAgIHZhciBncm91cHMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0Lmdyb3VwcywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwcyArPSAgdGhpcy5uYW1lICsgJyA8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhHcm91cExpc3QnKS5odG1sKGdyb3Vwcyk7CgogICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXN1bHQuYWxsLCBmdW5jdGlvbihpLCBkYXRhKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oZGF0YS5uYW1lLCBkYXRhLmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzaGFyZWRXaXRoTW9kYWxTaG93ID0gdHJ1ZTsKCiAgICAgICAgfSkub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgc2hhcmVkV2l0aE1vZGFsU2hvdyA9IGZhbHNlOwogICAgICAgICAgICAkKCcjc2hhcmVkV2l0aCcpLnZhbChudWxsKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5maW5kKCdvcHRpb24nKS5yZW1vdmUoKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGdldFRhZ3NFbGVtZW50ID0gZnVuY3Rpb24odGFncykgewogICAgICAgIHZhciB0YWdzRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJ0YWctY29udGFpbmVyIGJsb2NrLWVsbGlwc2lzIj48ZGl2IGNsYXNzPSJ0YWctbGVuZ3RoIj4nOwogICAgICAgIHZhciBnbG9iYWxUYWdzQXJyYXkgPSBbXTsKICAgICAgICB2YXIgYWxlcnRUYWdzcnJheSA9IFtdOwogICAgICAgIHZhciBwcml2YXRlVGFnc0FycmF5ID0gW107CiAgICAgICAgJC5lYWNoKHRhZ3MsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5wcml2YXRlVXNlciA9PSAnKFApJykgewogICAgICAgICAgICAgICAgcHJpdmF0ZVRhZ3NBcnJheS5wdXNoKHZhbHVlKQogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLnRhZ1R5cGUgPT0gJyhBKScpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VGFnc3JyYXkucHVzaCh2YWx1ZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsb2JhbFRhZ3NBcnJheS5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YWdzRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHMnLCB7CiAgICAgICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgIHRhZ3M6dGFncywKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHZpZXdBbGxFbGVtZW50cyA9IGZldGNoVmlld0FsbFRhZ3MoZ2xvYmFsVGFnc0FycmF5ICwgYWxlcnRUYWdzcnJheSAsIHByaXZhdGVUYWdzQXJyYXkpOwoKICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIGRhdGEtdG9nZ2xlPSJ0b29sdGlwIiBkYXRhLXBsYWNlbWVudD0icmlnaHQiIHRpdGxlPSJBZGQvRWRpdCBDYXRlZ29yaWVzIiBjbGFzcz0iZWRpdEFsZXJ0VGFncyBidG4tZWRpdC10YWcgbWlkIj48aSBjbGFzcz0ibWRpIG1kaS1wZW5jaWwtYm94IGZvbnQtMjAgYmx1ZS0xIj48L2k+PC9hPic7CiAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyt2aWV3QWxsRWxlbWVudHMrJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgIHRhZ3NFbGVtZW50ICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgIHJldHVybiB0YWdzRWxlbWVudAogICAgfTsKCiAgICB2YXIgZmV0Y2hWaWV3QWxsVGFncyA9IGZ1bmN0aW9uKGdsb2JhbFRhZ3NBcnJheSAsIGFsZXJ0VGFnc0FycmF5ICwgcHJpdmF0ZVRhZ3NBcnJheSkgewogICAgICAgIHZhciByZXR1cm5FbGVtZW50ID0gIiI7CiAgICAgICAgaWYgKGdsb2JhbFRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgPSAiPHAgY2xhc3M9J3Bicicgc3R5bGU9J21hcmdpbi10b3A6N3B4Jz48Yj5HbG9iYWwgQ2F0ZWdvcnk8L2I+PGhyIGNsYXNzPSd0YWdlaHInPiI7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzX3ZpZXdfYWxsJywge3RhZ3M6IGdsb2JhbFRhZ3NBcnJheX0pICsgIjwvcD4iICA7CiAgICAgICAgfQogICAgICAgIGlmIChhbGVydFRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gIjxwIGNsYXNzPSdwYnInIHN0eWxlPSdtYXJnaW4tdG9wOjdweCc+PGI+QWxlcnQgU3BlY2lmaWMgQ2F0ZWdvcnk8L2I+PGhyIGNsYXNzPSd0YWdlaHInPiI7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzX3ZpZXdfYWxsJywgewogICAgICAgICAgICAgICAgdGFnczogYWxlcnRUYWdzQXJyYXksCiAgICAgICAgICAgIH0pICArICI8L3A+IiA7CiAgICAgICAgfQogICAgICAgIGlmIChwcml2YXRlVGFnc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSAiPHAgY2xhc3M9J3Bicicgc3R5bGU9J21hcmdpbi10b3A6N3B4Jz48Yj5Qcml2YXRlIENhdGVnb3J5PC9iPjxociBjbGFzcz0ndGFnZWhyJz4iOwogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlsc192aWV3X2FsbCcsIHt0YWdzOiBwcml2YXRlVGFnc0FycmF5fSkgICsgIjwvcD4iIDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldHVybkVsZW1lbnQKICAgIH07CiAgICByZXR1cm4gewogICAgICAgIGdldF9wcmlvcml0aWVzOiBnZXRfcHJpb3JpdGllcywKICAgICAgICBwcmlvcml0aWVzX3NlbGVjdGlvbnM6IHByaW9yaXRpZXNfc2VsZWN0aW9ucywKICAgICAgICBnZXRfd29ya2Zsb3dTdGF0ZXM6IGdldF93b3JrZmxvd1N0YXRlcywKICAgICAgICB3b3JrZmxvd19zZWxlY3Rpb25zOiB3b3JrZmxvd19zZWxlY3Rpb25zLAogICAgICAgIGNvbXBvc2VfZWRpdF9zdGF0ZV9saW5rOiBjb21wb3NlX2VkaXRfc3RhdGVfbGluaywKICAgICAgICBzdGF0ZV9jaGFuZ2U6IHN0YXRlX2NoYW5nZWQsCiAgICAgICAgc2hvd19qc29uX2FzX2Nzdjogc2hvd19qc29uX2FzX2NzdiwKICAgICAgICBpbml0X21hdGNoZWRfYWxlcnRzX3RhYmxlOiBpbml0X21hdGNoZWRfYWxlcnRzX3RhYmxlLAogICAgICAgIGdldFNpZ25hbE5hbWVMaXN0OiBnZXRTaWduYWxOYW1lTGlzdCwKICAgICAgICBpbml0aWFsaXplU2hhcmVXaXRoU2VsZWN0MiA6IGluaXRpYWxpemVTaGFyZVdpdGhTZWxlY3QyLAogICAgICAgIGluaXRpYWxpemVTaGFyZVdpdGhWYWx1ZXM6aW5pdGlhbGl6ZVNoYXJlV2l0aFZhbHVlcywKICAgICAgICBnZXRfdGFnc19lbGVtZW50IDogZ2V0VGFnc0VsZW1lbnQKICAgIH0KfSkoKTsKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CgpzaWduYWwubGlzdF91dGlscyA9IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgZmxhZ19pdCA9IGZ1bmN0aW9uIChmbGFnLCBpZCkgewogICAgICAgIHZhciB0aGVIdG1sID0gJzxpIGNsYXNzPSJmYSBmYS1mbGFnLW8gdGV4dC1tdXRlZCByeC1saXN0LWZsYWciIGRhdGEtaWQ9IicgKyBpZCArICciPjwvaT4nCiAgICAgICAgaWYgKGZsYWcpIHsKICAgICAgICAgICAgdGhlSHRtbCA9ICc8aSBjbGFzcz0iZmEgZmEtZmxhZyB0ZXh0LXByaW1hcnkgcngtbGlzdC1mbGFnIiBkYXRhLWlkPSInICsgaWQgKyAnIj48L2k+JwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhlSHRtbAogICAgfTsKCiAgICB2YXIgZmxhZ19oYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRyb2xsZXIsIGFjdGlvbikgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcucngtbGlzdC1mbGFnJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIGVsZSA9IGUudGFyZ2V0OwogICAgICAgICAgICB2YXIgaWQgPSAkKGVsZSkuYXR0cignZGF0YS1pZCcpOwoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogIi9zaWduYWwvIiArIGNvbnRyb2xsZXIgKyAiLyIgKyBhY3Rpb24gKyAiP2lkPSIgKyBpZCwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmZsYWdnZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLnJlbW92ZUNsYXNzKCdmYS1mbGFnLW8nKS5yZW1vdmVDbGFzcygndGV4dC1tdXRlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkuYWRkQ2xhc3MoJ2ZhLWZsYWcnKS5hZGRDbGFzcygndGV4dC1wcmltYXJ5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLmFkZENsYXNzKCdmYS1mbGFnLW8nKS5hZGRDbGFzcygndGV4dC1tdXRlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkucmVtb3ZlQ2xhc3MoJ2ZhLWZsYWcnKS5yZW1vdmVDbGFzcygndGV4dC1wcmltYXJ5JykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIHByaW9yaXR5X2xpbmsgPSBmdW5jdGlvbiAocHJpb3JpdHksIGlkKSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gY29tcG9zZV9wcmlvcml0eV9pY29uKHByaW9yaXR5KTsKICAgICAgICByZXR1cm4gJzxhIGhyZWY9IiMiIGNsYXNzPSJjaGFuZ2UtcHJpb3JpdHkiPjxpbWcgZGF0YS1maWVsZD0icHJpb3JpdHkiIGRhdGEtaW5mbz0icm93IiBkYXRhLWlkPSInICsKICAgICAgICAgICAgaWQgKyAnIiBkYXRhLXZhbHVlPSInICsgcHJpb3JpdHkgKyAnIiBzcmM9IicgKyBpY29uX3VybCArICciLz48L2E+JwogICAgfTsKCiAgICB2YXIgY29tcG9zZV9wcmlvcml0eV9pY29uID0gZnVuY3Rpb24gKHByaW9yaXR5KSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gIi9zaWduYWwvYXNzZXRzL2ljb25zL2RlZmF1bHRfcHJpb3JpdHkucG5nIjsKCiAgICAgICAgaWYgKF8uY29udGFpbnMoWydoaWdoJywgJ2xvdycsICdtZWRpdW0nXSwgcHJpb3JpdHkudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgICAgICAgaWNvbl91cmwgPSAiL3NpZ25hbC9hc3NldHMvaWNvbnMvIiArIHByaW9yaXR5LnRvTG93ZXJDYXNlKCkgKyAiX3ByaW9yaXR5LnBuZyI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpY29uX3VybDsKICAgIH07CgogICAgdmFyIGNoYW5nZV9wcmlvcml0eSA9IGZ1bmN0aW9uIChwcmlvcml0eUVsZSwgcHJpb3JpdHkpIHsKICAgICAgICB2YXIgaWNvbl91cmwgPSBjb21wb3NlX3ByaW9yaXR5X2ljb24ocHJpb3JpdHkpOwogICAgICAgICQocHJpb3JpdHlFbGUpLmF0dHIoInNyYyIsIGljb25fdXJsKTsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJkYXRhLXZhbHVlIiwgcHJpb3JpdHkpOwogICAgfTsKCiAgICB2YXIgY2hhbmdlX3ByaW9yaXR5VGVzdCA9IGZ1bmN0aW9uIChwcmlvcml0eUVsZSwgcHJpb3JpdHkpIHsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJkYXRhLXZhbHVlIiwgcHJpb3JpdHkpOwogICAgfTsKCiAgICBjaGFuZ2VfcHJpb3JpdHlUZXN0CgogICAgdmFyIGZpbmRfZmllbGQgPSBmdW5jdGlvbiAodGFibGVfcm93X2VsZSwgYXR0cl9uYW1lKSB7CiAgICAgICAgcmV0dXJuICQodGFibGVfcm93X2VsZSkuZmluZCgiW2RhdGEtYXR0cmlidXRlLW5hbWU9JyIgKyBhdHRyX25hbWUgKyAiJ10iKQogICAgfTsKCiAgICB2YXIgc2V0X3ZhbHVlID0gZnVuY3Rpb24gKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSwgaWQsIGRhdGFfZnVuLCBhcHBfbmFtZSkgewogICAgICAgIHZhciBlbGUgPSBmaW5kX2ZpZWxkKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSk7CiAgICAgICAgZWxlLmh0bWwoZGF0YV9mdW4oaWQsIGFwcF9uYW1lKSk7CiAgICB9OwoKICAgIHZhciBnZXRfZHVlX2luID0gZnVuY3Rpb24gKGlkLCBhcHBfbmFtZSkgewogICAgICAgIHZhciBkdWVJbiA9IDA7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydC9kdWVJbj9hbGVydElkPSIgKyBpZCArICImYXBwTmFtZT0iICsgYXBwX25hbWUsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIGR1ZUluID0gZGF0YS5yZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZHVlSW4KICAgIH07CgogICAgdmFyIGR1ZV9pbl9jb21wID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlIDw9IDApIHsKICAgICAgICAgICAgcmV0dXJuICI8ZGl2IGRhdGEtYXR0cmlidXRlLW5hbWU9J2R1ZUluJyBzdHlsZSA9ICdjb2xvcjpyZWQnPiIgKyB2YWx1ZSArICI8L2Rpdj4iOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAiPGRpdiBkYXRhLWF0dHJpYnV0ZS1uYW1lPSdkdWVJbic+IiArIHZhbHVlICsgIjwvZGl2PiI7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgYXNzaWduZWRfdG9fY29tcCA9IGZ1bmN0aW9uIChpZCwgYXNzaWduZWRUbykgewogICAgICAgIHZhciBodG1sID0gJzxkaXYgY2xhc3M9ImFzc2lnbmVkVG9Db250YWluZXIiPjxzZWxlY3QgY2xhc3M9ImFzc2lnbmVkVG9TZWxlY3QgZm9ybS1jb250cm9sIHNlbGVjdDIiPjwvc2VsZWN0PjxpIGNsYXNzPSJtZGkgbWRpLXNwaW4gbWRpLWxvYWRpbmcgYXNzaWduVG9Qcm9jZXNzaW5nIiBzdHlsZT0iZGlzcGxheTogbm9uZSI+PC9pPjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIGh0bWwKICAgIH07CgogICAgdmFyIHRydW5jYXRlVGV4dEFuZFNob3dUb29sdGlwID0gZnVuY3Rpb24gKGN1dG9mZiwgd29yZGJyZWFrLCBlc2NhcGVIdG1sKSB7CiAgICAgICAgdmFyIGVzYyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgIC8vIE9yZGVyLCBzZWFyY2ggYW5kIHR5cGUgZ2V0IHRoZSBvcmlnaW5hbCBkYXRhCiAgICAgICAgICAgIGlmICh0eXBlICE9PSAnZGlzcGxheScpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIGQgIT09ICdudW1iZXInICYmIHR5cGVvZiBkICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGQgPSBkLnRvU3RyaW5nKCk7IC8vIGNhc3QgbnVtYmVycwoKICAgICAgICAgICAgaWYgKGQubGVuZ3RoIDw9IGN1dG9mZikgewogICAgICAgICAgICAgICAgcmV0dXJuIGVzYyhkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHNob3J0ZW5lZCA9IGQuc3Vic3RyKDAsIGN1dG9mZiAtIDEpOwoKICAgICAgICAgICAgLy8gRmluZCB0aGUgbGFzdCB3aGl0ZSBzcGFjZSBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZwogICAgICAgICAgICBpZiAod29yZGJyZWFrKSB7CiAgICAgICAgICAgICAgICBzaG9ydGVuZWQgPSBzaG9ydGVuZWQucmVwbGFjZSgvXHMoW15cc10qKSQvLCAnJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFByb3RlY3QgYWdhaW5zdCB1bmNvbnRyb2xsZWQgSFRNTCBpbnB1dAogICAgICAgICAgICBpZiAoZXNjYXBlSHRtbCkgewogICAgICAgICAgICAgICAgc2hvcnRlbmVkID0gZXNjKHNob3J0ZW5lZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9ImVsbGlwc2lzIiB0aXRsZT0iJyArIGVzYyhkKSArICciPicgKyBzaG9ydGVuZWQgKyAnJiM4MjMwOzwvc3Bhbj4nOwogICAgICAgIH07CiAgICB9OwoKICAgIHZhciBhZGRfZmlsdGVycyA9IGZ1bmN0aW9uICh0YWJsZSwgZmlsdGVycywgZmlsdGVyX3RvZ2dsZV9idF9jb250YWluZXIpIHsKCiAgICAgICAgdmFyIHlhZGNmX2ZpbHRlcnMgPSBfLmZpbHRlcihmaWx0ZXJzLCBmdW5jdGlvbiAoZikgewogICAgICAgICAgICBpZiAoZlsxXSAhPSAnY3VzdG9taXplZCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBjdXN0X2ZpbHRlcnMgPSBfLmRpZmZlcmVuY2UoZmlsdGVycywgeWFkY2ZfZmlsdGVycyk7CgogICAgICAgIHlhZGNmLmluaXQodGFibGUsIF8ubWFwKHlhZGNmX2ZpbHRlcnMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtWzJdID09IHRydWUpCiAgICAgICAgICAgICAgICByZXR1cm4ge2NvbHVtbl9udW1iZXI6IGl0ZW1bMF0sIGZpbHRlcl90eXBlOiBpdGVtWzFdLCBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6ICd4J307CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiB7Y29sdW1uX251bWJlcjogaXRlbVswXSwgZmlsdGVyX3R5cGU6IGl0ZW1bMV0sIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2V9OwogICAgICAgIH0pKTsKCiAgICAgICAgaWYgKGZpbHRlcl90b2dnbGVfYnRfY29udGFpbmVyKSB7CiAgICAgICAgICAgIGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbignaWR4eHh4eHgnLCBmaWx0ZXJfdG9nZ2xlX2J0X2NvbnRhaW5lcik7CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VzdF9maWx0ZXJzKSB7CiAgICAgICAgICAgIF8uZWFjaChjdXN0X2ZpbHRlcnMsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAkKHRhYmxlLmNvbHVtbihmWzBdKS5oZWFkZXIoKSkuYXBwZW5kKGNyZWF0ZV9zdGFja2VkX2ZpbHRlcihmWzBdKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNyZWF0ZV9zdGFja2VkX2ZpbHRlciA9IGZ1bmN0aW9uIChpZHgpIHsKICAgICAgICByZXR1cm4gJCgiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtaW5kZXg9JyIgKyBpZHggKyAiJyBjbGFzcz0nY29sdW1uLWZpbHRlcicgcGxhY2Vob2xkZXI9J1R5cGUgdG8gZmlsdGVyJz4iICsKICAgICAgICAgICAgIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLWluZGV4PSciICsgaWR4ICsgIicgY2xhc3M9J2NvbHVtbi1maWx0ZXInIHBsYWNlaG9sZGVyPSdUeXBlIHRvIGZpbHRlcic+Iik7CiAgICB9OwoKICAgIHZhciBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b24gPSBmdW5jdGlvbiAodGFibGVfaWQsIGNvbnRhaW5lcikgewogICAgICAgICQoJy55YWRjZi1maWx0ZXItd3JhcHBlciwgLmNvbHVtbi1maWx0ZXInKS5oaWRlKCk7CiAgICAgICAgJCgnLmNvbHVtbi1maWx0ZXInKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgJCgnLmNvbHVtbi1maWx0ZXInKS5vbigna2V5dXAnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIC8vIFBlcmZvcm0gc2VhcmNoCiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuZGF0YSgnaW5kZXgnKTsKICAgICAgICAgICAgJCh0YWJsZV9pZCkuRGF0YVRhYmxlKCkuY29sdW1uKGluZGV4KS5zZWFyY2goJCh0aGlzKS52YWwoKSkuZHJhdygpOwogICAgICAgIH0pOwogICAgICAgIHZhciBmaWx0ZXJUb2dnbGUgPSAiPGkgY2xhc3M9J3RhYmxlLWZpbHRlci10b2dnbGUgZ2x5cGhpY29uIGdseXBoaWNvbi1maWx0ZXInIGRhdGEtdGFibGU9JyIgKyB0YWJsZV9pZCArCiAgICAgICAgICAgICInIG9uY2xpY2s9J3NpZ25hbC5saXN0X3V0aWxzLmhhbmRsZV9maWx0ZXJfdG9nZ2xlJyBkYXRhLXNob3ctZmlsdGVyPSd0cnVlJz48L2k+IjsKICAgICAgICB2YXIgdG9nZ2xlX2J1dHRvbiA9ICQucGFyc2VIVE1MKGZpbHRlclRvZ2dsZSk7CiAgICAgICAgaWYgKCEoXy5pc1VuZGVmaW5lZChjb250YWluZXIpICYmIF8uaXNOdWxsKGNvbnRhaW5lcikpKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQodG9nZ2xlX2J1dHRvbik7CiAgICAgICAgfQoKICAgICAgICAkKGRvY3VtZW50KS5vbignZmlsdGVyLXRvZ2dsZS1pbml0JywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAkKCcudGFibGUtZmlsdGVyLXRvZ2dsZScpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBoaWRlX3Nob3dfZml0bGVyID0gZnVuY3Rpb24gKHRhYmxlSWQsIGhpZGVPclNob3cpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGlkZU9yU2hvdyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0YWJsZUlkICsgJ193cmFwcGVyIC55YWRjZi1maWx0ZXItd3JhcHBlciwuY29sdW1uLWZpbHRlcicpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRhYmxlSWQgKyAnX3dyYXBwZXIgLnlhZGNmLWZpbHRlci13cmFwcGVyLC5jb2x1bW4tZmlsdGVyJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIHRhcmdldEZpbHRlclRvZ2dsZSA9ICQoZXZ0LnRhcmdldCk7CiAgICAgICAgICAgICAgICB2YXIgdGFibGVJZCA9IHRhcmdldEZpbHRlclRvZ2dsZS5kYXRhKCd0YWJsZScpOwogICAgICAgICAgICAgICAgdmFyIHNob3dGaWx0ZXIgPSB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvdy1maWx0ZXInKTsKICAgICAgICAgICAgICAgIGlmIChzaG93RmlsdGVyID09PSAndHJ1ZScpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvd0ZpbHRlcicsICdmYWxzZScpOwogICAgICAgICAgICAgICAgICAgIGhpZGVfc2hvd19maXRsZXIodGFibGVJZCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvd0ZpbHRlcicsICd0cnVlJyk7CiAgICAgICAgICAgICAgICAgICAgaGlkZV9zaG93X2ZpdGxlcih0YWJsZUlkLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgICQoZG9jdW1lbnQpLnRyaWdnZXIoJ2ZpbHRlci10b2dnbGUtaW5pdCcpOwogICAgICAgIHJldHVybiAkKHRvZ2dsZV9idXR0b24pOwogICAgfTsKCiAgICB2YXIgaGFuZGxlX2ZpbHRlcl90b2dnbGUgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgJCh0aGlzKS5hdHRyKCd0YXJnZXQtdGFibGUnKTsKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBmbGFnX2l0OiBmbGFnX2l0LAogICAgICAgIGZsYWdfaGFuZGxlcjogZmxhZ19oYW5kbGVyLAogICAgICAgIHByaW9yaXR5X2xpbms6IHByaW9yaXR5X2xpbmssCiAgICAgICAgY2hhbmdlX3ByaW9yaXR5OiBjaGFuZ2VfcHJpb3JpdHksCiAgICAgICAgZmluZF9maWVsZDogZmluZF9maWVsZCwKICAgICAgICBzZXRfdmFsdWU6IHNldF92YWx1ZSwKICAgICAgICBnZXRfZHVlX2luOiBnZXRfZHVlX2luLAogICAgICAgIGR1ZV9pbl9jb21wOiBkdWVfaW5fY29tcCwKICAgICAgICBhc3NpZ25lZF90b19jb21wOiBhc3NpZ25lZF90b19jb21wLAogICAgICAgIHRydW5jYXRlVGV4dEFuZFNob3dUb29sdGlwOiB0cnVuY2F0ZVRleHRBbmRTaG93VG9vbHRpcCwKICAgICAgICBhZGRfZmlsdGVyczogYWRkX2ZpbHRlcnMsCiAgICAgICAgaGFuZGxlX2ZpbHRlcl90b2dnbGU6IGhhbmRsZV9maWx0ZXJfdG9nZ2xlLAogICAgICAgIGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbjogYWRkX2ZpbHRlcl90b2dnbGVfYnV0dG9uCiAgICB9Cn0pKCk7CnZhciBzaWduYWwgPSBzaWduYWwgfHwge30KCnNpZ25hbC5hY3Rpdml0aWVzX3V0aWxzID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIGFjdGl2aXR5X3RhYmxlOwogICAgdmFyIHNvcnRpbmdDb3VudCA9IDM7CgogICAgdmFyIGluaXRfYWN0aXZpdGllc190YWJsZSA9IGZ1bmN0aW9uKHRhYmxlLCB1cmwsIGFwcFR5cGUpIHsKICAgICAgICB2YXIgY29sdW1ucyA9IGNyZWF0ZV9hY3Rpdml0eV9jb2x1bW5fZGF0YShhcHBUeXBlKTsKICAgICAgICBhY3Rpdml0eV90YWJsZSA9ICQodGFibGUpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICJzUGFnaW5hdGlvblR5cGUiOiAiYm9vdHN0cmFwIiwKCiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgICAgICB9LAogICAgICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJCgnYVtocmVmPSIjYWN0aXZpdGllcyJdJykub24oInNob3duLmJzLnRhYiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGl2aXRpZXNUYWJsZScpLkRhdGFUYWJsZSgpLmFqYXgudXJsKGdldEFjdGl2aXR5VXJsKCkpLmxvYWQoKTsKICAgICAgICAgICAgICAgICAgICBhZGRHcmlkU2hvcnRjdXRzKCcjYWN0aXZpdGllc1RhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlR3JpZFNob3J0Y3V0cygnI2FsZXJ0c0RldGFpbHNUYWJsZScpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUdyaWRTaG9ydGN1dHMoJyNhcmNoaXZlZEFsZXJ0c1RhYmxlJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFhU29ydGluZyI6IFtbc29ydGluZ0NvdW50LCAiZGVzYyJdXSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiAxMCwKICAgICAgICAgICAgImJBdXRvV2lkdGgiOiBmYWxzZSwKICAgICAgICAgICAgImFvQ29sdW1ucyI6IGNvbHVtbnMsCiAgICAgICAgICAgICJzY3JvbGxYIjogdHJ1ZSwKICAgICAgICAgICAgInNjcm9sbFkiOiJjYWxjKDEwMHZoIC0gMzAxcHgpIiwKICAgICAgICAgICAgImF1dG9XaWR0aCI6dHJ1ZSwKICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gYWN0aXZpdHlfdGFibGU7CiAgICB9OwoKICAgIHZhciBjcmVhdGVfYWN0aXZpdHlfY29sdW1uX2RhdGEgPSBmdW5jdGlvbihhcHBUeXBlKSB7CiAgICAgICAgdmFyIGFvQ29sdW1ucyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInR5cGUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICBpZihyb3cudHlwZT09J1BFQ0Rpc3NvY2lhdGVkJyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUEVDIERpc3NvY2lhdGVkJwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihyb3cudHlwZT09J1BFQ0Fzc29jaWF0ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUEVDIEFzc29jaWF0ZWQnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMuYnJlYWtJdChyb3cudHlwZSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZGV0YWlscyIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJvdy5kZXRhaWxzID0gcm93LmRldGFpbHMucmVwbGFjZSgvPGJyPi9nLCdcbicpCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5qdXN0aWZpY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPHNwYW4gY2xhc3M9J3dvcmQtd3JhcC1icmVhay13b3JkJz4iK2VzY2FwZUhUTUwocm93LmRldGFpbHMpICsgIiAtLSB3aXRoIEp1c3RpZmljYXRpb24gJyIgKyBlc2NhcGVIVE1MKHJvdy5qdXN0aWZpY2F0aW9uKSArICInIisiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlc2NyaXB0aW9uVGV4dCA9IHByb2Nlc3NfZGVzY3JpcHRpb24ocm93LmRldGFpbHMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCBjZWxsLWJyZWFrJz4iK2Rlc2NyaXB0aW9uVGV4dCsiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0yMDAgY29sLW1heC0zMDAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwZXJmb3JtZWRCeSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICBpZihyb3cucGVyZm9ybWVkQnlEZXB0ICYmIHJvdy5wZXJmb3JtZWRCeURlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwocm93LnBlcmZvcm1lZEJ5ICsgIiAoIiArIHJvdy5wZXJmb3JtZWRCeURlcHQgKyAiKSIpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93LnBlcmZvcm1lZEJ5CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aW1lc3RhbXAiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbihkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfQogICAgICAgIF07CiAgICAgICAgaWYoYXBwVHlwZSA9PSAnU2luZ2xlIENhc2UgQWxlcnQnKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMCwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlTnVtYmVyIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDIsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3VzcGVjdCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMjAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgzLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImV2ZW50TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg1LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImN1cnJlbnRBc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyQXNzaWdubWVudAogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICYmIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSByb3cuY3VycmVudEFzc2lnbm1lbnQgKyAiICgiICsgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCArICIpIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gKHJvdy5jdXJyZW50QXNzaWdubWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwoY3VyckFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvcnRpbmdDb3VudCA9IDcKICAgICAgICB9ZWxzZSBpZihhcHBUeXBlID09ICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCcpIHsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgwLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImFydGljbGVJZCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgyLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInNlYXJjaFN0cmluZyIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgzLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInByb2R1Y3ROYW1lIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0yMDAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDQsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZXZlbnROYW1lIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDYsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY3VycmVudEFzc2lnbm1lbnQiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJBc3NpZ25tZW50CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgJiYgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyQXNzaWdubWVudCA9IHJvdy5jdXJyZW50QXNzaWdubWVudCArICIgKCIgKyByb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICsgIikiCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSAocm93LmN1cnJlbnRBc3NpZ25tZW50KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXNjYXBlSFRNTChjdXJyQXNzaWdubWVudCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc29ydGluZ0NvdW50ID0gOAogICAgICAgIH0gZWxzZSBpZiAoYXBwVHlwZSA9PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnIHx8IGFwcFR5cGUgPT0gJ0VWREFTIEFsZXJ0JykgewogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDEsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3VzcGVjdCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgyLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImV2ZW50TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg0LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImN1cnJlbnRBc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyQXNzaWdubWVudAogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICYmIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSByb3cuY3VycmVudEFzc2lnbm1lbnQgKyAiICgiICsgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCArICIpIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gKHJvdy5jdXJyZW50QXNzaWdubWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwoY3VyckFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvcnRpbmdDb3VudCA9IDYKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFvQ29sdW1ucwogICAgfTsKCiAgICB2YXIgcmVsb2FkX2FjdGl2aXR5X3RhYmxlID0gZnVuY3Rpb24oKSB7CgogICAgICAgIGlmICh0eXBlb2YgYWN0aXZpdHlfdGFibGUgIT0gInVuZGVmaW5lZCIgJiYgYWN0aXZpdHlfdGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICBhY3Rpdml0eV90YWJsZS5hamF4LnJlbG9hZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJVbmFibGUgdG8gcmVsb2FkIHRoZSBhY3Rpdml0eSB0YWJsZS4gUGxlYXNlIHJlZnJlc2ggdGhlIHBhZ2UuIikKICAgICAgICB9CgogICAgfTsKCiAgICB2YXIgcHJvY2Vzc19kZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKGRlc2NyaXB0aW9uU3RyKSB7CiAgICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdGlvblN0ciAhPSAidW5kZWZpbmVkIiAmJiBkZXNjcmlwdGlvblN0ciAhPSBudWxsKSB7CiAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbnMgPSBkZXNjcmlwdGlvblN0ci5zcGxpdCgnfCcpOwogICAgICAgICAgICAvL3ZhciBmb3JtYXR0ZWRTdHJpbmcgPSAnJwogICAgICAgICAgICB2YXIgZm9ybWF0dGVkU3RyaW5nID0gIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4PGRlc2NyaXB0aW9ucy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uc1tpbmRleF07CiAgICAgICAgICAgICAgICB2YXIgZGVzY1NwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICBkZXNjU3Bhbi5pbm5lckhUTUwgPSBlc2NhcGVIVE1MKGRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgICAgIGRlc2NTcGFuLmlubmVySFRNTCA9IGRlc2NTcGFuLmlubmVySFRNTC5yZXBsYWNlKC9cbi9nLCAnPGJyPicpCiAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTdHJpbmcuYXBwZW5kQ2hpbGQoZGVzY1NwYW4pOwogICAgICAgICAgICAgICAgZm9ybWF0dGVkU3RyaW5nLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRTdHJpbmcuaW5uZXJIVE1MOwogICAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBpbml0X2FjdGl2aXRpZXNfdGFibGUgOiBpbml0X2FjdGl2aXRpZXNfdGFibGUsCiAgICAgICAgcHJvY2Vzc19kZXNjcmlwdGlvbiA6IHByb2Nlc3NfZGVzY3JpcHRpb24sCiAgICAgICAgcmVsb2FkX2FjdGl2aXR5X3RhYmxlIDogcmVsb2FkX2FjdGl2aXR5X3RhYmxlCiAgICB9Cn0pKCk7CgpmdW5jdGlvbiBnZXRBY3Rpdml0eVVybCgpIHsKICAgIGlmIChhcHBsaWNhdGlvbk5hbWUgPT09IEFMRVJUX0NPTkZJR19UWVBFLkxJVEVSQVRVUkVfU0VBUkNIX0FMRVJUKSB7CiAgICAgICAgcmV0dXJuIGFsZXJ0QWN0aXZpdGllczsKICAgIH0gZWxzZSBpZiAoYXBwbGljYXRpb25OYW1lID09PSBBTEVSVF9DT05GSUdfVFlQRS5TSUdOQUxfTUFOQUdFTUVOVCkgewogICAgICAgIHJldHVybiBhY3Rpdml0eVVybDsKICAgIH0KICAgIHJldHVybiBhbGVydEFjdGl2aXRpZXNVcmwgKyBlbmNvZGVVUkkoJz9leGVjdXRlZElkTGlzdD0nICsgZXhlY3V0ZWRJZExpc3QgKyAiJmFwcFR5cGU9IiArIGFwcGxpY2F0aW9uTmFtZSkKCn0KCgp2YXIgc2hvd1RvcGljV2lkZ2V0ID0gZnVuY3Rpb24gKCkgewogICAgJCgiI3RvcGljIikuc2VsZWN0Mih7CiAgICAgICAgdGFnczogdHJ1ZSwKICAgICAgICBwbGFjZWhvbGRlcjogIlNlbGVjdCB0b3BpYyIsCiAgICAgICAgYWxsb3dDbGVhcjogdHJ1ZSwKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGNyZWF0ZVRhZzogZnVuY3Rpb24gKHBhcmFtcykgewogICAgICAgICAgICB2YXIgdGVybSA9ICQudHJpbShwYXJhbXMudGVybSk7CiAgICAgICAgICAgIGlmICh0ZXJtICE9ICIiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiB0ZXJtLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IHRlcm0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0KICAgIH0pOwp9OwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9jb21tb24uanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfbGlzdF91dGlscy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9oYW5kbGViYXJfZXh0LmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvdG9waWMvYXR0YWNoQWxlcnRUb1RvcGljLmpzCgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKdmFyIHRvcGljRGF0YTsKdmFyIGNvbHVtblNlcTsKdmFyIGlzVmlld0luc3RhbmNlID0gMTsKdmFyIHNpZ25hbEFsZXJ0VHlwZSA9IHsKICAgIFNJTkdMRV9DQVNFX0FMRVJUOiAiU2luZ2xlIENhc2UgQWxlcnQiLAogICAgQUdHUkVHQVRFX0FMRVJUOiAiQWdncmVnYXRlIENhc2UgQWxlcnQiLAogICAgRVZEQVNfQUxFUlQ6ICJFdmRhcyBBbGVydCIsCiAgICBBREhPQ19BTEVSVDogIkFkLUhvYyBBbGVydCIsCiAgICBMSVRFUkFUVVJFX1NFQVJDSF9BTEVSVDogIkxpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0Igp9CgpzaWduYWwuYWxlcnRSZXZpZXcgPSAoZnVuY3Rpb24gKCkgewoKICAgIHZhciBpZHMgPSBbXTsKICAgIHZhciByb3dzID0gW107CgogICAgdmFyIGFwcGx5QnVzaW5lc3NSdWxlcyA9IGZ1bmN0aW9uIChyb3csIGRhdGEpIHsKICAgICAgICAvL0FwcGx5IHRoZSBldWRyYSBydWxlcy4KICAgICAgICBpZiAoZGF0YS5mb3JtYXQpIHsKICAgICAgICAgICAgdmFyIGZvcm1hdHMgPSBKU09OLnBhcnNlKGRhdGEuZm9ybWF0KTsKICAgICAgICAgICAgJC5lYWNoKGZvcm1hdHMsIGZ1bmN0aW9uIChpbmR4LCBmb3JtYXQpIHsKICAgICAgICAgICAgICAgIHZhciBvYmogPSBmb3JtYXQ7CiAgICAgICAgICAgICAgICB2YXIgdGV4dE9iajsKICAgICAgICAgICAgICAgICQuZWFjaChvYmoudGV4dC50YywgZnVuY3Rpb24gKGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dE9iaiA9ICQocm93KS5maW5kKCcuJyArIGRhdGEpOwogICAgICAgICAgICAgICAgICAgIHRleHRPYmouY3NzKCdjb2xvcicsIG9iai50ZXh0LmNvbG9yKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnRleHQuYm9sZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygnZm9udC13ZWlnaHQnLCAnOTAwJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvYmoudGV4dC5pdGFsaWMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dE9iai5jc3MoJ2ZvbnQtc3R5bGUnLCAnaXRhbGljJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvYmoudGV4dC51bmRlcmxpbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dE9iai5jc3MoJ3RleHQtZGVjb3JhdGlvbicsICd1bmRlcmxpbmUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQuZWFjaChvYmouY2VsbC50YywgZnVuY3Rpb24gKGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgJChyb3cpLmZpbmQoJy4nICsgZGF0YSkucGFyZW50cygndGQnKS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBvYmouY2VsbC5jb2xvcik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgZW5hYmxlTWVudVRvb2x0aXBzID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoIi5ncmlkLW1lbnUtdG9vbHRpcCIpLm1vdXNlb3ZlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgICAgIHZhciB0b29sdGlwVGV4dCA9ICR0aGlzLmF0dHIoImRhdGEtdGl0bGUiKTsKICAgICAgICAgICAgJHRoaXMudG9vbHRpcCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdG9vbHRpcFRleHQsCiAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICJib3R0b20iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkdGhpcy50b29sdGlwKCdzaG93Jyk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBkaXNhYmxlVG9vbHRpcHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgiLm1kaS1hbHBoYS1kLWJveCwgLm1kaS1maWx0ZXItb3V0bGluZSwgLm1kaS10cmVuZGluZy11cCwgLm1kaS1jb250ZW50LXNhdmUsIC5tZGktZXhwb3J0LCAubWRpLXNldHRpbmdzLCBtZGktcGx1cy1ib3gsIG1kaS1jaGFydC1iYXIiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoIi50b29sdGlwIikuaGlkZSgpOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgc29ydEljb25IYW5kbGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0aEFycmF5ID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLmNvbHVtbnMoKS5oZWFkZXIoKTsKICAgICAgICBpZiAoaXNWaWV3SW5zdGFuY2UpIHsKICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWU7CiAgICAgICAgICAgIHZhciBpbmRleE9mQ29sdW1uID0gMDsKICAgICAgICAgICAgY29sdW1uU2VxLmV2ZXJ5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZXEgPSBjb2x1bW5TZXFbaW5kZXhPZkNvbHVtbl0uc2VxOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IHNlcSkgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbk5hbWUgPSBjb2x1bW5TZXFbaW5kZXhPZkNvbHVtbl0ubmFtZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbmRleE9mQ29sdW1uKys7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBjb2x1bW5JbmRleCA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5maW5kKCJ0aFtkYXRhLWZpZWxkPSIgKyBjb2x1bW5OYW1lICsgIl0iKS5hdHRyKCdkYXRhLWNvbHVtbi1pbmRleCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbHVtbkluZGV4ID0gaW5kZXg7CiAgICAgICAgfQogICAgICAgICQuZWFjaCh0aEFycmF5LCBmdW5jdGlvbiAoY3VycmVudEluZGV4LCBlbGVtZW50KSB7CiAgICAgICAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19hc2MnKSkgewogICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nX2FzYycpOwogICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3NvcnRpbmdfZGVzYycpKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NvcnRpbmdfZGVzYycpOwogICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGN1cnJlbnRJbmRleCA9PSBjb2x1bW5JbmRleCAmJiAhZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3NvcnRpbmdfZGlzYWJsZWQnKSkgewogICAgICAgICAgICAgICAgaWYgKGRpciA9PSAnYXNjJykgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc29ydGluZycpOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgic29ydGluZ19hc2MiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlyID09ICdkZXNjJykgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc29ydGluZycpOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgic29ydGluZ19kZXNjIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgLyoqCiAgICAgKiBUaGUgcmVzZXQgbW9kYWwgc2NyZWVuIGZ1bmN0aW9uIHdoaWNoIHJlc2V0cyB0aGUgcGFzc3dvcmQgZGl2IGluIHRoZSB3b3JrZmxvdyBtb2RhbCBzY3JlZW4uCiAgICAgKiBUaGlzIGlzIGludGVybmFsIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBpbnRlcm5hbGx5IGluIHRoaXMgb2JqZWN0IHNjb3BlLgogICAgICovCiAgICB2YXIgcmVzZXRNb2RhbFNjcmVlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAvL0NsZWFuIHVwIHRoZSB0aGUgZGlzcG9zaXRpb25zIGZpZWxkcy4KICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNleHRyYS12YWx1ZS1zZWxlY3QnKS5odG1sKCI8b3B0aW9uPjwvb3B0aW9uPiIpOwogICAgICAgIC8vSGlkZSB0aGUgcGFzc3dvcmQKICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNwYXNzd29yZERpdicpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjaXNQYXNzd29yZEVuYWJsZWQnKS52YWwoMCk7CiAgICB9CgogICAgdmFyIHNob3dQYXNzd29yZEZpZWxkID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI3Bhc3N3b3JkRGl2JykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNpc1Bhc3N3b3JkRW5hYmxlZCcpLnZhbCgxKTsKICAgIH0KCiAgICB2YXIgY2hhbmdlV29ya2Zsb3dFZGl0U2NyZWVuID0gZnVuY3Rpb24gKGF2YWlsYWJsZVZhbHVlcywgdGFyZ2V0VmFsKSB7CgogICAgICAgIHZhciBhdmFpbGFibGVWYWxPYmogPSBfLmZpbmRXaGVyZShhdmFpbGFibGVWYWx1ZXMsIHt2YWx1ZTogdGFyZ2V0VmFsfSk7CgogICAgICAgIGlmICh0eXBlb2YgYXZhaWxhYmxlVmFsT2JqICE9ICd1bmRlZmluZWQnICYmIGF2YWlsYWJsZVZhbE9iaikgewogICAgICAgICAgICBpZiAoYXZhaWxhYmxlVmFsT2JqLmFwcHJvdmFsUmVxdWlyZWQpIHsKICAgICAgICAgICAgICAgIHNob3dQYXNzd29yZEZpZWxkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXNldE1vZGFsU2NyZWVuKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vQ2xlYW4gdXAgdGhlIHRoZSBkaXNwb3NpdGlvbnMgZmllbGRzCiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2V4dHJhLXZhbHVlLXNlbGVjdCcpLmh0bWwoJycpCgogICAgICAgICAgICAvL0ZpbGwgdXAgdGhlIGRpc3Bvc2l0aW9ucyBpbiB0aGUgY29tYm8KICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjZXh0cmEtdmFsdWUtc2VsZWN0JykuaHRtbChnZXREaXNwb3NpdGlvbk9wdGlvbnMoYXZhaWxhYmxlVmFsT2JqKSkKICAgICAgICB9CiAgICB9CgogICAgdmFyIGdldERpc3Bvc2l0aW9uT3B0aW9ucyA9IGZ1bmN0aW9uIChhdmFpbGFibGVWYWxPYmopIHsKICAgICAgICB2YXIgZGlzcG9zaXRpb25TdHIgPSAiPG9wdGlvbj48L29wdGlvbj4iOwogICAgICAgIF8uZWFjaChhdmFpbGFibGVWYWxPYmouZGlzcG9zaXRpb25zLCBmdW5jdGlvbiAoZGlzcG9zaXRpb24pIHsKICAgICAgICAgICAgZGlzcG9zaXRpb25TdHIgPSBkaXNwb3NpdGlvblN0ciArCiAgICAgICAgICAgICAgICAiPG9wdGlvbiB2YWx1ZT1cIiIgKyBkaXNwb3NpdGlvbi52YWx1ZSArICJcIj4iICsgZW5jb2RlVG9IVE1MKGRpc3Bvc2l0aW9uLmRpc3BsYXlOYW1lKSArICI8L29wdGlvbj4iCiAgICAgICAgfSkKICAgICAgICByZXR1cm4gZGlzcG9zaXRpb25TdHIKICAgIH0KCiAgICB2YXIgYXV0aGVudGljYXRlVXNlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmV0dXJuVmFsID0gZmFsc2UKICAgICAgICB2YXIgcGFzc3dvcmRKc29uID0gewogICAgICAgICAgICAicGFzc3dvcmQiOiAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNwYXNzd29yZEF1dGhlbnRpY2F0aW9uJykudmFsKCkKICAgICAgICB9CgogICAgICAgIHZhciBhdXRoVXJsID0gJy9zaWduYWwvdXNlci9hdXRoZW50aWNhdGUnCgogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogYXV0aFVybCwKICAgICAgICAgICAgZGF0YTogcGFzc3dvcmRKc29uLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYXV0aG9yaXplZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRydWUKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmV0dXJuVmFsCiAgICB9CgogICAgdmFyIHRvZ2dsZUVycm9yTm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIGlmIChhY3Rpb24gPT0gJ2hpZGUnKSB7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsIC5lcnJvck5vdGlmaWNhdGlvbicpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnLmVycm9yTWVzc2FnZScpLmh0bWwoJycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsIC5lcnJvck5vdGlmaWNhdGlvbicpLnJlbW92ZUNsYXNzKCdoaWRlJykKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcuZXJyb3JNZXNzYWdlJykuaHRtbCgnIEF1dGhlbnRpY2F0aW9uIEZhaWxlZCEnKTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBvcGVuQ2FzZUhpc3RvcnlNb2RhbCA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgLy9CaW5kIHRoZSBjbGljayBldmVudCBvbiB0aGUgY2FzZSBoaXN0b3J5IGljb24uCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jYXNlLWhpc3RvcnktaWNvbicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICBpZiAoaXNBYnN0cmFjdFZpZXdPckNhc2VWaWV3KHNlbGVjdGVkUm93SW5kZXgpKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAvIDIKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaXNTaWduYWwgPSAkKHRoaXMpLmRhdGEoJ3NpZ25hbCcpOwoKICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgICAgICBpZiAoIWlzU2lnbmFsKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZS5yb3dzKHNlbGVjdGVkUm93SW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlU2luZ2xlUmV2aWV3LnJvdygkKHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHJvd09iamVjdC5jYXNlTnVtYmVyOwogICAgICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHJvd09iamVjdC5wcm9kdWN0RmFtaWx5OwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSByb3dPYmplY3QuY2FzZVZlcnNpb247CiAgICAgICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHJvd09iamVjdC5wcm9kdWN0TmFtZTsKICAgICAgICAgICAgdmFyIHB0ID0gcm93T2JqZWN0LnByaW1hcnlFdmVudDsKICAgICAgICAgICAgdmFyIGFsZXJ0Q29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKCiAgICAgICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI2Nhc2VIaXN0b3J5TW9kYWwnKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjY2FzZU51bWJlciIpLmh0bWwoY2FzZU51bWJlcik7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3Byb2R1Y3RGYW1pbHkiKS5odG1sKHByb2R1Y3RGYW1pbHkpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNjYXNlVmVyc2lvbiIpLnZhbChjYXNlVmVyc2lvbik7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3Byb2R1Y3ROYW1lIikudmFsKHByb2R1Y3ROYW1lKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjYWxlcnRDb25maWdJZCIpLnZhbChhbGVydENvbmZpZ0lkKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjcHQiKS52YWwocHQpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLm1vZGFsKCdzaG93Jyk7CgogICAgICAgICAgICBpZih0eXBlb2Ygc2luZ2xlQ2FzZVVwZGF0ZUp1c3RpZmljYXRpb25VcmwgIT0gJ3VuZGVmaW5lZCcpCiAgICAgICAgICAgICAgICB1cGRhdGVKdXN0aWZpY2F0aW9uVXJsID0gc2luZ2xlQ2FzZVVwZGF0ZUp1c3RpZmljYXRpb25Vcmw7CgogICAgICAgICAgICBzaWduYWwuY2FzZUhpc3RvcnlUYWJsZS5pbml0X2Nhc2VfaGlzdG9yeV90YWJsZShjYXNlSGlzdG9yeVVybCk7CiAgICAgICAgICAgIHNpZ25hbC5jYXNlSGlzdG9yeVRhYmxlLmluaXRfY2FzZV9oaXN0b3J5X3RhYmxlX3N1c3BlY3QoY2FzZUhpc3RvcnlTdXNwZWN0VXJsKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5BbGVydENvbW1lbnRNb2RhbCA9IGZ1bmN0aW9uIChhbGVydFR5cGUsIGFwcGxpY2F0aW9uTmFtZSkgewoKICAgICAgICAvL01vZGFsIG9iamVjdAogICAgICAgIHZhciBjb21tZW50TW9kYWwgPSAkKCcjY29tbWVudE1vZGFsJyk7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jb21tZW50LWljb24nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIGRhdGFJbmZvOwogICAgICAgICAgICB2YXIgaXNDYXNlRGV0YWlsOwogICAgICAgICAgICB2YXIgYXBwVHlwZTsKICAgICAgICAgICAgdmFyIHZhbGlkYXRlZFNpZ25hbElkOwogICAgICAgICAgICB2YXIgY29tbWVudEFsZXJ0VHlwZSA9ICQoJHRoaXMpLmRhdGEoJ25hbWUnKTsKICAgICAgICAgICAgdmFyIGlzU2lnbmFsID0gJCgkdGhpcykuZGF0YSgnc2lnbmFsJyk7CgogICAgICAgICAgICBpZiAoY29tbWVudEFsZXJ0VHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBhbGVydFR5cGUgPSBjb21tZW50QWxlcnRUeXBlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbkFycmF5ID0gW107CiAgICAgICAgICAgIGRhdGFJbmZvID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2RhdGEtaW5mbycpOwogICAgICAgICAgICBpc0Nhc2VEZXRhaWwgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1jb21tZW50Jyk7CgogICAgICAgICAgICBhcHBUeXBlID0gJCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICBpZiAoYXBwVHlwZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgIGFwcFR5cGUgPSBjb21tZW50TW9kYWwuZmluZCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVkU2lnbmFsSWQgPSBjb21tZW50TW9kYWwuZmluZCgiI3ZhbGlkYXRlZFNpZ25hbElkIikuaHRtbCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0NvdW50OwogICAgICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93Q291bnQgPSAkKCd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VsZWN0ZWRSb3dDb3VudCA+IDEgJiYgJCgkdGhpcykuY2xvc2VzdCgndHInKS5maW5kKCIuY29weS1zZWxlY3QiKS5wcm9wKCJjaGVja2VkIikpIHsKICAgICAgICAgICAgICAgIHZhciB0ZXh0VG9EaXNwbGF5OwogICAgICAgICAgICAgICAgc3dpdGNoIChhcHBsaWNhdGlvbk5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdTaW5nbGUgQ2FzZSBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnQ2FzZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFRvRGlzcGxheSA9ICdQRUMnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdFVkRBUyBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnUEVDJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0VG9EaXNwbGF5ID0gJ0FydGljbGUnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uJykuc2hvdygpOwogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24gc3Bhbi5hbGVydFR5cGVUZXh0JykuaHRtbCh0ZXh0VG9EaXNwbGF5KTsKICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uIHNwYW4uY291bnQnKS5odG1sKHNlbGVjdGVkUm93Q291bnQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24nKS5oaWRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24gaW5wdXRbbmFtZT1idWxrT3B0aW9uc10nKS51bmJpbmQoKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc3dpdGNoICgkKHRoaXMpLnZhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWxsU2VsZWN0ZWQnOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbkFycmF5ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYXRlU2luZ2xlQnVsa1Jvd0NvbW1lbnRQcm9jZXNzKGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmluZEFkZENvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgImJ1bGsiLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdjdXJyZW50JzoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25BcnJheSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzLCBjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRBZGRDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uQXJyYXksICJyb3ciLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZGF0YUluZm8gPT09ICJyb3ciKSB7CiAgICAgICAgICAgICAgICBpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzLCBjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICBiaW5kQWRkQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbkFycmF5LCBkYXRhSW5mbywgYWxlcnRUeXBlLCB2YWxpZGF0ZWRTaWduYWxJZCwgaXNDYXNlRGV0YWlsLCAkdGhpcykKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgYmluZEFkZENvbW1lbnRzID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgZGF0YUluZm8sIGFsZXJ0VHlwZSwgdmFsaWRhdGVkU2lnbmFsSWQsIGlzQ2FzZURldGFpbCwgY3VycmVudFJvdykgewogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuYWRkLWNvbW1lbnRzIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY2FzZUpzb247CiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iajsKICAgICAgICAgICAgdmFyIGRhdGE7CiAgICAgICAgICAgIHZhciB1cmw7CiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iakFycmF5ID0gW107CiAgICAgICAgICAgIGlmIChkYXRhSW5mbyA9PT0gInJvdyIpIHsKICAgICAgICAgICAgICAgIGNhc2VKc29uID0gY2FzZUpzb25BcnJheVswXTsKCiAgICAgICAgICAgICAgICBpZiAoY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21tZW50IjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJpZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6ICQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNhc2VKc29uLmNvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBjYXNlSnNvbi5saXRlcmF0dXJlQWxlcnRJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5jb21tZW50PT0iIikgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvZGVsZXRlQ29tbWVudCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvdXBkYXRlQ29tbWVudCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvc2F2ZUNvbW1lbnQiOwoKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogY2FzZUpzb24ucHJvZHVjdE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBjYXNlSnNvbi5ldmVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdCI6IGNhc2VKc29uLnB0LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tbWVudHMiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlSnNvbi5jYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IGNhc2VKc29uLnByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBjYXNlSnNvbi5hc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogY2FzZUpzb24uYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0SWQiOiBjYXNlSnNvbi5wcm9kdWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdENvZGUiOiBjYXNlSnNvbi5wdENvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNhc2VKc29uLmNvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBjYXNlSnNvbi5saXRlcmF0dXJlQWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImFydGljbGVJZCI6IGNhc2VKc29uLmFydGljbGVJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheS5wdXNoKGNhc2VKc29uT2JqKTsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5OiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9zYXZlQ29tbWVudCI7CiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dDb3VudDsKICAgICAgICAgICAgICAgIGlmICgkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlLkRURkNfQ2xvbmVkIC5jb3B5LXNlbGVjdDpjaGVja2VkJykubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHNlbGVjdGVkUm93Q291bnQ7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZWRTaWduYWxJZCA9ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbiA9IGNhc2VKc29uQXJyYXlbaW5kZXhdOwoKICAgICAgICAgICAgICAgICAgICAvL0Nhc2UgSlNPTi4KICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogY2FzZUpzb24ucHJvZHVjdE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBjYXNlSnNvbi5ldmVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdCI6IGNhc2VKc29uLnB0LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tbWVudHMiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlSnNvbi5jYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IGNhc2VKc29uLnByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBjYXNlSnNvbi5hc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogY2FzZUpzb24uYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogY2FzZUpzb24ucHJvZHVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAicHRDb2RlIjogY2FzZUpzb24ucHRDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAiY29uZmlnSWQiOiBjYXNlSnNvbi5jb25maWdJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogY2FzZUpzb24ubGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcnRpY2xlSWQiOiBjYXNlSnNvbi5hcnRpY2xlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY2FzZUpzb24uZXhlY3V0ZWRDb25maWdJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheS5wdXNoKGNhc2VKc29uT2JqKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5OiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL1NhdmUgY29tbWVudCBjYWxsCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoImkuaXNQcm9jZXNzaW5nIikuc2hvdygpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiaS5pc1Byb2Nlc3NpbmciKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgLy9Qb3B1bGF0ZSB0aGUgY29tbWVudHMgYWdhaW4gaWYgc2luZ2xlIGNvbW1lbnQgaXMgYWRkZWQuCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpc0Nhc2VEZXRhaWwgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUluZm8gPT09ICJyb3ciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydENvbW1lbnRzLnBvcHVsYXRlX2NvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY29tbWVudGJveCcpLnZhbCgnJykuYmx1cigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5jb21tZW50ICE9ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Q29tbWVudEljb24oY3VycmVudFJvdykgOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ29tbWVudEljb24oY3VycmVudFJvdykgOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vZGFsLWJhY2tkcm9wJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGVja2JveFNlbGVjdG9yOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZSNhbGVydHNEZXRhaWxzVGFibGUgLmNvcHktc2VsZWN0OmNoZWNrZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCQoY2hlY2tib3hTZWxlY3RvciksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDb21tZW50SWNvbih0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnc3VjY2VzcycsICd0b3AgcmlnaHQnLCAiU3VjY2VzcyIsICJDb21tZW50cyBhZGRlZCBzdWNjZXNzZnVsbHkuIiwge2F1dG9IaWRlRGVsYXk6IDEwMDAwfSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRpYXRlU2luZ2xlUm93Q29tbWVudFByb2Nlc3MgPSBmdW5jdGlvbiAoJHRoaXMsIGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKSB7CiAgICAgICAgdmFyIGFkaG9jQWxlcnRJZDsKICAgICAgICB2YXIgbGl0ZXJhdHVyZUFsZXJ0SWQ7CiAgICAgICAgdmFyIGFydGljbGVJZDsKCiAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgIGlmICgoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ1NpbmdsZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdFVkRBUyBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSAmJiAhaXNTaWduYWwpIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSAkKCR0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIGlmIChpc0Fic3RyYWN0Vmlld09yQ2FzZVZpZXcoc2VsZWN0ZWRSb3dJbmRleCkpIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93SW5kZXggPSBzZWxlY3RlZFJvd0luZGV4IC8gMgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlLnJvdyhzZWxlY3RlZFJvd0luZGV4KS5kYXRhKCk7CiAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09ICdBZ2dyZWdhdGUgQ2FzZSBBbGVydCcpIHsKICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVBZ2dSZXZpZXcucm93KCQoJHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICB9IGVsc2UgaWYgKGFsZXJ0VHlwZSA9PT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgewogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZUxpdGVyYXR1cmVSZXZpZXcucm93KCQoJHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZVNpbmdsZVJldmlldy5yb3coJCgkdGhpcykucGFyZW50cygndHInKSkuZGF0YSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSByb3dPYmplY3QuY2FzZU51bWJlcjsKICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHJvd09iamVjdC5wcm9kdWN0RmFtaWx5OwogICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHJvd09iamVjdC5jYXNlVmVyc2lvbjsKICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3dPYmplY3QucHJvZHVjdE5hbWU7CiAgICAgICAgdmFyIGV2ZW50TmFtZSA9IHJvd09iamVjdC5wcmVmZXJyZWRUZXJtOwogICAgICAgIHZhciBwdCA9IHJvd09iamVjdC5wdDsKICAgICAgICB2YXIgYXNzaWduZWRUbyA9IHJvd09iamVjdC5hc3NpZ25lZFRvLmlkOwogICAgICAgIHZhciBhc3NpZ25lZFRvVXNlciA9IG51bGw7CiAgICAgICAgIGlmKHJvd09iamVjdC5hc3NpZ25lZFRvVXNlciAhPSB1bmRlZmluZWQpCiAgICAgICAgICAgICBhc3NpZ25lZFRvVXNlciA9IHJvd09iamVjdC5hc3NpZ25lZFRvVXNlci5pZDsKICAgICAgICB2YXIgcHJvZHVjdElkID0gcm93T2JqZWN0LnByb2R1Y3RJZDsKICAgICAgICB2YXIgcHRDb2RlID0gcm93T2JqZWN0LnB0Q29kZTsKICAgICAgICB2YXIgY29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKICAgICAgICB2YXIgZXhlY3V0ZWRDb25maWdJZCA9IHJvd09iamVjdC5leGVjQ29uZmlnSWQ7CgogICAgICAgIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5BREhPQ19BTEVSVCkgewogICAgICAgICAgICBhZGhvY0FsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5MSVRFUkFUVVJFX1NFQVJDSF9BTEVSVCkgewogICAgICAgICAgICBsaXRlcmF0dXJlQWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgYXJ0aWNsZUlkID0gcm93T2JqZWN0LmFydGljbGVJZAogICAgICAgIH0KICAgICAgICB2YXIgY2FzZUpzb24gPSB7CiAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICJwcm9kdWN0RmFtaWx5IjogcHJvZHVjdEZhbWlseSwKICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlTnVtYmVyLAogICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBwcm9kdWN0TmFtZSwKICAgICAgICAgICAgImV2ZW50TmFtZSI6IGV2ZW50TmFtZSwKICAgICAgICAgICAgInB0IjogcHQsCiAgICAgICAgICAgICJwdENvZGUiOiBwdENvZGUsCiAgICAgICAgICAgICJwcm9kdWN0SWQiOiBwcm9kdWN0SWQsCiAgICAgICAgICAgICJhc3NpZ25lZFRvIjogYXNzaWduZWRUbyA/IGFzc2lnbmVkVG8gOiBhc3NpZ25lZFRvVXNlciwKICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAiY29uZmlnSWQiOiBjb25maWdJZCwKICAgICAgICAgICAgImFkaG9jQWxlcnRJZCI6IGFkaG9jQWxlcnRJZCwKICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogbGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICJhcnRpY2xlSWQiOiBhcnRpY2xlSWQKICAgICAgICB9OwoKICAgICAgICBjYXNlSnNvbkFycmF5LnB1c2goY2FzZUpzb24pOwogICAgICAgIHZhciBjb21tZW50TWV0YUluZm8gPSAiIjsKCiAgICAgICAgaWYgKGNhc2VKc29uLmFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkFHR1JFR0FURV9BTEVSVCB8fCBjYXNlSnNvbi5hbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5FVkRBU19BTEVSVCkgewogICAgICAgICAgICBpZiAodHlwZW9mIChjYXNlSnNvbi5ldmVudE5hbWUpID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgKGNhc2VKc29uLnByb2R1Y3ROYW1lKSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICIiCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAnPHNwYW4gaWQ9InByb2R1Y3ROYW1lIj4nICsgY2FzZUpzb24ucHJvZHVjdE5hbWUgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJldmVudE5hbWUiPicgKyBjYXNlSnNvbi5ldmVudE5hbWUgKyAnPC9zcGFuPicgKyAnPHNwYW4gY2xhc3M9ImhpZGRlbiIgaWQ9InByb2R1Y3RJZCI+JyArIGNhc2VKc29uLnByb2R1Y3RJZCArICc8L3NwYW4+JyArCiAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPSJoaWRkZW4iIGlkPSJwdENvZGUiPicgKyBjYXNlSnNvbi5wdENvZGUgKyAnPC9zcGFuPicKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgKGNhc2VKc29uLmNhc2VOdW1iZXIpID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgKGNhc2VKc29uLnByb2R1Y3RGYW1pbHkpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gIiIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0iY2FzZU51bWJlciI+JyArIGNhc2VKc29uLmNhc2VOdW1iZXIgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJwcm9kdWN0RmFtaWx5Ij4nICsgY2FzZUpzb24ucHJvZHVjdEZhbWlseSArICc8L3NwYW4+JwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudC1tZXRhLWluZm8iKS5odG1sKGNvbW1lbnRNZXRhSW5mbyk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNhc3NpZ25lZFRvIikuaHRtbChhc3NpZ25lZFRvKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbmZpZ0lkIikuaHRtbChjb25maWdJZCk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoY2FzZUpzb24uYWxlcnRUeXBlKTsKCiAgICAgICAgLy9Qb3B1bGF0ZSB0aGUgZXhpc3RpbmcgY29tbWVudHMgYW5kIGJpbmQgZXZlbnRzIHRvIHRoZW0gaW4gY2FzZSBvZiBzaW5nbGUgY29tbWVudC4KICAgICAgICBpZiAodHlwZW9mIGlzQ2FzZURldGFpbCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgJCgnI2xvYWRpbmdDb21tZW50cycpLmh0bWwoJycpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2lnbmFsLmFsZXJ0Q29tbWVudHMucG9wdWxhdGVfY29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CiAgICAgICAgfQogICAgICAgICQoIiNjb21tZW50TW9kYWwiKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCcjY29tbWVudGJveCcpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJy5hZGQtY29tbWVudHMnKS5odG1sKCdBZGQnKTsKICAgICAgICAgICAgJCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBpbml0aWF0ZVNpbmdsZUJ1bGtSb3dDb21tZW50UHJvY2VzcyA9IGZ1bmN0aW9uIChjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCkgewogICAgICAgIHZhciBpbmRleFNldCA9IG5ldyBTZXQoKTsKICAgICAgICB2YXIgY2hlY2tib3hTZWxlY3RvcjsKICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICBjaGVja2JveFNlbGVjdG9yID0gJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgfQogICAgICAgICQuZWFjaCgkKGNoZWNrYm94U2VsZWN0b3IpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0luZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIGlmIChpc0Fic3RyYWN0Vmlld09yQ2FzZVZpZXcoc2VsZWN0ZWRSb3dJbmRleCkpCiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAvIDI7CiAgICAgICAgICAgIGluZGV4U2V0LmFkZCgoc2VsZWN0ZWRSb3dJbmRleCkpOwogICAgICAgIH0pOwogICAgICAgIGluZGV4U2V0LmZvckVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgIHZhciBhZGhvY0FsZXJ0SWQ7CiAgICAgICAgICAgIHZhciBsaXRlcmF0dXJlQWxlcnRJZDsKICAgICAgICAgICAgdmFyIGFydGljbGVJZDsKICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgICAgICBpZiAoKGFsZXJ0VHlwZSA9PT0gJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdTaW5nbGUgQ2FzZSBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnRVZEQVMgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgJiYgIWlzU2lnbmFsKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZS5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZUFnZ1Jldmlldy5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZVNpbmdsZVJldmlldy5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjYXNlTnVtYmVyID0gcm93T2JqZWN0LmNhc2VOdW1iZXI7CiAgICAgICAgICAgIHZhciBwcm9kdWN0RmFtaWx5ID0gcm93T2JqZWN0LnByb2R1Y3RGYW1pbHk7CiAgICAgICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHJvd09iamVjdC5jYXNlVmVyc2lvbjsKICAgICAgICAgICAgdmFyIHByb2R1Y3ROYW1lID0gcm93T2JqZWN0LnByb2R1Y3ROYW1lOwogICAgICAgICAgICB2YXIgZXZlbnROYW1lID0gcm93T2JqZWN0LnByZWZlcnJlZFRlcm07CiAgICAgICAgICAgIHZhciBwdCA9IHJvd09iamVjdC5wdDsKICAgICAgICAgICAgdmFyIGFzc2lnbmVkVG8gPSByb3dPYmplY3QuYXNzaWduZWRUby5pZDsKICAgICAgICAgICAgdmFyIHByb2R1Y3RJZCA9IHJvd09iamVjdC5wcm9kdWN0SWQ7CiAgICAgICAgICAgIHZhciBwdENvZGUgPSByb3dPYmplY3QucHRDb2RlOwogICAgICAgICAgICB2YXIgY29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKICAgICAgICAgICAgdmFyIGV4ZWN1dGVkQ29uZmlnSWQgPSByb3dPYmplY3QuZXhlY0NvbmZpZ0lkOwoKICAgICAgICAgICAgaWYgKGFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkFESE9DX0FMRVJUKSB7CiAgICAgICAgICAgICAgICBhZGhvY0FsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuTElURVJBVFVSRV9TRUFSQ0hfQUxFUlQpIHsKICAgICAgICAgICAgICAgIGxpdGVyYXR1cmVBbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICAgICAgYXJ0aWNsZUlkID0gcm93T2JqZWN0LmFydGljbGVJZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjYXNlSnNvbiA9IHsKICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IHByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNhc2VOdW1iZXIsCiAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBwcm9kdWN0TmFtZSwKICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBldmVudE5hbWUsCiAgICAgICAgICAgICAgICAicHQiOiBwdCwKICAgICAgICAgICAgICAgICJwdENvZGUiOiBwdENvZGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogcHJvZHVjdElkLAogICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBhc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgImNvbmZpZ0lkIjogY29uZmlnSWQsCiAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogbGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAiYXJ0aWNsZUlkIjogYXJ0aWNsZUlkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhc2VKc29uQXJyYXkucHVzaChjYXNlSnNvbikKICAgICAgICB9KTsKCiAgICAgICAgLy9TZXQgdmFsdWVzIHRvIHRoZSBtb2RhbCBlbGVtZW50cy4KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2xvYWRpbmdDb21tZW50cyIpLmhpZGUoKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnQtbWV0YS1pbmZvIikuaHRtbCgiIik7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5wcmV2aW91cy1jb21tZW50cyIpLmh0bWwoIiIpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgIGlmIChjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoKSAhPSAnVXBkYXRlJykgewogICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgIH0KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLm9uKCJrZXl1cCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLnZhbCgpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIHJlc3RhcnRSZXZpZXcgPSBmdW5jdGlvbiAoY2FzZVJldmlld1ByZXZpb3VzVXJsKSB7CgogICAgICAgIC8vRXZlbnQgd2hlbiByZXZpZXcgcmVzdGFydCBpcyBjbGlja2VkLgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY2FzZS1yZXN0YXJ0LXJldmlldycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJjYXNlTnVtYmVyIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBmb2xsb3dVcE51bWJlciA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJmb2xsb3dVcE51bWJlciJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZVZlcnNpb24iXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSBwYXJlbnRfcm93LmZpbmQoJ2lucHV0W2RhdGEtZmllbGQ9InByb2R1Y3RGYW1pbHkiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGZvbGxvd1VwTW9kYWwgPSAkKCcjZm9sbG93VXBNb2RhbCcpOwogICAgICAgICAgICBmb2xsb3dVcE1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIGZvbGxvd1VwTW9kYWwuZmluZCgiLnByZXZpb3VzLWZvbGxvd1VwIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGdldFByZXZpb3VzU3RhdGUgPSBjYXNlUmV2aWV3UHJldmlvdXNVcmwgKyAiP2Nhc2VOdW1iZXI9IiArIGNhc2VOdW1iZXIgKwogICAgICAgICAgICAgICAgICAgICImY2FzZVZlcnNpb249IiArIGNhc2VWZXJzaW9uICsgIiZwcm9kdWN0RmFtaWx5PSIgKyBwcm9kdWN0RmFtaWx5ICsgIiZmb2xsb3dVcE51bWJlcj0iICsgZm9sbG93VXBOdW1iZXI7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogZ2V0UHJldmlvdXNTdGF0ZSwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJ3b3JrZmxvd1N0YXRlIl0nKS50ZXh0KHJlc3VsdC5wcmV2aW91c1N0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImRpc3Bvc2l0aW9uIl0nKS50ZXh0KHJlc3VsdC5wcmV2aW91c0Rpc3Bvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImluZm8tc2lnbiJdJykuYWRkQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICAgICAgICAgICAgICAgICBmb2xsb3dVcE1vZGFsLm1vZGFsKCdkZXN0cm95Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5TaW1pbGFyQ2FzZXNNb2RhbCA9IGZ1bmN0aW9uIChjYXNlSW5mb1VybCkgewoKICAgICAgICAvL0V2ZW50IHRyaWdnZXJlZCB3aGVuIHNpbWlsYXIgY2FzZXMgY291bnQgaXMgY2xpY2tlZC4KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNpbWlsYXItY2FzZXMnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCiAgICAgICAgICAgIHZhciBzaW1pbGFyQ2FzZU1vZGFsID0gJCgnI3NpbWlsYXJDYXNlTW9kYWwnKTsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoInRyIik7CgogICAgICAgICAgICAvL0ZldGNoIHRoZSB2YWx1ZXMgb2YgdGhlIGV2ZW50LgogICAgICAgICAgICB2YXIgZXZlbnRWYWwgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1ldmVudC12YWwnKTsKICAgICAgICAgICAgdmFyIGV2ZW50VHlwZSA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWZpZWxkJyk7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gJChldmVudC50YXJnZXQpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIHB0ID0gJChldmVudC50YXJnZXQpLmF0dHIoImRhdGEtcHQiKTsKICAgICAgICAgICAgdmFyIGV2ZW50Q29kZTsKICAgICAgICAgICAgaWYgKGV2ZW50VHlwZSkgewogICAgICAgICAgICAgICAgZXZlbnRDb2RlID0gKGV2ZW50VHlwZS5zcGxpdCgiX2NvZGUiKVswXSk7CiAgICAgICAgICAgICAgICBldmVudFR5cGUgPSBldmVudFR5cGUuc3BsaXQoIl8iKVsyXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZU51bWJlciJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZVZlcnNpb24iXScpLmF0dHIoImRhdGEtaWQiKTsKCiAgICAgICAgICAgIC8vU2hvdyBtb2RhbCBhbmQgc2V0IGl0cyB2YWx1ZXMuCiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRUeXBlIikuaHRtbChldmVudFR5cGUpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNldmVudFZhbCIpLmh0bWwoZXZlbnRWYWwpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNjYXNlTnVtYmVySW5mbyIpLnZhbChjYXNlTnVtYmVyKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXhlY3V0ZWRDb25maWdJZCIpLnZhbChleGVjdXRlZENvbmZpZ0lkKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjY2FzZUN1cnJlbnRWZXJzaW9uIikudmFsKGNhc2VWZXJzaW9uKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRDb2RlIikudmFsKGV2ZW50Q29kZSk7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2V2ZW50Q29kZVZhbCIpLnZhbChldmVudFZhbCk7CiAgICAgICAgICAgIC8vTWFrZSB0aGUgbW9kYWwgdGFibGUgYXMgZGF0YXRhYmxlCgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNpZ25hbC5zaW1pbGFyQ2FzZVRhYmxlLmluaXRfc2ltaWxhcl9jYXNlX3RhYmxlKGNhc2VJbmZvVXJsKQogICAgICAgICAgICB9LCAxMDApOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgb3BlbkF0dGFjaG1lbnRNb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNob3ctYXR0YWNobWVudC1pY29uJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGZldGNoQWNjZXB0ZWRGaWxlRm9ybWF0cygpOwogICAgICAgICAgICAvL3ZhciBpc0FyY2hpdmVkID0gJCgiI2lzQXJjaGl2ZWQiKS52YWwoKTsKICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSBwYXJlbnRfcm93LmZpbmQoJ2FbZGF0YS1maWVsZD0iYXR0YWNobWVudCJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgY2FzZUNvbnRyb2xsZXIgPSBwYXJlbnRfcm93LmZpbmQoJ2FbZGF0YS1maWVsZD0iYXR0YWNobWVudCJdJykuYXR0cigiZGF0YS1jb250cm9sbGVyIik7CiAgICAgICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC8iICsgY2FzZUNvbnRyb2xsZXIgKyAiL3VwbG9hZD9pc0FyY2hpdmVkPSIraXNBcmNoaXZlZDsKICAgICAgICAgICAgdmFyIGdldEF0dGFjaG1lbnRVcmwgPSAiL3NpZ25hbC8iICsgY2FzZUNvbnRyb2xsZXIgKyAiL2ZldGNoQXR0YWNobWVudD9hbGVydElkPSIgKyBhbGVydElkICsgIiZpc0FyY2hpdmVkPSIgKyBpc0FyY2hpdmVkOwogICAgICAgICAgICAkKCcjc2hvd0F0dGFjaG1lbnRNb2RhbCAjYXR0YWNobWVudEZvcm0gI2F0dGFjaG1lbnRGb3JtSWQnKS5hdHRyKCd2YWx1ZScsIGFsZXJ0SWQpOwogICAgICAgICAgICB2YXIgY2FzZUhpc3RvcnlNb2RhbCA9ICQoJyNzaG93QXR0YWNobWVudE1vZGFsJyk7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgJCgiI3Nob3dBdHRhY2htZW50TW9kYWwgZm9ybSNhdHRhY2htZW50Rm9ybSIpLnVuYmluZCgnc3VibWl0Jykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSh0aGlzKTsKICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZmluZCgnLmF0dGFjaG1lbnQtZmlsZScpLnZhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCgiLnVwbG9hZCIpLmF0dHIoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCgnLmF0dGFjaG1lbnQtZmlsZScpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93QXR0YWNobWVudEljb24ocGFyZW50X3Jvdyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2hvd0F0dGFjaG1lbnRNb2RhbCAjYXR0YWNobWVudC10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCIudXBsb2FkIikuYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCIudXBsb2FkIikuYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ2Vycm9yJywgJ3RvcCByaWdodCcsICJFcnJvciIsICJTb3JyeSwgVGhpcyBGaWxlIEZvcm1hdCBOb3QgQWNjZXB0ZWQiLCB7YXV0b0hpZGVEZWxheTogMTAwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJCgnI3Nob3dBdHRhY2htZW50TW9kYWwgI2F0dGFjaG1lbnQtdGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICAgICAgZGVzdHJveTogdHJ1ZSwKICAgICAgICAgICAgICAgIHNlYXJjaGluZzogZmFsc2UsCiAgICAgICAgICAgICAgICBzUGFnaW5hdGlvblR5cGU6ICJib290c3RyYXAiLAogICAgICAgICAgICAgICAgcmVzcG9uc2l2ZTogZmFsc2UsCiAgICAgICAgICAgICAgICBsYW5ndWFnZTogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICAgICAidXJsIjogZ2V0QXR0YWNobWVudFVybCwKICAgICAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAkKCcucmVtb3ZlLWF0dGFjaG1lbnQnKS5jbGljayhmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0YWNobWVudFJvdyA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2htZW50SWQgPSBhdHRhY2htZW50Um93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0icmVtb3ZlQXR0YWNobWVudCJdJykuYXR0cigiZGF0YS1hdHRhY2htZW50SWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlbW92ZVVybCA9ICcvc2lnbmFsLycgKyBjYXNlQ29udHJvbGxlciArICcvZGVsZXRlQXR0YWNobWVudD9hdHRhY2htZW50SWQ9JyArIGF0dGFjaG1lbnRJZCArICcmaXNBcmNoaXZlZD0nICsgaXNBcmNoaXZlZDsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogcmVtb3ZlVXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge2FsZXJ0SWQ6IGFsZXJ0SWR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoJy5yZW1vdmUtYXR0YWNobWVudCcpLmxlbmd0aCA9PT0xICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVBdHRhY2htZW50SWNvbigkdGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Nob3dBdHRhY2htZW50TW9kYWwgI2F0dGFjaG1lbnQtdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5Ob3RpZmljYXRpb24ubm90aWZ5KCdlcnJvcicsICd0b3AgcmlnaHQnLCAiRXJyb3IiLCAiQWxsIHNlbGVjdGVkIHNhZmV0eSBvYnNlcnZhdGlvbnMgbXVzdCBiZSBpbiBzYW1lIGRpc3Bvc2l0aW9uIGZvciBwZXJmb3JtaW5nIHRoZSBidWxrIHVwZGF0ZS4iLCB7YXV0b0hpZGVEZWxheTogMTAwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSIvc2lnbmFsL2F0dGFjaG1lbnRhYmxlL2Rvd25sb2FkP2lkPScgKyByb3cuaWQgKyAnIj4nICsgZXNjYXBlSFRNTChyb3cubmFtZSkgKyAnPC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjZWxsLWJyZWFrJywKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aW1lU3RhbXAiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibW9kaWZpZWRCeSIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiB0YWJpbmRleD0iMCIgdGl0bGU9IlJlbW92ZSBBdHRhY2htZW50IiAgc3R5bGU9ImN1cnNvcjogcG9pbnRlciIgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlIHJlbW92ZS1hdHRhY2htZW50IiBkYXRhLWZpZWxkPSJyZW1vdmVBdHRhY2htZW50IiBkYXRhLWF0dGFjaG1lbnRJZD0nICsgcm93LmlkICsgJz48L3NwYW4+JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogZmFsc2UsCiAgICAgICAgICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRHcmlkRHluYW1pY0ZpbHRlcnMgPSBmdW5jdGlvbiAoZmlsdGVyc0RhdGEsIHByZWZpeCwgaWQpIHsKICAgICAgICAvL0FkZCBmaWx0ZXJzIHRvIHRoZSBkYXRhIHRhYmxlLgogICAgICAgIHZhciBkYXRhVGFibGVzX2xlbmd0aCA9ICQoJy5kYXRhVGFibGVzX2xlbmd0aCcpOwogICAgICAgIGRhdGFUYWJsZXNfbGVuZ3RoLmFkZENsYXNzKCdjb2wtc20tMTInKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoKS5yZW1vdmVDbGFzcygiY29sLXhzLTIiKTsKICAgICAgICBhcHBsaWNhdGlvbk5hbWUgPT0gQUxFUlRfQ09ORklHX1RZUEUuQURIT0NfQUxFUlQgPyBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoIjpub3QoJy5kYXRhVGFibGVzX3dyYXBwZXInKSIpLmFkZENsYXNzKCJjb2wteHMtOSIpIDogZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5hZGRDbGFzcygiY29sLXhzLTEwIik7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5uZXh0KCkucmVtb3ZlQ2xhc3MoImNvbC14cy0xMCIpOwogICAgICAgIGFwcGxpY2F0aW9uTmFtZSA9PSBBTEVSVF9DT05GSUdfVFlQRS5BREhPQ19BTEVSVCA/IGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgiOm5vdCgnLmRhdGFUYWJsZXNfd3JhcHBlcicpIikubmV4dCgpLmFkZENsYXNzKCJjb2wteHMtMyIpIDogZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5uZXh0KCkuYWRkQ2xhc3MoImNvbC14cy0yIik7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGguZmluZCgibGFiZWwiKS5hZGRDbGFzcygnY29sLXhzLTInKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGR0QnV0dG9ucyA9ICc8ZGl2IGNsYXNzPSJkYXRhVGFibGUtdG9wLWRpc3Bvc2l0aW9uIGNvbC14cy0xMCI+JzsKICAgICAgICAgICAgJC5lYWNoKGZpbHRlcnNEYXRhLCBmdW5jdGlvbiAoaW5kZXgsIG9iaikgewogICAgICAgICAgICAgICAgaWYgKG9iai5jbG9zZWQgfHwgb2JqLmlzQ2xvc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8ZGl2IGNsYXNzPSJjaGVja2JveCBjaGVja2JveC1wcmltYXJ5IGNoZWNrYm94LWlubGluZSBtLWwtMyBjaGVja2JveC1wb3MtYWJzIj4nOwogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGlucHV0IGlkPSJmaWx0ZXInICsgaW5kZXggKyAnIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImR5bmFtaWMtZmlsdGVycyIgbmFtZT0icmVsYXRlZFJlc3VsdHMiIGRhdGEtY2xvc2VkPSInICsgb2JqLmlzQ2xvc2VkICsgJyIgdmFsdWU9IicgKyBvYmoudmFsdWUgKyAnIiAvPiA8bGFiZWwgY2xhc3M9Im0tci0zMCIgIGZvcj0iZmlsdGVyJyArIGluZGV4ICsgJyI+JyArIG9iai52YWx1ZSArICc8L2xhYmVsPjwvZGl2PicKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8ZGl2IGNsYXNzPSJjaGVja2JveCBjaGVja2JveC1wcmltYXJ5IGNoZWNrYm94LWlubGluZSBtLWwtMyBjaGVja2JveC1wb3MtYWJzIj4nOwogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGlucHV0IGlkPSJmaWx0ZXInICsgaW5kZXggKyAnIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImR5bmFtaWMtZmlsdGVycyIgbmFtZT0icmVsYXRlZFJlc3VsdHMiIGRhdGEtY2xvc2VkPSInICsgb2JqLmlzQ2xvc2VkICsgJyIgY2hlY2tlZD0iY2hlY2tlZCIgdmFsdWU9IicgKyBvYmoudmFsdWUgKyAnIiAvPiA8bGFiZWwgY2xhc3M9Im0tci0zMCIgZm9yPSJmaWx0ZXInICsgaW5kZXggKyAnIj4nICsgb2JqLnZhbHVlICsgJzwvbGFiZWw+PC9kaXY+JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8L2Rpdj4nOwogICAgICAgICAgICBkdEJ1dHRvbnMgPSBkdEJ1dHRvbnMgKyAnPC9kaXY+JzsKICAgICAgICAgICAgaWYgKHRoaXMuaWQgIT09ICdhcmNoaXZlZEFsZXJ0c1RhYmxlX2xlbmd0aCcgJiYgdGhpcy5pZCAhPT0gJ2FjdGl2aXRpZXNUYWJsZV9sZW5ndGgnKQogICAgICAgICAgICAgICAgJCh0aGlzKS5hcHBlbmQoZHRCdXR0b25zKTsKICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5keW5hbWljLWZpbHRlcnMnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYWxlcnREZXRhaWxzVGFibGU7CiAgICAgICAgICAgICAgICB2YXIgZnJlcVNlbGVjdGVkID0gIiI7CiAgICAgICAgICAgICAgICBpZiAoJCgiI2ZyZXF1ZW5jeU5hbWVzIikpIHsKICAgICAgICAgICAgICAgICAgICBmcmVxU2VsZWN0ZWQgPSAkKCIjZnJlcXVlbmN5TmFtZXMiKS52YWwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJBcnJheSA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGZpbHRlclZhbHVlcyA9IFtdOwogICAgICAgICAgICAgICAgJCgnLmR5bmFtaWMtZmlsdGVycycpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVzLnB1c2goJCh0aGlzKS52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZpbHRlckFycmF5LnB1c2goJCh0aGlzKS5pcygnOmNoZWNrZWQnKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiLCBKU09OLnN0cmluZ2lmeShmaWx0ZXJBcnJheSkpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyAiZmlsdGVyc192YWx1ZSIsIEpTT04uc3RyaW5naWZ5KGZpbHRlclZhbHVlcykpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyAiaWQiLCBpZCk7CiAgICAgICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICAgICAgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnREZXRhaWxzVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gbGlzdENvbmZpZ1VybCArICI/ZmlsdGVycz0iICsgZmlsdGVyVmFsdWVzLmpvaW4oIiwiKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhbGVydERldGFpbHNUYWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKTsKICAgICAgICAgICAgICAgICAgICB1cmwgPSBsaXN0Q29uZmlnVXJsICsgIiZmcmVxdWVuY3k9IiArIGZyZXFTZWxlY3RlZCArICImaXNGaWx0ZXJSZXF1ZXN0PXRydWUmZmlsdGVycz0iICsgZW5jb2RlVVJJKEpTT04uc3RyaW5naWZ5KGZpbHRlclZhbHVlcykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYWxlcnREZXRhaWxzVGFibGUuYWpheC51cmwodXJsKS5sb2FkKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgfTsKCiAgICB2YXIgaXNBbGVydFBlcnNpc3RlZEluU2Vzc2lvblN0b3JhZ2UgPSBmdW5jdGlvbiAocHJlZml4KSB7CiAgICAgICAgdmFyIGMgPSBzaWduYWwudXRpbHMuZ2V0UXVlcnlTdHJpbmcoImNvbmZpZ0lkIik7CiAgICAgICAgcmV0dXJuIGMgPyBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHByZWZpeCArICJpZCIpID09IGMgOiBmYWxzZQogICAgfTsKCiAgICB2YXIgcmVtb3ZlRmlsdGVyc0Zyb21TZXNzaW9uU3RvcmFnZSA9IGZ1bmN0aW9uIChwcmVmaXgpIHsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKHByZWZpeCArICJmaWx0ZXJzX3N0b3JlIik7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShwcmVmaXggKyAiZmlsdGVyc192YWx1ZSIpOwogICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0ocHJlZml4ICsgImlkIik7CiAgICB9OwoKICAgIHZhciBvcGVuU2F2ZVZpZXdNb2RhbCA9IGZ1bmN0aW9uIChmaWx0ZXJJbmRleCwgYXBwbGljYXRpb25OYW1lLCB2aWV3SWQpIHsKICAgICAgICB2YXIgc3lzdGVtRGVmYXVsdCA9IFsiU3lzdGVtIFZpZXciXTsKICAgICAgICB2YXIgdmlld0luZm87CgogICAgICAgIC8vc2F2aW5nIG5ldyB2aWV3CiAgICAgICAgJCgiLnNhdmVWaWV3IikudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy5zYXZlVmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld1NoYXJlZFdpdGgnKS5lbXB0eSgpOwoKICAgICAgICAgICAgJCgiI3NhdmUtdmlldy1tb2RhbCAgI3NhdmVEaXYiKS5zaG93KCk7CiAgICAgICAgICAgICQoIiNzYXZlLXZpZXctbW9kYWwgICNlZGl0RGl2IikuaGlkZSgpOwogICAgICAgICAgICB2aWV3SW5mbyA9IGdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwoKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19maWx0ZXJzJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLmZpbHRlck1hcCkpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2NvbHVtbkxpc3QnKS52YWwodmlld0luZm8ubm90VmlzaWJsZUNvbHVtbik7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWxlcnRUeXBlJykudmFsKGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfc29ydGluZycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hZHZhbmNlZF9maWx0ZXInKS52YWwodmlld0luZm8uYWR2YW5jZWRGaWx0ZXIpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICNjdXJyZW50X3ZpZXdfaWQnKS52YWwodmlld0lkKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuc2F2ZV9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsJykubW9kYWwoJ3Nob3cnKTsKICAgICAgICB9KQoKICAgICAgICAvL3VwZGF0aW5nIGV4aXN0aW5nIHZpZXcKICAgICAgICAkKCIudXBkYXRlVmlldyIpLnVuYmluZCgnY2xpY2snKTsKICAgICAgICAkKCcudXBkYXRlVmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmlld0luZm8gPSBnZW5lcmF0ZVZpZXdJbmZvKGZpbHRlckluZGV4KTsKICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSwgc3lzdGVtRGVmYXVsdCkgIT0gLTEpIHsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfZmlsdGVycycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5maWx0ZXJNYXApKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfY29sdW1uTGlzdCcpLnZhbCh2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWxlcnRUeXBlJykudmFsKGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X3NvcnRpbmcnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uc29ydGVkQ29sdW1uKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICNjdXJyZW50X3ZpZXdfaWQnKS52YWwodmlld0lkKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgLnNhdmVfYnV0dG9ucycpLnNob3coKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGlzVmlld1VwZGF0ZUFsbG93ZWQgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRXhpc3RpbmdWaWV3KHZpZXdJbmZvKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBib290Ym94LmNvbmZpcm0oewogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAkLmkxOG4uXygnZGVmYXVsdFZpZXdVcGRhdGVPbmx5JyksCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm06IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NvbnRpbnVlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdidG4tc3VjY2VzcycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NhbmNlbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnYnRuLWRhbmdlcicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUV4aXN0aW5nVmlldyh2aWV3SW5mbykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vc2VsZWN0aW5nIGFub3RoZXIgdmlldwogICAgICAgICQoJy52aWV3U2VsZWN0JykudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy52aWV3U2VsZWN0Jykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHBhZ2VVUkwgPSAkKGxvY2F0aW9uKS5hdHRyKCJocmVmIik7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFZpZXcgPSAkKCcudmlld1NlbGVjdCcpLnZhbCgpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdpc1ZpZXdDYWxsJywgJ3RydWUnKTsKICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigidmlld0lkIikgIT0gLTEpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcGFnZVVSTC5zbGljZSgwLCBwYWdlVVJMLmluZGV4T2YoInZpZXdJZCIpICsgNykgKyBzZWxlY3RlZFZpZXcKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwYWdlVVJMLmluZGV4T2YoIiMiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VVUkwgPSBwYWdlVVJMLnNsaWNlKDAsIHBhZ2VVUkwuaW5kZXhPZigiIyIpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBwYWdlVVJMICsgIiZ2aWV3SWQ9IiArIHNlbGVjdGVkVmlldwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vZGVsZXRpbmcgb3IgZWRpdGluZyBzZWxlY3RlZCB2aWV3CiAgICAgICAgJCgnLmVkaXRWaWV3JykudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy5lZGl0VmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICQoIiNzYXZlLXZpZXctbW9kYWwgICNzYXZlRGl2IikuaGlkZSgpOwogICAgICAgICAgICAkKCIjc2F2ZS12aWV3LW1vZGFsICAjZWRpdERpdiIpLnNob3coKTsKICAgICAgICAgICAgdmlld0luZm8gPSBnZW5lcmF0ZVZpZXdJbmZvKGZpbHRlckluZGV4KTsKCiAgICAgICAgICAgIGlmICgkLmluQXJyYXkoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCksIHN5c3RlbURlZmF1bHQpID09IC0xKSB7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X25hbWUnKS52YWwoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X25hbWUnKS52YWwoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihTKSIsICIiKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2RlZmF1bHQnKS5wcm9wKCdjaGVja2VkJywgKCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5pbmRleE9mKCIoZGVmYXVsdCkiKSAhPSAtMSkpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19pZCcpLnZhbCgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS52YWwoKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2ZpbHRlcnMnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2NvbHVtbkxpc3QnKS52YWwodmlld0luZm8ubm90VmlzaWJsZUNvbHVtbik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X3NvcnRpbmcnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uc29ydGVkQ29sdW1uKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FsZXJ0VHlwZScpLnZhbChhcHBsaWNhdGlvbk5hbWUpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuZWRpdF9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCcjYWxlcnQtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgZ2VuZXJhdGVWaWV3SW5mbyA9IGZ1bmN0aW9uIChmaWx0ZXJJbmRleCkgewogICAgICAgIHZhciBvVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CgogICAgICAgIC8vZ2VuZXJhdGUgZmlsdGVyIHZhbHVlIG1hcAogICAgICAgIHZhciBmaWx0ZXJNYXAgPSBuZXcgT2JqZWN0KCk7CiAgICAgICAgJC5lYWNoKGZpbHRlckluZGV4LCBmdW5jdGlvbiAoaWR4LCBvYmopIHsKICAgICAgICAgICAgdmFyIGZpbHRlclZhbCA9IHlhZGNmLmV4R2V0Q29sdW1uRmlsdGVyVmFsKG9UYWJsZSwgb2JqKTsKICAgICAgICAgICAgaWYgKGZpbHRlclZhbCkgewogICAgICAgICAgICAgICAgZmlsdGVyTWFwW29ial0gPSBmaWx0ZXJWYWwKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvL2dlbmVyYXRlIGNvbHVtbnMgdmlzaWJsZSBsaXN0CiAgICAgICAgdmFyIG5vdFZpc2libGVDb2x1bW4gPSAkKCcjY29sdW1uSW5kZXgnKS52YWwoKTsKCiAgICAgICAgLy9nZW5lcmF0ZSBzb3J0aW5nIGNvbHVtbiBpbmZvCiAgICAgICAgdmFyIHNvcnRlZENvbHVtbiA9IG5ldyBPYmplY3QoKTsKICAgICAgICBpZiAoJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmRhdGFUYWJsZSgpLmZuU2V0dGluZ3MoKS5hYVNvcnRpbmdbMF0pIHsKICAgICAgICAgICAgdmFyIHNvcnRlZENvbCA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5kYXRhVGFibGUoKS5mblNldHRpbmdzKCkuYWFTb3J0aW5nWzBdWzBdOwogICAgICAgICAgICB2YXIgY29sdW1uTmFtZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5maW5kKCJ0aCIpLmVxKHNvcnRlZENvbCkuYXR0cigiZGF0YS1maWVsZCIpOwogICAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgICBjb2x1bW5TZXEuZXZlcnkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlcU5hbWUgPSBjb2x1bW5TZXFbaW5kZXhdLm5hbWU7CiAgICAgICAgICAgICAgICBpZiAoY29sdW1uTmFtZSA9PSBzZXFOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgc29ydGVkQ29sID0gY29sdW1uU2VxW2luZGV4XS5zZXE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHNvcnRlZERpciA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5kYXRhVGFibGUoKS5mblNldHRpbmdzKCkuYWFTb3J0aW5nWzBdWzFdOwogICAgICAgICAgICBzb3J0ZWRDb2x1bW5bc29ydGVkQ29sXSA9IHNvcnRlZERpcjsKICAgICAgICB9CgogICAgICAgIC8vZ2VuZXJhdGUgYWR2YW5jZWQgZmlsdGVyIGluZm8KICAgICAgICB2YXIgYWR2YW5jZWRGaXRlcklkID0gJCgnLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93bicpLnZhbCgpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdmaWx0ZXJNYXAnOiBmaWx0ZXJNYXAsCiAgICAgICAgICAgICdub3RWaXNpYmxlQ29sdW1uJzogbm90VmlzaWJsZUNvbHVtbiwKICAgICAgICAgICAgJ3NvcnRlZENvbHVtbic6IHNvcnRlZENvbHVtbiwKICAgICAgICAgICAgJ2FkdmFuY2VkRmlsdGVyJzogYWR2YW5jZWRGaXRlcklkCiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgY3JlYXRlU29ydGluZ01hcCA9IGZ1bmN0aW9uIChpbmZvS2V5LCB2aWV3TmFtZSkgewogICAgICAgIHZhciBzb3J0aW5nTWFwID0gW107CiAgICAgICAgdmFyIHNvcnRpbmcgPSB7fTsKICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsKSB7CiAgICAgICAgICAgIHNvcnRpbmcgPSAkLnBhcnNlSlNPTihzZXNzaW9uU3RvcmVkVmFsKTsKICAgICAgICB9IGVsc2UgaWYgKCQoIiNzb3J0ZWRDb2x1bW4iKS52YWwoKSAhPSAiIiAmJiAkKCIjc29ydGVkQ29sdW1uIikudmFsKCkgIT0gInt9IiAmJiBjYWxsaW5nU2NyZWVuID09ICdyZXZpZXcnKSB7CiAgICAgICAgICAgIHNvcnRpbmcgPSAkLnBhcnNlSlNPTigkKCcjc29ydGVkQ29sdW1uJykudmFsKCkpOwogICAgICAgIH0KICAgICAgICAkLmVhY2goc29ydGluZywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgc29ydGluZ01hcC5wdXNoKFtwYXJzZUludChrZXkpLCB2YWx1ZV0pCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHNvcnRpbmdNYXAKICAgIH07CgogICAgdmFyIGNyZWF0ZUZpbHRlck1hcCA9IGZ1bmN0aW9uIChpbmZvS2V5LCB2aWV3TmFtZSkgewogICAgICAgIHZhciBmaWx0ZXJzVmFsdWUgPSBbXTsKICAgICAgICB2YXIgZmlsdGVyTWFwID0ge307CiAgICAgICAgdmFyIHNlc3Npb25TdG9yZWRWYWw7CiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0odmlld05hbWUpID09ICQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpKSB7CiAgICAgICAgICAgIHNlc3Npb25TdG9yZWRWYWwgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGluZm9LZXkpOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvblN0b3JlZFZhbCAmJiBzZXNzaW9uU3RvcmVkVmFsICE9IHt9KSB7CiAgICAgICAgICAgIGZpbHRlck1hcCA9ICQucGFyc2VKU09OKHNlc3Npb25TdG9yZWRWYWwpOwogICAgICAgIH0gZWxzZSBpZiAoJCgnI2ZpbHRlck1hcCcpLnZhbCgpICE9ICIiICYmICQoJyNmaWx0ZXJNYXAnKS52YWwoKSAhPSAie30iKSB7CiAgICAgICAgICAgIGZpbHRlck1hcCA9ICQucGFyc2VKU09OKCQoJyNmaWx0ZXJNYXAnKS52YWwoKSk7CiAgICAgICAgfQogICAgICAgICQuZWFjaChmaWx0ZXJNYXAsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBmaWx0ZXJBcnIgPSBbcGFyc2VJbnQoa2V5KSwgdmFsdWVdOwogICAgICAgICAgICBmaWx0ZXJzVmFsdWUucHVzaChmaWx0ZXJBcnIpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZpbHRlcnNWYWx1ZQogICAgfTsKCiAgICB2YXIgY3JlYXRlTGlzdE9mSW5kZXggPSBmdW5jdGlvbiAoaW5mb0tleSwgaXNFdmRhcywgdmlld05hbWUpIHsKICAgICAgICB2YXIgbG9pID0gW107CiAgICAgICAgdmFyIGNvbHVtbkluZGV4ID0gW10KICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09ICdyZXZpZXcnKSB7CiAgICAgICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsKSB7CiAgICAgICAgICAgICAgICBjb2x1bW5JbmRleCA9IHNlc3Npb25TdG9yZWRWYWwuc3BsaXQoJywnKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29sdW1uSW5kZXggPSAkKCcjY29sdW1uSW5kZXgnKS52YWwoKS5zcGxpdCgnLCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZWFjaChjb2x1bW5JbmRleCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGlzRXZkYXMpIHsKICAgICAgICAgICAgICAgICAgICBsb2kucHVzaChwYXJzZUludCh0aGlzKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9pLnB1c2gocGFyc2VJbnQodGhpcykgKyAxKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxvaQogICAgfTsKCiAgICB2YXIgc2V0U29ydE9yZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoIiNhbGVydHNEZXRhaWxzVGFibGVSb3ciKS5vbignbW91c2Vkb3duJywgJ3RoJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpbmRleCA9ICQodGhpcykuYXR0cigiZGF0YS1jb2x1bW4taW5kZXgiKTsKICAgICAgICAgICAgZGlyID0gJ2FzYyc7CiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdzb3J0aW5nX2FzYycpKSB7CiAgICAgICAgICAgICAgICBkaXIgPSAnZGVzYycKICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdzb3J0aW5nX2Rlc2MnKSkgewogICAgICAgICAgICAgICAgZGlyID0gJ2FzYycKICAgICAgICAgICAgfQogICAgICAgICAgICBpc1ZpZXdJbnN0YW5jZSA9IDA7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuQWxlcnRUYWdNb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmVkaXRBbGVydFRhZ3MnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0gdGFibGUucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgdmFyIGV4ZWNDb25maWdJZCA9IHBhcmVudF9yb3cuZmluZCgnLmV4ZWNDb25maWdJZCcpLmF0dHIoInZhbHVlIik7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IGZldGNoVGFnc1VybCwKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhbGVydFRhZ01vZGFsT2JqID0gJCgnI2FsZXJ0VGFnTW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS5zZWxlY3QyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICJBZGQgQ2F0ZWdvcmllcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQudGFnTGlzdAoKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykudmFsKHJlc3VsdC5hbGVydFRhZ0xpc3QpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgiLmFkZFRhZ3MiKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHNhdmVUYWdVcmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdzOiBKU09OLnN0cmluZ2lmeShhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRJZDogYWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjQ29uZmlnSWQ6IGV4ZWNDb25maWdJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuYWpheC5yZWxvYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuU2luZ2xlQWxlcnRUYWdNb2RhbCA9IGZ1bmN0aW9uICh0YWJsZU9iaiwgdGFnc09iaikgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZWRpdEFsZXJ0VGFncycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgaW5kZXggPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICAgICAgaWYgKGlzQWJzdHJhY3RWaWV3T3JDYXNlVmlldyhpbmRleCkpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggLyAyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHRhYmxlT2JqLnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIHZhciBleGVjQ29uZmlnSWQgPSBwYXJlbnRfcm93LmZpbmQoJy5leGVjQ29uZmlnSWQnKS5hdHRyKCJ2YWx1ZSIpOwogICAgICAgICAgICB2YXIgYWxlcnRUYWdNb2RhbE9iaiA9ICQoJyNhbGVydFRhZ01vZGFsJyk7CiAgICAgICAgICAgIHZhciAkc2luZ2xlQ2FzZUFsZXJ0VGFncyA9IGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpOwogICAgICAgICAgICB2YXIgJGdsb2JhbFRhZ3MgPSBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNnbG9iYWxUYWdzJyk7CiAgICAgICAgICAgIGFwcGx5U2VsZWN0MkZvclRhZ3MoJHNpbmdsZUNhc2VBbGVydFRhZ3MsIGZldGNoVGFnc1VybCwgJ0Nhc2UgU2VyaWVzIENhdGVnb3JpZXMnLCB0cnVlKTsKICAgICAgICAgICAgYXBwbHlTZWxlY3QyRm9yVGFncygkZ2xvYmFsVGFncywgZmV0Y2hUYWdzVXJsLCAnR2xvYmFsIENhdGVnb3JpZXMnLCBmYWxzZSk7CiAgICAgICAgICAgICRzaW5nbGVDYXNlQWxlcnRUYWdzLmZpbmQoJ29wdGlvbicpLnJlbW92ZSgpCiAgICAgICAgICAgICRnbG9iYWxUYWdzLmZpbmQoJ29wdGlvbicpLnJlbW92ZSgpCiAgICAgICAgICAgICRzaW5nbGVDYXNlQWxlcnRUYWdzLnZhbChudWxsKS50cmlnZ2VyKCJjaGFuZ2UiKTsKICAgICAgICAgICAgJGdsb2JhbFRhZ3MudmFsKG51bGwpLnRyaWdnZXIoImNoYW5nZSIpOwogICAgICAgICAgICAkLmVhY2gocm93T2JqZWN0LmNhc2VTZXJpZXNUYWdzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0gbmV3IE9wdGlvbih2YWx1ZSwgdmFsdWUsIHRydWUsIHRydWUpOwogICAgICAgICAgICAgICAgJHNpbmdsZUNhc2VBbGVydFRhZ3MuYXBwZW5kKG9wdGlvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkLmVhY2gocm93T2JqZWN0Lmdsb2JhbFRhZ3MsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKHZhbHVlLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAkZ2xvYmFsVGFncy5hcHBlbmQob3B0aW9uKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNnbG9iYWxUYWdzJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgIHZhciBlbmFibGVDYXNlU2VyaWVzVGFncyA9IHJvd09iamVjdC5pc0Nhc2VTZXJpZXNHZW5lcmF0ZWQ7CiAgICAgICAgICAgIGlmICghZW5hYmxlQ2FzZVNlcmllc1RhZ3MpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLmF0dHIoJ2Rpc2FibGVkJywgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmoubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCIuYWRkVGFncyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBzYXZlVGFnVXJsLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdzOiBKU09OLnN0cmluZ2lmeShhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbFRhZ3M6IEpTT04uc3RyaW5naWZ5KGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI2dsb2JhbFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRDYXNlU2VyaWVzVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5kZWxldGVkQ2FzZVNlcmllc1RhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkR2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5kZWxldGVkR2xvYmFsVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkQ2FzZVNlcmllc1RhZ3M6IEpTT04uc3RyaW5naWZ5KHRhZ3NPYmouYWRkZWRDYXNlU2VyaWVzVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkR2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5hZGRlZEdsb2JhbFRhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICBleGVjQ29uZmlnSWQ6IGV4ZWNDb25maWdJZAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocGF5bG9hZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlT2JqLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ3N1Y2Nlc3MnLCAndG9wIHJpZ2h0JywgIlN1Y2Nlc3MiLCBwYXlsb2FkLm1lc3NhZ2UsIHthdXRvSGlkZURlbGF5OiAyMDAwfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ2Vycm9yJywgJ3RvcCByaWdodCcsICJFcnJvciIsIHBheWxvYWQubWVzc2FnZSwge2F1dG9IaWRlRGVsYXk6IDIwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2luZ2xlLWNhc2UtYWxlcnQtc3Bpbm5lcicpLmFkZENsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoJyNzaW5nbGUtY2FzZS1hbGVydC1zcGlubmVyJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIHBvcHVsYXRlQWR2YW5jZWRGaWx0ZXJTZWxlY3QgPSBmdW5jdGlvbiAoYWxlcnRUeXBlKSB7CgogICAgICAgICQoIi5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24iKS5zZWxlY3QyKHsKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICQuaTE4bi5fKCdzZWxlY3RPbmUnKSwKICAgICAgICAgICAgYWxsb3dDbGVhcjogdHJ1ZSwKICAgICAgICAgICAgYWpheDogewogICAgICAgICAgICAgICAgdXJsOiBmZXRjaEFkdkZpbHRlclVybCwKICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgIHF1aWV0TWlsbGlzOiA1MCwKICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydFR5cGU6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGVybTogcGFyYW1zLnRlcm0gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhcmFtcy5wYWdlIHx8IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heDogcGFyYW1zLm1heCB8fCAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGluZ1NjcmVlbjogY2FsbGluZ1NjcmVlbgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJvY2Vzc1Jlc3VsdHM6IGZ1bmN0aW9uIChkYXRhLCBwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMucGFnZSA9IHBhcmFtcy5wYWdlIHx8IDE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogJC5tYXAoZGF0YS5saXN0LCBmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGZpbHRlci5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWx0ZXIuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcmU6IChwYXJhbXMucGFnZSAqIDMwKSA8IGRhdGEudG90YWxDb3VudAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvL3NlbGVjdCBhZHZhbmNlZCBmaWx0ZXIgYmFzZWQgb24gY3VycmVudCB2aWV3CiAgICAgICAgaWYgKCQoJyNhZHZhbmNlZEZpbHRlclZpZXcnKS52YWwoKSkgewogICAgICAgICAgICB2YXIgYWR2YW5jZWRGaWx0ZXJWaWV3ID0gJC5wYXJzZUpTT04oJCgnI2FkdmFuY2VkRmlsdGVyVmlldycpLnZhbCgpKTsKICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oYWR2YW5jZWRGaWx0ZXJWaWV3Lm5hbWUsIGFkdmFuY2VkRmlsdGVyVmlldy5pZCwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICQoIi5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24iKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICB9CgogICAgICAgICQoJyNhZGRBZHZhbmNlZEZpbHRlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2lnbmFsLmFkdmFuY2VkRmlsdGVyLmluaXRpYWxpemVBZHZhbmNlZEZpbHRlcnMoJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwnKSk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNzZWxlY3RPcGVyYXRvcicpLmVtcHR5KCkuYXBwZW5kKCc8b3B0aW9uIHNlbGVjdGVkPSJzZWxlY3RlZCIgdmFsdWU9IiI+U2VsZWN0IE9wZXJhdG9yPC9vcHRpb24+Jyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNuYW1lJykudmFsKCcnKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2Rlc2NyaXB0aW9uJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3F1ZXJ5SlNPTicpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNhbGVydFR5cGUnKS52YWwoJycpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjYWR2YW5jZWRGaWx0ZXJTaGFyZWRXaXRoJykuZW1wdHkoKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2J1aWxkZXJBbGwnKS5maW5kKCcuZXhwcmVzc2lvbicpLnJlbW92ZSgpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZGVsZXRlQWR2RmlsdGVyJykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgLmRlbGV0ZUFkdkZpbHRlcicpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjYWRkRXhwcmVzc2lvbicpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZmlsdGVyc1dpdGhvdXRTYXZpbmcnKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuc2F2ZUFkdmFuY2VkRmlsdGVycycpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpLm1vZGFsKCdzaG93Jyk7CgogICAgICAgIH0pOwoKICAgICAgICAkKCcjZWRpdEFkdmFuY2VkRmlsdGVyJykudW5iaW5kKCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgYWR2YW5jZWRGaWx0ZXJJZCA9ICQoJy5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24nKS52YWwoKTsKICAgICAgICAgICAgaWYgKGFkdmFuY2VkRmlsdGVySWQpIHsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBmZXRjaEFkdmFuY2VkRmlsdGVySW5mb1VybCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7J2FkdmFuY2VkRmlsdGVyLmlkJzogYWR2YW5jZWRGaWx0ZXJJZH0sCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc0Rpc2FibGVkID0gKHJlc3VsdC5pc0ZpbHRlclVwZGF0ZUFsbG93ZWQgPT0gdHJ1ZSkgPyBmYWxzZSA6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3NlbGVjdE9wZXJhdG9yJykuZW1wdHkoKS5hcHBlbmQoJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iIj5TZWxlY3QgT3BlcmF0b3I8L29wdGlvbj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI25hbWUnKS52YWwocmVzdWx0Lm5hbWUpLmF0dHIoImRpc2FibGVkIiwgaXNEaXNhYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNuYW1lJykudmFsKHJlc3VsdC5uYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2Rlc2NyaXB0aW9uJykudmFsKHJlc3VsdC5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNxdWVyeUpTT04nKS52YWwocmVzdWx0LkpTT05RdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNhbGVydFR5cGUnKS52YWwoYWxlcnRUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2ZpbHRlcklkJykudmFsKGFkdmFuY2VkRmlsdGVySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjc2hhcmVBZHZGaWx0ZXJJZCcpLmh0bWwocmVzdWx0LnNoYXJlV2l0aEVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZmlsdGVyc1dpdGhvdXRTYXZpbmcnKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZGVsZXRlQWR2RmlsdGVyJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2FkZEV4cHJlc3Npb24nKS5hdHRyKCJkaXNhYmxlZCIsIGlzRGlzYWJsZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZGVsZXRlQWR2RmlsdGVyJykuYXR0cigiZGlzYWJsZWQiLCBpc0Rpc2FibGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgLnNhdmVBZHZhbmNlZEZpbHRlcnMnKS5hdHRyKCJkaXNhYmxlZCIsIGlzRGlzYWJsZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAubW9kYWwtdGl0bGUnKS5odG1sKCJFZGl0IEZpbHRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWR2YW5jZWRGaWx0ZXIuaW5pdGlhbGl6ZUFkdmFuY2VkRmlsdGVycygpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLm9uKCJjaGFuZ2UiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgb3BlbkFsZXJ0Q29tbWVudE1vZGFsOiBvcGVuQWxlcnRDb21tZW50TW9kYWwsCiAgICAgICAgb3BlbkNhc2VIaXN0b3J5TW9kYWw6IG9wZW5DYXNlSGlzdG9yeU1vZGFsLAogICAgICAgIHJlc3RhcnRSZXZpZXc6IHJlc3RhcnRSZXZpZXcsCiAgICAgICAgb3BlblNpbWlsYXJDYXNlc01vZGFsOiBvcGVuU2ltaWxhckNhc2VzTW9kYWwsCiAgICAgICAgYXBwbHlCdXNpbmVzc1J1bGVzOiBhcHBseUJ1c2luZXNzUnVsZXMsCiAgICAgICAgc2hvd0F0dGFjaG1lbnRNb2RhbDogb3BlbkF0dGFjaG1lbnRNb2RhbCwKICAgICAgICBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzOiBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzLAogICAgICAgIGVuYWJsZU1lbnVUb29sdGlwczogZW5hYmxlTWVudVRvb2x0aXBzLAogICAgICAgIGRpc2FibGVUb29sdGlwczogZGlzYWJsZVRvb2x0aXBzLAogICAgICAgIHNvcnRJY29uSGFuZGxlcjogc29ydEljb25IYW5kbGVyLAogICAgICAgIGlzQWxlcnRQZXJzaXN0ZWRJblNlc3Npb25TdG9yYWdlOiBpc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZSwKICAgICAgICByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlOiByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlLAogICAgICAgIG9wZW5TYXZlVmlld01vZGFsOiBvcGVuU2F2ZVZpZXdNb2RhbCwKICAgICAgICBjcmVhdGVTb3J0aW5nTWFwOiBjcmVhdGVTb3J0aW5nTWFwLAogICAgICAgIGNyZWF0ZUZpbHRlck1hcDogY3JlYXRlRmlsdGVyTWFwLAogICAgICAgIGNyZWF0ZUxpc3RPZkluZGV4OiBjcmVhdGVMaXN0T2ZJbmRleCwKICAgICAgICBvcGVuQWxlcnRUYWdNb2RhbDogb3BlbkFsZXJ0VGFnTW9kYWwsCiAgICAgICAgc2V0U29ydE9yZGVyOiBzZXRTb3J0T3JkZXIsCiAgICAgICAgb3BlblNpbmdsZUFsZXJ0VGFnTW9kYWw6IG9wZW5TaW5nbGVBbGVydFRhZ01vZGFsLAogICAgICAgIGdlbmVyYXRlVmlld0luZm86IGdlbmVyYXRlVmlld0luZm8sCiAgICAgICAgcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdDogcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdAogICAgfQoKfSkoKTsKCmZ1bmN0aW9uIHNob3dFcnJvck1lc3NhZ2VJbk1vZGFsKCRtb2RhbCwgdGV4dCkgewogICAgY2xlYXJfZXJyb3JzKCk7CiAgICBpZiAodGV4dCkgewogICAgICAgIHRleHQgPSB0ZXh0OwogICAgfSBlbHNlIHsKICAgICAgICB0ZXh0ID0gJ1BsZWFzZSBmaWxsICB0aGUgcmVxdWlyZWQgRmllbGRzJzsKICAgIH0KICAgIHZhciBhbGVydEh0bWwgPSBnZXRFcnJvck1lc3NhZ2VIdG1sKHRleHQpOwogICAgJG1vZGFsLmZpbmQoJy5tb2RhbC1ib2R5JykucHJlcGVuZChhbGVydEh0bWwpOwp9CgpmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2VIdG1sKG1zZykgewogICAgdmFyIGFsZXJ0SHRtbCA9ICc8ZGl2IGNsYXNzPSJhbGVydCBhbGVydC1kYW5nZXIgYWxlcnQtZGlzbWlzc2libGUiIHJvbGU9ImFsZXJ0Ij4gJyArCiAgICAgICAgJzxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0iYWxlcnQiPiAnICsKICAgICAgICAnPHNwYW4gYXJpYS1oaWRkZW49InRydWUiPiZ0aW1lczs8L3NwYW4+ICcgKwogICAgICAgICc8c3BhbiBjbGFzcz0ic3Itb25seSI+PGc6bWVzc2FnZSBjb2RlPSJkZWZhdWx0LmJ1dHRvbi5jbG9zZS5sYWJlbCIgLz48L3NwYW4+ICcgKwogICAgICAgICc8L2J1dHRvbj4gJyArIG1zZzsKICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGFsZXJ0SHRtbDsKfQoKdmFyIGNsZWFyX2Vycm9ycyA9IGZ1bmN0aW9uICgpIHsKICAgICQoJy5tb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKTsKfTsKCmZ1bmN0aW9uIHNlYXJjaChuYW1lS2V5LCBteUFycmF5KSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG15QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobXlBcnJheVtpXS5uYW1lID09PSBuYW1lS2V5KSB7CiAgICAgICAgICAgIHJldHVybiBteUFycmF5W2ldOwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwsIHRvcGljT2JqKSB7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnZhbCh0b3BpY09iai5zdGFydERhdGUpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKHRvcGljT2JqLmVuZERhdGUpOwogICAgJG1vZGFsLmZpbmQoJy5wcm9kdWN0LXNwYW4nKS50ZXh0KGdldFByb2R1Y3ROYW1lTGlzdChKU09OLnBhcnNlKHRvcGljT2JqLnByb2R1Y3RzKSkpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS5hdHRyKCJkaXNhYmxlZCIsICIiKTsKICAgICRtb2RhbC5maW5kKCcjZW5kRGF0ZScpLmF0dHIoImRpc2FibGVkIiwgIiIpOwogICAgaWYgKHRvcGljT2JqLnByb2R1Y3RzKSB7CiAgICAgICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykuYXR0cigiZGlzYWJsZWQiLCAiIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGRlcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwpIHsKICAgIHZhciBwcm9kdWN0SnNvbiA9ICRtb2RhbC5maW5kKCcucHJvZHVjdC1qc29uLWNvbnRhaW5lcicpLnZhbCgpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS52YWwoIiIpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKCIiKTsKICAgICRtb2RhbC5maW5kKCcjcHJvZHVjdCcpLnZhbCgiIik7CiAgICAkbW9kYWwuZmluZCgnLnByb2R1Y3Qtc3BhbicpLnRleHQoZ2V0UHJvZHVjdE5hbWVMaXN0KEpTT04ucGFyc2UocHJvZHVjdEpzb24pKSk7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAkbW9kYWwuZmluZCgnI2VuZERhdGUnKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVQcm9kdWN0SnNvbihwcm9kdWN0SWQsIHByb2R1Y3ROYW1lLCBsZXZlbCkgewogICAgdmFyIHRvcGljUHJvZHVjdFZhbHVlcyA9IHsiMSI6IFtdLCAiMiI6IFtdLCAiMyI6IFtdLCAiNCI6IFtdLCAiNSI6IFtdfTsKICAgIHRvcGljUHJvZHVjdFZhbHVlc1tsZXZlbF0ucHVzaCh7bmFtZTogcHJvZHVjdE5hbWUsIGlkOiBwcm9kdWN0SWR9KTsKICAgIHJldHVybiB0b3BpY1Byb2R1Y3RWYWx1ZXM7Cn0KCmZ1bmN0aW9uIGdldFByb2R1Y3ROYW1lTGlzdChvYmopIHsKICAgIHZhciBwcm9kdWN0QXJyYXkgPSBbXTsKICAgIHZhciBvYmpBcnJheSA9IG9ialsnMyddOwogICAgJC5lYWNoKG9iakFycmF5LCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgcHJvZHVjdEFycmF5LnB1c2godmFsdWUubmFtZSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9kdWN0QXJyYXkuam9pbignLCcpOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0SnNvbihhcHBsaWNhdGlvbk5hbWUsIHJvdykgewogICAgdmFyIHByb2R1Y3RKc29uOwogICAgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PSAiQWQtSG9jIEFsZXJ0IikgewogICAgICAgIGlmIChyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpCiAgICAgICAgICAgIHByb2R1Y3RKc29uID0gSlNPTi5wYXJzZShyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJwcm9kdWN0TmFtZSJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgIHZhciBwcm9kdWN0SWQgPSByb3cuZmluZCgnLnJvdy1wcm9kdWN0LWlkJykudmFsKCk7CiAgICAgICAgdmFyIGxldmVsID0gcm93LmZpbmQoJy5yb3ctbGV2ZWwtaWQnKS52YWwoKTsKICAgICAgICBpZiAoIWxldmVsKSB7CiAgICAgICAgICAgIGxldmVsID0gMzsKICAgICAgICB9CiAgICAgICAgcHJvZHVjdEpzb24gPSBnZW5lcmF0ZVByb2R1Y3RKc29uKHByb2R1Y3RJZCwgcHJvZHVjdE5hbWUsIGxldmVsKTsKICAgIH0KICAgIHJldHVybiBwcm9kdWN0SnNvbjsKfQoKZnVuY3Rpb24gYXBwbHlTZWxlY3QyRm9yVGFncygkc2VsZWN0b3IsIHVybCwgcGxhY2VIb2xkZXJUZXh0LCBpc0Nhc2VTZXJpZXNUYWcpIHsKICAgICRzZWxlY3Rvci5zZWxlY3QyKHsKICAgICAgICBtaW5pbXVtSW5wdXRMZW5ndGg6IDAsCiAgICAgICAgbXVsdGlwbGU6IHRydWUsCiAgICAgICAgdGFnczogdHJ1ZSwKICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2VIb2xkZXJUZXh0LAogICAgICAgIGFsbG93Q2xlYXI6IHRydWUsCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBjcmVhdGVUYWc6IGZ1bmN0aW9uICh0YWcpIHsKCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBvcHRpb24gaXMgYWxyZWFkeSB0aGVyZQogICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAkc2VsZWN0b3IuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoJC50cmltKHRhZy50ZXJtKS50b1VwcGVyQ2FzZSgpID09PSAkLnRyaW0oJCh0aGlzKS50ZXh0KCkpLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICBwcmV2VGFnID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gaWYgaXQncyBub3QgdGhlcmUsIHRoZW4gc2hvdyB0aGUgc3VnZ2VzdGlvbgogICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0odGFnLnRlcm0pLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbSh0YWcudGVybSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0ocHJldlRhZy50ZXh0KCkpLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbShwcmV2VGFnLnRleHQoKSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFqYXg6IHsKICAgICAgICAgICAgcXVpZXRNaWxsaXM6IDI1MCwKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdGVybTogcGFyYW1zLnRlcm0sCiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFyYW1zLnBhZ2UgfHwgMSwKICAgICAgICAgICAgICAgICAgICBtYXg6IDMwLAogICAgICAgICAgICAgICAgICAgIGxhbmc6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgaXNDYXNlU2VyaWVzVGFnOiBpc0Nhc2VTZXJpZXNUYWcKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByb2Nlc3NSZXN1bHRzOiBmdW5jdGlvbiAoZGF0YSwgcGFyYW1zKSB7CiAgICAgICAgICAgICAgICBwYXJhbXMucGFnZSA9IHBhcmFtcy5wYWdlIHx8IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IGRhdGEubGlzdCwKICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vcmU6IChwYXJhbXMucGFnZSAqIDMwKSA8IGRhdGEudG90YWxDb3VudAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gc2hvd0NvbW1lbnRJY29uKGN1cnJlbnRSb3cpIHsKICAgIHZhciAkYnRuR3JvdXAgPSAkKGN1cnJlbnRSb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuZHJvcGRvd24tdG9nZ2xlJykuYWZ0ZXIoJzxpIGNsYXNzPSJtZGkgbWRpLWNoYXQgYmx1ZS0yIGZvbnQtMTMgcG9zLWFiIGNvbW1lbnQiIHRpdGxlPSInICsgJC5pMThuLl8oJ2NvbW1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nKTsKICAgIH0KfQoKZnVuY3Rpb24gcmVtb3ZlQ29tbWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLm5leHQoJ2knKS5yZW1vdmUoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlQXR0YWNobWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICBpZiAoJCgkYnRuR3JvdXApLmZpbmQoJy5jb21tZW50JykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgJCgkYnRuR3JvdXApLmZpbmQoJy5kcm9wZG93bi10b2dnbGUnKS5uZXh0KCdpJykucmVtb3ZlKCk7CiAgICB9IGVsc2UgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLm5leHQoJ2knKS5yZW1vdmUoKTsKICAgIH0KfQoKZnVuY3Rpb24gc2hvd0F0dGFjaG1lbnRJY29uKHRyUm93KSB7CiAgICB2YXIgJGJ0bkdyb3VwID0gJCh0clJvdykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuYXR0YWNoJykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0KICAgIH0KfQoKdmFyIGlzU2FmZXR5TGVhZEFsbG93ZWQgPSBmdW5jdGlvbiAobGlzdFByb2R1Y3RJZHMsIHNlbGVjdGVkUHJvZHVjdElkKSB7CiAgICByZXR1cm4gbGlzdFByb2R1Y3RJZHMuaW5kZXhPZihzZWxlY3RlZFByb2R1Y3RJZCkgIT09IC0xCn07Cgp2YXIgc2V0Q29sdW1uU2VxID0gZnVuY3Rpb24gKG1hcFNlcSkgewogICAgY29sdW1uU2VxID0gbWFwU2VxCn0KCnZhciB1cGRhdGVFeGlzdGluZ1ZpZXcgPSBmdW5jdGlvbih2aWV3SW5mbyl7CiAgICB2YXIgcmVxdWVzdCA9IG5ldyBPYmplY3QoKQogICAgdmFyIHNoYXJlZFdpdGhEYXRhID0gJCgnI3ZpZXdTaGFyZWRXaXRoRWRpdCcpLnZhbCgpID8gSlNPTi5zdHJpbmdpZnkoJCgnI3ZpZXdTaGFyZWRXaXRoRWRpdCcpLnZhbCgpKSA6IG51bGw7CiAgICByZXF1ZXN0WyduYW1lJ10gPSAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKTsKICAgIHJlcXVlc3RbJ2ZpbHRlck1hcCddID0gSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKTsKICAgIHJlcXVlc3RbJ2NvbHVtbkxpc3QnXSA9IHZpZXdJbmZvLm5vdFZpc2libGVDb2x1bW4udG9TdHJpbmcoKTsKICAgIHJlcXVlc3RbJ2FsZXJ0VHlwZSddID0gYXBwbGljYXRpb25OYW1lOwogICAgcmVxdWVzdFsnaWQnXSA9ICQoJy52aWV3U2VsZWN0JykudmFsKCk7CiAgICByZXF1ZXN0Wydzb3J0aW5nJ10gPSBKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pOwogICAgcmVxdWVzdFsnYWR2YW5jZWRGaWx0ZXInXSA9IHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyOwogICAgcmVxdWVzdFsndmlld1NoYXJlZFdpdGgnXSA9IHNoYXJlZFdpdGhEYXRhOwogICAgJC5hamF4KHsKICAgICAgICB1cmw6IHVwZGF0ZVZpZXdVcmwsCiAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgIGRhdGE6IHJlcXVlc3QsCiAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICB2YXIgcGFnZVVSTCA9ICQobG9jYXRpb24pLmF0dHIoImhyZWYiKTsKICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigidmlld0lkIikgIT0gLTEpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHBhZ2VVUkwuc2xpY2UoMCwgcGFnZVVSTC5pbmRleE9mKCJ2aWV3SWQiKSArIDcpICsgZGF0YS52aWV3SWQKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwYWdlVVJMLmluZGV4T2YoIiMiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VVUkwgPSBwYWdlVVJMLnNsaWNlKDAsIHBhZ2VVUkwuaW5kZXhPZigiIyIpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcGFnZVVSTCArICImdmlld0lkPSIgKyBkYXRhLnZpZXdJZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGRhdGEuZXJyb3JNZXNzYWdlICE9ICcnKXsKICAgICAgICAgICAgICAgIHNob3dFcnJvck5vdGlmaWNhdGlvbihkYXRhLmVycm9yTWVzc2FnZSwgMTAwMDApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSkKfQoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fQoKc2lnbmFsLmFsZXJ0Q29tbWVudHMgPSAoZnVuY3Rpb24gKCkgewoKICAgIHZhciBsaXN0Q29tbWVudHMgPSBmdW5jdGlvbiAoY2FzZUpzb24pIHsKCiAgICAgICAgLy9Nb2RhbCBvYmplY3QKICAgICAgICB2YXIgY29tbWVudE1vZGFsID0gJCgnI2NvbW1lbnRNb2RhbCcpOwoKICAgICAgICAvL1BvcHVsYXRlIHRoZSBleGlzdGluZyBjb21tZW50cyBhbmQgYmluZCBldmVudHMgdG8gdGhlbS4KICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwoKICAgICAgICAvL1NldCB2YWx1ZXMgdG8gdGhlIG1vZGFsIGVsZW1lbnRzLgogICAgICAgIHZhciBjb21tZW50TWV0YUluZm8gPSAiIgogICAgICAgIGlmIChjYXNlSnNvbi5hbGVydFR5cGUgPT0gIkFnZ3JlZ2F0ZSBDYXNlIEFsZXJ0IikgewogICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAnPHNwYW4gaWQ9InByb2R1Y3ROYW1lIj4nICsgY2FzZUpzb24ucHJvZHVjdE5hbWUgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJldmVudE5hbWUiPicgKyBjYXNlSnNvbi5ldmVudE5hbWUgKyAnPC9zcGFuPicKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAnPHNwYW4gaWQ9ImNhc2VOdW1iZXIiPicgKyBjYXNlSnNvbi5jYXNlTnVtYmVyICsgJzwvc3Bhbj4gLSA8c3BhbiBpZD0icHJvZHVjdEZhbWlseSI+JyArIGNhc2VKc29uLnByb2R1Y3RGYW1pbHkgKyAnPC9zcGFuPicKICAgICAgICB9CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50LW1ldGEtaW5mbyIpLmh0bWwoY29tbWVudE1ldGFJbmZvKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2FwcGxpY2F0aW9uIikuaHRtbChjYXNlSnNvbi5hbGVydFR5cGUpOwogICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgIGJpbmRTYXZlQ29tbWVudChjb21tZW50TW9kYWwpOwogICAgfTsKCiAgICB2YXIgcG9wdWxhdGVDb21tZW50cyA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwsIGNhc2VKc29uLCBvblNpZ25hbFNjcmVlbikgewogICAgICAgIHZhciB1cGRhdGVkQ29tbWVudHMgPSAkKCIjY29tbWVudGJveCIpLnZhbCgpOwogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvYWxlcnRDb21tZW50L2xpc3RDb21tZW50cyIsCiAgICAgICAgICAgIGRhdGE6IGNhc2VKc29uLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNuby1jb21tZW50cyIpLmFkZENsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94JykucmVtb3ZlQ2xhc3MoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIlVwZGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGlmKHVwZGF0ZWRDb21tZW50cy5sZW5ndGggPj0gcmVzdWx0LmNvbW1lbnRzLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCh1cGRhdGVkQ29tbWVudHMpOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwocmVzdWx0LmNvbW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwocmVzdWx0LmlkKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmNyZWF0ZWRCeSIpLnRleHQoIkxhc3QgTW9kaWZpZWQgYnkgIiArIHJlc3VsdC5tb2RpZmllZEJ5ICsgIiBvbiAiICsgcmVzdWx0LmRhdGVVcGRhdGVkKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGlzQ29tbWVudEFkZGVkICE9ICd1bmRlZmluZWQnICYmIGlzQ29tbWVudEFkZGVkICYmIG9uU2lnbmFsU2NyZWVuKXsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCJBZGQiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjbm8tY29tbWVudHMiKS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwoKICAgICAgICAgICAgICAgIH1lbHNlIGlmKHR5cGVvZiBpc0NvbW1lbnRBZGRlZCAhPSAndW5kZWZpbmVkJyAmJiBpc0NvbW1lbnRBZGRlZCl7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgiQWRkIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI25vLWNvbW1lbnRzIikucmVtb3ZlQ2xhc3MoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94JykuYWRkQ2xhc3MoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCJBZGQiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94Jykub24oImtleXVwIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmKGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCk9PSIiICYmIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLnZhbCgpPT0iIikKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB9LAogICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlVuYWJsZSB0byBsb2FkIHByZXZpb3VzIGNvbW1lbnRzLiIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kU2F2ZUNvbW1lbnQgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsKSB7CgogICAgICAgIC8vQWRkIGNsaWNrIGV2ZW50IHRvIHRoZSBhZGQgY29tbWVudCBidXR0b24uCiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5hZGQtY29tbWVudHMiKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iakFycmF5ID0gW107CiAgICAgICAgICAgIHZhciBhcHBUeXBlID0gJCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICB2YXIgdmFsaWRhdGVkU2lnbmFsSWQgPSAkKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS5odG1sKCk7CiAgICAgICAgICAgIHZhciB0b3BpY0lkID0gJCgiI3RvcGljSWQiKS5odG1sKCk7CgogICAgICAgICAgICBpZiAoYXBwVHlwZSA9PSAnJykgewogICAgICAgICAgICAgICAgYXBwVHlwZSA9IGNvbW1lbnRNb2RhbC5maW5kKCIjYXBwbGljYXRpb24iKS5odG1sKCk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZWRTaWduYWxJZCA9IGNvbW1lbnRNb2RhbC5maW5kKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS5odG1sKCk7CiAgICAgICAgICAgICAgICB0b3BpY0lkID0gY29tbWVudE1vZGFsLmZpbmQoIiN0b3BpY0lkIikuaHRtbCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iajsKICAgICAgICAgICAgdmFyIHVybDsKICAgICAgICAgICAgdmFyIGRhdGE7CiAgICAgICAgICAgIC8vQ2FzZSBKU09OLgogICAgICAgICAgICBjYXNlSnNvbk9iaiA9IHsKICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhcHBUeXBlLAogICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogY29tbWVudE1vZGFsLmZpbmQoIiNwcm9kdWN0TmFtZSIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBjb21tZW50TW9kYWwuZmluZCgiI2V2ZW50TmFtZSIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJjb21tZW50cyI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgpLAogICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogdmFsaWRhdGVkU2lnbmFsSWQsCiAgICAgICAgICAgICAgICAiYXNzaWduZWRUbyI6IGNvbW1lbnRNb2RhbC5maW5kKCIjYXNzaWduZWRUbyIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY29tbWVudE1vZGFsLmZpbmQoIiNleGVjdXRlZENvbmZpZ0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImNvbmZpZ0lkIiA6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29uZmlnSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAidG9waWNJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJwcm9kdWN0RmFtaWx5IjogY29tbWVudE1vZGFsLmZpbmQoIiNwcm9kRmFtaWx5IikuaHRtbCgpLAogICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjb21tZW50TW9kYWwuZmluZCgiI2Nhc2VObyIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJwcm9kdWN0SWQiOiBwYXJzZUludChjb21tZW50TW9kYWwuZmluZCgiI3Byb2R1Y3RJZCIpLmh0bWwoKSksCiAgICAgICAgICAgICAgICAicHRDb2RlIjogcGFyc2VJbnQoY29tbWVudE1vZGFsLmZpbmQoIiNwdENvZGUiKS5odG1sKCkpCgogICAgICAgICAgICB9OwogICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5LnB1c2goY2FzZUpzb25PYmopOwogICAgICAgICAgICBpZihjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgpKXsKICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC91cGRhdGVDb21tZW50IjsKICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFwcFR5cGUsCiAgICAgICAgICAgICAgICAgICAgImNvbW1lbnQiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAiaWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY29tbWVudE1vZGFsLmZpbmQoIiNleGVjdXRlZENvbmZpZ0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9zYXZlQ29tbWVudCI7CiAgICAgICAgICAgICAgICBkYXRhID0geyJjYXNlSnNvbk9iakFycmF5IjogSlNPTi5zdHJpbmdpZnkoY2FzZUpzb25PYmpBcnJheSl9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNpc1VwZGF0ZWQiKS52YWwoInRydWUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uT2JqQXJyYXlbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY29tbWVudGJveCcpLnZhbCgnJykuYmx1cigpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgYmluZEVkaXRDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCkgewoKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLnByZXZpb3VzLWNvbW1lbnRzIikuZmluZCgnLmVkaXQtY29tbWVudCcpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIudXBkYXRlLWNvbW1lbnQiKS5yZW1vdmVDbGFzcygiaGlkZGVuIik7CiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnQtYXJlYSIpLmF0dHIoJ2Rpc2FibGVkJywgZmFsc2UpOwogICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCJoaWRkZW4iKQogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgYmluZERlbGV0ZUNvbW1lbnQgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsLCBjYXNlSnNvbikgewoKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLnByZXZpb3VzLWNvbW1lbnRzIikuZmluZCgnLmRlbGV0ZS1jb21tZW50JykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaWQgPSB7CiAgICAgICAgICAgICAgICAiaWQiOiAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5jb21tZW50SWQiKS52YWwoKSwKICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLnRleHQoKSwKICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiIDogY2FzZUpzb24uYWRob2NBbGVydElkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9kZWxldGVDb21tZW50IiwKICAgICAgICAgICAgICAgIGRhdGE6IGlkLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kVXBkYXRlQ29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwsIGNhc2VKc29uKSB7CgoKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLnByZXZpb3VzLWNvbW1lbnRzIikuZmluZCgnLnVwZGF0ZS1jb21tZW50JykuY2xpY2soZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuZ2x5cGhpY29uLXBlbmNpbCIpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAgICAgICAgICAgdmFyIGNvbW1lbnREYXRhID0gewogICAgICAgICAgICAgICAgImNvbW1lbnQiOiAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5jb21tZW50LWFyZWEiKS52YWwoKSwKICAgICAgICAgICAgICAgICJpZCI6ICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnRJZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogJCgiI3ZhbGlkYXRlZFNpZ25hbElkIikudGV4dCgpLAogICAgICAgICAgICAgICAgInRvcGljSWQiOiAkKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY2FzZUpzb24uZXhlY3V0ZWRDb25maWdJZCwKICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiIDogY2FzZUpzb24uYWRob2NBbGVydElkCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydENvbW1lbnQvdXBkYXRlQ29tbWVudCIsCiAgICAgICAgICAgICAgICBkYXRhOiBjb21tZW50RGF0YSwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKCiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBsaXN0X2NvbW1lbnRzOiBsaXN0Q29tbWVudHMsCiAgICAgICAgcG9wdWxhdGVfY29tbWVudHM6IHBvcHVsYXRlQ29tbWVudHMsCiAgICAgICAgc2F2ZV9jb21tZW50OiBiaW5kU2F2ZUNvbW1lbnQKICAgIH0KfSkoKTsKCgovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9jb21tb24uanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfYWxlcnRfdXRpbHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfbGlzdF91dGlscy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2FjdGl2aXR5L2FjdGl2aXRpZXMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfaGFuZGxlYmFyX2V4dC5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2RhdGFUYWJsZUFjdGlvbkJ1dHRvbnMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9hbGVydHNfcmV2aWV3L2FsZXJ0X3JldmlldwovLz0gcmVxdWlyZSBhcHAvcHZzL2FsZXJ0Q29tbWVudHMvYWxlcnRDb21tZW50cy5qcwoKdmFyIHVzZXJMb2NhbCA9ICJlbiI7CnZhciBhcHBsaWNhdGlvbk5hbWUgPSAiQWQtSG9jIEFsZXJ0IjsKdmFyIGFwcGxpY2F0aW9uTGFiZWwgPSAiQWQtSG9jIEFsZXJ0IjsKdmFyIHRhYmxlOwp2YXIgZGlyID0gJyc7CnZhciBpbmRleCA9IC0xOwp2YXIgY29tbWVudExpc3Q7CgokLmZuLmRhdGFUYWJsZS5leHQub3JkZXJbJ2RvbS1wcmlvcml0eSddID0gZnVuY3Rpb24gKHNldHRpbmdzLCBjb2wpIHsKICAgIHZhciBqc29uID0gJC5wYXJzZUpTT04ocHJpb3JpdGllcyk7CiAgICByZXR1cm4gdGhpcy5hcGkoKS5jb2x1bW4oY29sLCB7b3JkZXI6ICdpbmRleCd9KS5ub2RlcygpLm1hcChmdW5jdGlvbiAodGQsIGkpIHsKICAgICAgICB2YXIgcHJpb3JpdHkgPSAkKCdhJywgdGQpWzBdLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqc29uLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmIChqc29uW2ldWzBdID09IHByaW9yaXR5KQogICAgICAgICAgICAgICAgcmV0dXJuIGpzb25baV1bMV07CiAgICAgICAgfQogICAgfSk7Cn07CgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICB2YXIgYWxlcnREZXRhaWxzVGFibGU7CiAgICBhc3NpZ25lZFRvRGF0YSA9IFtdOwoKICAgIHZhciBjaGVja2VkSWRMaXN0ID0gW107CiAgICB2YXIgY2hlY2tlZFJvd0xpc3QgPSBbXTsKICAgIHNpZ25hbC5hbGVydFJldmlldy5zZXRTb3J0T3JkZXIoKTsKCgogICAgdmFyIGluaXRBbGVydERldGFpbHNUYWJsZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgdmFyIGlzRmlsdGVyUmVxdWVzdCA9IHRydWU7CiAgICAgICAgdmFyIGZpbHRlclZhbHVlcyA9IFtdOwogICAgICAgIHZhciBwcmVmaXggPSAiYWRob2NfIjsKICAgICAgICBpZiAod2luZG93LnNlc3Npb25TdG9yYWdlKSB7CiAgICAgICAgICAgIGlmIChzaWduYWwuYWxlcnRSZXZpZXcuaXNBbGVydFBlcnNpc3RlZEluU2Vzc2lvblN0b3JhZ2UocHJlZml4KSkgewogICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHByZWZpeCArICJmaWx0ZXJzX3ZhbHVlIikpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnJlbW92ZUZpbHRlcnNGcm9tU2Vzc2lvblN0b3JhZ2UocHJlZml4KTsKICAgICAgICAgICAgICAgIGlzRmlsdGVyUmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0YWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImJvb3RzdHJhcCIsCiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInJvd0NhbGxiYWNrIjogZnVuY3Rpb24gKHJvdywgZGF0YSwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIC8vQmluZCBBc3NpZ25lZFRvIFNlbGVjdCBCb3gKICAgICAgICAgICAgICAgIGFzc2lnbmVkVG9EYXRhLnB1c2goe25hbWU6IGRhdGEuYXNzaWduZWRUb1ZhbHVlLm5hbWUsIGlkOiBkYXRhLmFzc2lnbmVkVG9WYWx1ZS5pZH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2lnbmFsLmxpc3RfdXRpbHMuZmxhZ19oYW5kbGVyKCJhZEhvY0FsZXJ0IiwgInRvZ2dsZUZsYWciKTsKICAgICAgICAgICAgICAgICQoIi5hc3NpZ25lZFRvU2VsZWN0IikuZWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgICAgICAgICAgICAgIHNpZ25hbC51c2VyX2dyb3VwX3V0aWxzLmJpbmRfYXNzaWduX3RvKCQodGhpcyksIHNlYXJjaFVzZXJHcm91cExpc3RVcmwsIGFzc2lnbmVkVG9EYXRhW2ldKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnNvcnRJY29uSGFuZGxlcigpCiAgICAgICAgICAgICAgICBjb2xFbGxpcHNpcygpOwogICAgICAgICAgICAgICAgd2ViVWlQb3BJbml0KCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBmbkluaXRDb21wbGV0ZTogZnVuY3Rpb24gKHNldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICBhc3NpZ25lZFRvRGF0YSA9IFtdOwogICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LmJpbmRHcmlkRHluYW1pY0ZpbHRlcnMoanNvbi5maWx0ZXJzLCBwcmVmaXgsIGpzb24uY29uZmlnSWQpOwoKICAgICAgICAgICAgICAgIHZhciB0aGVEYXRhVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CgogICAgICAgICAgICAgICAgJCgiI2Nsb3NlZENoZWNrQm94IikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIC8vVE9ETzogRmlsdGVycyBmb3IgZ2lyZCB0byBiZSBpbnRyb2R1Y2VkLgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1jb2x1bW4tZmlsdGVycyIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWxlID0gJCgnLnlhZGNmLWZpbHRlci13cmFwcGVyJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlucHV0RWxlID0gJCgnLnlhZGNmLWZpbHRlcicpOwogICAgICAgICAgICAgICAgICAgIGlmIChlbGUuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBlbGUuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dEVsZS5maXJzdCgpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoZURhdGFUYWJsZS5kcmF3KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoJy55YWRjZi1maWx0ZXItd3JhcHBlcicpLmhpZGUoKTsKICAgICAgICAgICAgICAgIHRoZURhdGFUYWJsZS5kcmF3KCk7CiAgICAgICAgICAgICAgICBzaWduYWwuZmllbGRNYW5hZ2VtZW50LmluaXQoJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLCAnI2FsZXJ0c0RldGFpbHNUYWJsZScsIDQpOwogICAgICAgICAgICAgICAgYmluZEFzc2lnblRvU2VsZWN0aW9uKHNlYXJjaFVzZXJHcm91cExpc3RVcmwsIGFzc2lnblRvR3JvdXBVcmwsIHRhYmxlKTsKICAgICAgICAgICAgICAgIGFkZEdyaWRTaG9ydGN1dHMoJyNhbGVydHNEZXRhaWxzVGFibGUnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICJhamF4IjogewogICAgICAgICAgICAgICAgInVybCI6IGxpc3RDb25maWdVcmwgKyAnJmlzRmlsdGVyUmVxdWVzdD0nICsgaXNGaWx0ZXJSZXF1ZXN0ICsgJyZmaWx0ZXJzPScgKyBKU09OLnN0cmluZ2lmeShmaWx0ZXJWYWx1ZXMpLAogICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLAogICAgICAgICAgICAgICAgImRhdGEiOiBmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgICAgIGQuZGlzcG9zaXRpb24gPSAkKCcjZGlzcG9zaXRpb25GaWx0ZXInKS52YWwoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJkYXRhU3JjIjogImRhdGEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJhYVNvcnRpbmciOiBbXSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiA1MCwKICAgICAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKICAgICAgICAgICAgImNvbFJlb3JkZXIiOiB7CiAgICAgICAgICAgICAgICAicmVhbHRpbWUiOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICAiTVNHX0xPQURJTkciOiAnJywKICAgICAgICAgICAgIm9MYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJzUHJvY2Vzc2luZyI6ICc8ZGl2IGNsYXNzPSJncmlkLWxvYWRpbmciPjxpbWcgc3JjPSIvc2lnbmFsL2Fzc2V0cy9zcGlubmVyLmdpZiIgd2lkdGg9IjMwIiBhbGlnbj0ibWlkZGxlIiAvPjwvZGl2PicsCiAgICAgICAgICAgICAgICAic1plcm9SZWNvcmRzIjogIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIiwgInNFbXB0eVRhYmxlIjogIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzUwLCAxMDAsIDIwMCwgMTAwMCwgLTFdLCBbNTAsIDEwMCwgMjAwLCAxMDAwLCAiQWxsIl1dLAogICAgICAgICAgICBzZWFyY2hpbmc6IHRydWUsCiAgICAgICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInNlbGVjdGVkIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJhbGVydC1jaGVjay1ib3ggZWRpdG9yLWFjdGl2ZSBjb3B5LXNlbGVjdCIgZGF0YS1maWVsZD0iYWxlcnRJZCIgZGF0YS1pZD0nICsgcm93LmlkICsgJyAvPic7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogdHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZHJvcGRvd24iLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiY29sLW1pbi0yMCIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25CdXR0b24gPSAnPGRpdiBzdHlsZT0iZGlzcGxheTogYmxvY2s7IiBjbGFzcz0iYnRuLWdyb3VwIGRyb3Bkb3duIGRhdGFUYWJsZUhpZGVDZWxsQ29udGVudCIgYWxpZ249ImNlbnRlciI+IFwKICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiB0YWJpbmRleD0iMCI+IFwKICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImN1cnNvcjogcG9pbnRlcjtmb250LXNpemU6IDEyNSU7IiBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1vcHRpb24tdmVydGljYWwiPjwvc3Bhbj48c3BhbiBjbGFzcz0ic3Itb25seSI+VG9nZ2xlIERyb3Bkb3duPC9zcGFuPiBcCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYocm93Lm5vdGVzICE9ICcnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiArPSAgJzxpIGNsYXNzPSJtZGkgbWRpLWNoYXQgYmx1ZS0yIGZvbnQtMTMgcG9zLWFiIGNvbW1lbnQiIHRpdGxlPSInICsgJC5pMThuLl8oJ2NvbW1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gJzx1bCBjbGFzcz0iZHJvcGRvd24tbWVudSBtZW51LWNvc3kiIHJvbGU9Im1lbnUiPjxsaSByb2xlPSJwcmVzZW50YXRpb24iPjxhIHRhYmluZGV4PSIwIiBjbGFzcz0icmV2aWV3LXJvdy1pY29uIGNvbW1lbnQtaWNvbiIgZGF0YS1pbmZvPSJyb3ciPjxzcGFuIGNsYXNzPSJmYSBmYS1jb21tZW50IG0tci0xMCIgPjwvc3Bhbj4nICsgJC5pMThuLl8oJ2NvbW1lbnRzJykgKyAnPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25CdXR0b247CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiJkcm9wRG93biIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInByaW9yaXR5IiwKICAgICAgICAgICAgICAgICAgICAiYVRhcmdldHMiOiBbInByaW9yaXR5Il0sCiAgICAgICAgICAgICAgICAgICAgIm9yZGVyRGF0YVR5cGUiOiAiZG9tLXByaW9yaXR5IiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzUHJpb3J0eUNoYW5nZUFsbG93ZWQgPSAoaXNQcm9kdWN0U2VjdXJpdHkgPT0gJ3RydWUnICYmIGlzU2FmZXR5TGVhZEFsbG93ZWQoYWxsb3dlZFByb2R1Y3RzQXNTYWZldHlMZWFkLCByb3cucHJvZHVjdElkKSkgfHwgaXNQcm9kdWN0U2VjdXJpdHkgPT0gJ2ZhbHNlJwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLnV0aWxzLnJlbmRlcigncHJpb3JpdHknLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eVZhbHVlOiByb3cucHJpb3JpdHkudmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eUNsYXNzOiByb3cucHJpb3JpdHkuaWNvbkNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNQcmlvcml0eUNoYW5nZUFsbG93ZWQ6IGlzUHJpb3J0eUNoYW5nZUFsbG93ZWQKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ3RleHQtY2VudGVyIGNvbC1taW4tMzAgcHJpb3JpdHlQYXJlbnQnLAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogdHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTEwMCIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICI8aW5wdXQgdHlwZT0naGlkZGVuJyBjbGFzcz0ncm93LXByb2R1Y3QtanNvbi1jb250YWluZXInIHZhbHVlPSciICsgcm93LnByb2R1Y3RTZWxlY3Rpb25Kc29uICsgIicvPiIgLAogICAgICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICI8YSBocmVmPScvc2lnbmFsL2FkSG9jQWxlcnQvYWxlcnREZXRhaWw/aWQ9IiArIHJvdy5pZCArICInPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXNjYXBlSFRNTChyb3cubmFtZSkgKyAiPC9hPiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyArIGVuY29kZVRvSFRNTChyb3cubmFtZSkgKyAnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xFbGVtZW50OwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcm9kdWN0U2VsZWN0aW9uIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTUwIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBkYXRhLWZpZWxkID0ncHJvZHVjdE5hbWUnIGRhdGEtaWQ9JyIgKyByb3cucHJvZHVjdFNlbGVjdGlvbiArICInPiIgKyAocm93LnByb2R1Y3RTZWxlY3Rpb24pICsgIjwvc3Bhbj4iCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3Byb2R1Y3RTZWxlY3Rpb24nKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZXZlbnRTZWxlY3Rpb24iLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiY29sLW1pbi0xMDAiLAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnZXZlbnRTZWxlY3Rpb24nKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiaXNzdWVUcmFja2VkIiwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2lzc3VlVHJhY2tlZCcpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJudW1PZkljc3JzIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tNzUiLAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnbnVtT2ZJY3NycycpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpbml0RGF0YVNyYyIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTEwMCIsCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdpbml0RGF0YVNyYycpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICdzaWduYWxzQW5kVG9waWNzJywKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTUwIGNvbC1tYXgtMjAwIHNpZ25hbEluZm9ybWF0aW9uIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNpZ25hbEFuZFRvcGljcyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2gocm93LnNpZ25hbHNBbmRUb3BpY3MsIGZ1bmN0aW9uKGksIG9iail7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gc2lnbmFsRGV0YWlsVXJsICsgJz9pZD0nICsgb2JqWydzaWduYWxJZCddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsQW5kVG9waWNzID0gc2lnbmFsQW5kVG9waWNzICsgJzxzcGFuIGNsYXNzPSJjbGljayI+PGEgIGNsYXNzPSJjZWxsLWJyZWFrIiAgb25jbGljaz0idmFsaWRhdGVBY2Nlc3MoZXZlbnQsJyArIG9ialsnc2lnbmFsSWQnXSArICcpIiBocmVmPSInICsgdXJsICsgJyI+JyArIGVzY2FwZUhUTUwob2JqWyduYW1lJ10pICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsQW5kVG9waWNzID0gc2lnbmFsQW5kVG9waWNzICsgIiwiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZihzaWduYWxBbmRUb3BpY3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdj4nICsgc2lnbmFsQW5kVG9waWNzLnN1YnN0cmluZygwLCBzaWduYWxBbmRUb3BpY3MubGVuZ3RoIC0gMSkgKyAnPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICctJzsKCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3NpZ25hbHNBbmRUb3BpY3MnKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY3VycmVudERpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25hbC51dGlscy5yZW5kZXIoJ2Rpc3Bvc2l0aW9uJywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZERpc3Bvc2l0aW9uOiBkaXNwb3NpdGlvbkluY29taW5nT3V0Z29pbmdNYXBbcm93LmRpc3Bvc2l0aW9uXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnREaXNwb3NpdGlvbjogcm93LmRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VKdXN0aWZpY2F0aW9uOiBmb3JjZUp1c3RpZmljYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkYXRpb25TdGF0ZUFjaGlldmVkOiByb3cuaXNWYWxpZGF0aW9uU3RhdGVBY2hpZXZlZAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY3VycmVudERpc3Bvc2l0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgImNsYXNzIjogJ2NvbC1tYXgtMjUwIGRpc3Bvc2l0aW9uQWN0aW9uJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGlzcG9zaXRpb24iLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiY29sLW1heC0yNTAgY3VycmVudERpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5kaXNwb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnZGlzcG9zaXRpb24nKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXNzaWduZWRUbyIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTEwMCBjb2wtbWF4LTE1MCIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwubGlzdF91dGlscy5hc3NpZ25lZF90b19jb21wKHJvdy5pZCwgcm93LmFzc2lnbmVkVG9WYWx1ZSkKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnYXNzaWduZWRUbycpLAogICAgICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGV0ZWN0ZWREYXRlIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTAwIiwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2RldGVjdGVkRGF0ZScpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkdWVJbiIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTEwMCBkdWVJbiIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwubGlzdF91dGlscy5kdWVfaW5fY29tcChyb3cuZHVlSW4pCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2R1ZUluJykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgc2Nyb2xsWDogdHJ1ZSwKICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgICAgICB9KTsKICAgICAgICBuZXcgJC5mbi5kYXRhVGFibGUuRml4ZWRDb2x1bW5zKHRhYmxlLCB7CiAgICAgICAgICAgIGxlZnRDb2x1bW5zOiA0LAogICAgICAgICAgICByaWdodENvbHVtbnM6IDAsCiAgICAgICAgICAgIGhlaWdodE1hdGNoOiAnYXV0bycKICAgICAgICB9KTsKCiAgICAgICAgdGFibGUub24oICd4aHInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbW1lbnRMaXN0ID0gdGFibGUuYWpheC5qc29uKCkuY29tbWVudExpc3Q7CiAgICAgICAgfSk7CgogICAgICAgIGluaXRfZmlsdGVyKHRhYmxlKTsKICAgICAgICByZXR1cm4gdGFibGUKICAgIH07CgogICAgdmFyIGluaXRfZmlsdGVyID0gZnVuY3Rpb24gKGRhdGFfdGFibGUpIHsKCiAgICAgICAgdmFyIGZpbHRlck9wdGlvbnMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMsCiAgICAgICAgICAgIH0sICAvL25hbWUKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogNCwKICAgICAgICAgICAgfSwgIC8vcHJvZHVjdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA1LAogICAgICAgICAgICB9LCAgLy9ldmVudAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA2LAogICAgICAgICAgICB9LCAgLy9pc3N1ZXMgdHJhY2tlZAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA3LAogICAgICAgICAgICB9LCAgLy9udW0gaWNzcgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA4LAogICAgICAgICAgICB9LCAgLy9pbml0IGRhdGFzb3VyY2UKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOSwKICAgICAgICAgICAgfSwgLy9zaWduYWwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTAsCiAgICAgICAgICAgIH0sIC8vZGlzcG9zaXRpb24KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTIsCiAgICAgICAgICAgIH0sIC8vZGV0ZWN0ZWQgZGF0ZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMywKICAgICAgICAgICAgfSwgLy9kZXRlY3RlZCBkYXRlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE0LAogICAgICAgICAgICB9ICAvL2R1ZSBpbgogICAgICAgIF07CiAgICAgICAgeWFkY2YuaW5pdChkYXRhX3RhYmxlLCBmaWx0ZXJPcHRpb25zLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgIH0pOwogICAgfTsKCgogICAgJCgnaSNjb3B5U2VsZWN0aW9uJykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgIHNob3dBbGxTZWxlY3RlZENhc2VOdW1iZXJzKCkKICAgIH0pOwoKICAgIHZhciBzaG93QWxsU2VsZWN0ZWRDYXNlTnVtYmVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcjY29weUNhc2VOdW1iZXJNb2RlbCcpLm1vZGFsKHsKICAgICAgICAgICAgc2hvdzogdHJ1ZQogICAgICAgIH0pOwoKICAgICAgICB2YXIgbnVtYmVycyA9IF8ubWFwKCQoJ2lucHV0LmNvcHktc2VsZWN0OmNoZWNrZWQnKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCd0ZDpudGgtY2hpbGQoNCknKSwgZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgICAgIHJldHVybiAkKGl0KS50ZXh0KCkKICAgICAgICB9KTsKICAgICAgICAkKCIjY2FzZU51bWJlcnMiKS50ZXh0KG51bWJlcnMpOwogICAgfTsKCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnBvcHVsYXRlQ29sdW1uTGlzdChncmlkQ29sdW1uc1ZpZXdVcmwsIGdyaWRDb2x1bW5zVmlld1VwZGF0ZVVybCk7CiAgICAgICAgYWxlcnREZXRhaWxzVGFibGUgPSBpbml0QWxlcnREZXRhaWxzVGFibGUoKTsKICAgICAgICAkKCdpI2NvcHlTZWxlY3Rpb24nKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHNob3dBbGxTZWxlY3RlZENhc2VOdW1iZXJzKCkKICAgICAgICB9KTsKCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2lucHV0I3NlbGVjdC1hbGwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoIi5jb3B5LXNlbGVjdCIpLnByb3AoJ2NoZWNrZWQnLCB0aGlzLmNoZWNrZWQpOwogICAgICAgIH0pOwogICAgICAgIGJpbmRDb21tZW50Tm90ZXMoKTsKICAgIH07CgogICAgaW5pdCgpOwoKCiAgICAkKCcjZXhwb3J0VHlwZXMgYVtocmVmXScpLmNsaWNrKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIGNsaWNrZWRVUkwgPSBlLmN1cnJlbnRUYXJnZXQuaHJlZjsKICAgICAgICB2YXIgaWRzID0gW107CiAgICAgICAgJCgnaW5wdXQuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLm1hcChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlkcy5wdXNoKCQodGhpcykuYXR0cignZGF0YS1pZCcpKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgaXNGaWx0ZXJSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICB2YXIgZmlsdGVyVmFsdWVzID0gW107CiAgICAgICAgdmFyIHByZWZpeCA9ICJhZGhvY18iOwogICAgICAgICQoJy5keW5hbWljLWZpbHRlcnMnKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoJCh0aGlzKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVzLnB1c2goJCh0aGlzKS52YWwoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB2YXIgdXBkYXRlZEV4cG9ydFVybCA9IGNsaWNrZWRVUkwgKyAnJmlzRmlsdGVyUmVxdWVzdD0nICsgaXNGaWx0ZXJSZXF1ZXN0ICsgJyZmaWx0ZXJzPScgKyBKU09OLnN0cmluZ2lmeShmaWx0ZXJWYWx1ZXMpICsgIiZpZHM9IiArIGlkcyArICImY2FsbGluZ1NjcmVlbj0iICsgY2FsbGluZ1NjcmVlbjsKICAgICAgICB2YXIgZmlsdGVyX3BhcmFtcyA9ICIiOwogICAgICAgICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKS5jb2x1bW5zKCkuZXZlcnkoIGZ1bmN0aW9uICgpCiAgICAgICAgewogICAgICAgICAgICBpZih0aGlzLnNlYXJjaCgpICE9PSAiIikgewogICAgICAgICAgICAgICAgZmlsdGVyX3BhcmFtcyA9IGZpbHRlcl9wYXJhbXMgKyAiJiIrdGhpcy5kYXRhU3JjKCkgKyAiPSIgKyB0aGlzLnNlYXJjaCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cGRhdGVkRXhwb3J0VXJsICsgZmlsdGVyX3BhcmFtczsKICAgICAgICByZXR1cm4gZmFsc2UKICAgIH0pOwoKICAgICQoIiNjb21tZW50c01vZGFsIikub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcjY29tbWVudE5vdGVzJykudmFsKCIiKTsKICAgICAgICAkKCcjY29tbWVudE5vdGVzJykudmFsKCIiKTsKICAgICAgICAkKCIuY3JlYXRlZEJ5IikudGV4dCgiIik7CiAgICAgICAgJCgnLmFkZEFkaG9jQ29tbWVudCcpLmh0bWwoIkFkZCIpOwogICAgfSkKCn0pOwoKdmFyIGJpbmRDb21tZW50Tm90ZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCAiLmNvbW1lbnQtaWNvbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgJHRoaXMgPSB0aGlzOwogICAgICAgIHZhciBzZWxlY3RlZFJvd0lkcyA9IFtdOwogICAgICAgIHZhciBzZWxlY3RlZFJvd0NvdW50ID0gJCgndGFibGUuRFRGQ19DbG9uZWQgLmNvcHktc2VsZWN0OmNoZWNrZWQnKS5sZW5ndGg7CiAgICAgICAgdmFyIGNvbW1lbnRNb2RhbCA9ICQoJyNjb21tZW50c01vZGFsJyk7CiAgICAgICAgaWYgKHNlbGVjdGVkUm93Q291bnQgPiAxICYmICQodGhpcykuY2xvc2VzdCgndHInKS5maW5kKCIuY29weS1zZWxlY3QiKS5wcm9wKCJjaGVja2VkIikpIHsKICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24nKS5zaG93KCk7CiAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uIHNwYW4uY291bnQnKS5odG1sKHNlbGVjdGVkUm93Q291bnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uJykuaGlkZSgpOwogICAgICAgIH0KCiAgICAgICAgJCgnZGl2LmJ1bGtPcHRpb25zU2VjdGlvbiBpbnB1dFtuYW1lPWJ1bGtPcHRpb25zXScpLnVuYmluZCgpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHN3aXRjaCAoJCh0aGlzKS52YWwoKSkgewogICAgICAgICAgICAgICAgY2FzZSAnYWxsU2VsZWN0ZWQnOgogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93SWRzID0gaW5pdGlhdGVCdWxrUm93Q29tbWVudFByb2Nlc3MoKTsKICAgICAgICAgICAgICAgICAgICBiaW5kQWRkQ29tbWVudE5vdGVzKGNvbW1lbnRNb2RhbCwgc2VsZWN0ZWRSb3dJZHMsImJ1bGsiKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2N1cnJlbnQnOgogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93SWRzID0gW107CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dJZHMucHVzaChpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgYmluZEFkZENvbW1lbnROb3Rlcyhjb21tZW50TW9kYWwsIHNlbGVjdGVkUm93SWRzLCJyb3ciKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmICgkKHRoaXMpLmRhdGEoJ2luZm8nKSA9PT0gJ3JvdycpIHsKICAgICAgICAgICAgc2VsZWN0ZWRSb3dJZHMucHVzaChpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzKSk7CiAgICAgICAgICAgIGJpbmRBZGRDb21tZW50Tm90ZXMoY29tbWVudE1vZGFsLCBzZWxlY3RlZFJvd0lkcywicm93IiwkdGhpcyk7CiAgICAgICAgfQogICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgfSk7Cn07Cgp2YXIgaW5pdGlhdGVTaW5nbGVSb3dDb21tZW50UHJvY2VzcyA9IGZ1bmN0aW9uICgkdGhpcykgewogICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSAkKCR0aGlzKS5wYXJlbnRzKCd0cicpLmluZGV4KCk7CiAgICB2YXIgYWRob2NBbGVydElkID0gdGFibGUucm93KHNlbGVjdGVkUm93SW5kZXgpLmRhdGEoKS5pZDsKICAgIHZhciB1cGRhdGVkQ29tbWVudHMgPSAkKCcjY29tbWVudE5vdGVzJykudmFsKCk7CiAgICAkLmFqYXgoewogICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICBkYXRhOiB7J2FkaG9jQWxlcnQuaWQnOiBhZGhvY0FsZXJ0SWR9LAogICAgICAgIHVybDogZmV0Y2hDb21tZW50VXJsLAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgdmFyIGNvbW1lbnRNb2RhbCA9ICQoJyNjb21tZW50c01vZGFsJyk7CiAgICAgICAgICAgIGlmIChyZXN1bHQuY29tbWVudCkgewogICAgICAgICAgICAgICAgaWYodXBkYXRlZENvbW1lbnRzLmxlbmd0aCA+PSByZXN1bHQuY29tbWVudC5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudE5vdGVzJykudmFsKGVuY29kZVRvSFRNTCh1cGRhdGVkQ29tbWVudHMpKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudE5vdGVzJykudmFsKGVuY29kZVRvSFRNTChyZXN1bHQuY29tbWVudCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCJMYXN0IE1vZGlmaWVkIGJ5ICIgKyByZXN1bHQuY3JlYXRlZEJ5ICsgIiBvbiAiICsgcmVzdWx0LmRhdGVVcGRhdGVkKTsKICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkQWRob2NDb21tZW50JykuaHRtbCgiVXBkYXRlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gc2VsZWN0ZWRSb3dJbmRleAp9OwoKdmFyIGluaXRpYXRlQnVsa1Jvd0NvbW1lbnRQcm9jZXNzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGluZGV4U2V0ID0gbmV3IFNldCgpOwogICAgdmFyIHNlbGVjdGVkUm93SWRzID0gW107CiAgICAkLmVhY2goJCgndGFibGUuRFRGQ19DbG9uZWQgLmNvcHktc2VsZWN0OmNoZWNrZWQnKSwgZnVuY3Rpb24gKCkgewogICAgICAgIGluZGV4U2V0LmFkZCgoJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCkpKTsKICAgIH0pOwoKICAgIGluZGV4U2V0LmZvckVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgc2VsZWN0ZWRSb3dJZHMucHVzaChpbmRleCk7CiAgICB9KTsKICAgIHJldHVybiBzZWxlY3RlZFJvd0lkczsKfTsKCnZhciBiaW5kQWRkQ29tbWVudE5vdGVzID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgc2VsZWN0ZWRSb3dJZHMsZGF0YUluZm8sY3VycmVudFJvdykgewogICAgdmFyIHNlbGVjdGVkQWRob2NBbGVydElkcyA9IFtdOwogICAgc2VsZWN0ZWRSb3dJZHMuZm9yRWFjaChmdW5jdGlvbiAocm93SWQpIHsKICAgICAgICBzZWxlY3RlZEFkaG9jQWxlcnRJZHMucHVzaCh0YWJsZS5yb3cocm93SWQpLmRhdGEoKS5pZCkKICAgIH0pOwogICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGRBZGhvY0NvbW1lbnQnKS51bmJpbmQoKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAnc2VsZWN0ZWRBZGhvY0FsZXJ0SWRzJzogSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRBZGhvY0FsZXJ0SWRzKSwKICAgICAgICAgICAgICAgICdjb21tZW50JzogJCgiI2NvbW1lbnROb3RlcyIpLnZhbCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVybDogc2F2ZUNvbW1lbnRVcmwsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIHZhciBjb21tZW50TW9kYWwgPSAkKCcjY29tbWVudHNNb2RhbCcpOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuY29tbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnROb3RlcycpLnZhbChyZXN1bHQuY29tbWVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgiTGFzdCBNb2RpZmllZCBieSAiICsgcmVzdWx0LmNyZWF0ZWRCeSArICIgb24gIiArIHJlc3VsdC5kYXRlVXBkYXRlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkQWRob2NDb21tZW50JykuaHRtbCgiVXBkYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnc3VjY2VzcycsICd0b3AgcmlnaHQnLCAiU3VjY2VzcyIsICJDb21tZW50cyBhZGRlZCBzdWNjZXNzZnVsbHkuIiwge2F1dG9IaWRlRGVsYXk6IDEwMDAwfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChkYXRhSW5mbyA9PT0gInJvdyIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmNvbW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NvbW1lbnRJY29uKGN1cnJlbnRSb3cpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNvbW1lbnRJY29uKGN1cnJlbnRSb3cpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrYm94U2VsZWN0b3IgPSAndGFibGUuRFRGQ19DbG9uZWQgLmNvcHktc2VsZWN0OmNoZWNrZWQnOwogICAgICAgICAgICAgICAgICAgICQuZWFjaCgkKGNoZWNrYm94U2VsZWN0b3IpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuY29tbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NvbW1lbnRJY29uKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ29tbWVudEljb24odGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KQp9OwoKZnVuY3Rpb24gYmluZEFzc2lnblRvU2VsZWN0aW9uKHNlYXJjaFVzZXJHcm91cExpc3RVcmwsIGFzc2lnblRvR3JvdXBVcmwsIHRhYmxlKSB7CiAgICAkKCIuYXNzaWduZWRUb1NlbGVjdCIpLmVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICBzaWduYWwudXNlcl9ncm91cF91dGlscy5iaW5kX2Fzc2lnbl90bygkKHRoaXMpLCBzZWFyY2hVc2VyR3JvdXBMaXN0VXJsLCBhc3NpZ25lZFRvRGF0YVtpXSk7CiAgICB9KTsKICAgIHNpZ25hbC51c2VyX2dyb3VwX3V0aWxzLmJpbmRfYXNzaWduVG9fc2VsZWN0aW9uKGFzc2lnblRvR3JvdXBVcmwsIHRhYmxlKTsKfQoKCg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="195765250" offset="0" length="8192" />
        <PacketInfo time="195765265" offset="8192" length="16384" />
        <PacketInfo time="195765281" offset="24576" length="2827" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>