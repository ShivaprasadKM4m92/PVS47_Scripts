<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="160">
  <HTTPTask id="757" hostname="10.100.22.24:8181" path="/signal/assets/app/pvs/alerts_review/single_case_alert_details-09363ee86eb158f849b41946e0442b37.js" url="http://10.100.22.24:8181/signal/assets/app/pvs/alerts_review/single_case_alert_details-09363ee86eb158f849b41946e0442b37.js" ip="10.100.22.24" port="8181" connectionId="34" origin="Primary" frame="1" startDateTime="2020-07-30T17:24:17.697+05:30" startTime="773236531" endTime="773237953">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0OjgxODE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg0LjAuNDE0Ny4xMDUgU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC9zaW5nbGVDYXNlQWxlcnQvZGV0YWlscz9jYWxsaW5nU2NyZWVuPXJldmlldyZjb25maWdJZD0zMzMwJmlzRmFlcnM9JmlzQ2FzZVNlcmllcz10cnVl</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj03NjA0ZmMyOC0zODgyLTRlZGEtODQxOS02MmQ5MjcwN2U4ZWQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9zaWduYWwvYXNzZXRzL2FwcC9wdnMvYWxlcnRzX3Jldmlldy9zaW5nbGVfY2FzZV9hbGVydF9kZXRhaWxzLTA5MzYzZWU4NmViMTU4Zjg0OWI0MTk0NmUwNDQyYjM3LmpzIEhUVFAvMS4xDQpIb3N0OiAxMC4xMDAuMjIuMjQ6ODE4MQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzg0LjAuNDE0Ny4xMDUgU2FmYXJpLzUzNy4zNg0KQWNjZXB0OiAqLyoNClJlZmVyZXI6IGh0dHA6Ly8xMC4xMDAuMjIuMjQ6ODE4MS9zaWduYWwvc2luZ2xlQ2FzZUFsZXJ0L2RldGFpbHM/Y2FsbGluZ1NjcmVlbj1yZXZpZXcmY29uZmlnSWQ9MzMzMCZpc0ZhZXJzPSZpc0Nhc2VTZXJpZXM9dHJ1ZQ0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTLGVuO3E9MC45DQpDb29raWU6IFNFU1NJT049NzYwNGZjMjgtMzg4Mi00ZWRhLTg0MTktNjJkOTI3MDdlOGVkDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NzYwNGZjMjgtMzg4Mi00ZWRhLTg0MTktNjJkOTI3MDdlOGVk</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>40410</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Last-Modified" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>V2VkLCAyMiBKdWwgMjAyMCAwMzozMzo0MCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ImFwcC9wdnMvYWxlcnRzX3Jldmlldy9zaW5nbGVfY2FzZV9hbGVydF9kZXRhaWxzLTA5MzYzZWU4NmViMTU4Zjg0OWI0MTk0NmUwNDQyYjM3LmpzIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>NDA0MTA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAzMCBKdWwgMjAyMCAxMTozODo1NSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KTGFzdC1Nb2RpZmllZDogV2VkLCAyMiBKdWwgMjAyMCAwMzozMzo0MCBHTVQNCkVUYWc6ICJhcHAvcHZzL2FsZXJ0c19yZXZpZXcvc2luZ2xlX2Nhc2VfYWxlcnRfZGV0YWlscy0wOTM2M2VlODZlYjE1OGY4NDliNDE5NDZlMDQ0MmIzNy5qcyINClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KQ2FjaGUtQ29udHJvbDogcHVibGljLCBtYXgtYWdlPTMxNTM2MDAwDQpDb250ZW50LUVuY29kaW5nOiBnemlwDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQ7Y2hhcnNldD1VVEYtOA0KQ29udGVudC1MZW5ndGg6IDQwNDEwDQpEYXRlOiBUaHUsIDMwIEp1bCAyMDIwIDExOjM4OjU1IEdNVA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCi8vIGEgY29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHBhcnNpbmcgc3RyaW5nIG5hbWVzcGFjZXMgYW5kCi8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGluZyBuZXN0ZWQgbmFtZXNwYWNlcwpmdW5jdGlvbiBleHRlbmQoIG5zLCBuc19zdHJpbmcgKSB7CiAgICB2YXIgcGFydHMgPSBuc19zdHJpbmcuc3BsaXQoJy4nKSwKICAgICAgICBwYXJlbnQgPSBucywKICAgICAgICBwbCwgaTsKICAgIGlmIChwYXJ0c1swXSA9PSAic2lnbmFsIikgewogICAgICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7CiAgICB9CiAgICBwbCA9IHBhcnRzLmxlbmd0aDsKICAgIGZvciAoaSA9IDA7IGkgPCBwbDsgaSsrKSB7CiAgICAgICAgLy9jcmVhdGUgYSBwcm9wZXJ0eSBpZiBpdCBkb2VzbnQgZXhpc3QKICAgICAgICBpZiAodHlwZW9mIHBhcmVudFtwYXJ0c1tpXV0gPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcGFyZW50W3BhcnRzW2ldXSA9IHt9OwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbcGFydHNbaV1dOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKfQoKLy9Qcm90b3R5cGUgbWV0aG9kcwpEYXRlLnByb3RvdHlwZS5hZGREYXlzID0gZnVuY3Rpb24oZGF5cykgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTsKICAgIHJldHVybiBkYXRlOwp9OwoKQXJyYXkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGYpe2YgIT0gdmFsdWV9KTsKfTsKClNDQV9XT1JLRkxPV19TVEFUVVNfRU5VTSA9IHsgTkVXOiAnTmV3JywKICAgIEFTU09DSUFURV9SRVZJRVdFRDogJ0Fzc29jaWF0ZVJldmlld2VkJywKICAgIFBIWVNJQ0lBTl9SRVZJRVdFRDogJ1BoeXNpY2lhblJldmlld2VkJywKICAgIFJFUVVJUkVEX0VWQUxVQVRJT046ICdSZXF1aXJlZEV2YWx1YXRpb24nLAogICAgQ09OVElOVUVEX01PTklUT1JJTkc6ICdDb250aW51ZWRNb25pdG9yaW5nJwp9OwoKU0NBX0RJU1BPU0lUSU9OX0VOVU0gPSB7CiAgICBWQUxJREFURURfU0lHTkFMIDogJ1ZhbGlkYXRlZFNpZ25hbCcsCiAgICBWQUxJREFURURfTk9OX0NPTkZJUk1FRF9TSUdOQUwgOiAnVmFsaWRhdGVkTm9uQ29uZmlybWVkU2lnbmFsJywKICAgIFZBTElEQVRFRF9VTkRFUl9JTlZFU1RJR0FUSU9OIDogJ1ZhbGlkYXRlZFVuZGVySW52ZXN0aWdhdGlvbicsCiAgICBDT01NVU5JQ0FURURfU0lHTkFMIDogJ0NvbW11bmljYXRlZFNpZ25hbCcsCiAgICBOT05fVkFMSUQ6ICdOb25WYWxpZCcKfTsKClNDQV9QUklPUklUWV9FTlVNID0gewogICAgSElHSDogIkhpZ2giLAogICAgTUVESVVNOiAiTWVkaXVtIiwKICAgIExPVzogIkxPVyIKfTsKCkRBVEVfRk1UX1RaID0gIllZWVktTU0tREQiOwoKc2lnbmFsLnV0aWxzID0gKGZ1bmN0aW9uKCkgewoKICAgIHZhciBzdGFja2VkID0gZnVuY3Rpb24odG9wVmFsdWUsIGJvdHRvbVZhbHVlKSB7CiAgICAgICAgdmFyIHRvcENvbXAgPSAiIjsKICAgICAgICB2YXIgYm90dG9tQ29tcCA9ICIiOwoKICAgICAgICBpZihfLmlzRnVuY3Rpb24odG9wVmFsdWUpKSB7CiAgICAgICAgICAgIHRvcENvbXAgPSB0b3BWYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9wQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLXRvcCI+JyArIHRvcFZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oYm90dG9tVmFsdWUpKSB7CiAgICAgICAgICAgIGJvdHRvbUNvbXAgPSBib3R0b21WYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm90dG9tQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLWJvdHRvbSI+JyArIGJvdHRvbVZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3BDb21wICsgYm90dG9tQ29tcAogICAgfTsKCiAgICAvLyBBbmQgdGhpcyBpcyB0aGUgZGVmaW5pdGlvbiBvZiB0aGUgY3VzdG9tIGZ1bmN0aW9uIOKAiwogICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRtcGxfbmFtZSwgdG1wbF9kYXRhKSB7CgogICAgICAgIGlmICggIXJlbmRlci50bXBsX2NhY2hlICkgewoKCgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZSA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoIXJlbmRlci50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgdmFyIHRtcGxfZGlyID0gJy9zaWduYWwvYXNzZXRzL2FwcC9wdnMvaGJzLXRlbXBsYXRlcyc7CiAgICAgICAgICAgIHZhciB0bXBsX3VybCA9IHRtcGxfZGlyICsgJy8nICsgdG1wbF9uYW1lICsgJy5oYnMnOwoKICAgICAgICAgICAgdmFyIHRtcGxfc3RyaW5nID0gIiI7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHRtcGxfdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0bXBsX3N0cmluZyA9IGRhdGEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKHRtcGxfc3RyaW5nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdKHRtcGxfZGF0YSkKICAgIH07CgogICAgdmFyIGhic19wYXJ0aWFsID0gZnVuY3Rpb24odG1wbF9uYW1lKSB7CiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlKSB7CiAgICAgICAgICAgIGhic19wYXJ0aWFsLnRtcGxfY2FjaGUgPSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgIHZhciB0bXBsX2RpciA9ICcvc2lnbmFsL2Fzc2V0cy9hcHAvcHZzL2hicy10ZW1wbGF0ZXMnOwogICAgICAgICAgICB2YXIgdG1wbF91cmwgPSB0bXBsX2RpciArICcvJyArIHRtcGxfbmFtZSArICcuaGJzJzsKCiAgICAgICAgICAgIHZhciB0bXBsX3N0cmluZyA9ICIiOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB0bXBsX3VybCwKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdG1wbF9zdHJpbmcgPSBkYXRhCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaGJzX3BhcnRpYWwudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gdG1wbF9zdHJpbmcKICAgICAgICB9CgogICAgICAgIHJldHVybiBoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0KICAgIH07CgogICAgdmFyIGNvbXBvc2VVcmwgPSBmdW5jdGlvbihjb250cm9sbGVyLCBhY3Rpb24sIHBhcmFtcykgewogICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC8iICsgY29udHJvbGxlciArICIvIiArIGFjdGlvbiArIChfLmlzTnVsbChwYXJhbXMpID8gJycgOiAnPycgKyBjb21wb3NlUGFyYW1zKHBhcmFtcykpOwoKICAgICAgICByZXR1cm4gdXJsCiAgICB9OwoKICAgIC8vVE9ETyA6IE5lZWQgdG8gY2hhbmdlIHRoaXMgdG8gaGFuZGxlYmFyIGZvcm0sIFdpbGwgYmUgZG9uZSBsYXRlcgogICAgdmFyIHBvc3RVcmwgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBuZXdXaW5kb3cpIHsKCiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKICAgICAgICBmb3JtLm1ldGhvZCA9ICJwb3N0IjsKICAgICAgICBmb3JtLmFjdGlvbiA9IHBhdGg7CiAgICAgICAgZm9ybS5lbmN0eXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgaWYgKG5ld1dpbmRvdykgZm9ybS50YXJnZXQgPSAiX2JsYW5rIjsKCiAgICAgICAgdmFyIHRva2VuID0gJCgibWV0YVtuYW1lPSdfY3NyZiddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHZhciBwYXJhbWV0ZXIgPSAkKCJtZXRhW25hbWU9J19jc3JmX3BhcmFtZXRlciddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHBhcmFtc1twYXJhbWV0ZXJdID0gdG9rZW47CiAgICAgICAgZm9yIChsZXQga2V5IGluIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLnR5cGUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLm5hbWUgPSBrZXk7CiAgICAgICAgICAgICAgICBoaWRkZW5GaWVsZC52YWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChoaWRkZW5GaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmb3JtKTsKICAgICAgICBmb3JtLnN1Ym1pdCgpOwogICAgfQoKICAgIHZhciBjb21wb3NlUGFyYW1zID0gZnVuY3Rpb24obykgewogICAgICAgIHJldHVybiBfLm1hcChfLnBhaXJzKG8pLCBmdW5jdGlvbihwKXtyZXR1cm4gcC5qb2luKCc9Jyl9ICkuam9pbignJicpCiAgICB9OwoKICAgIHZhciBjYXBpdGFsSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgJiYgc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKTsKICAgIH07CgogICAgdmFyIGJyZWFrSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgPyBzLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCcgJykgOiBzCiAgICB9OwoKICAgIHZhciBlbmFibGVfbG9hZF9idXR0b24gPSBmdW5jdGlvbihlbGUsIGVuYWJsZWQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXRFbGUgPSBlbGUuZmluZCgnLmdseXBoaWNvbicpOwogICAgICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgICAgICAgJCh0YXJnZXRFbGUpLmFkZENsYXNzKCdyZWZyZXNoLWFuaW1hdGUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQodGFyZ2V0RWxlKS5yZW1vdmVDbGFzcygncmVmcmVzaC1hbmltYXRlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNldEluTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24ocHJvcCwgZGF0YSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHByb3AsIGRhdGEpOwogICAgfTsKCiAgICB2YXIgZ2V0RnJvbUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKHByb3ApIHsKICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvcCk7CiAgICB9OwoKICAgIHZhciBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbihwcm9wLCBkYXRhKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvcCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgfTsKCiAgICB2YXIgZ2V0SlNPTkZyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb3ApKTsKICAgIH07CgogICAgdmFyIGxvY2FsU3RvcmFnZVV0aWwgPSB7CiAgICAgICAgc2V0UHJvcCA6IHNldEluTG9jYWxTdG9yYWdlLAogICAgICAgIGdldFByb3AgOiBnZXRGcm9tTG9jYWxTdG9yYWdlLAogICAgICAgIHNldEpTT04gOiBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UsCiAgICAgICAgZ2V0SlNPTiA6IGdldEpTT05Gcm9tTG9jYWxTdG9yYWdlCiAgICB9OwoKICAgIHZhciBnZXRRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBrZXkgPSBmYWxzZSwgcmVzID0ge30sIGl0bSA9IG51bGw7CiAgICAgICAgLy8gZ2V0IHRoZSBxdWVyeSBzdHJpbmcgd2l0aG91dCB0aGUgPwogICAgICAgIHZhciBxcyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgLy8gY2hlY2sgZm9yIHRoZSBrZXkgYXMgYW4gYXJndW1lbnQKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIGtleSA9IGFyZ3VtZW50c1swXTsKICAgICAgICAvLyBtYWtlIGEgcmVnZXggcGF0dGVybiB0byBncmFiIGtleS92YWx1ZQogICAgICAgIHZhciBwYXR0ZXJuID0gLyhbXiY9XSspPShbXiZdKikvZzsKICAgICAgICAvLyBsb29wIHRoZSBpdGVtcyBpbiB0aGUgcXVlcnkgc3RyaW5nLCBlaXRoZXIKICAgICAgICAvLyBmaW5kIGEgbWF0Y2ggdG8gdGhlIGFyZ3VtZW50LCBvciBidWlsZCBhbiBvYmplY3QKICAgICAgICAvLyB3aXRoIGtleS92YWx1ZSBwYWlycwogICAgICAgIHdoaWxlIChpdG0gPSBwYXR0ZXJuLmV4ZWMocXMpKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09IGZhbHNlICYmIGRlY29kZVVSSUNvbXBvbmVudChpdG1bMV0pID09PSBrZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICByZXNbZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ga2V5ID09PSBmYWxzZSA/IHJlcyA6IG51bGw7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgcmVuZGVyIDogcmVuZGVyLAogICAgICAgIHN0YWNrZWQ6IHN0YWNrZWQsCiAgICAgICAgY29tcG9zZVVybDogY29tcG9zZVVybCwKICAgICAgICBwb3N0VXJsOiBwb3N0VXJsLAogICAgICAgIGNvbXBvc2VQYXJhbXM6IGNvbXBvc2VQYXJhbXMsCiAgICAgICAgY2FwaXRhbEl0OiBjYXBpdGFsSXQsCiAgICAgICAgYnJlYWtJdDogYnJlYWtJdCwKICAgICAgICBoYnNfcGFydGlhbDogaGJzX3BhcnRpYWwsCiAgICAgICAgZW5hYmxlX2xvYWRfYnV0dG9uOiBlbmFibGVfbG9hZF9idXR0b24sCiAgICAgICAgbG9jYWxTdG9yYWdlVXRpbDogbG9jYWxTdG9yYWdlVXRpbCwKICAgICAgICBnZXRRdWVyeVN0cmluZzogZ2V0UXVlcnlTdHJpbmcKICAgIH0KfSkoKTsKCnZhciBmZXRjaEFjY2VwdGVkRmlsZUZvcm1hdHMgPSBmdW5jdGlvbigpIHsKICAgICQuYWpheCh7CiAgICAgICAgdXJsOiAnL3NpZ25hbC9hdHRhY2htZW50YWJsZS9mZXRjaEFjY2VwdGVkRmlsZUZvcm1hdHMnICwKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICQoIi5hdHRhY2htZW50LWZpbGUiKS5hdHRyKCJhY2NlcHQiICwgcmVzdWx0LmpvaW4oIiwiKSkKICAgICAgICB9LAogICAgfSk7Cn07CgoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaTE4bicsCiAgICBmdW5jdGlvbihzdHIpewogICAgICAgIHJldHVybiAoICh0eXBlb2YgaTE4bikgIT09ICd1bmRlZmluZWQnID8gc3RyIDogc3RyKQogICAgfQopOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2VsZWN0JywgZnVuY3Rpb24obmFtZSwgc2VsZWN0ZWRWYWx1ZSwgb3B0aW9ucywgZGlzcF9maWVsZCwgdmFsdWVfZmllbGQpIHsKICAgIHZhciBvdXQgPSAiPHNlbGVjdCBjbGFzcz0nZm9ybS1jb250cm9sIHNlbGVjdEJveCcgaWQ9XCciICsgbmFtZSArICJcJyBuYW1lPSIgKyBuYW1lICsgIj5cbiI7CiAgICBfLmVhY2gob3B0aW9ucywgZnVuY3Rpb24odikgewogICAgICAgIG91dCArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIHZbdmFsdWVfZmllbGRdICsgIiciICsKICAgICAgICAgICAgKHZbdmFsdWVfZmllbGRdID09IHNlbGVjdGVkVmFsdWVbdmFsdWVfZmllbGRdID8gIiBzZWxlY3RlZCAiIDogIiIpICsgIiA+IiArCiAgICAgICAgICAgIGVzY2FwZUhUTUwodltkaXNwX2ZpZWxkXSkgKyAiPC9vcHRpb24+XG4iCiAgICB9KTsKICAgIG91dCArPSAiPC9zZWxlY3Q+IjsKCiAgICByZXR1cm4gbmV3IEhhbmRsZWJhcnMuU2FmZVN0cmluZyhvdXQpCn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlclBhcnRpYWwoJ2RhdGVfcGlja2VyX3RlbXBsYXRlJywgc2lnbmFsLnV0aWxzLmhic19wYXJ0aWFsKCdkYXRlX3BpY2tlcl90ZW1wbGF0ZScpKTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZiBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2VxJywgZnVuY3Rpb24oYSwgYiwgb3B0cykgewogICAgaWYgKGEgPT0gYikgewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfQp9KTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZi4uZWxzZSBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2Vsc2VfZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSA9PSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfdGFnX2V4aXN0JywgZnVuY3Rpb24oa2V5LCB2YWx1ZSx0YWdzLCBvcHRzKSB7CiAgICBpZih2YWx1ZS50YWdUZXh0ID09IHRhZ3Nba2V5LTFdLnRhZ1RleHQgJiYgdmFsdWUuc3ViVGFnVGV4dCE9bnVsbCAmJiB2YWx1ZS5zdWJUYWdUZXh0ICE9IHRhZ3Nba2V5LTFdLnN1YlRhZ1RleHQpewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfSBlbHNlewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfZWxzZV9uZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSAhPSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfaGFuZGxlYmFyX2V4dC5qcwoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCnNpZ25hbC5hbGVydHNfdXRpbHMgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgcHJpb3JpdGllczsKICAgIHZhciB3b3JrZmxvd1N0YXRlczsKCiAgICB2YXIgZ2V0X3ByaW9yaXRpZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL3dvcmtmbG93L3ByaW9yaXRpZXMiLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgcHJpb3JpdGllcyA9IHJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBwcmlvcml0aWVzCiAgICB9OwoKICAgIHZhciBnZXRfd29ya2Zsb3dTdGF0ZXMgPSBmdW5jdGlvbihpbml0RGF0YSkgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvd29ya2Zsb3cvd29ya2Zsb3dTdGF0ZSIsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgZGF0YTogaW5pdERhdGEsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgd29ya2Zsb3dTdGF0ZXMgPSByZXN1bHQKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gd29ya2Zsb3dTdGF0ZXMKICAgIH07CgogICAgdmFyIHByaW9yaXRpZXNfc2VsZWN0aW9ucyA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgIHZhciBuZXdfc2VsZWN0ID0gJzxkaXY+PHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGFkZC1jdXJzb3IiICcgKwogICAgICAgICAgICAnc3R5bGU9ImhlaWdodDogMzBweDsiIG9uY2hhbmdlPSJ1cGRhdGVQcmlvcml0eSh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgcHJpb3JpdHkgPSByb3cucHJpb3JpdHk7CgogICAgICAgIHZhciB0aGVfc2VsZWN0ID0gXy5yZWR1Y2UocHJpb3JpdGllcywgZnVuY3Rpb24obSwgcCl7CiAgICAgICAgICAgIGlmIChwLnZhbHVlID09IHByaW9yaXR5KQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIiBzZWxlY3RlZD4gJyArIHAuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIj4nICsgcC5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nCiAgICAgICAgfSwgbmV3X3NlbGVjdCk7CiAgICAgICAgdGhlX3NlbGVjdCA9IHRoZV9zZWxlY3QgKyAnPC9zZWxlY3Q+PC9kaXY+JzsKICAgICAgICByZXR1cm4gdGhlX3NlbGVjdDsKICAgIH07CgogICAgdmFyIHdvcmtmbG93X3NlbGVjdGlvbnMgPSBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICB2YXIgbmV3X3NlbGVjdCA9ICc8ZGl2PjxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBhZGQtY3Vyc29yIiBzdHlsZT0iaGVpZ2h0OiAzMHB4OyIgb25jaGFuZ2U9InVwZGF0ZVN0YXR1cyh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgd29ya2Zsb3dTdGF0ZSA9IHJvdy53b3JrZmxvd1N0YXRlOwoKICAgICAgICB2YXIgdGhlX3NlbGVjdCA9IF8ucmVkdWNlKHdvcmtmbG93U3RhdGVzLCBmdW5jdGlvbihtLCB3cyl7CiAgICAgICAgICAgIGlmICh3cy52YWx1ZSA9PSB3b3JrZmxvd1N0YXRlKQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHdzLnZhbHVlICsgJyIgc2VsZWN0ZWQ+ICcgKyB3cy5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbSArICc8b3B0aW9uIHZhbHVlPSInICsgd3MudmFsdWUgKyAnIj4nICsgd3MuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JwogICAgICAgIH0sIG5ld19zZWxlY3QpOwogICAgICAgIHRoZV9zZWxlY3QgPSB0aGVfc2VsZWN0ICsgJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIHRoZV9zZWxlY3Q7CiAgICB9OwoKICAgIHZhciBjb21wb3NlX2VkaXRfc3RhdGVfbGluayA9IGZ1bmN0aW9uKHZhbHVlLCByb3dJZCwgZmlsZWROYW1lKSB7CiAgICAgICAgcmV0dXJuICI8c3Bhbj4iICsgdmFsdWUgKyAiPC9zcGFuPiIgKyAiPGEgaHJlZj0nIycgY2xhc3M9J2VkaXQtc3RhdGUnID4iICsKICAgICAgICAgICAgIjxpIGNsYXNzPSdmYSBmYS1zaGFyZS1hbHQgcHVsbC1yaWdodCcgZGF0YS1maWVsZD0nIiAgKyBmaWxlZE5hbWUgKwogICAgICAgICAgICAiJyBkYXRhLWlkPSciICsgcm93SWQgKyAiJy8+PC9hPiIKICAgIH07CgogICAgdmFyIHN0YXRlX2NoYW5nZWQgPSBmdW5jdGlvbihleHRyYV92YWx1ZXMpIHsKICAgICAgICAkKCIjdmFsdWVTZWxlY3QiKS5jaGFuZ2UoZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciBhdmFpbGFibGVfZXh0cmFfdmFsdWVzID0gZXh0cmFfdmFsdWVzWyQodmFsdWVTZWxlY3QpLnZhbCgpXQogICAgICAgIH0pCiAgICB9OwoKICAgIC8vVE9ETyB0aGlzIGlzIGEgdGVtcCBzb2x1dGlvbiBmb3IgdGhlIEpTT04gZm9ybWF0LiBJdCBzaG91bGQgY29tZSBmcm9tIHNlcnZlciBzaWRlCiAgICAvL0Z1bmN0aW9uIHRoYXQgY29udmVydHMgdGhlIGpzb24gaW5uZXJodG1sIHRvIHRoZSBjc3YgdmFsdWVzLgogICAgLy9JdCBjb252ZXJ0cyB0aGUgcHJvcGVydGllcyB3aGljaCBhcmUgbm90IGlkLgogICAgdmFyIHNob3dfanNvbl9hc19jc3YgPSBmdW5jdGlvbiAoZWxlbWVudENsYXNzKSB7CiAgICAgICAgJCgiLiIgKyBlbGVtZW50Q2xhc3MpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKGlzTmFOKCQodGhpcykuaHRtbCgpKSkgewogICAgICAgICAgICAgICAgICB2YXIgbW9kaWZpZWRWYWwgPSAiIjsKICAgICAgICAgICAgICAgICAgdmFyIGpzb25WYWwgPSBKU09OLnBhcnNlKCQodGhpcykuaHRtbCgpKTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgb2JqIGluIGpzb25WYWwpIHsKICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb25WYWwuaGFzT3duUHJvcGVydHkob2JqKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGpzb25WYWxbb2JqXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvblZhbFtvYmpdLmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wICE9ICdpZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRWYWwgPSBtb2RpZmllZFZhbCArIGpzb25WYWxbb2JqXVtwcm9wXSArICIsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgJCh0aGlzKS5odG1sKG1vZGlmaWVkVmFsLnNsaWNlKDAsIC0xKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgLy9EbyBub3RoaW5nCiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhlcnIpCiAgICAgICAgICAgfQogICAgICAgICAgICQodGhpcykuaHRtbCgpCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRfbWF0Y2hlZF9hbGVydHNfdGFibGUgPSBmdW5jdGlvbih0YWJsZUVsZSwgdXJsKSB7CiAgICAgICAgdmFyIHRhYmxlID0gdGFibGVFbGUuRGF0YVRhYmxlKHsKICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgInVybCI6ICIvc2lnbmFsL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhamF4OiB7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGFTcmM6ICcnLAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHhocixzdGF0dXMsZXJyb3Ipe30KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFvQ29sdW1uczpbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICduYW1lJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ3Byb2R1Y3RTZWxlY3Rpb24nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAndG9waWMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAnZGV0ZWN0ZWREYXRlJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ2Rpc3Bvc2l0aW9uJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBkb206ICcnCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YWJsZQogICAgfTsKCiAgICB2YXIgZ2V0U2lnbmFsTmFtZUxpc3QgPSBmdW5jdGlvbihzaWduYWxzQW5kVG9waWNzKSB7CiAgICAgICAgdmFyIHNpZ25hbEFuZFRvcGljcyA9ICcnOwogICAgICAgICQuZWFjaChzaWduYWxzQW5kVG9waWNzLCBmdW5jdGlvbihpLCBvYmopewogICAgICAgICAgICB2YXIgdXJsID0gc2lnbmFsRGV0YWlsVXJsICsgJz9pZD0nICsgb2JqWydzaWduYWxJZCddOwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAnPHNwYW4gY2xhc3M9ImNsaWNrIj48YSBocmVmPSInICsgdXJsICsgJyI+JyArIG9ialsnbmFtZSddICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAiLCIKICAgICAgICB9KTsKICAgICAgICBpZihzaWduYWxBbmRUb3BpY3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgcmV0dXJuICc8ZGl2PicgKyBzaWduYWxBbmRUb3BpY3Muc3Vic3RyaW5nKDAsIHNpZ25hbEFuZFRvcGljcy5sZW5ndGggLSAxKSArICc8L2Rpdj4nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuICctJzsKICAgIH07CgogICAgLy8gRm9yIHNoYXJlZCB3aXRoIG1vZGFsCiAgICB2YXIgaW5pdGlhbGl6ZVNoYXJlV2l0aFNlbGVjdDIgPSBmdW5jdGlvbigpewogICAgICAgICQoJyNzaGFyZVdpdGgnKS5zZWxlY3QyKCkub24oImNoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICQoJyNzaGFyZVdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBpbml0aWFsaXplU2hhcmVXaXRoVmFsdWVzID0gZnVuY3Rpb24oKXsKICAgICAgICAkKCcjc2hhcmVkV2l0aE1vZGFsJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gZS5yZWxhdGVkVGFyZ2V0LmlkOwogICAgICAgICAgICAkKCcjZXhlY3V0ZWRDb25maWdJZCcpLnZhbChleGVjdXRlZENvbmZpZ0lkKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsCiAgICAgICAgICAgICAgICB1cmw6IGdldFNoYXJlZFdpdGggKyAnP2lkPScgKyBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJlc3VsdC51c2VycywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzICs9IHRoaXMubmFtZSArICc8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhVc2VyTGlzdCcpLmh0bWwodXNlcnMpOwogICAgICAgICAgICAgICAgICAgIHZhciBncm91cHMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0Lmdyb3VwcywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwcyArPSAgdGhpcy5uYW1lICsgJyA8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhHcm91cExpc3QnKS5odG1sKGdyb3Vwcyk7CgogICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXN1bHQuYWxsLCBmdW5jdGlvbihpLCBkYXRhKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oZGF0YS5uYW1lLCBkYXRhLmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzaGFyZWRXaXRoTW9kYWxTaG93ID0gdHJ1ZTsKCiAgICAgICAgfSkub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgc2hhcmVkV2l0aE1vZGFsU2hvdyA9IGZhbHNlOwogICAgICAgICAgICAkKCcjc2hhcmVkV2l0aCcpLnZhbChudWxsKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5maW5kKCdvcHRpb24nKS5yZW1vdmUoKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGdldFRhZ3NFbGVtZW50ID0gZnVuY3Rpb24odGFncykgewogICAgICAgIHZhciB0YWdzRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJ0YWctY29udGFpbmVyIGJsb2NrLWVsbGlwc2lzIj48ZGl2IGNsYXNzPSJ0YWctbGVuZ3RoIj4nOwogICAgICAgIHZhciBnbG9iYWxUYWdzQXJyYXkgPSBbXTsKICAgICAgICB2YXIgYWxlcnRUYWdzcnJheSA9IFtdOwogICAgICAgIHZhciBwcml2YXRlVGFnc0FycmF5ID0gW107CiAgICAgICAgJC5lYWNoKHRhZ3MsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5wcml2YXRlVXNlciA9PSAnKFApJykgewogICAgICAgICAgICAgICAgcHJpdmF0ZVRhZ3NBcnJheS5wdXNoKHZhbHVlKQogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLnRhZ1R5cGUgPT0gJyhBKScpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VGFnc3JyYXkucHVzaCh2YWx1ZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsb2JhbFRhZ3NBcnJheS5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YWdzRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHMnLCB7CiAgICAgICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgIHRhZ3M6dGFncywKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHZpZXdBbGxFbGVtZW50cyA9IGZldGNoVmlld0FsbFRhZ3MoZ2xvYmFsVGFnc0FycmF5ICwgYWxlcnRUYWdzcnJheSAsIHByaXZhdGVUYWdzQXJyYXkpOwoKICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIGRhdGEtdG9nZ2xlPSJ0b29sdGlwIiBkYXRhLXBsYWNlbWVudD0icmlnaHQiIHRpdGxlPSJBZGQvRWRpdCBDYXRlZ29yaWVzIiBjbGFzcz0iZWRpdEFsZXJ0VGFncyBidG4tZWRpdC10YWcgbWlkIj48aSBjbGFzcz0ibWRpIG1kaS1wZW5jaWwtYm94IGZvbnQtMjAgYmx1ZS0xIj48L2k+PC9hPic7CiAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyt2aWV3QWxsRWxlbWVudHMrJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgIHRhZ3NFbGVtZW50ICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgIHJldHVybiB0YWdzRWxlbWVudAogICAgfTsKCiAgICB2YXIgZmV0Y2hWaWV3QWxsVGFncyA9IGZ1bmN0aW9uKGdsb2JhbFRhZ3NBcnJheSAsIGFsZXJ0VGFnc0FycmF5ICwgcHJpdmF0ZVRhZ3NBcnJheSkgewogICAgICAgIHZhciByZXR1cm5FbGVtZW50ID0gIiI7CiAgICAgICAgaWYgKGdsb2JhbFRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgPSAiPHAgY2xhc3M9J3Bicicgc3R5bGU9J21hcmdpbi10b3A6N3B4Jz48Yj5HbG9iYWwgQ2F0ZWdvcnk8L2I+PGhyIGNsYXNzPSd0YWdlaHInPiI7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzX3ZpZXdfYWxsJywge3RhZ3M6IGdsb2JhbFRhZ3NBcnJheX0pICsgIjwvcD4iICA7CiAgICAgICAgfQogICAgICAgIGlmIChhbGVydFRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gIjxwIGNsYXNzPSdwYnInIHN0eWxlPSdtYXJnaW4tdG9wOjdweCc+PGI+QWxlcnQgU3BlY2lmaWMgQ2F0ZWdvcnk8L2I+PGhyIGNsYXNzPSd0YWdlaHInPiI7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzX3ZpZXdfYWxsJywgewogICAgICAgICAgICAgICAgdGFnczogYWxlcnRUYWdzQXJyYXksCiAgICAgICAgICAgIH0pICArICI8L3A+IiA7CiAgICAgICAgfQogICAgICAgIGlmIChwcml2YXRlVGFnc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSAiPHAgY2xhc3M9J3Bicicgc3R5bGU9J21hcmdpbi10b3A6N3B4Jz48Yj5Qcml2YXRlIENhdGVnb3J5PC9iPjxociBjbGFzcz0ndGFnZWhyJz4iOwogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlsc192aWV3X2FsbCcsIHt0YWdzOiBwcml2YXRlVGFnc0FycmF5fSkgICsgIjwvcD4iIDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldHVybkVsZW1lbnQKICAgIH07CiAgICByZXR1cm4gewogICAgICAgIGdldF9wcmlvcml0aWVzOiBnZXRfcHJpb3JpdGllcywKICAgICAgICBwcmlvcml0aWVzX3NlbGVjdGlvbnM6IHByaW9yaXRpZXNfc2VsZWN0aW9ucywKICAgICAgICBnZXRfd29ya2Zsb3dTdGF0ZXM6IGdldF93b3JrZmxvd1N0YXRlcywKICAgICAgICB3b3JrZmxvd19zZWxlY3Rpb25zOiB3b3JrZmxvd19zZWxlY3Rpb25zLAogICAgICAgIGNvbXBvc2VfZWRpdF9zdGF0ZV9saW5rOiBjb21wb3NlX2VkaXRfc3RhdGVfbGluaywKICAgICAgICBzdGF0ZV9jaGFuZ2U6IHN0YXRlX2NoYW5nZWQsCiAgICAgICAgc2hvd19qc29uX2FzX2Nzdjogc2hvd19qc29uX2FzX2NzdiwKICAgICAgICBpbml0X21hdGNoZWRfYWxlcnRzX3RhYmxlOiBpbml0X21hdGNoZWRfYWxlcnRzX3RhYmxlLAogICAgICAgIGdldFNpZ25hbE5hbWVMaXN0OiBnZXRTaWduYWxOYW1lTGlzdCwKICAgICAgICBpbml0aWFsaXplU2hhcmVXaXRoU2VsZWN0MiA6IGluaXRpYWxpemVTaGFyZVdpdGhTZWxlY3QyLAogICAgICAgIGluaXRpYWxpemVTaGFyZVdpdGhWYWx1ZXM6aW5pdGlhbGl6ZVNoYXJlV2l0aFZhbHVlcywKICAgICAgICBnZXRfdGFnc19lbGVtZW50IDogZ2V0VGFnc0VsZW1lbnQKICAgIH0KfSkoKTsKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CgpzaWduYWwubGlzdF91dGlscyA9IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgZmxhZ19pdCA9IGZ1bmN0aW9uIChmbGFnLCBpZCkgewogICAgICAgIHZhciB0aGVIdG1sID0gJzxpIGNsYXNzPSJmYSBmYS1mbGFnLW8gdGV4dC1tdXRlZCByeC1saXN0LWZsYWciIGRhdGEtaWQ9IicgKyBpZCArICciPjwvaT4nCiAgICAgICAgaWYgKGZsYWcpIHsKICAgICAgICAgICAgdGhlSHRtbCA9ICc8aSBjbGFzcz0iZmEgZmEtZmxhZyB0ZXh0LXByaW1hcnkgcngtbGlzdC1mbGFnIiBkYXRhLWlkPSInICsgaWQgKyAnIj48L2k+JwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhlSHRtbAogICAgfTsKCiAgICB2YXIgZmxhZ19oYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRyb2xsZXIsIGFjdGlvbikgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcucngtbGlzdC1mbGFnJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIGVsZSA9IGUudGFyZ2V0OwogICAgICAgICAgICB2YXIgaWQgPSAkKGVsZSkuYXR0cignZGF0YS1pZCcpOwoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogIi9zaWduYWwvIiArIGNvbnRyb2xsZXIgKyAiLyIgKyBhY3Rpb24gKyAiP2lkPSIgKyBpZCwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmZsYWdnZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLnJlbW92ZUNsYXNzKCdmYS1mbGFnLW8nKS5yZW1vdmVDbGFzcygndGV4dC1tdXRlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkuYWRkQ2xhc3MoJ2ZhLWZsYWcnKS5hZGRDbGFzcygndGV4dC1wcmltYXJ5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLmFkZENsYXNzKCdmYS1mbGFnLW8nKS5hZGRDbGFzcygndGV4dC1tdXRlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkucmVtb3ZlQ2xhc3MoJ2ZhLWZsYWcnKS5yZW1vdmVDbGFzcygndGV4dC1wcmltYXJ5JykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIHByaW9yaXR5X2xpbmsgPSBmdW5jdGlvbiAocHJpb3JpdHksIGlkKSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gY29tcG9zZV9wcmlvcml0eV9pY29uKHByaW9yaXR5KTsKICAgICAgICByZXR1cm4gJzxhIGhyZWY9IiMiIGNsYXNzPSJjaGFuZ2UtcHJpb3JpdHkiPjxpbWcgZGF0YS1maWVsZD0icHJpb3JpdHkiIGRhdGEtaW5mbz0icm93IiBkYXRhLWlkPSInICsKICAgICAgICAgICAgaWQgKyAnIiBkYXRhLXZhbHVlPSInICsgcHJpb3JpdHkgKyAnIiBzcmM9IicgKyBpY29uX3VybCArICciLz48L2E+JwogICAgfTsKCiAgICB2YXIgY29tcG9zZV9wcmlvcml0eV9pY29uID0gZnVuY3Rpb24gKHByaW9yaXR5KSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gIi9zaWduYWwvYXNzZXRzL2ljb25zL2RlZmF1bHRfcHJpb3JpdHkucG5nIjsKCiAgICAgICAgaWYgKF8uY29udGFpbnMoWydoaWdoJywgJ2xvdycsICdtZWRpdW0nXSwgcHJpb3JpdHkudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgICAgICAgaWNvbl91cmwgPSAiL3NpZ25hbC9hc3NldHMvaWNvbnMvIiArIHByaW9yaXR5LnRvTG93ZXJDYXNlKCkgKyAiX3ByaW9yaXR5LnBuZyI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpY29uX3VybDsKICAgIH07CgogICAgdmFyIGNoYW5nZV9wcmlvcml0eSA9IGZ1bmN0aW9uIChwcmlvcml0eUVsZSwgcHJpb3JpdHkpIHsKICAgICAgICB2YXIgaWNvbl91cmwgPSBjb21wb3NlX3ByaW9yaXR5X2ljb24ocHJpb3JpdHkpOwogICAgICAgICQocHJpb3JpdHlFbGUpLmF0dHIoInNyYyIsIGljb25fdXJsKTsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJkYXRhLXZhbHVlIiwgcHJpb3JpdHkpOwogICAgfTsKCiAgICB2YXIgY2hhbmdlX3ByaW9yaXR5VGVzdCA9IGZ1bmN0aW9uIChwcmlvcml0eUVsZSwgcHJpb3JpdHkpIHsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJkYXRhLXZhbHVlIiwgcHJpb3JpdHkpOwogICAgfTsKCiAgICBjaGFuZ2VfcHJpb3JpdHlUZXN0CgogICAgdmFyIGZpbmRfZmllbGQgPSBmdW5jdGlvbiAodGFibGVfcm93X2VsZSwgYXR0cl9uYW1lKSB7CiAgICAgICAgcmV0dXJuICQodGFibGVfcm93X2VsZSkuZmluZCgiW2RhdGEtYXR0cmlidXRlLW5hbWU9JyIgKyBhdHRyX25hbWUgKyAiJ10iKQogICAgfTsKCiAgICB2YXIgc2V0X3ZhbHVlID0gZnVuY3Rpb24gKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSwgaWQsIGRhdGFfZnVuLCBhcHBfbmFtZSkgewogICAgICAgIHZhciBlbGUgPSBmaW5kX2ZpZWxkKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSk7CiAgICAgICAgZWxlLmh0bWwoZGF0YV9mdW4oaWQsIGFwcF9uYW1lKSk7CiAgICB9OwoKICAgIHZhciBnZXRfZHVlX2luID0gZnVuY3Rpb24gKGlkLCBhcHBfbmFtZSkgewogICAgICAgIHZhciBkdWVJbiA9IDA7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydC9kdWVJbj9hbGVydElkPSIgKyBpZCArICImYXBwTmFtZT0iICsgYXBwX25hbWUsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIGR1ZUluID0gZGF0YS5yZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZHVlSW4KICAgIH07CgogICAgdmFyIGR1ZV9pbl9jb21wID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlIDw9IDApIHsKICAgICAgICAgICAgcmV0dXJuICI8ZGl2IGRhdGEtYXR0cmlidXRlLW5hbWU9J2R1ZUluJyBzdHlsZSA9ICdjb2xvcjpyZWQnPiIgKyB2YWx1ZSArICI8L2Rpdj4iOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAiPGRpdiBkYXRhLWF0dHJpYnV0ZS1uYW1lPSdkdWVJbic+IiArIHZhbHVlICsgIjwvZGl2PiI7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgYXNzaWduZWRfdG9fY29tcCA9IGZ1bmN0aW9uIChpZCwgYXNzaWduZWRUbykgewogICAgICAgIHZhciBodG1sID0gJzxkaXYgY2xhc3M9ImFzc2lnbmVkVG9Db250YWluZXIiPjxzZWxlY3QgY2xhc3M9ImFzc2lnbmVkVG9TZWxlY3QgZm9ybS1jb250cm9sIHNlbGVjdDIiPjwvc2VsZWN0PjxpIGNsYXNzPSJtZGkgbWRpLXNwaW4gbWRpLWxvYWRpbmcgYXNzaWduVG9Qcm9jZXNzaW5nIiBzdHlsZT0iZGlzcGxheTogbm9uZSI+PC9pPjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIGh0bWwKICAgIH07CgogICAgdmFyIHRydW5jYXRlVGV4dEFuZFNob3dUb29sdGlwID0gZnVuY3Rpb24gKGN1dG9mZiwgd29yZGJyZWFrLCBlc2NhcGVIdG1sKSB7CiAgICAgICAgdmFyIGVzYyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgIC8vIE9yZGVyLCBzZWFyY2ggYW5kIHR5cGUgZ2V0IHRoZSBvcmlnaW5hbCBkYXRhCiAgICAgICAgICAgIGlmICh0eXBlICE9PSAnZGlzcGxheScpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIGQgIT09ICdudW1iZXInICYmIHR5cGVvZiBkICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGQgPSBkLnRvU3RyaW5nKCk7IC8vIGNhc3QgbnVtYmVycwoKICAgICAgICAgICAgaWYgKGQubGVuZ3RoIDw9IGN1dG9mZikgewogICAgICAgICAgICAgICAgcmV0dXJuIGVzYyhkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHNob3J0ZW5lZCA9IGQuc3Vic3RyKDAsIGN1dG9mZiAtIDEpOwoKICAgICAgICAgICAgLy8gRmluZCB0aGUgbGFzdCB3aGl0ZSBzcGFjZSBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZwogICAgICAgICAgICBpZiAod29yZGJyZWFrKSB7CiAgICAgICAgICAgICAgICBzaG9ydGVuZWQgPSBzaG9ydGVuZWQucmVwbGFjZSgvXHMoW15cc10qKSQvLCAnJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFByb3RlY3QgYWdhaW5zdCB1bmNvbnRyb2xsZWQgSFRNTCBpbnB1dAogICAgICAgICAgICBpZiAoZXNjYXBlSHRtbCkgewogICAgICAgICAgICAgICAgc2hvcnRlbmVkID0gZXNjKHNob3J0ZW5lZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9ImVsbGlwc2lzIiB0aXRsZT0iJyArIGVzYyhkKSArICciPicgKyBzaG9ydGVuZWQgKyAnJiM4MjMwOzwvc3Bhbj4nOwogICAgICAgIH07CiAgICB9OwoKICAgIHZhciBhZGRfZmlsdGVycyA9IGZ1bmN0aW9uICh0YWJsZSwgZmlsdGVycywgZmlsdGVyX3RvZ2dsZV9idF9jb250YWluZXIpIHsKCiAgICAgICAgdmFyIHlhZGNmX2ZpbHRlcnMgPSBfLmZpbHRlcihmaWx0ZXJzLCBmdW5jdGlvbiAoZikgewogICAgICAgICAgICBpZiAoZlsxXSAhPSAnY3VzdG9taXplZCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBjdXN0X2ZpbHRlcnMgPSBfLmRpZmZlcmVuY2UoZmlsdGVycywgeWFkY2ZfZmlsdGVycyk7CgogICAgICAgIHlhZGNmLmluaXQodGFibGUsIF8ubWFwKHlhZGNmX2ZpbHRlcnMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtWzJdID09IHRydWUpCiAgICAgICAgICAgICAgICByZXR1cm4ge2NvbHVtbl9udW1iZXI6IGl0ZW1bMF0sIGZpbHRlcl90eXBlOiBpdGVtWzFdLCBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6ICd4J307CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiB7Y29sdW1uX251bWJlcjogaXRlbVswXSwgZmlsdGVyX3R5cGU6IGl0ZW1bMV0sIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2V9OwogICAgICAgIH0pKTsKCiAgICAgICAgaWYgKGZpbHRlcl90b2dnbGVfYnRfY29udGFpbmVyKSB7CiAgICAgICAgICAgIGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbignaWR4eHh4eHgnLCBmaWx0ZXJfdG9nZ2xlX2J0X2NvbnRhaW5lcik7CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VzdF9maWx0ZXJzKSB7CiAgICAgICAgICAgIF8uZWFjaChjdXN0X2ZpbHRlcnMsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAkKHRhYmxlLmNvbHVtbihmWzBdKS5oZWFkZXIoKSkuYXBwZW5kKGNyZWF0ZV9zdGFja2VkX2ZpbHRlcihmWzBdKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNyZWF0ZV9zdGFja2VkX2ZpbHRlciA9IGZ1bmN0aW9uIChpZHgpIHsKICAgICAgICByZXR1cm4gJCgiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtaW5kZXg9JyIgKyBpZHggKyAiJyBjbGFzcz0nY29sdW1uLWZpbHRlcicgcGxhY2Vob2xkZXI9J1R5cGUgdG8gZmlsdGVyJz4iICsKICAgICAgICAgICAgIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLWluZGV4PSciICsgaWR4ICsgIicgY2xhc3M9J2NvbHVtbi1maWx0ZXInIHBsYWNlaG9sZGVyPSdUeXBlIHRvIGZpbHRlcic+Iik7CiAgICB9OwoKICAgIHZhciBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b24gPSBmdW5jdGlvbiAodGFibGVfaWQsIGNvbnRhaW5lcikgewogICAgICAgICQoJy55YWRjZi1maWx0ZXItd3JhcHBlciwgLmNvbHVtbi1maWx0ZXInKS5oaWRlKCk7CiAgICAgICAgJCgnLmNvbHVtbi1maWx0ZXInKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgJCgnLmNvbHVtbi1maWx0ZXInKS5vbigna2V5dXAnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIC8vIFBlcmZvcm0gc2VhcmNoCiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuZGF0YSgnaW5kZXgnKTsKICAgICAgICAgICAgJCh0YWJsZV9pZCkuRGF0YVRhYmxlKCkuY29sdW1uKGluZGV4KS5zZWFyY2goJCh0aGlzKS52YWwoKSkuZHJhdygpOwogICAgICAgIH0pOwogICAgICAgIHZhciBmaWx0ZXJUb2dnbGUgPSAiPGkgY2xhc3M9J3RhYmxlLWZpbHRlci10b2dnbGUgZ2x5cGhpY29uIGdseXBoaWNvbi1maWx0ZXInIGRhdGEtdGFibGU9JyIgKyB0YWJsZV9pZCArCiAgICAgICAgICAgICInIG9uY2xpY2s9J3NpZ25hbC5saXN0X3V0aWxzLmhhbmRsZV9maWx0ZXJfdG9nZ2xlJyBkYXRhLXNob3ctZmlsdGVyPSd0cnVlJz48L2k+IjsKICAgICAgICB2YXIgdG9nZ2xlX2J1dHRvbiA9ICQucGFyc2VIVE1MKGZpbHRlclRvZ2dsZSk7CiAgICAgICAgaWYgKCEoXy5pc1VuZGVmaW5lZChjb250YWluZXIpICYmIF8uaXNOdWxsKGNvbnRhaW5lcikpKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQodG9nZ2xlX2J1dHRvbik7CiAgICAgICAgfQoKICAgICAgICAkKGRvY3VtZW50KS5vbignZmlsdGVyLXRvZ2dsZS1pbml0JywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAkKCcudGFibGUtZmlsdGVyLXRvZ2dsZScpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBoaWRlX3Nob3dfZml0bGVyID0gZnVuY3Rpb24gKHRhYmxlSWQsIGhpZGVPclNob3cpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGlkZU9yU2hvdyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0YWJsZUlkICsgJ193cmFwcGVyIC55YWRjZi1maWx0ZXItd3JhcHBlciwuY29sdW1uLWZpbHRlcicpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRhYmxlSWQgKyAnX3dyYXBwZXIgLnlhZGNmLWZpbHRlci13cmFwcGVyLC5jb2x1bW4tZmlsdGVyJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIHRhcmdldEZpbHRlclRvZ2dsZSA9ICQoZXZ0LnRhcmdldCk7CiAgICAgICAgICAgICAgICB2YXIgdGFibGVJZCA9IHRhcmdldEZpbHRlclRvZ2dsZS5kYXRhKCd0YWJsZScpOwogICAgICAgICAgICAgICAgdmFyIHNob3dGaWx0ZXIgPSB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvdy1maWx0ZXInKTsKICAgICAgICAgICAgICAgIGlmIChzaG93RmlsdGVyID09PSAndHJ1ZScpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvd0ZpbHRlcicsICdmYWxzZScpOwogICAgICAgICAgICAgICAgICAgIGhpZGVfc2hvd19maXRsZXIodGFibGVJZCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvd0ZpbHRlcicsICd0cnVlJyk7CiAgICAgICAgICAgICAgICAgICAgaGlkZV9zaG93X2ZpdGxlcih0YWJsZUlkLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgICQoZG9jdW1lbnQpLnRyaWdnZXIoJ2ZpbHRlci10b2dnbGUtaW5pdCcpOwogICAgICAgIHJldHVybiAkKHRvZ2dsZV9idXR0b24pOwogICAgfTsKCiAgICB2YXIgaGFuZGxlX2ZpbHRlcl90b2dnbGUgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgJCh0aGlzKS5hdHRyKCd0YXJnZXQtdGFibGUnKTsKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBmbGFnX2l0OiBmbGFnX2l0LAogICAgICAgIGZsYWdfaGFuZGxlcjogZmxhZ19oYW5kbGVyLAogICAgICAgIHByaW9yaXR5X2xpbms6IHByaW9yaXR5X2xpbmssCiAgICAgICAgY2hhbmdlX3ByaW9yaXR5OiBjaGFuZ2VfcHJpb3JpdHksCiAgICAgICAgZmluZF9maWVsZDogZmluZF9maWVsZCwKICAgICAgICBzZXRfdmFsdWU6IHNldF92YWx1ZSwKICAgICAgICBnZXRfZHVlX2luOiBnZXRfZHVlX2luLAogICAgICAgIGR1ZV9pbl9jb21wOiBkdWVfaW5fY29tcCwKICAgICAgICBhc3NpZ25lZF90b19jb21wOiBhc3NpZ25lZF90b19jb21wLAogICAgICAgIHRydW5jYXRlVGV4dEFuZFNob3dUb29sdGlwOiB0cnVuY2F0ZVRleHRBbmRTaG93VG9vbHRpcCwKICAgICAgICBhZGRfZmlsdGVyczogYWRkX2ZpbHRlcnMsCiAgICAgICAgaGFuZGxlX2ZpbHRlcl90b2dnbGU6IGhhbmRsZV9maWx0ZXJfdG9nZ2xlLAogICAgICAgIGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbjogYWRkX2ZpbHRlcl90b2dnbGVfYnV0dG9uCiAgICB9Cn0pKCk7CnZhciBzaWduYWwgPSBzaWduYWwgfHwge30KCnNpZ25hbC5hY3Rpdml0aWVzX3V0aWxzID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIGFjdGl2aXR5X3RhYmxlOwogICAgdmFyIHNvcnRpbmdDb3VudCA9IDM7CgogICAgdmFyIGluaXRfYWN0aXZpdGllc190YWJsZSA9IGZ1bmN0aW9uKHRhYmxlLCB1cmwsIGFwcFR5cGUpIHsKICAgICAgICB2YXIgY29sdW1ucyA9IGNyZWF0ZV9hY3Rpdml0eV9jb2x1bW5fZGF0YShhcHBUeXBlKTsKICAgICAgICBhY3Rpdml0eV90YWJsZSA9ICQodGFibGUpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICJzUGFnaW5hdGlvblR5cGUiOiAiYm9vdHN0cmFwIiwKCiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgICAgICB9LAogICAgICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJCgnYVtocmVmPSIjYWN0aXZpdGllcyJdJykub24oInNob3duLmJzLnRhYiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGl2aXRpZXNUYWJsZScpLkRhdGFUYWJsZSgpLmFqYXgudXJsKGdldEFjdGl2aXR5VXJsKCkpLmxvYWQoKTsKICAgICAgICAgICAgICAgICAgICBhZGRHcmlkU2hvcnRjdXRzKCcjYWN0aXZpdGllc1RhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlR3JpZFNob3J0Y3V0cygnI2FsZXJ0c0RldGFpbHNUYWJsZScpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUdyaWRTaG9ydGN1dHMoJyNhcmNoaXZlZEFsZXJ0c1RhYmxlJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFhU29ydGluZyI6IFtbc29ydGluZ0NvdW50LCAiZGVzYyJdXSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiAxMCwKICAgICAgICAgICAgImJBdXRvV2lkdGgiOiBmYWxzZSwKICAgICAgICAgICAgImFvQ29sdW1ucyI6IGNvbHVtbnMsCiAgICAgICAgICAgICJzY3JvbGxYIjogdHJ1ZSwKICAgICAgICAgICAgInNjcm9sbFkiOiJjYWxjKDEwMHZoIC0gMzAxcHgpIiwKICAgICAgICAgICAgImF1dG9XaWR0aCI6dHJ1ZSwKICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gYWN0aXZpdHlfdGFibGU7CiAgICB9OwoKICAgIHZhciBjcmVhdGVfYWN0aXZpdHlfY29sdW1uX2RhdGEgPSBmdW5jdGlvbihhcHBUeXBlKSB7CiAgICAgICAgdmFyIGFvQ29sdW1ucyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInR5cGUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICBpZihyb3cudHlwZT09J1BFQ0Rpc3NvY2lhdGVkJyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUEVDIERpc3NvY2lhdGVkJwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihyb3cudHlwZT09J1BFQ0Fzc29jaWF0ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUEVDIEFzc29jaWF0ZWQnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMuYnJlYWtJdChyb3cudHlwZSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZGV0YWlscyIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJvdy5kZXRhaWxzID0gcm93LmRldGFpbHMucmVwbGFjZSgvPGJyPi9nLCdcbicpCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5qdXN0aWZpY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPHNwYW4gY2xhc3M9J3dvcmQtd3JhcC1icmVhay13b3JkJz4iK2VzY2FwZUhUTUwocm93LmRldGFpbHMpICsgIiAtLSB3aXRoIEp1c3RpZmljYXRpb24gJyIgKyBlc2NhcGVIVE1MKHJvdy5qdXN0aWZpY2F0aW9uKSArICInIisiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlc2NyaXB0aW9uVGV4dCA9IHByb2Nlc3NfZGVzY3JpcHRpb24ocm93LmRldGFpbHMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCBjZWxsLWJyZWFrJz4iK2Rlc2NyaXB0aW9uVGV4dCsiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0yMDAgY29sLW1heC0zMDAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwZXJmb3JtZWRCeSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICBpZihyb3cucGVyZm9ybWVkQnlEZXB0ICYmIHJvdy5wZXJmb3JtZWRCeURlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwocm93LnBlcmZvcm1lZEJ5ICsgIiAoIiArIHJvdy5wZXJmb3JtZWRCeURlcHQgKyAiKSIpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93LnBlcmZvcm1lZEJ5CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aW1lc3RhbXAiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbihkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfQogICAgICAgIF07CiAgICAgICAgaWYoYXBwVHlwZSA9PSAnU2luZ2xlIENhc2UgQWxlcnQnKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMCwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlTnVtYmVyIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDIsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3VzcGVjdCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMjAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgzLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImV2ZW50TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg1LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImN1cnJlbnRBc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyQXNzaWdubWVudAogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICYmIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSByb3cuY3VycmVudEFzc2lnbm1lbnQgKyAiICgiICsgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCArICIpIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gKHJvdy5jdXJyZW50QXNzaWdubWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwoY3VyckFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvcnRpbmdDb3VudCA9IDcKICAgICAgICB9ZWxzZSBpZihhcHBUeXBlID09ICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCcpIHsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgwLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImFydGljbGVJZCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgyLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInNlYXJjaFN0cmluZyIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgzLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInByb2R1Y3ROYW1lIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0yMDAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDQsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZXZlbnROYW1lIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDYsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY3VycmVudEFzc2lnbm1lbnQiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJBc3NpZ25tZW50CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgJiYgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyQXNzaWdubWVudCA9IHJvdy5jdXJyZW50QXNzaWdubWVudCArICIgKCIgKyByb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICsgIikiCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSAocm93LmN1cnJlbnRBc3NpZ25tZW50KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXNjYXBlSFRNTChjdXJyQXNzaWdubWVudCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc29ydGluZ0NvdW50ID0gOAogICAgICAgIH0gZWxzZSBpZiAoYXBwVHlwZSA9PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnIHx8IGFwcFR5cGUgPT0gJ0VWREFTIEFsZXJ0JykgewogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDEsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3VzcGVjdCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgyLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImV2ZW50TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg0LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImN1cnJlbnRBc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyQXNzaWdubWVudAogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICYmIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSByb3cuY3VycmVudEFzc2lnbm1lbnQgKyAiICgiICsgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCArICIpIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gKHJvdy5jdXJyZW50QXNzaWdubWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwoY3VyckFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvcnRpbmdDb3VudCA9IDYKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFvQ29sdW1ucwogICAgfTsKCiAgICB2YXIgcmVsb2FkX2FjdGl2aXR5X3RhYmxlID0gZnVuY3Rpb24oKSB7CgogICAgICAgIGlmICh0eXBlb2YgYWN0aXZpdHlfdGFibGUgIT0gInVuZGVmaW5lZCIgJiYgYWN0aXZpdHlfdGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICBhY3Rpdml0eV90YWJsZS5hamF4LnJlbG9hZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJVbmFibGUgdG8gcmVsb2FkIHRoZSBhY3Rpdml0eSB0YWJsZS4gUGxlYXNlIHJlZnJlc2ggdGhlIHBhZ2UuIikKICAgICAgICB9CgogICAgfTsKCiAgICB2YXIgcHJvY2Vzc19kZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKGRlc2NyaXB0aW9uU3RyKSB7CiAgICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdGlvblN0ciAhPSAidW5kZWZpbmVkIiAmJiBkZXNjcmlwdGlvblN0ciAhPSBudWxsKSB7CiAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbnMgPSBkZXNjcmlwdGlvblN0ci5zcGxpdCgnfCcpOwogICAgICAgICAgICAvL3ZhciBmb3JtYXR0ZWRTdHJpbmcgPSAnJwogICAgICAgICAgICB2YXIgZm9ybWF0dGVkU3RyaW5nID0gIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4PGRlc2NyaXB0aW9ucy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uc1tpbmRleF07CiAgICAgICAgICAgICAgICB2YXIgZGVzY1NwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICBkZXNjU3Bhbi5pbm5lckhUTUwgPSBlc2NhcGVIVE1MKGRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgICAgIGRlc2NTcGFuLmlubmVySFRNTCA9IGRlc2NTcGFuLmlubmVySFRNTC5yZXBsYWNlKC9cbi9nLCAnPGJyPicpCiAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTdHJpbmcuYXBwZW5kQ2hpbGQoZGVzY1NwYW4pOwogICAgICAgICAgICAgICAgZm9ybWF0dGVkU3RyaW5nLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRTdHJpbmcuaW5uZXJIVE1MOwogICAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBpbml0X2FjdGl2aXRpZXNfdGFibGUgOiBpbml0X2FjdGl2aXRpZXNfdGFibGUsCiAgICAgICAgcHJvY2Vzc19kZXNjcmlwdGlvbiA6IHByb2Nlc3NfZGVzY3JpcHRpb24sCiAgICAgICAgcmVsb2FkX2FjdGl2aXR5X3RhYmxlIDogcmVsb2FkX2FjdGl2aXR5X3RhYmxlCiAgICB9Cn0pKCk7CgpmdW5jdGlvbiBnZXRBY3Rpdml0eVVybCgpIHsKICAgIGlmIChhcHBsaWNhdGlvbk5hbWUgPT09IEFMRVJUX0NPTkZJR19UWVBFLkxJVEVSQVRVUkVfU0VBUkNIX0FMRVJUKSB7CiAgICAgICAgcmV0dXJuIGFsZXJ0QWN0aXZpdGllczsKICAgIH0gZWxzZSBpZiAoYXBwbGljYXRpb25OYW1lID09PSBBTEVSVF9DT05GSUdfVFlQRS5TSUdOQUxfTUFOQUdFTUVOVCkgewogICAgICAgIHJldHVybiBhY3Rpdml0eVVybDsKICAgIH0KICAgIHJldHVybiBhbGVydEFjdGl2aXRpZXNVcmwgKyBlbmNvZGVVUkkoJz9leGVjdXRlZElkTGlzdD0nICsgZXhlY3V0ZWRJZExpc3QgKyAiJmFwcFR5cGU9IiArIGFwcGxpY2F0aW9uTmFtZSkKCn0KCgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKc2lnbmFsLmFjdGlvbnNfdXRpbHMgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgYWN0aW9uX2xpc3RfdGFibGU7CiAgICB2YXIgY3VycmVudF9jcmVhdGVfYnQ7CiAgICB2YXIgYWRob2NfdmFsaWRhdGVkX3RhYmxlOwoKICAgIHZhciBzZXRfYWN0aW9uX2NyZWF0ZV9tb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcjY3JlYXRlQWN0aW9uTW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgJCh0aGlzKQogICAgICAgICAgICAgICAgLmZpbmQoJyNjb25maWcnKS52YWwoJycpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnI3R5cGUnKS52YWwoJycpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnI21lZXRpbmdFbGVtZW50JykudmFsKCcnKS5lbmQoKQogICAgICAgICAgICAgICAgLmZpbmQoJy5hc3NpZ25lZFRvVmFsdWUnKS52YWwoJycpLnRyaWdnZXIoJ2NoYW5nZScpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnLmFzc2lnbmVkVG9WYWx1ZScpLmVtcHR5KCkuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCJpbnB1dFt0eXBlPXRleHRdLHRleHRhcmVhIikudmFsKCcnKQogICAgICAgICAgICAgICAgLmVuZCgpOwoKICAgICAgICAgICAgJCgnI2NyZWF0ZUFjdGlvbk1vZGFsIC5zZWxlY3QyLXNlbGVjdGlvbl9fcmVuZGVyZWQnKS5ob3ZlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoJ3RpdGxlJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9KTsKCiAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsJykub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNsZWFyX2VkaXRfZXJyb3JzKCk7CiAgICAgICAgICAgICQodGhpcykKICAgICAgICAgICAgICAgIC5maW5kKCJpbnB1dFt0eXBlPXRleHRdLHRleHRhcmVhLHNlbGVjdCIpCiAgICAgICAgICAgICAgICAudmFsKCcnKQogICAgICAgICAgICAgICAgLmVuZCgpCiAgICAgICAgfSk7CgogICAgICAgICQoJyNlZGl0QWN0aW9uTW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY2xlYXJfZWRpdF9zaWduYWwoKTsKICAgICAgICAgICAgJCh0aGlzKQogICAgICAgICAgICAgICAgLmZpbmQoImlucHV0W3R5cGU9dGV4dF0sdGV4dGFyZWEsc2VsZWN0IikKICAgICAgICAgICAgICAgIC52YWwoJycpCiAgICAgICAgICAgICAgICAuZW5kKCkKICAgICAgICB9KTsKCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5hY3Rpb24tY3JlYXRlJywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICB2YXIgc3JjRWxlID0gJChldnQudGFyZ2V0KTsKICAgICAgICAgICAgY3VycmVudF9jcmVhdGVfYnQgPSBzcmNFbGU7CiAgICAgICAgICAgIHZhciBhbGVydElkID0gYWxlcnRJZDsKICAgICAgICAgICAgaWYgKHR5cGVvZiAoc3JjRWxlLmF0dHIoJ2FsZXJ0LWlkJykpICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgYWxlcnRJZCA9IHNyY0VsZS5hdHRyKCdhbGVydC1pZCcpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNyZWF0ZUFjdGlvbk1vZGFsID0gJCgnI2NyZWF0ZUFjdGlvbk1vZGFsJyk7CiAgICAgICAgICAgIHZhciBjcmVhdGVBY3Rpb25CdXR0b24gPSAkKCIjY3JlYXRlLWFjdGlvbi1idG4iKTsKICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwuZmluZCgnLmlkLWVsZW1lbnQnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CgogICAgICAgICAgICAvL1NldCB0aGUgYWxlcnRJZCBpbiB0aGUgaGlkZGVuIGZpZWxkIG9mIHRoZSBtb2RhbC4KICAgICAgICAgICAgaWYgKHR5cGVvZiBhbGVydElkICE9ICJ1bmRlZmluZWQiICYmIGFsZXJ0SWQgIT0gJycpIHsKICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbk1vZGFsLmZpbmQoIi5hbGVydElkIikudmFsKGFsZXJ0SWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjcmVhdGVBY3Rpb25Nb2RhbC5maW5kKCcjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcigpOwogICAgICAgICAgICBjcmVhdGVBY3Rpb25CdXR0b24uYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAkKCcuYWN0aW9uLXR5cGUtbGlzdCcpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgJCgnLm1lZXRpbmctbGlzdCcpLmFkZENsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwubW9kYWwoe30pOwoKICAgICAgICAgICAgLy9FdmVudCBiaW5kIHdoZW4gdGhlIHNhdmUvY3JlYXRlIGJ1dHRvbiBpcyBjbGljawogICAgICAgICAgICAvLyBrZWQgaW4gdGhlIGFjdGlvbiBldmVudCBtb2RhbC4KICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLnVuYmluZCgnY2xpY2snKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbkJ1dHRvbi5hdHRyKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1pZCcpOwogICAgICAgICAgICAgICAgdmFyIGFjdGlvbk1vZGFsSWQgPSAkKCIjY3JlYXRlQWN0aW9uTW9kYWwgI3RlbXBGb3JtIik7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbmFsL2FjdGlvbi9zYXZlJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiBnZXRBY3Rpb25EZXRhaWxzKGFjdGlvbk1vZGFsSWQpLAogICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhcl9lcnJvcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gIjxkaXYgY2xhc3M9J2FsZXJ0IGFsZXJ0LWRhbmdlcic+IjsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlT2JqID0gcmVzcG9uc2UuZGF0YVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSBlcnJvck1lc3NhZ2VPYmo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAnPC9icj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICI8L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWN0aW9uTW9kYWwgLm1vZGFsLWJvZHknKS5wcmVwZW5kKGVycm9yTXNnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbk1vZGFsLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfY3JlYXRlX2J0LnBhcmVudHNVbnRpbCgidGQiKS5maW5kKCcuZGVmYXVsdC12YWx1ZScpLmh0bWwocmVzcG9uc2UuYWN0aW9uQ291bnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgPT09ICJDYXNlIERldGFpbCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhbGVydElkICE9ICJ1bmRlZmluZWQiICYmIGFsZXJ0SWQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRldGFpbF90YWJsZSAhPSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxfdGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNtZWV0aW5nLXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2lnbmFsQWN0aXZpdHlUYWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vUmVmcmVzaCB0aGUgYWN0aXZpdHkgdGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkNBU0VfREVUQUlMICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkVWRU5UX0RFVEFJTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGl2aXRpZXNfdXRpbHMucmVsb2FkX2FjdGl2aXR5X3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBwbGljYXRpb25MYWJlbCA9PSBBUFBMSUNBVElPTl9MQUJFTC5TSUdOQUxfTUFOQUdFTUVOVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5tZWV0aW5nX3V0aWxzLnJlbG9hZF9tZWV0aW5nX3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1zZyA9ICI8ZGl2IGNsYXNzPSdhbGVydCBhbGVydC1kYW5nZXInPiI7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIkVycm9yIG9jY3VyZWQgd2hpbGUgc2F2aW5nIEFjdGlvbi4iOwogICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICI8L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpOwogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbkJ1dHRvbi5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGdldEFjdGlvbkRldGFpbHMgPSBmdW5jdGlvbihtb2RhbElkKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImNvbmZpZyI6IG1vZGFsSWQuZmluZCgiI2NvbmZpZyIpLnZhbCgpLAogICAgICAgICAgICAidHlwZSI6IG1vZGFsSWQuZmluZCgiI3R5cGUiKS52YWwoKSwKICAgICAgICAgICAgImFzc2lnbmVkVG9WYWx1ZSI6IG1vZGFsSWQuZmluZCgiI2Fzc2lnbmVkVG8iKS52YWwoKSwKICAgICAgICAgICAgImR1ZURhdGUiOiBtb2RhbElkLmZpbmQoIiNkdWVEYXRlIikudmFsKCksCiAgICAgICAgICAgICJkZXRhaWxzIjogbW9kYWxJZC5maW5kKCIjZGV0YWlscyIpLnZhbCgpLAogICAgICAgICAgICAiY29tbWVudHMiOiBtb2RhbElkLmZpbmQoIiNjb21tZW50cyIpLnZhbCgpLAogICAgICAgICAgICAiYWxlcnRJZCI6IG1vZGFsSWQuZmluZCgiI2FsZXJ0SWQiKS52YWwoKSwKICAgICAgICAgICAgImFwcFR5cGUiOiBtb2RhbElkLmZpbmQoIiNhcHBUeXBlIikudmFsKCksCiAgICAgICAgICAgICJleGVDb25maWdJZCI6IG1vZGFsSWQuZmluZCgiI2V4ZUNvbmZpZ0lkIikudmFsKCksCiAgICAgICAgICAgICJtZWV0aW5nSWQiOiBtb2RhbElkLmZpbmQoIiNtZWV0aW5nRWxlbWVudCIpLnZhbCgpLAogICAgICAgICAgICAiYWN0aW9uU3RhdHVzIjogbW9kYWxJZC5maW5kKCIjYWN0aW9uU3RhdHVzIikudmFsKCksCiAgICAgICAgICAgICJhY3Rpb25JZCI6IG1vZGFsSWQuZmluZCgiI2FjdGlvbklkIikudmFsKCksCiAgICAgICAgICAgICJpc0FyY2hpdmVkIjogaXNBcmNoaXZlZAogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNsZWFyX2Vycm9ycyA9IGZ1bmN0aW9uKCkgewogICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKQogICAgfTsKCiAgICB2YXIgY2xlYXJfZWRpdF9lcnJvcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsIC5tb2RhbC1ib2R5IC5hbGVydCcpLnJlbW92ZSgpCiAgICB9OwogICAgdmFyIGNsZWFyX2VkaXRfc2lnbmFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNlZGl0QWN0aW9uTW9kYWwgLm1vZGFsLWJvZHkgLmFsZXJ0JykucmVtb3ZlKCkKICAgIH07CgovL1NpbmdsZSBhbmQgQWdncmVnYXRlIEFjdGlvbiBsaXN0IGRhdGEKICAgIHZhciBzZXRfYWN0aW9uX2xpc3RfbW9kYWwgPSBmdW5jdGlvbihjb21wKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5saXN0LWFjdGlvbicsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29tcC5tb2RhbCgndG9nZ2xlJywgJCh0aGlzKSk7CiAgICAgICAgfSk7CiAgICAgICAgY29tcC5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbihldnQpIHsKICAgICAgICAgICAgdmFyIHNyY0VsZSA9IGV2dC5yZWxhdGVkVGFyZ2V0OwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9ICQoc3JjRWxlKS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgIHZhciBhcHBUeXBlID0gJCgiI2NyZWF0ZUFjdGlvbk1vZGFsICN0ZW1wRm9ybSIpLmZpbmQoIiNhcHBUeXBlIikudmFsKCk7CiAgICAgICAgICAgIHZhciBhY3Rpb25VcmwgPSAiL3NpZ25hbC9hY3Rpb24vbGlzdEJ5QWxlcnQ/YWxlcnRJZD0iICsgYWxlcnRJZCArIiZhcHBUeXBlPSIgKyBhcHBUeXBlKyAiJmlzQXJjaGl2ZWQ9IiArIGlzQXJjaGl2ZWQ7CiAgICAgICAgICAgIGFjdGlvbl9saXN0X3RhYmxlID0gJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICAgICBkZXN0cm95IDogdHJ1ZSwKICAgICAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAkKCcuZWRpdC1hY3Rpb24tbGluaycpLmNsaWNrKGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gIi9zaWduYWwvYWN0aW9uL2dldEJ5SWQ/aWQ9IiArICQodGhpcykuYXR0cignZGF0YS1pZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvbl90eXBlcyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLnR5cGVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25fY29uZmlncyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLmNvbmZpZ3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFsbF9zdGF0dXMgPSBhY3Rpb25fc2VsZWN0X3ZhbHVlcy5hbGxTdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFsZXJ0SWQgPSBhbGVydElkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25TdGF0dXMgPSB7bmFtZTogZGF0YS5hY3Rpb25TdGF0dXN9OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBodG1sX2NvbnRlbnQgPSBzaWduYWwudXRpbHMucmVuZGVyKCdhY3Rpb25fZWRpdG9yJywgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKS5odG1sKGh0bWxfY29udGVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXIgI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGRhdGEuZHVlRGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb21lbnRDb25maWc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VsdHVyZTogdXNlckxvY2FsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHo6IHVzZXJUaW1lWm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBERUZBVUxUX0RBVEVfRElTUExBWV9GT1JNQVQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5rZXlkb3duKHByZXZlbnRFbnRlcktleVN1Ym1pdCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGR1ZURhdGUgPSBtb21lbnQoZGF0YS5kdWVEYXRlLCAiREQtTU1NLVlZWVkiKS5mb3JtYXQoREVGQVVMVF9EQVRFX0ZPUk1BVCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKS5maW5kKCcjZHVlLWRhdGUtcGlja2VyJykuZmluZCgnI2R1ZURhdGUnKS52YWwoZHVlRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKS5maW5kKCcjYXBwVHlwZScpLnZhbChhcHBUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fZWRpdG9yID0gJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdEFjdGlvbk1vZGFsID0gJCgnI2FjdGlvbi1lZGl0LW1vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgnLmlkLWVsZW1lbnQnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgnLmFzc2lnbmVkVG9WYWx1ZScpLnZhbChudWxsKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tbW9kYWwnKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLm1vZGFsKHt9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI2NhbmNlbC1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI3VwZGF0ZS1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJmbkluaXRDb21wbGV0ZSI6IGZ1bmN0aW9uKG9TZXR0aW5ncywganNvbikgewogICAgICAgICAgICAgICAgICAgICQoJy5hY3Rpb24tY3JlYXRlJykuYXR0cignZGF0YS1pZCcsIGFsZXJ0SWQpOwogICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnNldF9hY3Rpb25fY3JlYXRlX21vZGFsKCk7CiAgICAgICAgICAgICAgICAgICAgJCgnI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJhamF4IjogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiBhY3Rpb25VcmwsCiAgICAgICAgICAgICAgICAgICAgY2FjaGU6ZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJzZWFyY2hpbmciOiB0cnVlLAogICAgICAgICAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJvTGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAgICAgInNQcm9jZXNzaW5nIjogJzxkaXYgY2xhc3M9ImdyaWQtbG9hZGluZyI+PGltZyBzcmM9Ii9zaWduYWwvYXNzZXRzL3NwaW5uZXIuZ2lmIiB3aWR0aD0iMzAiIGFsaWduPSJtaWRkbGUiIC8+PC9kaXY+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUsCiAgICAgICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzUsIDEwLCAyMCwgLTFdLCBbNSwgMTAsIDIwLCAiQWxsIl1dLAogICAgICAgICAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8YSBocmVmPScjJyBjbGFzcz0nZWRpdC1hY3Rpb24tbGluaycgZGF0YS1pZD0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93LmlkICsgIic+IiArIHJvdy5pZCArICI8YT4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInR5cGUiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb25maWciCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkZXRhaWxzIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ImNvbC1taW4tMjAwIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZHVlRGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiJjb2wtbWluLTEwMCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImFzc2lnbmVkVG8iLAogICAgICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjoiY29sLW1pbi0xMDAiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSIgOiAiYWN0aW9uU3RhdHVzIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY29tcGxldGVkRGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiJjb2wtbWluLTE1MCIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUscm93KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3cuY29tcGxldGVkRGF0ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIHNjcm9sbFg6IHRydWUsCiAgICAgICAgICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KQogICAgICAgIH0pOwoKICAgICAgICBjb21wLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbihldnQpIHsKICAgICAgICAgIGNvbXAuZmluZCgiI2FjdGlvbi10YWJsZSIpLmVtcHR5KCk7CiAgICAgICAgIH0pOwogICAgICAgIHJldHVybiBhY3Rpb25fbGlzdF90YWJsZQogICAgfTsKICAgIHZhciBzZXRFZGl0TW9kYWxWYWx1ZXMgPSBmdW5jdGlvbiAoZWRpdEFjdGlvbk1vZGFsLCBkYXRhKSB7CiAgICAgICAgdmFyIGFjdGlvblR5cGUgPSBkYXRhLnR5cGVPYmouaWQ7CiAgICAgICAgdmFyIG1lZXRpbmdJZCA9IGRhdGEubWVldGluZ0lkOwogICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKGRhdGEuYXNzaWduZWRUb09iai5mdWxsTmFtZSwgZGF0YS5hc3NpZ25lZFRvT2JqLmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2Fzc2lnbmVkVG8iKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICBpZighbWVldGluZ0lkKSB7CiAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjdHlwZSIpLnZhbChhY3Rpb25UeXBlKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjbWVldGluZ0VsZW1lbnQiKS52YWwobWVldGluZ0lkKTsKICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNtZWV0aW5nVmFsdWUiKS52YWwobWVldGluZ0lkKTsKICAgICAgICB9CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIi5zdGF0dXMtaWNvbiIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2NvbmZpZyIpLnZhbChkYXRhLmNvbmZpZ09iai5pZCk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNhY3Rpb25JZCIpLnZhbChkYXRhLmlkKTsKICAgICAgICB2YXIgZHVlRGF0ZSA9IG1vbWVudChkYXRhLmR1ZURhdGUsIERFRkFVTFRfREFURV9GT1JNQVQpLmZvcm1hdChERUZBVUxUX0RBVEVfRk9STUFUKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2R1ZS1kYXRlLXBpY2tlciIpLmRhdGVwaWNrZXIoewogICAgICAgICAgICBkYXRlOiAkKCIjZHVlLWRhdGUtcGlja2VyIikudmFsKCkgPyBuZXcgRGF0ZSgkKCIjZHVlLWRhdGUtcGlja2VyIikudmFsKCkpIDogbnVsbCwKICAgICAgICAgICAgbW9tZW50Q29uZmlnOiB7CiAgICAgICAgICAgICAgICBjdWx0dXJlOiB1c2VyTG9jYWxlLAogICAgICAgICAgICAgICAgZm9ybWF0OiBERUZBVUxUX0RBVEVfRElTUExBWV9GT1JNQVQKICAgICAgICAgICAgfQogICAgICAgIH0pLmtleXByZXNzKHByZXZlbnRFbnRlcktleVN1Ym1pdCk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNkdWVEYXRlIikudmFsKGR1ZURhdGUpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjY29tbWVudHMiKS52YWwoZGF0YS5jb21tZW50cyk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNkZXRhaWxzIikudmFsKGRhdGEuZGV0YWlscyk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNhY3Rpb25TdGF0dXMiKS52YWwoZGF0YS5hY3Rpb25TdGF0dXMpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuYWN0aW9uLXZhbHVlJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICB9OwogICAgdmFyIGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCA9IGZ1bmN0aW9uKGV2dCkgewogICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZhciBhY3Rpb25fbGlzdF90YWJsZSA9ICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKTsKICAgICAgICBhY3Rpb25fbGlzdF90YWJsZS5hamF4LnJlbG9hZCgpOwogICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCcpLm1vZGFsKCdoaWRlJykKICAgIH07CgogICAgdmFyIGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSA9IGZ1bmN0aW9uKGV2dCkgewogICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGlmICghZXZ0LmhhbmRsZWQpIHsKICAgICAgICAgICAgZXZ0LmhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICB2YXIganNvbiA9ICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lciBmb3JtI2FjdGlvbi1lZGl0b3ItZm9ybScpLnNlcmlhbGl6ZSgpICsgIiZhcHBUeXBlPSIgKyAkKCIjYXBwVHlwZSIpLnZhbCgpICsgIiZleGVDb25maWdJZD0iICsgJCgiI2V4ZUNvbmZpZ0lkIikudmFsKCkgKyAiJmlzQXJjaGl2ZWQ9IiArIGlzQXJjaGl2ZWQ7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiAnL3NpZ25hbC9hY3Rpb24vdXBkYXRlQWN0aW9uJywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgZGF0YToganNvbiwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhcl9lZGl0X2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSAiPGRpdiBjbGFzcz0nYWxlcnQgYWxlcnQtZGFuZ2VyJz4iOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCByZXNwb25zZS5kYXRhLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZU9iaiA9IHJlc3BvbnNlLmRhdGFbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gZXJyb3JNZXNzYWdlT2JqOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gJzwvYnI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAiPC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsIC5tb2RhbC1ib2R5JykucHJlcGVuZChlcnJvck1zZykKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uX2xpc3RfdGFibGUgPSAkKCcjYWN0aW9uLXRhYmxlJykuRGF0YVRhYmxlKCkKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX2xpc3RfdGFibGUuYWpheC5yZWxvYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAvL1JlZnJlc2ggdGhlIGFjdGl2aXR5IHRhYmxlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkNBU0VfREVUQUlMICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkVWRU5UX0RFVEFJTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGl2aXRpZXNfdXRpbHMucmVsb2FkX2FjdGl2aXR5X3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsJykubW9kYWwoJ2hpZGUnKQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQogICAgLy9BZC1ob2MgYWxlcnQgYWN0aW9uIGxpc3QgZGF0YQogICAgdmFyIGluaXRfYWN0aW9uX3RhYmxlID0gZnVuY3Rpb24gKHRhYmxlX2lkLCBhcHBUeXBlKSB7CiAgICAgICAgdmFyIGRhdGFVcmwgPSAiL3NpZ25hbC9hY3Rpb24vbGlzdEJ5QWxlcnQ/YWxlcnRJZD0iICsgYWxlcnRJZCArICImYXBwVHlwZT0iICsgYXBwVHlwZSArICImaXNBcmNoaXZlZD0iICsgaXNBcmNoaXZlZDsKICAgICAgICBhZGhvY192YWxpZGF0ZWRfdGFibGUgPSAkKHRhYmxlX2lkKS5EYXRhVGFibGUoewogICAgICAgICAgICAvLyJzUGFnaW5hdGlvblR5cGUiOiAiYm9vdHN0cmFwIiwKCiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGZuRHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKCcuZWRpdC1hY3Rpb24tbGluaycpLmNsaWNrKGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC9hY3Rpb24vZ2V0QnlJZD9pZD0iICsgJCh0aGlzKS5hdHRyKCdkYXRhLWlkJykKICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXBwVHlwZSA9PSAiU2lnbmFsIE1hbmFnZW1lbnQiIHx8IGFwcFR5cGUgPT0gIlRvcGljIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRBY3Rpb25Nb2RhbCA9ICQoJyNlZGl0QWN0aW9uTW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEVkaXRNb2RhbFZhbHVlcyhlZGl0QWN0aW9uTW9kYWwsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLm1vZGFsKHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcudXBkYXRlLWFjdGlvbicpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uTW9kYWxJZCA9ICQoIiNlZGl0QWN0aW9uTW9kYWwgI3RlbXBGb3JtIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLm1lZXRpbmctZGVjaWRlcicpLnZhbCgpID09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAnL3NpZ25hbC9hY3Rpb24vdXBkYXRlTWVldGluZ0FjdGlvbic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gJy9zaWduYWwvYWN0aW9uL3VwZGF0ZUFjdGlvbic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZ2V0QWN0aW9uRGV0YWlscyhhY3Rpb25Nb2RhbElkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2VkaXRfc2lnbmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gIjxkaXYgY2xhc3M9J2FsZXJ0IGFsZXJ0LWRhbmdlcic+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCByZXNwb25zZS5kYXRhLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlT2JqID0gcmVzcG9uc2UuZGF0YVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9IGVycm9yTWVzc2FnZU9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gJzwvYnI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIjwvZGl2PiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2VkaXRBY3Rpb25Nb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNtZWV0aW5nLXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9SZWZyZXNoIHRoZSBhY3Rpdml0eSB0YWJsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkNBU0VfREVUQUlMICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkVWRU5UX0RFVEFJTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvbl90eXBlcyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLnR5cGVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25fY29uZmlncyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLmNvbmZpZ3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFsbF9zdGF0dXMgPSBhY3Rpb25fc2VsZWN0X3ZhbHVlcy5hbGxTdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFsZXJ0SWQgPSBhbGVydElkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25TdGF0dXMgPSB7bmFtZTogZGF0YS5hY3Rpb25TdGF0dXN9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWxfY29udGVudCA9IHNpZ25hbC51dGlscy5yZW5kZXIoJ2FjdGlvbl9lZGl0b3InLCBkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fZWRpdG9yID0gJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fZWRpdG9yLmh0bWwoaHRtbF9jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lciAjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogZGF0YS5kdWVEYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbWVudENvbmZpZzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdWx0dXJlOiB1c2VyTG9jYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ejogdXNlclRpbWVab25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IERFRkFVTFRfREFURV9ESVNQTEFZX0ZPUk1BVAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmtleWRvd24ocHJldmVudEVudGVyS2V5U3VibWl0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9lZGl0b3IuZmluZCgnI2R1ZS1kYXRlLXBpY2tlcicpLmZpbmQoJyNkdWVEYXRlJykudmFsKGRhdGEuZHVlRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fZWRpdG9yLmZpbmQoJyNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdEFjdGlvbk1vZGFsID0gJCgnI2FjdGlvbi1lZGl0LW1vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgnLmlkLWVsZW1lbnQnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoe30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJykuZmluZCgnI2FwcFR5cGUnKS52YWwoYXBwVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI2NhbmNlbC1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI3VwZGF0ZS1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJmbkluaXRDb21wbGV0ZSI6IGZ1bmN0aW9uKG9TZXR0aW5ncywganNvbikgewogICAgICAgICAgICAgICAgJCgnLmFjdGlvbi1jcmVhdGUnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCkKICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnNldF9hY3Rpb25fY3JlYXRlX21vZGFsKCkKICAgICAgICAgICAgICAgICQoJyNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogZGF0YVVybCwKICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRhdGFTcmM6ICIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlYXJjaGluZzogdHJ1ZSwKICAgICAgICAgICAgZG9tOiAnQmZydGlwJywKICAgICAgICAgICAgYnV0dG9uczogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRleHQ6ICdOZXcgQWN0aW9uJywKICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdidG4tcHJpbWFyeSBhY3Rpb24tY3JlYXRlJywKICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uICggZSwgZHQsIG5vZGUsIGNvbmZpZyApIHsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGFhU29ydGluZzogW1swLCAiZGVzYyJdXSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiAxMCwKICAgICAgICAgICAgImFMZW5ndGhNZW51IjogW1sxMCwgMjAsIDUwLCAtMV0sIFsxMCwgMjAsIDUwLCAiQWxsIl1dLAogICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPGEgaHJlZj0nIycgY2xhc3M9J2VkaXQtYWN0aW9uLWxpbmsnIGRhdGEtaWQ9JyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93LmlkICsgIic+IiArIHJvdy5pZCArICI8YT4iCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogIiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInR5cGUiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0nd29yZC13cmFwLWJyZWFrLXdvcmQnPiIgKyBlc2NhcGVIVE1MKHJvdy50eXBlKSArICI8L3NwYW4+IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb25maWciLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0nd29yZC13cmFwLWJyZWFrLXdvcmQnPiIgKyBlc2NhcGVIVE1MKHJvdy5jb25maWcpICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRldGFpbHMiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0nd29yZC13cmFwLWJyZWFrLXdvcmQnPiIgKyBlc2NhcGVIVE1MKHJvdy5kZXRhaWxzKSArICI8L3NwYW4+IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkdWVEYXRlIiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJywKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEocm93LmFjdGlvblN0YXR1cyA9PT0gJ0Nsb3NlZCcgJiYgcm93LmFjdGlvblN0YXR1cyA9PT0gJ0RlbGV0ZWQnKSAmJiByb3cucGFzc0R1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8ZGl2IGNsYXNzPSdjbG9zZWQnPiIgKyByb3cuZHVlRGF0ZSArICI8L2Rpdj4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxkaXY+IiArIHJvdy5kdWVEYXRlICsgIjwvZGl2PiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImFzc2lnbmVkVG8iLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXNjYXBlSFRNTChyb3cuYXNzaWduZWRUbykKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiY29sLW1pbi0xNTAiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICIiLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93LmFjdGlvblN0YXR1cwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb21wbGV0ZWREYXRlIiwKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbihkYXRhLCB0eXBlLHJvdyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3cuY29tcGxldGVkRGF0ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTE1MCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgc2Nyb2xsWCA6IHRydWUKICAgICAgICB9KTsKICAgICAgICBhZGhvY192YWxpZGF0ZWRfdGFibGUuYnV0dG9uKCkuZGlzYWJsZSgpOwogICAgICAgIHJldHVybiBhZGhvY192YWxpZGF0ZWRfdGFibGUKICAgIH07CgogICAgdmFyIGJ1aWxkX2FjdGlvbl9yZW5kZXIgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIGFjdGlvbl9kcm9wX2Rvd25faHRtbCA9IHNpZ25hbC51dGlscy5yZW5kZXIoImFjdGlvbl9kcm9wX2Rvd24iLCBkYXRhKTsKICAgICAgICByZXR1cm4gYWN0aW9uX2Ryb3BfZG93bl9odG1sCiAgICB9OwogICAgdmFyIHJlbG9hZF9hY3Rpb25fdGFibGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhZGhvY192YWxpZGF0ZWRfdGFibGUgIT0gInVuZGVmaW5lZCIgJiYgYWRob2NfdmFsaWRhdGVkX3RhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgYWRob2NfdmFsaWRhdGVkX3RhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIlVuYWJsZSB0byByZWxvYWQgdGhlIGFjdGl2aXR5IHRhYmxlLiBQbGVhc2UgcmVmcmVzaCB0aGUgcGFnZS4iKQogICAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBzZXRfYWN0aW9uX2xpc3RfbW9kYWw6IHNldF9hY3Rpb25fbGlzdF9tb2RhbCwKICAgICAgICBzZXRfYWN0aW9uX2NyZWF0ZV9tb2RhbDogc2V0X2FjdGlvbl9jcmVhdGVfbW9kYWwsCiAgICAgICAgYnVpbGRfYWN0aW9uX3JlbmRlcjogYnVpbGRfYWN0aW9uX3JlbmRlciwKICAgICAgICBpbml0X2FjdGlvbl90YWJsZTogaW5pdF9hY3Rpb25fdGFibGUsCiAgICAgICAgcmVsb2FkX2FjdGlvbl90YWJsZSA6IHJlbG9hZF9hY3Rpb25fdGFibGUsCiAgICAgICAgaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsOiBoYW5kbGVfYWN0aW9uX2VkaXRvcl9jYW5jZWwsCiAgICAgICAgaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlOiBoYW5kbGVfYWN0aW9uX2VkaXRvcl91cGRhdGUsCiAgICAgICAgY2xlYXJfZWRpdF9lcnJvcnM6IGNsZWFyX2VkaXRfZXJyb3JzCiAgICB9Cn0pKCk7Cgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9CgpzaWduYWwuYWxlcnRDb21tZW50cyA9IChmdW5jdGlvbiAoKSB7CgogICAgdmFyIGxpc3RDb21tZW50cyA9IGZ1bmN0aW9uIChjYXNlSnNvbikgewoKICAgICAgICAvL01vZGFsIG9iamVjdAogICAgICAgIHZhciBjb21tZW50TW9kYWwgPSAkKCcjY29tbWVudE1vZGFsJyk7CgogICAgICAgIC8vUG9wdWxhdGUgdGhlIGV4aXN0aW5nIGNvbW1lbnRzIGFuZCBiaW5kIGV2ZW50cyB0byB0aGVtLgogICAgICAgIHBvcHVsYXRlQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CgogICAgICAgIC8vU2V0IHZhbHVlcyB0byB0aGUgbW9kYWwgZWxlbWVudHMuCiAgICAgICAgdmFyIGNvbW1lbnRNZXRhSW5mbyA9ICIiCiAgICAgICAgaWYgKGNhc2VKc29uLmFsZXJ0VHlwZSA9PSAiQWdncmVnYXRlIENhc2UgQWxlcnQiKSB7CiAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0icHJvZHVjdE5hbWUiPicgKyBjYXNlSnNvbi5wcm9kdWN0TmFtZSArICc8L3NwYW4+IC0gPHNwYW4gaWQ9ImV2ZW50TmFtZSI+JyArIGNhc2VKc29uLmV2ZW50TmFtZSArICc8L3NwYW4+JwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0iY2FzZU51bWJlciI+JyArIGNhc2VKc29uLmNhc2VOdW1iZXIgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJwcm9kdWN0RmFtaWx5Ij4nICsgY2FzZUpzb24ucHJvZHVjdEZhbWlseSArICc8L3NwYW4+JwogICAgICAgIH0KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnQtbWV0YS1pbmZvIikuaHRtbChjb21tZW50TWV0YUluZm8pOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjYXBwbGljYXRpb24iKS5odG1sKGNhc2VKc29uLmFsZXJ0VHlwZSk7CiAgICAgICAgY29tbWVudE1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgYmluZFNhdmVDb21tZW50KGNvbW1lbnRNb2RhbCk7CiAgICB9OwoKICAgIHZhciBwb3B1bGF0ZUNvbW1lbnRzID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24sIG9uU2lnbmFsU2NyZWVuKSB7CiAgICAgICAgdmFyIHVwZGF0ZWRDb21tZW50cyA9ICQoIiNjb21tZW50Ym94IikudmFsKCk7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydENvbW1lbnQvbGlzdENvbW1lbnRzIiwKICAgICAgICAgICAgZGF0YTogY2FzZUpzb24sCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI25vLWNvbW1lbnRzIikuYWRkQ2xhc3MoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgiVXBkYXRlIik7CiAgICAgICAgICAgICAgICAgICAgaWYodXBkYXRlZENvbW1lbnRzLmxlbmd0aCA+PSByZXN1bHQuY29tbWVudHMubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKHVwZGF0ZWRDb21tZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbChyZXN1bHQuY29tbWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbChyZXN1bHQuaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgiTGFzdCBNb2RpZmllZCBieSAiICsgcmVzdWx0Lm1vZGlmaWVkQnkgKyAiIG9uICIgKyByZXN1bHQuZGF0ZVVwZGF0ZWQpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YgaXNDb21tZW50QWRkZWQgIT0gJ3VuZGVmaW5lZCcgJiYgaXNDb21tZW50QWRkZWQgJiYgb25TaWduYWxTY3JlZW4pewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNuby1jb21tZW50cyIpLnJlbW92ZUNsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CgogICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGlzQ29tbWVudEFkZGVkICE9ICd1bmRlZmluZWQnICYmIGlzQ29tbWVudEFkZGVkKXsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCJBZGQiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjbm8tY29tbWVudHMiKS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5hZGRDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5vbigia2V5dXAiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKT09IiIgJiYgY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94JykudmFsKCk9PSIiKQogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIGxvYWQgcHJldmlvdXMgY29tbWVudHMuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRTYXZlQ29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwpIHsKCiAgICAgICAgLy9BZGQgY2xpY2sgZXZlbnQgdG8gdGhlIGFkZCBjb21tZW50IGJ1dHRvbi4KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmFkZC1jb21tZW50cyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqQXJyYXkgPSBbXTsKICAgICAgICAgICAgdmFyIGFwcFR5cGUgPSAkKCIjYXBwbGljYXRpb24iKS5odG1sKCk7CiAgICAgICAgICAgIHZhciB2YWxpZGF0ZWRTaWduYWxJZCA9ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgdmFyIHRvcGljSWQgPSAkKCIjdG9waWNJZCIpLmh0bWwoKTsKCiAgICAgICAgICAgIGlmIChhcHBUeXBlID09ICcnKSB7CiAgICAgICAgICAgICAgICBhcHBUeXBlID0gY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIHZhbGlkYXRlZFNpZ25hbElkID0gY29tbWVudE1vZGFsLmZpbmQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIHRvcGljSWQgPSBjb21tZW50TW9kYWwuZmluZCgiI3RvcGljSWQiKS5odG1sKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqOwogICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICB2YXIgZGF0YTsKICAgICAgICAgICAgLy9DYXNlIEpTT04uCiAgICAgICAgICAgIGNhc2VKc29uT2JqID0gewogICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFwcFR5cGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBjb21tZW50TW9kYWwuZmluZCgiI3Byb2R1Y3ROYW1lIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV2ZW50TmFtZSI6IGNvbW1lbnRNb2RhbC5maW5kKCIjZXZlbnROYW1lIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImNvbW1lbnRzIjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiB2YWxpZGF0ZWRTaWduYWxJZCwKICAgICAgICAgICAgICAgICJhc3NpZ25lZFRvIjogY29tbWVudE1vZGFsLmZpbmQoIiNhc3NpZ25lZFRvIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2V4ZWN1dGVkQ29uZmlnSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiY29uZmlnSWQiIDogY29tbWVudE1vZGFsLmZpbmQoIiNjb25maWdJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJ0b3BpY0lkIjogY29tbWVudE1vZGFsLmZpbmQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgInByb2R1Y3RGYW1pbHkiOiBjb21tZW50TW9kYWwuZmluZCgiI3Byb2RGYW1pbHkiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY2FzZU5vIikuaHRtbCgpLAogICAgICAgICAgICAgICAgInByb2R1Y3RJZCI6IHBhcnNlSW50KGNvbW1lbnRNb2RhbC5maW5kKCIjcHJvZHVjdElkIikuaHRtbCgpKSwKICAgICAgICAgICAgICAgICJwdENvZGUiOiBwYXJzZUludChjb21tZW50TW9kYWwuZmluZCgiI3B0Q29kZSIpLmh0bWwoKSkKCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhc2VKc29uT2JqQXJyYXkucHVzaChjYXNlSnNvbk9iaik7CiAgICAgICAgICAgIGlmKGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCkpewogICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3VwZGF0ZUNvbW1lbnQiOwogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYXBwVHlwZSwKICAgICAgICAgICAgICAgICAgICAiY29tbWVudCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICJpZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2V4ZWN1dGVkQ29uZmlnSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogdmFsaWRhdGVkU2lnbmFsSWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3NhdmVDb21tZW50IjsKICAgICAgICAgICAgICAgIGRhdGEgPSB7ImNhc2VKc29uT2JqQXJyYXkiOiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KX0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2lzVXBkYXRlZCIpLnZhbCgidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25PYmpBcnJheVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjb21tZW50Ym94JykudmFsKCcnKS5ibHVyKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kRWRpdENvbW1lbnQgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsKSB7CgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcuZWRpdC1jb21tZW50JykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi51cGRhdGUtY29tbWVudCIpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudC1hcmVhIikuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7CiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoImhpZGRlbiIpCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kRGVsZXRlQ29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwsIGNhc2VKc29uKSB7CgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcuZGVsZXRlLWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpZCA9IHsKICAgICAgICAgICAgICAgICJpZCI6ICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnRJZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogJCgiI3ZhbGlkYXRlZFNpZ25hbElkIikudGV4dCgpLAogICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCIgOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogIi9zaWduYWwvYWxlcnRDb21tZW50L2RlbGV0ZUNvbW1lbnQiLAogICAgICAgICAgICAgICAgZGF0YTogaWQsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRVcGRhdGVDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pIHsKCgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcudXBkYXRlLWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5nbHlwaGljb24tcGVuY2lsIikucmVtb3ZlQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICAgICB2YXIgY29tbWVudERhdGEgPSB7CiAgICAgICAgICAgICAgICAiY29tbWVudCI6ICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnQtYXJlYSIpLnZhbCgpLAogICAgICAgICAgICAgICAgImlkIjogJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiAkKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS50ZXh0KCksCiAgICAgICAgICAgICAgICAidG9waWNJZCI6ICQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjYXNlSnNvbi5leGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCIgOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC91cGRhdGVDb21tZW50IiwKICAgICAgICAgICAgICAgIGRhdGE6IGNvbW1lbnREYXRhLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewoKICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIGxpc3RfY29tbWVudHM6IGxpc3RDb21tZW50cywKICAgICAgICBwb3B1bGF0ZV9jb21tZW50czogcG9wdWxhdGVDb21tZW50cywKICAgICAgICBzYXZlX2NvbW1lbnQ6IGJpbmRTYXZlQ29tbWVudAogICAgfQp9KSgpOwoKCnZhciBzaG93VG9waWNXaWRnZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAkKCIjdG9waWMiKS5zZWxlY3QyKHsKICAgICAgICB0YWdzOiB0cnVlLAogICAgICAgIHBsYWNlaG9sZGVyOiAiU2VsZWN0IHRvcGljIiwKICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgY3JlYXRlVGFnOiBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgICAgICAgIHZhciB0ZXJtID0gJC50cmltKHBhcmFtcy50ZXJtKTsKICAgICAgICAgICAgaWYgKHRlcm0gIT0gIiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHRlcm0sCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGVybQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgfSk7Cn07Ci8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2NvbW1vbi5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9saXN0X3V0aWxzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2hhbmRsZWJhcl9leHQuanMKLy89IHJlcXVpcmUgYXBwL3B2cy90b3BpYy9hdHRhY2hBbGVydFRvVG9waWMuanMKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307Cgp2YXIgdG9waWNEYXRhOwp2YXIgY29sdW1uU2VxOwp2YXIgaXNWaWV3SW5zdGFuY2UgPSAxOwp2YXIgc2lnbmFsQWxlcnRUeXBlID0gewogICAgU0lOR0xFX0NBU0VfQUxFUlQ6ICJTaW5nbGUgQ2FzZSBBbGVydCIsCiAgICBBR0dSRUdBVEVfQUxFUlQ6ICJBZ2dyZWdhdGUgQ2FzZSBBbGVydCIsCiAgICBFVkRBU19BTEVSVDogIkV2ZGFzIEFsZXJ0IiwKICAgIEFESE9DX0FMRVJUOiAiQWQtSG9jIEFsZXJ0IiwKICAgIExJVEVSQVRVUkVfU0VBUkNIX0FMRVJUOiAiTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQiCn0KCnNpZ25hbC5hbGVydFJldmlldyA9IChmdW5jdGlvbiAoKSB7CgogICAgdmFyIGlkcyA9IFtdOwogICAgdmFyIHJvd3MgPSBbXTsKCiAgICB2YXIgYXBwbHlCdXNpbmVzc1J1bGVzID0gZnVuY3Rpb24gKHJvdywgZGF0YSkgewogICAgICAgIC8vQXBwbHkgdGhlIGV1ZHJhIHJ1bGVzLgogICAgICAgIGlmIChkYXRhLmZvcm1hdCkgewogICAgICAgICAgICB2YXIgZm9ybWF0cyA9IEpTT04ucGFyc2UoZGF0YS5mb3JtYXQpOwogICAgICAgICAgICAkLmVhY2goZm9ybWF0cywgZnVuY3Rpb24gKGluZHgsIGZvcm1hdCkgewogICAgICAgICAgICAgICAgdmFyIG9iaiA9IGZvcm1hdDsKICAgICAgICAgICAgICAgIHZhciB0ZXh0T2JqOwogICAgICAgICAgICAgICAgJC5lYWNoKG9iai50ZXh0LnRjLCBmdW5jdGlvbiAoaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqID0gJChyb3cpLmZpbmQoJy4nICsgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgdGV4dE9iai5jc3MoJ2NvbG9yJywgb2JqLnRleHQuY29sb3IpOwogICAgICAgICAgICAgICAgICAgIGlmIChvYmoudGV4dC5ib2xkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRPYmouY3NzKCdmb250LXdlaWdodCcsICc5MDAnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai50ZXh0Lml0YWxpYykgewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygnZm9udC1zdHlsZScsICdpdGFsaWMnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai50ZXh0LnVuZGVybGluZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygndGV4dC1kZWNvcmF0aW9uJywgJ3VuZGVybGluZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJC5lYWNoKG9iai5jZWxsLnRjLCBmdW5jdGlvbiAoaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAkKHJvdykuZmluZCgnLicgKyBkYXRhKS5wYXJlbnRzKCd0ZCcpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIG9iai5jZWxsLmNvbG9yKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBlbmFibGVNZW51VG9vbHRpcHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgiLmdyaWQtbWVudS10b29sdGlwIikubW91c2VvdmVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIHRvb2x0aXBUZXh0ID0gJHRoaXMuYXR0cigiZGF0YS10aXRsZSIpOwogICAgICAgICAgICAkdGhpcy50b29sdGlwKHsKICAgICAgICAgICAgICAgIHRpdGxlOiB0b29sdGlwVGV4dCwKICAgICAgICAgICAgICAgIHBsYWNlbWVudDogImJvdHRvbSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICR0aGlzLnRvb2x0aXAoJ3Nob3cnKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGRpc2FibGVUb29sdGlwcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCIubWRpLWFscGhhLWQtYm94LCAubWRpLWZpbHRlci1vdXRsaW5lLCAubWRpLXRyZW5kaW5nLXVwLCAubWRpLWNvbnRlbnQtc2F2ZSwgLm1kaS1leHBvcnQsIC5tZGktc2V0dGluZ3MsIG1kaS1wbHVzLWJveCwgbWRpLWNoYXJ0LWJhciIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgiLnRvb2x0aXAiKS5oaWRlKCk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBzb3J0SWNvbkhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHRoQXJyYXkgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCkuY29sdW1ucygpLmhlYWRlcigpOwogICAgICAgIGlmIChpc1ZpZXdJbnN0YW5jZSkgewogICAgICAgICAgICB2YXIgY29sdW1uTmFtZTsKICAgICAgICAgICAgdmFyIGluZGV4T2ZDb2x1bW4gPSAwOwogICAgICAgICAgICBjb2x1bW5TZXEuZXZlcnkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlcSA9IGNvbHVtblNlcVtpbmRleE9mQ29sdW1uXS5zZXE7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gc2VxKSB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uTmFtZSA9IGNvbHVtblNlcVtpbmRleE9mQ29sdW1uXS5uYW1lOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGluZGV4T2ZDb2x1bW4rKzsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGNvbHVtbkluZGV4ID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmZpbmQoInRoW2RhdGEtZmllbGQ9IiArIGNvbHVtbk5hbWUgKyAiXSIpLmF0dHIoJ2RhdGEtY29sdW1uLWluZGV4Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29sdW1uSW5kZXggPSBpbmRleDsKICAgICAgICB9CiAgICAgICAgJC5lYWNoKHRoQXJyYXksIGZ1bmN0aW9uIChjdXJyZW50SW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzb3J0aW5nX2FzYycpKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NvcnRpbmdfYXNjJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoInNvcnRpbmciKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19kZXNjJykpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc29ydGluZ19kZXNjJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoInNvcnRpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3VycmVudEluZGV4ID09IGNvbHVtbkluZGV4ICYmICFlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19kaXNhYmxlZCcpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGlyID09ICdhc2MnKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nX2FzYyIpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXIgPT0gJ2Rlc2MnKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nX2Rlc2MiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICAvKioKICAgICAqIFRoZSByZXNldCBtb2RhbCBzY3JlZW4gZnVuY3Rpb24gd2hpY2ggcmVzZXRzIHRoZSBwYXNzd29yZCBkaXYgaW4gdGhlIHdvcmtmbG93IG1vZGFsIHNjcmVlbi4KICAgICAqIFRoaXMgaXMgaW50ZXJuYWwgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGludGVybmFsbHkgaW4gdGhpcyBvYmplY3Qgc2NvcGUuCiAgICAgKi8KICAgIHZhciByZXNldE1vZGFsU2NyZWVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8vQ2xlYW4gdXAgdGhlIHRoZSBkaXNwb3NpdGlvbnMgZmllbGRzLgogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2V4dHJhLXZhbHVlLXNlbGVjdCcpLmh0bWwoIjxvcHRpb24+PC9vcHRpb24+Iik7CiAgICAgICAgLy9IaWRlIHRoZSBwYXNzd29yZAogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI3Bhc3N3b3JkRGl2JykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNpc1Bhc3N3b3JkRW5hYmxlZCcpLnZhbCgwKTsKICAgIH0KCiAgICB2YXIgc2hvd1Bhc3N3b3JkRmllbGQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjcGFzc3dvcmREaXYnKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2lzUGFzc3dvcmRFbmFibGVkJykudmFsKDEpOwogICAgfQoKICAgIHZhciBjaGFuZ2VXb3JrZmxvd0VkaXRTY3JlZW4gPSBmdW5jdGlvbiAoYXZhaWxhYmxlVmFsdWVzLCB0YXJnZXRWYWwpIHsKCiAgICAgICAgdmFyIGF2YWlsYWJsZVZhbE9iaiA9IF8uZmluZFdoZXJlKGF2YWlsYWJsZVZhbHVlcywge3ZhbHVlOiB0YXJnZXRWYWx9KTsKCiAgICAgICAgaWYgKHR5cGVvZiBhdmFpbGFibGVWYWxPYmogIT0gJ3VuZGVmaW5lZCcgJiYgYXZhaWxhYmxlVmFsT2JqKSB7CiAgICAgICAgICAgIGlmIChhdmFpbGFibGVWYWxPYmouYXBwcm92YWxSZXF1aXJlZCkgewogICAgICAgICAgICAgICAgc2hvd1Bhc3N3b3JkRmllbGQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc2V0TW9kYWxTY3JlZW4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9DbGVhbiB1cCB0aGUgdGhlIGRpc3Bvc2l0aW9ucyBmaWVsZHMKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjZXh0cmEtdmFsdWUtc2VsZWN0JykuaHRtbCgnJykKCiAgICAgICAgICAgIC8vRmlsbCB1cCB0aGUgZGlzcG9zaXRpb25zIGluIHRoZSBjb21ibwogICAgICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNleHRyYS12YWx1ZS1zZWxlY3QnKS5odG1sKGdldERpc3Bvc2l0aW9uT3B0aW9ucyhhdmFpbGFibGVWYWxPYmopKQogICAgICAgIH0KICAgIH0KCiAgICB2YXIgZ2V0RGlzcG9zaXRpb25PcHRpb25zID0gZnVuY3Rpb24gKGF2YWlsYWJsZVZhbE9iaikgewogICAgICAgIHZhciBkaXNwb3NpdGlvblN0ciA9ICI8b3B0aW9uPjwvb3B0aW9uPiI7CiAgICAgICAgXy5lYWNoKGF2YWlsYWJsZVZhbE9iai5kaXNwb3NpdGlvbnMsIGZ1bmN0aW9uIChkaXNwb3NpdGlvbikgewogICAgICAgICAgICBkaXNwb3NpdGlvblN0ciA9IGRpc3Bvc2l0aW9uU3RyICsKICAgICAgICAgICAgICAgICI8b3B0aW9uIHZhbHVlPVwiIiArIGRpc3Bvc2l0aW9uLnZhbHVlICsgIlwiPiIgKyBlbmNvZGVUb0hUTUwoZGlzcG9zaXRpb24uZGlzcGxheU5hbWUpICsgIjwvb3B0aW9uPiIKICAgICAgICB9KQogICAgICAgIHJldHVybiBkaXNwb3NpdGlvblN0cgogICAgfQoKICAgIHZhciBhdXRoZW50aWNhdGVVc2VyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciByZXR1cm5WYWwgPSBmYWxzZQogICAgICAgIHZhciBwYXNzd29yZEpzb24gPSB7CiAgICAgICAgICAgICJwYXNzd29yZCI6ICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI3Bhc3N3b3JkQXV0aGVudGljYXRpb24nKS52YWwoKQogICAgICAgIH0KCiAgICAgICAgdmFyIGF1dGhVcmwgPSAnL3NpZ25hbC91c2VyL2F1dGhlbnRpY2F0ZScKCiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiBhdXRoVXJsLAogICAgICAgICAgICBkYXRhOiBwYXNzd29yZEpzb24sCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5hdXRob3JpemVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gdHJ1ZQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXR1cm5WYWwKICAgIH0KCiAgICB2YXIgdG9nZ2xlRXJyb3JOb3RpZmljYXRpb24gPSBmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgaWYgKGFjdGlvbiA9PSAnaGlkZScpIHsKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwgLmVycm9yTm90aWZpY2F0aW9uJykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcuZXJyb3JNZXNzYWdlJykuaHRtbCgnJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwgLmVycm9yTm90aWZpY2F0aW9uJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKQogICAgICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJy5lcnJvck1lc3NhZ2UnKS5odG1sKCcgQXV0aGVudGljYXRpb24gRmFpbGVkIScpOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIG9wZW5DYXNlSGlzdG9yeU1vZGFsID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAvL0JpbmQgdGhlIGNsaWNrIGV2ZW50IG9uIHRoZSBjYXNlIGhpc3RvcnkgaWNvbi4KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNhc2UtaGlzdG9yeS1pY29uJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0luZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIGlmIChpc0Fic3RyYWN0Vmlld09yQ2FzZVZpZXcoc2VsZWN0ZWRSb3dJbmRleCkpIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93SW5kZXggPSBzZWxlY3RlZFJvd0luZGV4IC8gMgogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpc1NpZ25hbCA9ICQodGhpcykuZGF0YSgnc2lnbmFsJyk7CgogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0ge307CiAgICAgICAgICAgIGlmICghaXNTaWduYWwpIHsKICAgICAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlLnJvd3Moc2VsZWN0ZWRSb3dJbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVTaW5nbGVSZXZpZXcucm93KCQodGhpcykucGFyZW50cygndHInKSkuZGF0YSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjYXNlTnVtYmVyID0gcm93T2JqZWN0LmNhc2VOdW1iZXI7CiAgICAgICAgICAgIHZhciBwcm9kdWN0RmFtaWx5ID0gcm93T2JqZWN0LnByb2R1Y3RGYW1pbHk7CiAgICAgICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHJvd09iamVjdC5jYXNlVmVyc2lvbjsKICAgICAgICAgICAgdmFyIHByb2R1Y3ROYW1lID0gcm93T2JqZWN0LnByb2R1Y3ROYW1lOwogICAgICAgICAgICB2YXIgcHQgPSByb3dPYmplY3QucHJpbWFyeUV2ZW50OwogICAgICAgICAgICB2YXIgYWxlcnRDb25maWdJZCA9IHJvd09iamVjdC5hbGVydENvbmZpZ0lkOwoKICAgICAgICAgICAgdmFyIGNhc2VIaXN0b3J5TW9kYWwgPSAkKCcjY2FzZUhpc3RvcnlNb2RhbCcpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNjYXNlTnVtYmVyIikuaHRtbChjYXNlTnVtYmVyKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjcHJvZHVjdEZhbWlseSIpLmh0bWwocHJvZHVjdEZhbWlseSk7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VWZXJzaW9uIikudmFsKGNhc2VWZXJzaW9uKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjcHJvZHVjdE5hbWUiKS52YWwocHJvZHVjdE5hbWUpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNhbGVydENvbmZpZ0lkIikudmFsKGFsZXJ0Q29uZmlnSWQpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNwdCIpLnZhbChwdCk7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwubW9kYWwoJ3Nob3cnKTsKCiAgICAgICAgICAgIGlmKHR5cGVvZiBzaW5nbGVDYXNlVXBkYXRlSnVzdGlmaWNhdGlvblVybCAhPSAndW5kZWZpbmVkJykKICAgICAgICAgICAgICAgIHVwZGF0ZUp1c3RpZmljYXRpb25VcmwgPSBzaW5nbGVDYXNlVXBkYXRlSnVzdGlmaWNhdGlvblVybDsKCiAgICAgICAgICAgIHNpZ25hbC5jYXNlSGlzdG9yeVRhYmxlLmluaXRfY2FzZV9oaXN0b3J5X3RhYmxlKGNhc2VIaXN0b3J5VXJsKTsKICAgICAgICAgICAgc2lnbmFsLmNhc2VIaXN0b3J5VGFibGUuaW5pdF9jYXNlX2hpc3RvcnlfdGFibGVfc3VzcGVjdChjYXNlSGlzdG9yeVN1c3BlY3RVcmwpOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgb3BlbkFsZXJ0Q29tbWVudE1vZGFsID0gZnVuY3Rpb24gKGFsZXJ0VHlwZSwgYXBwbGljYXRpb25OYW1lKSB7CgogICAgICAgIC8vTW9kYWwgb2JqZWN0CiAgICAgICAgdmFyIGNvbW1lbnRNb2RhbCA9ICQoJyNjb21tZW50TW9kYWwnKTsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNvbW1lbnQtaWNvbicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzOwogICAgICAgICAgICB2YXIgZGF0YUluZm87CiAgICAgICAgICAgIHZhciBpc0Nhc2VEZXRhaWw7CiAgICAgICAgICAgIHZhciBhcHBUeXBlOwogICAgICAgICAgICB2YXIgdmFsaWRhdGVkU2lnbmFsSWQ7CiAgICAgICAgICAgIHZhciBjb21tZW50QWxlcnRUeXBlID0gJCgkdGhpcykuZGF0YSgnbmFtZScpOwogICAgICAgICAgICB2YXIgaXNTaWduYWwgPSAkKCR0aGlzKS5kYXRhKCdzaWduYWwnKTsKCiAgICAgICAgICAgIGlmIChjb21tZW50QWxlcnRUeXBlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VHlwZSA9IGNvbW1lbnRBbGVydFR5cGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIGNhc2VKc29uQXJyYXkgPSBbXTsKICAgICAgICAgICAgZGF0YUluZm8gPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1pbmZvJyk7CiAgICAgICAgICAgIGlzQ2FzZURldGFpbCA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWNvbW1lbnQnKTsKCiAgICAgICAgICAgIGFwcFR5cGUgPSAkKCIjYXBwbGljYXRpb24iKS5odG1sKCk7CiAgICAgICAgICAgIGlmIChhcHBUeXBlID09PSAnJykgewogICAgICAgICAgICAgICAgYXBwVHlwZSA9IGNvbW1lbnRNb2RhbC5maW5kKCIjYXBwbGljYXRpb24iKS5odG1sKCk7CiAgICAgICAgICAgICAgICB2YWxpZGF0ZWRTaWduYWxJZCA9IGNvbW1lbnRNb2RhbC5maW5kKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS5odG1sKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93Q291bnQ7CiAgICAgICAgICAgIGlmICgkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0NvdW50ID0gJCgndGFibGUjYWxlcnRzRGV0YWlsc1RhYmxlIC5jb3B5LXNlbGVjdDpjaGVja2VkJykubGVuZ3RoOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlLkRURkNfQ2xvbmVkIC5jb3B5LXNlbGVjdDpjaGVja2VkJykubGVuZ3RoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzZWxlY3RlZFJvd0NvdW50ID4gMSAmJiAkKCR0aGlzKS5jbG9zZXN0KCd0cicpLmZpbmQoIi5jb3B5LXNlbGVjdCIpLnByb3AoImNoZWNrZWQiKSkgewogICAgICAgICAgICAgICAgdmFyIHRleHRUb0Rpc3BsYXk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGFwcGxpY2F0aW9uTmFtZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ1NpbmdsZSBDYXNlIEFsZXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFRvRGlzcGxheSA9ICdDYXNlJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnQWdncmVnYXRlIENhc2UgQWxlcnQnOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0VG9EaXNwbGF5ID0gJ1BFQyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0VWREFTIEFsZXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFRvRGlzcGxheSA9ICdQRUMnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnQXJ0aWNsZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24nKS5zaG93KCk7CiAgICAgICAgICAgICAgICAkKGNvbW1lbnRNb2RhbCkuZmluZCgnZGl2LmJ1bGtPcHRpb25zU2VjdGlvbiBzcGFuLmFsZXJ0VHlwZVRleHQnKS5odG1sKHRleHRUb0Rpc3BsYXkpOwogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24gc3Bhbi5jb3VudCcpLmh0bWwoc2VsZWN0ZWRSb3dDb3VudCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKGNvbW1lbnRNb2RhbCkuZmluZCgnZGl2LmJ1bGtPcHRpb25zU2VjdGlvbicpLmhpZGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJCgnZGl2LmJ1bGtPcHRpb25zU2VjdGlvbiBpbnB1dFtuYW1lPWJ1bGtPcHRpb25zXScpLnVuYmluZCgpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKCQodGhpcykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdhbGxTZWxlY3RlZCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VKc29uQXJyYXkgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhdGVTaW5nbGVCdWxrUm93Q29tbWVudFByb2Nlc3MoY2FzZUpzb25BcnJheSwgY29tbWVudE1vZGFsLCBhbGVydFR5cGUsIGlzQ2FzZURldGFpbCwgaXNTaWduYWwpOwogICAgICAgICAgICAgICAgICAgICAgICBiaW5kQWRkQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbkFycmF5LCAiYnVsayIsIGFsZXJ0VHlwZSwgdmFsaWRhdGVkU2lnbmFsSWQsIGlzQ2FzZURldGFpbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2N1cnJlbnQnOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbkFycmF5ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYXRlU2luZ2xlUm93Q29tbWVudFByb2Nlc3MoJHRoaXMsIGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmluZEFkZENvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgInJvdyIsIGFsZXJ0VHlwZSwgdmFsaWRhdGVkU2lnbmFsSWQsIGlzQ2FzZURldGFpbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChkYXRhSW5mbyA9PT0gInJvdyIpIHsKICAgICAgICAgICAgICAgIGluaXRpYXRlU2luZ2xlUm93Q29tbWVudFByb2Nlc3MoJHRoaXMsIGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29tbWVudE1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIGJpbmRBZGRDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uQXJyYXksIGRhdGFJbmZvLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwsICR0aGlzKQogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBiaW5kQWRkQ29tbWVudHMgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsLCBjYXNlSnNvbkFycmF5LCBkYXRhSW5mbywgYWxlcnRUeXBlLCB2YWxpZGF0ZWRTaWduYWxJZCwgaXNDYXNlRGV0YWlsLCBjdXJyZW50Um93KSB7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5hZGQtY29tbWVudHMiKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbjsKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqOwogICAgICAgICAgICB2YXIgZGF0YTsKICAgICAgICAgICAgdmFyIHVybDsKICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqQXJyYXkgPSBbXTsKICAgICAgICAgICAgaWYgKGRhdGFJbmZvID09PSAicm93IikgewogICAgICAgICAgICAgICAgY2FzZUpzb24gPSBjYXNlSnNvbkFycmF5WzBdOwoKICAgICAgICAgICAgICAgIGlmIChjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbW1lbnQiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImlkIjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogdmFsaWRhdGVkU2lnbmFsSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0b3BpY0lkIjogJCgiI3RvcGljSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY2FzZUpzb24uZXhlY3V0ZWRDb25maWdJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCI6IGNhc2VKc29uLmFkaG9jQWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbmZpZ0lkIjogY2FzZUpzb24uY29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJsaXRlcmF0dXJlQWxlcnRJZCI6IGNhc2VKc29uLmxpdGVyYXR1cmVBbGVydElkCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmNvbW1lbnQ9PSIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9kZWxldGVDb21tZW50IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC91cGRhdGVDb21tZW50IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9zYXZlQ29tbWVudCI7CgogICAgICAgICAgICAgICAgICAgIGNhc2VKc29uT2JqID0gewogICAgICAgICAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYWxlcnRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBjYXNlSnNvbi5wcm9kdWN0TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgImV2ZW50TmFtZSI6IGNhc2VKc29uLmV2ZW50TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgInB0IjogY2FzZUpzb24ucHQsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21tZW50cyI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNhc2VKc29uLmNhc2VOdW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0RmFtaWx5IjogY2FzZUpzb24ucHJvZHVjdEZhbWlseSwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogdmFsaWRhdGVkU2lnbmFsSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0b3BpY0lkIjogY29tbWVudE1vZGFsLmZpbmQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiYXNzaWduZWRUbyI6IGNhc2VKc29uLmFzc2lnbmVkVG8sCiAgICAgICAgICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY2FzZUpzb24uZXhlY3V0ZWRDb25maWdJZCwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3RJZCI6IGNhc2VKc29uLnByb2R1Y3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgInB0Q29kZSI6IGNhc2VKc29uLnB0Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbmZpZ0lkIjogY2FzZUpzb24uY29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJsaXRlcmF0dXJlQWxlcnRJZCI6IGNhc2VKc29uLmxpdGVyYXR1cmVBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJ0aWNsZUlkIjogY2FzZUpzb24uYXJ0aWNsZUlkCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5LnB1c2goY2FzZUpzb25PYmopOwogICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VKc29uT2JqQXJyYXk6IEpTT04uc3RyaW5naWZ5KGNhc2VKc29uT2JqQXJyYXkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3NhdmVDb21tZW50IjsKICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0NvdW50OwogICAgICAgICAgICAgICAgaWYgKCQoJyNkZXRhaWxlZC12aWV3LWNoZWNrYm94JykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0NvdW50ID0gJCgndGFibGUjYWxlcnRzRGV0YWlsc1RhYmxlIC5jb3B5LXNlbGVjdDpjaGVja2VkJykubGVuZ3RoOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0NvdW50ID0gJCgndGFibGUuRFRGQ19DbG9uZWQgLmNvcHktc2VsZWN0OmNoZWNrZWQnKS5sZW5ndGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgc2VsZWN0ZWRSb3dDb3VudDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlZFNpZ25hbElkID0gJCgiI3ZhbGlkYXRlZFNpZ25hbElkIikuaHRtbCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2VKc29uID0gY2FzZUpzb25BcnJheVtpbmRleF07CgogICAgICAgICAgICAgICAgICAgIC8vQ2FzZSBKU09OLgogICAgICAgICAgICAgICAgICAgIGNhc2VKc29uT2JqID0gewogICAgICAgICAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYWxlcnRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBjYXNlSnNvbi5wcm9kdWN0TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgImV2ZW50TmFtZSI6IGNhc2VKc29uLmV2ZW50TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgInB0IjogY2FzZUpzb24ucHQsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21tZW50cyI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNhc2VKc29uLmNhc2VOdW1iZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0RmFtaWx5IjogY2FzZUpzb24ucHJvZHVjdEZhbWlseSwKICAgICAgICAgICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogdmFsaWRhdGVkU2lnbmFsSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0b3BpY0lkIjogY29tbWVudE1vZGFsLmZpbmQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiYXNzaWduZWRUbyI6IGNhc2VKc29uLmFzc2lnbmVkVG8sCiAgICAgICAgICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0SWQiOiBjYXNlSnNvbi5wcm9kdWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdENvZGUiOiBjYXNlSnNvbi5wdENvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNhc2VKc29uLmNvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBjYXNlSnNvbi5saXRlcmF0dXJlQWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImFydGljbGVJZCI6IGNhc2VKc29uLmFydGljbGVJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjYXNlSnNvbi5leGVjdXRlZENvbmZpZ0lkCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5LnB1c2goY2FzZUpzb25PYmopCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgIGNhc2VKc29uT2JqQXJyYXk6IEpTT04uc3RyaW5naWZ5KGNhc2VKc29uT2JqQXJyYXkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vU2F2ZSBjb21tZW50IGNhbGwKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIGJlZm9yZVNlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiaS5pc1Byb2Nlc3NpbmciKS5zaG93KCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCJpLmlzUHJvY2Vzc2luZyIpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAvL1BvcHVsYXRlIHRoZSBjb21tZW50cyBhZ2FpbiBpZiBzaW5nbGUgY29tbWVudCBpcyBhZGRlZC4KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGlzQ2FzZURldGFpbCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhSW5mbyA9PT0gInJvdyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0Q29tbWVudHMucG9wdWxhdGVfY29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjb21tZW50Ym94JykudmFsKCcnKS5ibHVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmNvbW1lbnQgIT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDb21tZW50SWNvbihjdXJyZW50Um93KSA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVDb21tZW50SWNvbihjdXJyZW50Um93KSA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnbW9kYWwtb3BlbicpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwtYmFja2Ryb3AnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrYm94U2VsZWN0b3I7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2JveFNlbGVjdG9yID0gJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2JveFNlbGVjdG9yID0gJ3RhYmxlLkRURkNfQ2xvbmVkIC5jb3B5LXNlbGVjdDpjaGVja2VkJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goJChjaGVja2JveFNlbGVjdG9yKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NvbW1lbnRJY29uKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJC5Ob3RpZmljYXRpb24ubm90aWZ5KCdzdWNjZXNzJywgJ3RvcCByaWdodCcsICJTdWNjZXNzIiwgIkNvbW1lbnRzIGFkZGVkIHN1Y2Nlc3NmdWxseS4iLCB7YXV0b0hpZGVEZWxheTogMTAwMDB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgaW5pdGlhdGVTaW5nbGVSb3dDb21tZW50UHJvY2VzcyA9IGZ1bmN0aW9uICgkdGhpcywgY2FzZUpzb25BcnJheSwgY29tbWVudE1vZGFsLCBhbGVydFR5cGUsIGlzQ2FzZURldGFpbCwgaXNTaWduYWwpIHsKICAgICAgICB2YXIgYWRob2NBbGVydElkOwogICAgICAgIHZhciBsaXRlcmF0dXJlQWxlcnRJZDsKICAgICAgICB2YXIgYXJ0aWNsZUlkOwoKICAgICAgICB2YXIgcm93T2JqZWN0ID0ge307CiAgICAgICAgaWYgKChhbGVydFR5cGUgPT09ICdBZ2dyZWdhdGUgQ2FzZSBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnU2luZ2xlIENhc2UgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ0VWREFTIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCcpICYmICFpc1NpZ25hbCkgewogICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9ICQoJHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICAgICAgaWYgKGlzQWJzdHJhY3RWaWV3T3JDYXNlVmlldyhzZWxlY3RlZFJvd0luZGV4KSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dJbmRleCA9IHNlbGVjdGVkUm93SW5kZXggLyAyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGUucm93KHNlbGVjdGVkUm93SW5kZXgpLmRhdGEoKTsKICAgICAgICB9IGVsc2UgaWYgKGFsZXJ0VHlwZSA9PT0gJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JykgewogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZUFnZ1Jldmlldy5yb3coJCgkdGhpcykucGFyZW50cygndHInKSkuZGF0YSgpOwogICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSB7CiAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlTGl0ZXJhdHVyZVJldmlldy5yb3coJCgkdGhpcykucGFyZW50cygndHInKSkuZGF0YSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlU2luZ2xlUmV2aWV3LnJvdygkKCR0aGlzKS5wYXJlbnRzKCd0cicpKS5kYXRhKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2FzZU51bWJlciA9IHJvd09iamVjdC5jYXNlTnVtYmVyOwogICAgICAgIHZhciBwcm9kdWN0RmFtaWx5ID0gcm93T2JqZWN0LnByb2R1Y3RGYW1pbHk7CiAgICAgICAgdmFyIGNhc2VWZXJzaW9uID0gcm93T2JqZWN0LmNhc2VWZXJzaW9uOwogICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHJvd09iamVjdC5wcm9kdWN0TmFtZTsKICAgICAgICB2YXIgZXZlbnROYW1lID0gcm93T2JqZWN0LnByZWZlcnJlZFRlcm07CiAgICAgICAgdmFyIHB0ID0gcm93T2JqZWN0LnB0OwogICAgICAgIHZhciBhc3NpZ25lZFRvID0gcm93T2JqZWN0LmFzc2lnbmVkVG8uaWQ7CiAgICAgICAgdmFyIGFzc2lnbmVkVG9Vc2VyID0gbnVsbDsKICAgICAgICAgaWYocm93T2JqZWN0LmFzc2lnbmVkVG9Vc2VyICE9IHVuZGVmaW5lZCkKICAgICAgICAgICAgIGFzc2lnbmVkVG9Vc2VyID0gcm93T2JqZWN0LmFzc2lnbmVkVG9Vc2VyLmlkOwogICAgICAgIHZhciBwcm9kdWN0SWQgPSByb3dPYmplY3QucHJvZHVjdElkOwogICAgICAgIHZhciBwdENvZGUgPSByb3dPYmplY3QucHRDb2RlOwogICAgICAgIHZhciBjb25maWdJZCA9IHJvd09iamVjdC5hbGVydENvbmZpZ0lkOwogICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gcm93T2JqZWN0LmV4ZWNDb25maWdJZDsKCiAgICAgICAgaWYgKGFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkFESE9DX0FMRVJUKSB7CiAgICAgICAgICAgIGFkaG9jQWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICB9IGVsc2UgaWYgKGFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkxJVEVSQVRVUkVfU0VBUkNIX0FMRVJUKSB7CiAgICAgICAgICAgIGxpdGVyYXR1cmVBbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICBhcnRpY2xlSWQgPSByb3dPYmplY3QuYXJ0aWNsZUlkCiAgICAgICAgfQogICAgICAgIHZhciBjYXNlSnNvbiA9IHsKICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgInByb2R1Y3RGYW1pbHkiOiBwcm9kdWN0RmFtaWx5LAogICAgICAgICAgICAiY2FzZU51bWJlciI6IGNhc2VOdW1iZXIsCiAgICAgICAgICAgICJwcm9kdWN0TmFtZSI6IHByb2R1Y3ROYW1lLAogICAgICAgICAgICAiZXZlbnROYW1lIjogZXZlbnROYW1lLAogICAgICAgICAgICAicHQiOiBwdCwKICAgICAgICAgICAgInB0Q29kZSI6IHB0Q29kZSwKICAgICAgICAgICAgInByb2R1Y3RJZCI6IHByb2R1Y3RJZCwKICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBhc3NpZ25lZFRvID8gYXNzaWduZWRUbyA6IGFzc2lnbmVkVG9Vc2VyLAogICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICJjb25maWdJZCI6IGNvbmZpZ0lkLAogICAgICAgICAgICAiYWRob2NBbGVydElkIjogYWRob2NBbGVydElkLAogICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBsaXRlcmF0dXJlQWxlcnRJZCwKICAgICAgICAgICAgImFydGljbGVJZCI6IGFydGljbGVJZAogICAgICAgIH07CgogICAgICAgIGNhc2VKc29uQXJyYXkucHVzaChjYXNlSnNvbik7CiAgICAgICAgdmFyIGNvbW1lbnRNZXRhSW5mbyA9ICIiOwoKICAgICAgICBpZiAoY2FzZUpzb24uYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuQUdHUkVHQVRFX0FMRVJUIHx8IGNhc2VKc29uLmFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkVWREFTX0FMRVJUKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgKGNhc2VKc29uLmV2ZW50TmFtZSkgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiAoY2FzZUpzb24ucHJvZHVjdE5hbWUpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gIiIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0icHJvZHVjdE5hbWUiPicgKyBjYXNlSnNvbi5wcm9kdWN0TmFtZSArICc8L3NwYW4+IC0gPHNwYW4gaWQ9ImV2ZW50TmFtZSI+JyArIGNhc2VKc29uLmV2ZW50TmFtZSArICc8L3NwYW4+JyArICc8c3BhbiBjbGFzcz0iaGlkZGVuIiBpZD0icHJvZHVjdElkIj4nICsgY2FzZUpzb24ucHJvZHVjdElkICsgJzwvc3Bhbj4nICsKICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9ImhpZGRlbiIgaWQ9InB0Q29kZSI+JyArIGNhc2VKc29uLnB0Q29kZSArICc8L3NwYW4+JwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiAoY2FzZUpzb24uY2FzZU51bWJlcikgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiAoY2FzZUpzb24ucHJvZHVjdEZhbWlseSkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAiIgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gJzxzcGFuIGlkPSJjYXNlTnVtYmVyIj4nICsgY2FzZUpzb24uY2FzZU51bWJlciArICc8L3NwYW4+IC0gPHNwYW4gaWQ9InByb2R1Y3RGYW1pbHkiPicgKyBjYXNlSnNvbi5wcm9kdWN0RmFtaWx5ICsgJzwvc3Bhbj4nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50LW1ldGEtaW5mbyIpLmh0bWwoY29tbWVudE1ldGFJbmZvKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2Fzc2lnbmVkVG8iKS5odG1sKGFzc2lnbmVkVG8pOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29uZmlnSWQiKS5odG1sKGNvbmZpZ0lkKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2FwcGxpY2F0aW9uIikuaHRtbChjYXNlSnNvbi5hbGVydFR5cGUpOwoKICAgICAgICAvL1BvcHVsYXRlIHRoZSBleGlzdGluZyBjb21tZW50cyBhbmQgYmluZCBldmVudHMgdG8gdGhlbSBpbiBjYXNlIG9mIHNpbmdsZSBjb21tZW50LgogICAgICAgIGlmICh0eXBlb2YgaXNDYXNlRGV0YWlsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAkKCcjbG9hZGluZ0NvbW1lbnRzJykuaHRtbCgnJykKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzaWduYWwuYWxlcnRDb21tZW50cy5wb3B1bGF0ZV9jb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uKTsKICAgICAgICB9CiAgICAgICAgJCgiI2NvbW1lbnRNb2RhbCIpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoJyNjb21tZW50Ym94JykudmFsKCcnKTsKICAgICAgICAgICAgJCgnLmFkZC1jb21tZW50cycpLmh0bWwoJ0FkZCcpOwogICAgICAgICAgICAkKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRpYXRlU2luZ2xlQnVsa1Jvd0NvbW1lbnRQcm9jZXNzID0gZnVuY3Rpb24gKGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKSB7CiAgICAgICAgdmFyIGluZGV4U2V0ID0gbmV3IFNldCgpOwogICAgICAgIHZhciBjaGVja2JveFNlbGVjdG9yOwogICAgICAgIGlmICgkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgIGNoZWNrYm94U2VsZWN0b3IgPSAndGFibGUjYWxlcnRzRGV0YWlsc1RhYmxlIC5jb3B5LXNlbGVjdDpjaGVja2VkJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGVja2JveFNlbGVjdG9yID0gJ3RhYmxlLkRURkNfQ2xvbmVkIC5jb3B5LXNlbGVjdDpjaGVja2VkJzsKICAgICAgICB9CiAgICAgICAgJC5lYWNoKCQoY2hlY2tib3hTZWxlY3RvciksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICAgICAgaWYgKGlzQWJzdHJhY3RWaWV3T3JDYXNlVmlldyhzZWxlY3RlZFJvd0luZGV4KSkKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93SW5kZXggPSBzZWxlY3RlZFJvd0luZGV4IC8gMjsKICAgICAgICAgICAgaW5kZXhTZXQuYWRkKChzZWxlY3RlZFJvd0luZGV4KSk7CiAgICAgICAgfSk7CiAgICAgICAgaW5kZXhTZXQuZm9yRWFjaChmdW5jdGlvbiAoaW5kZXgpIHsKICAgICAgICAgICAgdmFyIGFkaG9jQWxlcnRJZDsKICAgICAgICAgICAgdmFyIGxpdGVyYXR1cmVBbGVydElkOwogICAgICAgICAgICB2YXIgYXJ0aWNsZUlkOwogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0ge307CiAgICAgICAgICAgIGlmICgoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ1NpbmdsZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdFVkRBUyBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSAmJiAhaXNTaWduYWwpIHsKICAgICAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlLnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09ICdBZ2dyZWdhdGUgQ2FzZSBBbGVydCcpIHsKICAgICAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlQWdnUmV2aWV3LnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlU2luZ2xlUmV2aWV3LnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSByb3dPYmplY3QuY2FzZU51bWJlcjsKICAgICAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSByb3dPYmplY3QucHJvZHVjdEZhbWlseTsKICAgICAgICAgICAgdmFyIGNhc2VWZXJzaW9uID0gcm93T2JqZWN0LmNhc2VWZXJzaW9uOwogICAgICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3dPYmplY3QucHJvZHVjdE5hbWU7CiAgICAgICAgICAgIHZhciBldmVudE5hbWUgPSByb3dPYmplY3QucHJlZmVycmVkVGVybTsKICAgICAgICAgICAgdmFyIHB0ID0gcm93T2JqZWN0LnB0OwogICAgICAgICAgICB2YXIgYXNzaWduZWRUbyA9IHJvd09iamVjdC5hc3NpZ25lZFRvLmlkOwogICAgICAgICAgICB2YXIgcHJvZHVjdElkID0gcm93T2JqZWN0LnByb2R1Y3RJZDsKICAgICAgICAgICAgdmFyIHB0Q29kZSA9IHJvd09iamVjdC5wdENvZGU7CiAgICAgICAgICAgIHZhciBjb25maWdJZCA9IHJvd09iamVjdC5hbGVydENvbmZpZ0lkOwogICAgICAgICAgICB2YXIgZXhlY3V0ZWRDb25maWdJZCA9IHJvd09iamVjdC5leGVjQ29uZmlnSWQ7CgogICAgICAgICAgICBpZiAoYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuQURIT0NfQUxFUlQpIHsKICAgICAgICAgICAgICAgIGFkaG9jQWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5MSVRFUkFUVVJFX1NFQVJDSF9BTEVSVCkgewogICAgICAgICAgICAgICAgbGl0ZXJhdHVyZUFsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgICAgICBhcnRpY2xlSWQgPSByb3dPYmplY3QuYXJ0aWNsZUlkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNhc2VKc29uID0gewogICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICJwcm9kdWN0RmFtaWx5IjogcHJvZHVjdEZhbWlseSwKICAgICAgICAgICAgICAgICJjYXNlTnVtYmVyIjogY2FzZU51bWJlciwKICAgICAgICAgICAgICAgICJwcm9kdWN0TmFtZSI6IHByb2R1Y3ROYW1lLAogICAgICAgICAgICAgICAgImV2ZW50TmFtZSI6IGV2ZW50TmFtZSwKICAgICAgICAgICAgICAgICJwdCI6IHB0LAogICAgICAgICAgICAgICAgInB0Q29kZSI6IHB0Q29kZSwKICAgICAgICAgICAgICAgICJwcm9kdWN0SWQiOiBwcm9kdWN0SWQsCiAgICAgICAgICAgICAgICAiYXNzaWduZWRUbyI6IGFzc2lnbmVkVG8sCiAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAiY29uZmlnSWQiOiBjb25maWdJZCwKICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiOiBhZGhvY0FsZXJ0SWQsCiAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBsaXRlcmF0dXJlQWxlcnRJZCwKICAgICAgICAgICAgICAgICJhcnRpY2xlSWQiOiBhcnRpY2xlSWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY2FzZUpzb25BcnJheS5wdXNoKGNhc2VKc29uKQogICAgICAgIH0pOwoKICAgICAgICAvL1NldCB2YWx1ZXMgdG8gdGhlIG1vZGFsIGVsZW1lbnRzLgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjbG9hZGluZ0NvbW1lbnRzIikuaGlkZSgpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudC1tZXRhLWluZm8iKS5odG1sKCIiKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLnByZXZpb3VzLWNvbW1lbnRzIikuaHRtbCgiIik7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoJycpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CiAgICAgICAgaWYgKGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgpICE9ICdVcGRhdGUnKSB7CiAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgiQWRkIik7CiAgICAgICAgfQogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94Jykub24oImtleXVwIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94JykudmFsKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgcmVzdGFydFJldmlldyA9IGZ1bmN0aW9uIChjYXNlUmV2aWV3UHJldmlvdXNVcmwpIHsKCiAgICAgICAgLy9FdmVudCB3aGVuIHJldmlldyByZXN0YXJ0IGlzIGNsaWNrZWQuCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jYXNlLXJlc3RhcnQtcmV2aWV3JywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBjYXNlTnVtYmVyID0gcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImNhc2VOdW1iZXIiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGZvbGxvd1VwTnVtYmVyID0gcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImZvbGxvd1VwTnVtYmVyIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJjYXNlVmVyc2lvbiJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHBhcmVudF9yb3cuZmluZCgnaW5wdXRbZGF0YS1maWVsZD0icHJvZHVjdEZhbWlseSJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgZm9sbG93VXBNb2RhbCA9ICQoJyNmb2xsb3dVcE1vZGFsJyk7CiAgICAgICAgICAgIGZvbGxvd1VwTW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgZm9sbG93VXBNb2RhbC5maW5kKCIucHJldmlvdXMtZm9sbG93VXAiKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgZ2V0UHJldmlvdXNTdGF0ZSA9IGNhc2VSZXZpZXdQcmV2aW91c1VybCArICI/Y2FzZU51bWJlcj0iICsgY2FzZU51bWJlciArCiAgICAgICAgICAgICAgICAgICAgIiZjYXNlVmVyc2lvbj0iICsgY2FzZVZlcnNpb24gKyAiJnByb2R1Y3RGYW1pbHk9IiArIHByb2R1Y3RGYW1pbHkgKyAiJmZvbGxvd1VwTnVtYmVyPSIgKyBmb2xsb3dVcE51bWJlcjsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBnZXRQcmV2aW91c1N0YXRlLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9IndvcmtmbG93U3RhdGUiXScpLnRleHQocmVzdWx0LnByZXZpb3VzU3RhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iZGlzcG9zaXRpb24iXScpLnRleHQocmVzdWx0LnByZXZpb3VzRGlzcG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iaW5mby1zaWduIl0nKS5hZGRDbGFzcygiaGlkZGVuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvbGxvd1VwTW9kYWwubW9kYWwoJ2Rlc3Ryb3knKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgb3BlblNpbWlsYXJDYXNlc01vZGFsID0gZnVuY3Rpb24gKGNhc2VJbmZvVXJsKSB7CgogICAgICAgIC8vRXZlbnQgdHJpZ2dlcmVkIHdoZW4gc2ltaWxhciBjYXNlcyBjb3VudCBpcyBjbGlja2VkLgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuc2ltaWxhci1jYXNlcycsIGZ1bmN0aW9uIChldmVudCkgewoKICAgICAgICAgICAgdmFyIHNpbWlsYXJDYXNlTW9kYWwgPSAkKCcjc2ltaWxhckNhc2VNb2RhbCcpOwogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgidHIiKTsKCiAgICAgICAgICAgIC8vRmV0Y2ggdGhlIHZhbHVlcyBvZiB0aGUgZXZlbnQuCiAgICAgICAgICAgIHZhciBldmVudFZhbCA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWV2ZW50LXZhbCcpOwogICAgICAgICAgICB2YXIgZXZlbnRUeXBlID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2RhdGEtZmllbGQnKTsKICAgICAgICAgICAgdmFyIGV4ZWN1dGVkQ29uZmlnSWQgPSAkKGV2ZW50LnRhcmdldCkuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgcHQgPSAkKGV2ZW50LnRhcmdldCkuYXR0cigiZGF0YS1wdCIpOwogICAgICAgICAgICB2YXIgZXZlbnRDb2RlOwogICAgICAgICAgICBpZiAoZXZlbnRUeXBlKSB7CiAgICAgICAgICAgICAgICBldmVudENvZGUgPSAoZXZlbnRUeXBlLnNwbGl0KCJfY29kZSIpWzBdKTsKICAgICAgICAgICAgICAgIGV2ZW50VHlwZSA9IGV2ZW50VHlwZS5zcGxpdCgiXyIpWzJdOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJjYXNlTnVtYmVyIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJjYXNlVmVyc2lvbiJdJykuYXR0cigiZGF0YS1pZCIpOwoKICAgICAgICAgICAgLy9TaG93IG1vZGFsIGFuZCBzZXQgaXRzIHZhbHVlcy4KICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNldmVudFR5cGUiKS5odG1sKGV2ZW50VHlwZSk7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2V2ZW50VmFsIikuaHRtbChldmVudFZhbCk7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2Nhc2VOdW1iZXJJbmZvIikudmFsKGNhc2VOdW1iZXIpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNleGVjdXRlZENvbmZpZ0lkIikudmFsKGV4ZWN1dGVkQ29uZmlnSWQpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNjYXNlQ3VycmVudFZlcnNpb24iKS52YWwoY2FzZVZlcnNpb24pOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNldmVudENvZGUiKS52YWwoZXZlbnRDb2RlKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRDb2RlVmFsIikudmFsKGV2ZW50VmFsKTsKICAgICAgICAgICAgLy9NYWtlIHRoZSBtb2RhbCB0YWJsZSBhcyBkYXRhdGFibGUKCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2lnbmFsLnNpbWlsYXJDYXNlVGFibGUuaW5pdF9zaW1pbGFyX2Nhc2VfdGFibGUoY2FzZUluZm9VcmwpCiAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuQXR0YWNobWVudE1vZGFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuc2hvdy1hdHRhY2htZW50LWljb24nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpczsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZmV0Y2hBY2NlcHRlZEZpbGVGb3JtYXRzKCk7CiAgICAgICAgICAgIC8vdmFyIGlzQXJjaGl2ZWQgPSAkKCIjaXNBcmNoaXZlZCIpLnZhbCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHBhcmVudF9yb3cuZmluZCgnYVtkYXRhLWZpZWxkPSJhdHRhY2htZW50Il0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBjYXNlQ29udHJvbGxlciA9IHBhcmVudF9yb3cuZmluZCgnYVtkYXRhLWZpZWxkPSJhdHRhY2htZW50Il0nKS5hdHRyKCJkYXRhLWNvbnRyb2xsZXIiKTsKICAgICAgICAgICAgdmFyIHVybCA9ICIvc2lnbmFsLyIgKyBjYXNlQ29udHJvbGxlciArICIvdXBsb2FkP2lzQXJjaGl2ZWQ9Iitpc0FyY2hpdmVkOwogICAgICAgICAgICB2YXIgZ2V0QXR0YWNobWVudFVybCA9ICIvc2lnbmFsLyIgKyBjYXNlQ29udHJvbGxlciArICIvZmV0Y2hBdHRhY2htZW50P2FsZXJ0SWQ9IiArIGFsZXJ0SWQgKyAiJmlzQXJjaGl2ZWQ9IiArIGlzQXJjaGl2ZWQ7CiAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50Rm9ybSAjYXR0YWNobWVudEZvcm1JZCcpLmF0dHIoJ3ZhbHVlJywgYWxlcnRJZCk7CiAgICAgICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI3Nob3dBdHRhY2htZW50TW9kYWwnKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICAkKCIjc2hvd0F0dGFjaG1lbnRNb2RhbCBmb3JtI2F0dGFjaG1lbnRGb3JtIikudW5iaW5kKCdzdWJtaXQnKS5vbignc3VibWl0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKHRoaXMpOwogICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy5maW5kKCcuYXR0YWNobWVudC1maWxlJykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCIudXBsb2FkIikuYXR0cigiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmb3JtRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCcuYXR0YWNobWVudC1maWxlJykudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBdHRhY2htZW50SWNvbihwYXJlbnRfcm93KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50LXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIi51cGxvYWQiKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIi51cGxvYWQiKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnZXJyb3InLCAndG9wIHJpZ2h0JywgIkVycm9yIiwgIlNvcnJ5LCBUaGlzIEZpbGUgRm9ybWF0IE5vdCBBY2NlcHRlZCIsIHthdXRvSGlkZURlbGF5OiAxMDAwMH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCcjc2hvd0F0dGFjaG1lbnRNb2RhbCAjYXR0YWNobWVudC10YWJsZScpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICAgICBkZXN0cm95OiB0cnVlLAogICAgICAgICAgICAgICAgc2VhcmNoaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgIHNQYWdpbmF0aW9uVHlwZTogImJvb3RzdHJhcCIsCiAgICAgICAgICAgICAgICByZXNwb25zaXZlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGxhbmd1YWdlOiB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJhamF4IjogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiBnZXRBdHRhY2htZW50VXJsLAogICAgICAgICAgICAgICAgICAgICJkYXRhU3JjIjogIiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICQoJy5yZW1vdmUtYXR0YWNobWVudCcpLmNsaWNrKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2htZW50Um93ID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dGFjaG1lbnRJZCA9IGF0dGFjaG1lbnRSb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJyZW1vdmVBdHRhY2htZW50Il0nKS5hdHRyKCJkYXRhLWF0dGFjaG1lbnRJZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVtb3ZlVXJsID0gJy9zaWduYWwvJyArIGNhc2VDb250cm9sbGVyICsgJy9kZWxldGVBdHRhY2htZW50P2F0dGFjaG1lbnRJZD0nICsgYXR0YWNobWVudElkICsgJyZpc0FyY2hpdmVkPScgKyBpc0FyY2hpdmVkOwogICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiByZW1vdmVVcmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7YWxlcnRJZDogYWxlcnRJZH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCgnLnJlbW92ZS1hdHRhY2htZW50JykubGVuZ3RoID09PTEgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUF0dGFjaG1lbnRJY29uKCR0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2hvd0F0dGFjaG1lbnRNb2RhbCAjYXR0YWNobWVudC10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ2Vycm9yJywgJ3RvcCByaWdodCcsICJFcnJvciIsICJBbGwgc2VsZWN0ZWQgc2FmZXR5IG9ic2VydmF0aW9ucyBtdXN0IGJlIGluIHNhbWUgZGlzcG9zaXRpb24gZm9yIHBlcmZvcm1pbmcgdGhlIGJ1bGsgdXBkYXRlLiIsIHthdXRvSGlkZURlbGF5OiAxMDAwMH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJuYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9Ii9zaWduYWwvYXR0YWNobWVudGFibGUvZG93bmxvYWQ/aWQ9JyArIHJvdy5pZCArICciPicgKyBlc2NhcGVIVE1MKHJvdy5uYW1lKSArICc8L2E+JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NlbGwtYnJlYWsnLAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInRpbWVTdGFtcCIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJtb2RpZmllZEJ5IgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIHRhYmluZGV4PSIwIiB0aXRsZT0iUmVtb3ZlIEF0dGFjaG1lbnQiICBzdHlsZT0iY3Vyc29yOiBwb2ludGVyIiBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUgcmVtb3ZlLWF0dGFjaG1lbnQiIGRhdGEtZmllbGQ9InJlbW92ZUF0dGFjaG1lbnQiIGRhdGEtYXR0YWNobWVudElkPScgKyByb3cuaWQgKyAnPjwvc3Bhbj4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAgICAgInRhcmdldHMiOiAnX2FsbCcsCiAgICAgICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgYmluZEdyaWREeW5hbWljRmlsdGVycyA9IGZ1bmN0aW9uIChmaWx0ZXJzRGF0YSwgcHJlZml4LCBpZCkgewogICAgICAgIC8vQWRkIGZpbHRlcnMgdG8gdGhlIGRhdGEgdGFibGUuCiAgICAgICAgdmFyIGRhdGFUYWJsZXNfbGVuZ3RoID0gJCgnLmRhdGFUYWJsZXNfbGVuZ3RoJyk7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGguYWRkQ2xhc3MoJ2NvbC1zbS0xMicpOwogICAgICAgIGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgpLnJlbW92ZUNsYXNzKCJjb2wteHMtMiIpOwogICAgICAgIGFwcGxpY2F0aW9uTmFtZSA9PSBBTEVSVF9DT05GSUdfVFlQRS5BREhPQ19BTEVSVCA/IGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgiOm5vdCgnLmRhdGFUYWJsZXNfd3JhcHBlcicpIikuYWRkQ2xhc3MoImNvbC14cy05IikgOiBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoIjpub3QoJy5kYXRhVGFibGVzX3dyYXBwZXInKSIpLmFkZENsYXNzKCJjb2wteHMtMTAiKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoIjpub3QoJy5kYXRhVGFibGVzX3dyYXBwZXInKSIpLm5leHQoKS5yZW1vdmVDbGFzcygiY29sLXhzLTEwIik7CiAgICAgICAgYXBwbGljYXRpb25OYW1lID09IEFMRVJUX0NPTkZJR19UWVBFLkFESE9DX0FMRVJUID8gZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5uZXh0KCkuYWRkQ2xhc3MoImNvbC14cy0zIikgOiBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoIjpub3QoJy5kYXRhVGFibGVzX3dyYXBwZXInKSIpLm5leHQoKS5hZGRDbGFzcygiY29sLXhzLTIiKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5maW5kKCJsYWJlbCIpLmFkZENsYXNzKCdjb2wteHMtMicpOwogICAgICAgIGRhdGFUYWJsZXNfbGVuZ3RoLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZHRCdXR0b25zID0gJzxkaXYgY2xhc3M9ImRhdGFUYWJsZS10b3AtZGlzcG9zaXRpb24gY29sLXhzLTEwIj4nOwogICAgICAgICAgICAkLmVhY2goZmlsdGVyc0RhdGEsIGZ1bmN0aW9uIChpbmRleCwgb2JqKSB7CiAgICAgICAgICAgICAgICBpZiAob2JqLmNsb3NlZCB8fCBvYmouaXNDbG9zZWQpIHsKICAgICAgICAgICAgICAgICAgICBkdEJ1dHRvbnMgKz0gJzxkaXYgY2xhc3M9ImNoZWNrYm94IGNoZWNrYm94LXByaW1hcnkgY2hlY2tib3gtaW5saW5lIG0tbC0zIGNoZWNrYm94LXBvcy1hYnMiPic7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8aW5wdXQgaWQ9ImZpbHRlcicgKyBpbmRleCArICciIHR5cGU9ImNoZWNrYm94IiBjbGFzcz0iZHluYW1pYy1maWx0ZXJzIiBuYW1lPSJyZWxhdGVkUmVzdWx0cyIgZGF0YS1jbG9zZWQ9IicgKyBvYmouaXNDbG9zZWQgKyAnIiB2YWx1ZT0iJyArIG9iai52YWx1ZSArICciIC8+IDxsYWJlbCBjbGFzcz0ibS1yLTMwIiAgZm9yPSJmaWx0ZXInICsgaW5kZXggKyAnIj4nICsgb2JqLnZhbHVlICsgJzwvbGFiZWw+PC9kaXY+JwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkdEJ1dHRvbnMgKz0gJzxkaXYgY2xhc3M9ImNoZWNrYm94IGNoZWNrYm94LXByaW1hcnkgY2hlY2tib3gtaW5saW5lIG0tbC0zIGNoZWNrYm94LXBvcy1hYnMiPic7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8aW5wdXQgaWQ9ImZpbHRlcicgKyBpbmRleCArICciIHR5cGU9ImNoZWNrYm94IiBjbGFzcz0iZHluYW1pYy1maWx0ZXJzIiBuYW1lPSJyZWxhdGVkUmVzdWx0cyIgZGF0YS1jbG9zZWQ9IicgKyBvYmouaXNDbG9zZWQgKyAnIiBjaGVja2VkPSJjaGVja2VkIiB2YWx1ZT0iJyArIG9iai52YWx1ZSArICciIC8+IDxsYWJlbCBjbGFzcz0ibS1yLTMwIiBmb3I9ImZpbHRlcicgKyBpbmRleCArICciPicgKyBvYmoudmFsdWUgKyAnPC9sYWJlbD48L2Rpdj4nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkdEJ1dHRvbnMgKz0gJzwvZGl2Pic7CiAgICAgICAgICAgIGR0QnV0dG9ucyA9IGR0QnV0dG9ucyArICc8L2Rpdj4nOwogICAgICAgICAgICBpZiAodGhpcy5pZCAhPT0gJ2FyY2hpdmVkQWxlcnRzVGFibGVfbGVuZ3RoJyAmJiB0aGlzLmlkICE9PSAnYWN0aXZpdGllc1RhYmxlX2xlbmd0aCcpCiAgICAgICAgICAgICAgICAkKHRoaXMpLmFwcGVuZChkdEJ1dHRvbnMpOwogICAgICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmR5bmFtaWMtZmlsdGVycycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhbGVydERldGFpbHNUYWJsZTsKICAgICAgICAgICAgICAgIHZhciBmcmVxU2VsZWN0ZWQgPSAiIjsKICAgICAgICAgICAgICAgIGlmICgkKCIjZnJlcXVlbmN5TmFtZXMiKSkgewogICAgICAgICAgICAgICAgICAgIGZyZXFTZWxlY3RlZCA9ICQoIiNmcmVxdWVuY3lOYW1lcyIpLnZhbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGZpbHRlckFycmF5ID0gW107CiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyVmFsdWVzID0gW107CiAgICAgICAgICAgICAgICAkKCcuZHluYW1pYy1maWx0ZXJzJykuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZXMucHVzaCgkKHRoaXMpLnZhbCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZmlsdGVyQXJyYXkucHVzaCgkKHRoaXMpLmlzKCc6Y2hlY2tlZCcpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyAiZmlsdGVyc19zdG9yZSIsIEpTT04uc3RyaW5naWZ5KGZpbHRlckFycmF5KSk7CiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHByZWZpeCArICJmaWx0ZXJzX3ZhbHVlIiwgSlNPTi5zdHJpbmdpZnkoZmlsdGVyVmFsdWVzKSk7CiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHByZWZpeCArICJpZCIsIGlkKTsKICAgICAgICAgICAgICAgIHZhciB1cmw7CiAgICAgICAgICAgICAgICBpZiAoYXBwbGljYXRpb25OYW1lID09ICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCcpIHsKICAgICAgICAgICAgICAgICAgICBhbGVydERldGFpbHNUYWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKTsKICAgICAgICAgICAgICAgICAgICB1cmwgPSBsaXN0Q29uZmlnVXJsICsgIj9maWx0ZXJzPSIgKyBmaWx0ZXJWYWx1ZXMuam9pbigiLCIpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0RGV0YWlsc1RhYmxlID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpOwogICAgICAgICAgICAgICAgICAgIHVybCA9IGxpc3RDb25maWdVcmwgKyAiJmZyZXF1ZW5jeT0iICsgZnJlcVNlbGVjdGVkICsgIiZpc0ZpbHRlclJlcXVlc3Q9dHJ1ZSZmaWx0ZXJzPSIgKyBlbmNvZGVVUkkoSlNPTi5zdHJpbmdpZnkoZmlsdGVyVmFsdWVzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhbGVydERldGFpbHNUYWJsZS5hamF4LnVybCh1cmwpLmxvYWQoKQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICB9OwoKICAgIHZhciBpc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZSA9IGZ1bmN0aW9uIChwcmVmaXgpIHsKICAgICAgICB2YXIgYyA9IHNpZ25hbC51dGlscy5nZXRRdWVyeVN0cmluZygiY29uZmlnSWQiKTsKICAgICAgICByZXR1cm4gYyA/IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocHJlZml4ICsgImlkIikgPT0gYyA6IGZhbHNlCiAgICB9OwoKICAgIHZhciByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiKTsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKHByZWZpeCArICJmaWx0ZXJzX3ZhbHVlIik7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShwcmVmaXggKyAiaWQiKTsKICAgIH07CgogICAgdmFyIG9wZW5TYXZlVmlld01vZGFsID0gZnVuY3Rpb24gKGZpbHRlckluZGV4LCBhcHBsaWNhdGlvbk5hbWUsIHZpZXdJZCkgewogICAgICAgIHZhciBzeXN0ZW1EZWZhdWx0ID0gWyJTeXN0ZW0gVmlldyJdOwogICAgICAgIHZhciB2aWV3SW5mbzsKCiAgICAgICAgLy9zYXZpbmcgbmV3IHZpZXcKICAgICAgICAkKCIuc2F2ZVZpZXciKS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgJCgnLnNhdmVWaWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3U2hhcmVkV2l0aCcpLmVtcHR5KCk7CgogICAgICAgICAgICAkKCIjc2F2ZS12aWV3LW1vZGFsICAjc2F2ZURpdiIpLnNob3coKTsKICAgICAgICAgICAgJCgiI3NhdmUtdmlldy1tb2RhbCAgI2VkaXREaXYiKS5oaWRlKCk7CiAgICAgICAgICAgIHZpZXdJbmZvID0gZ2VuZXJhdGVWaWV3SW5mbyhmaWx0ZXJJbmRleCk7CgogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2ZpbHRlcnMnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKSk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfY29sdW1uTGlzdCcpLnZhbCh2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hbGVydFR5cGUnKS52YWwoYXBwbGljYXRpb25OYW1lKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19zb3J0aW5nJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLnNvcnRlZENvbHVtbikpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI2N1cnJlbnRfdmlld19pZCcpLnZhbCh2aWV3SWQpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsIC5zYXZlX2J1dHRvbnMnKS5zaG93KCk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgIH0pCgogICAgICAgIC8vdXBkYXRpbmcgZXhpc3RpbmcgdmlldwogICAgICAgICQoIi51cGRhdGVWaWV3IikudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy51cGRhdGVWaWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2aWV3SW5mbyA9IGdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwogICAgICAgICAgICBpZiAoJC5pbkFycmF5KCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpLCBzeXN0ZW1EZWZhdWx0KSAhPSAtMSkgewogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19maWx0ZXJzJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLmZpbHRlck1hcCkpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19jb2x1bW5MaXN0JykudmFsKHZpZXdJbmZvLm5vdFZpc2libGVDb2x1bW4pOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hbGVydFR5cGUnKS52YWwoYXBwbGljYXRpb25OYW1lKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfc29ydGluZycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWR2YW5jZWRfZmlsdGVyJykudmFsKHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI2N1cnJlbnRfdmlld19pZCcpLnZhbCh2aWV3SWQpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuc2F2ZV9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAgICAgJCgiI3NhdmUtdmlldy1tb2RhbCAgI3NhdmVEaXYiKS5zaG93KCk7CiAgICAgICAgICAgICAgICAkKCIjc2F2ZS12aWV3LW1vZGFsICAjZWRpdERpdiIpLmhpZGUoKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGlzVmlld1VwZGF0ZUFsbG93ZWQgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlRXhpc3RpbmdWaWV3KHZpZXdJbmZvKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBib290Ym94LmNvbmZpcm0oewogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAkLmkxOG4uXygnZGVmYXVsdFZpZXdVcGRhdGVPbmx5JyksCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm06IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NvbnRpbnVlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdidG4tc3VjY2VzcycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWw6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NhbmNlbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnYnRuLWRhbmdlcicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUV4aXN0aW5nVmlldyh2aWV3SW5mbykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vc2VsZWN0aW5nIGFub3RoZXIgdmlldwogICAgICAgICQoJy52aWV3U2VsZWN0JykudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy52aWV3U2VsZWN0Jykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHBhZ2VVUkwgPSAkKGxvY2F0aW9uKS5hdHRyKCJocmVmIik7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFZpZXcgPSAkKCcudmlld1NlbGVjdCcpLnZhbCgpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdpc1ZpZXdDYWxsJywgJ3RydWUnKTsKICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigidmlld0lkIikgIT0gLTEpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcGFnZVVSTC5zbGljZSgwLCBwYWdlVVJMLmluZGV4T2YoInZpZXdJZCIpICsgNykgKyBzZWxlY3RlZFZpZXcKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwYWdlVVJMLmluZGV4T2YoIiMiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VVUkwgPSBwYWdlVVJMLnNsaWNlKDAsIHBhZ2VVUkwuaW5kZXhPZigiIyIpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBwYWdlVVJMICsgIiZ2aWV3SWQ9IiArIHNlbGVjdGVkVmlldwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vZGVsZXRpbmcgb3IgZWRpdGluZyBzZWxlY3RlZCB2aWV3CiAgICAgICAgJCgnLmVkaXRWaWV3JykudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy5lZGl0VmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICQoIiNzYXZlLXZpZXctbW9kYWwgICNzYXZlRGl2IikuaGlkZSgpOwogICAgICAgICAgICAkKCIjc2F2ZS12aWV3LW1vZGFsICAjZWRpdERpdiIpLnNob3coKTsKICAgICAgICAgICAgdmlld0luZm8gPSBnZW5lcmF0ZVZpZXdJbmZvKGZpbHRlckluZGV4KTsKCiAgICAgICAgICAgIGlmICgkLmluQXJyYXkoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCksIHN5c3RlbURlZmF1bHQpID09IC0xKSB7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X25hbWUnKS52YWwoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X25hbWUnKS52YWwoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihTKSIsICIiKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2RlZmF1bHQnKS5wcm9wKCdjaGVja2VkJywgKCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5pbmRleE9mKCIoZGVmYXVsdCkiKSAhPSAtMSkpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19pZCcpLnZhbCgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS52YWwoKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2ZpbHRlcnMnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2NvbHVtbkxpc3QnKS52YWwodmlld0luZm8ubm90VmlzaWJsZUNvbHVtbik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X3NvcnRpbmcnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uc29ydGVkQ29sdW1uKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FsZXJ0VHlwZScpLnZhbChhcHBsaWNhdGlvbk5hbWUpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuZWRpdF9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCcjYWxlcnQtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgZ2VuZXJhdGVWaWV3SW5mbyA9IGZ1bmN0aW9uIChmaWx0ZXJJbmRleCkgewogICAgICAgIHZhciBvVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CgogICAgICAgIC8vZ2VuZXJhdGUgZmlsdGVyIHZhbHVlIG1hcAogICAgICAgIHZhciBmaWx0ZXJNYXAgPSBuZXcgT2JqZWN0KCk7CiAgICAgICAgJC5lYWNoKGZpbHRlckluZGV4LCBmdW5jdGlvbiAoaWR4LCBvYmopIHsKICAgICAgICAgICAgdmFyIGZpbHRlclZhbCA9IHlhZGNmLmV4R2V0Q29sdW1uRmlsdGVyVmFsKG9UYWJsZSwgb2JqKTsKICAgICAgICAgICAgaWYgKGZpbHRlclZhbCkgewogICAgICAgICAgICAgICAgZmlsdGVyTWFwW29ial0gPSBmaWx0ZXJWYWwKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvL2dlbmVyYXRlIGNvbHVtbnMgdmlzaWJsZSBsaXN0CiAgICAgICAgdmFyIG5vdFZpc2libGVDb2x1bW4gPSAkKCcjY29sdW1uSW5kZXgnKS52YWwoKTsKCiAgICAgICAgLy9nZW5lcmF0ZSBzb3J0aW5nIGNvbHVtbiBpbmZvCiAgICAgICAgdmFyIHNvcnRlZENvbHVtbiA9IG5ldyBPYmplY3QoKTsKICAgICAgICBpZiAoJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmRhdGFUYWJsZSgpLmZuU2V0dGluZ3MoKS5hYVNvcnRpbmdbMF0pIHsKICAgICAgICAgICAgdmFyIHNvcnRlZENvbCA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5kYXRhVGFibGUoKS5mblNldHRpbmdzKCkuYWFTb3J0aW5nWzBdWzBdOwogICAgICAgICAgICB2YXIgY29sdW1uTmFtZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5maW5kKCJ0aCIpLmVxKHNvcnRlZENvbCkuYXR0cigiZGF0YS1maWVsZCIpOwogICAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgICBjb2x1bW5TZXEuZXZlcnkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlcU5hbWUgPSBjb2x1bW5TZXFbaW5kZXhdLm5hbWU7CiAgICAgICAgICAgICAgICBpZiAoY29sdW1uTmFtZSA9PSBzZXFOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgc29ydGVkQ29sID0gY29sdW1uU2VxW2luZGV4XS5zZXE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHNvcnRlZERpciA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5kYXRhVGFibGUoKS5mblNldHRpbmdzKCkuYWFTb3J0aW5nWzBdWzFdOwogICAgICAgICAgICBzb3J0ZWRDb2x1bW5bc29ydGVkQ29sXSA9IHNvcnRlZERpcjsKICAgICAgICB9CgogICAgICAgIC8vZ2VuZXJhdGUgYWR2YW5jZWQgZmlsdGVyIGluZm8KICAgICAgICB2YXIgYWR2YW5jZWRGaXRlcklkID0gJCgnLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93bicpLnZhbCgpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdmaWx0ZXJNYXAnOiBmaWx0ZXJNYXAsCiAgICAgICAgICAgICdub3RWaXNpYmxlQ29sdW1uJzogbm90VmlzaWJsZUNvbHVtbiwKICAgICAgICAgICAgJ3NvcnRlZENvbHVtbic6IHNvcnRlZENvbHVtbiwKICAgICAgICAgICAgJ2FkdmFuY2VkRmlsdGVyJzogYWR2YW5jZWRGaXRlcklkCiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgY3JlYXRlU29ydGluZ01hcCA9IGZ1bmN0aW9uIChpbmZvS2V5LCB2aWV3TmFtZSkgewogICAgICAgIHZhciBzb3J0aW5nTWFwID0gW107CiAgICAgICAgdmFyIHNvcnRpbmcgPSB7fTsKICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsKSB7CiAgICAgICAgICAgIHNvcnRpbmcgPSAkLnBhcnNlSlNPTihzZXNzaW9uU3RvcmVkVmFsKTsKICAgICAgICB9IGVsc2UgaWYgKCQoIiNzb3J0ZWRDb2x1bW4iKS52YWwoKSAhPSAiIiAmJiAkKCIjc29ydGVkQ29sdW1uIikudmFsKCkgIT0gInt9IiAmJiBjYWxsaW5nU2NyZWVuID09ICdyZXZpZXcnKSB7CiAgICAgICAgICAgIHNvcnRpbmcgPSAkLnBhcnNlSlNPTigkKCcjc29ydGVkQ29sdW1uJykudmFsKCkpOwogICAgICAgIH0KICAgICAgICAkLmVhY2goc29ydGluZywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgc29ydGluZ01hcC5wdXNoKFtwYXJzZUludChrZXkpLCB2YWx1ZV0pCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHNvcnRpbmdNYXAKICAgIH07CgogICAgdmFyIGNyZWF0ZUZpbHRlck1hcCA9IGZ1bmN0aW9uIChpbmZvS2V5LCB2aWV3TmFtZSkgewogICAgICAgIHZhciBmaWx0ZXJzVmFsdWUgPSBbXTsKICAgICAgICB2YXIgZmlsdGVyTWFwID0ge307CiAgICAgICAgdmFyIHNlc3Npb25TdG9yZWRWYWw7CiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0odmlld05hbWUpID09ICQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpKSB7CiAgICAgICAgICAgIHNlc3Npb25TdG9yZWRWYWwgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGluZm9LZXkpOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvblN0b3JlZFZhbCAmJiBzZXNzaW9uU3RvcmVkVmFsICE9IHt9KSB7CiAgICAgICAgICAgIGZpbHRlck1hcCA9ICQucGFyc2VKU09OKHNlc3Npb25TdG9yZWRWYWwpOwogICAgICAgIH0gZWxzZSBpZiAoJCgnI2ZpbHRlck1hcCcpLnZhbCgpICE9ICIiICYmICQoJyNmaWx0ZXJNYXAnKS52YWwoKSAhPSAie30iKSB7CiAgICAgICAgICAgIGZpbHRlck1hcCA9ICQucGFyc2VKU09OKCQoJyNmaWx0ZXJNYXAnKS52YWwoKSk7CiAgICAgICAgfQogICAgICAgICQuZWFjaChmaWx0ZXJNYXAsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBmaWx0ZXJBcnIgPSBbcGFyc2VJbnQoa2V5KSwgdmFsdWVdOwogICAgICAgICAgICBmaWx0ZXJzVmFsdWUucHVzaChmaWx0ZXJBcnIpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZpbHRlcnNWYWx1ZQogICAgfTsKCiAgICB2YXIgY3JlYXRlTGlzdE9mSW5kZXggPSBmdW5jdGlvbiAoaW5mb0tleSwgaXNFdmRhcywgdmlld05hbWUpIHsKICAgICAgICB2YXIgbG9pID0gW107CiAgICAgICAgdmFyIGNvbHVtbkluZGV4ID0gW10KICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09ICdyZXZpZXcnKSB7CiAgICAgICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsKSB7CiAgICAgICAgICAgICAgICBjb2x1bW5JbmRleCA9IHNlc3Npb25TdG9yZWRWYWwuc3BsaXQoJywnKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29sdW1uSW5kZXggPSAkKCcjY29sdW1uSW5kZXgnKS52YWwoKS5zcGxpdCgnLCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZWFjaChjb2x1bW5JbmRleCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGlzRXZkYXMpIHsKICAgICAgICAgICAgICAgICAgICBsb2kucHVzaChwYXJzZUludCh0aGlzKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9pLnB1c2gocGFyc2VJbnQodGhpcykgKyAxKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxvaQogICAgfTsKCiAgICB2YXIgc2V0U29ydE9yZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoIiNhbGVydHNEZXRhaWxzVGFibGVSb3ciKS5vbignbW91c2Vkb3duJywgJ3RoJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpbmRleCA9ICQodGhpcykuYXR0cigiZGF0YS1jb2x1bW4taW5kZXgiKTsKICAgICAgICAgICAgZGlyID0gJ2FzYyc7CiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdzb3J0aW5nX2FzYycpKSB7CiAgICAgICAgICAgICAgICBkaXIgPSAnZGVzYycKICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdzb3J0aW5nX2Rlc2MnKSkgewogICAgICAgICAgICAgICAgZGlyID0gJ2FzYycKICAgICAgICAgICAgfQogICAgICAgICAgICBpc1ZpZXdJbnN0YW5jZSA9IDA7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuQWxlcnRUYWdNb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmVkaXRBbGVydFRhZ3MnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0gdGFibGUucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgdmFyIGV4ZWNDb25maWdJZCA9IHBhcmVudF9yb3cuZmluZCgnLmV4ZWNDb25maWdJZCcpLmF0dHIoInZhbHVlIik7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IGZldGNoVGFnc1VybCwKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhbGVydFRhZ01vZGFsT2JqID0gJCgnI2FsZXJ0VGFnTW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS5zZWxlY3QyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICJBZGQgQ2F0ZWdvcmllcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQudGFnTGlzdAoKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykudmFsKHJlc3VsdC5hbGVydFRhZ0xpc3QpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgiLmFkZFRhZ3MiKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHNhdmVUYWdVcmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdzOiBKU09OLnN0cmluZ2lmeShhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRJZDogYWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjQ29uZmlnSWQ6IGV4ZWNDb25maWdJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuYWpheC5yZWxvYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuU2luZ2xlQWxlcnRUYWdNb2RhbCA9IGZ1bmN0aW9uICh0YWJsZU9iaiwgdGFnc09iaikgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZWRpdEFsZXJ0VGFncycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgaW5kZXggPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICAgICAgaWYgKGlzQWJzdHJhY3RWaWV3T3JDYXNlVmlldyhpbmRleCkpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggLyAyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHRhYmxlT2JqLnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIHZhciBleGVjQ29uZmlnSWQgPSBwYXJlbnRfcm93LmZpbmQoJy5leGVjQ29uZmlnSWQnKS5hdHRyKCJ2YWx1ZSIpOwogICAgICAgICAgICB2YXIgYWxlcnRUYWdNb2RhbE9iaiA9ICQoJyNhbGVydFRhZ01vZGFsJyk7CiAgICAgICAgICAgIHZhciAkc2luZ2xlQ2FzZUFsZXJ0VGFncyA9IGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpOwogICAgICAgICAgICB2YXIgJGdsb2JhbFRhZ3MgPSBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNnbG9iYWxUYWdzJyk7CiAgICAgICAgICAgIGFwcGx5U2VsZWN0MkZvclRhZ3MoJHNpbmdsZUNhc2VBbGVydFRhZ3MsIGZldGNoVGFnc1VybCwgJ0Nhc2UgU2VyaWVzIENhdGVnb3JpZXMnLCB0cnVlKTsKICAgICAgICAgICAgYXBwbHlTZWxlY3QyRm9yVGFncygkZ2xvYmFsVGFncywgZmV0Y2hUYWdzVXJsLCAnR2xvYmFsIENhdGVnb3JpZXMnLCBmYWxzZSk7CiAgICAgICAgICAgICRzaW5nbGVDYXNlQWxlcnRUYWdzLmZpbmQoJ29wdGlvbicpLnJlbW92ZSgpCiAgICAgICAgICAgICRnbG9iYWxUYWdzLmZpbmQoJ29wdGlvbicpLnJlbW92ZSgpCiAgICAgICAgICAgICRzaW5nbGVDYXNlQWxlcnRUYWdzLnZhbChudWxsKS50cmlnZ2VyKCJjaGFuZ2UiKTsKICAgICAgICAgICAgJGdsb2JhbFRhZ3MudmFsKG51bGwpLnRyaWdnZXIoImNoYW5nZSIpOwogICAgICAgICAgICAkLmVhY2gocm93T2JqZWN0LmNhc2VTZXJpZXNUYWdzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0gbmV3IE9wdGlvbih2YWx1ZSwgdmFsdWUsIHRydWUsIHRydWUpOwogICAgICAgICAgICAgICAgJHNpbmdsZUNhc2VBbGVydFRhZ3MuYXBwZW5kKG9wdGlvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkLmVhY2gocm93T2JqZWN0Lmdsb2JhbFRhZ3MsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKHZhbHVlLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAkZ2xvYmFsVGFncy5hcHBlbmQob3B0aW9uKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNnbG9iYWxUYWdzJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgIHZhciBlbmFibGVDYXNlU2VyaWVzVGFncyA9IHJvd09iamVjdC5pc0Nhc2VTZXJpZXNHZW5lcmF0ZWQ7CiAgICAgICAgICAgIGlmICghZW5hYmxlQ2FzZVNlcmllc1RhZ3MpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLmF0dHIoJ2Rpc2FibGVkJywgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmoubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCIuYWRkVGFncyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBzYXZlVGFnVXJsLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdzOiBKU09OLnN0cmluZ2lmeShhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbFRhZ3M6IEpTT04uc3RyaW5naWZ5KGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI2dsb2JhbFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRDYXNlU2VyaWVzVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5kZWxldGVkQ2FzZVNlcmllc1RhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkR2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5kZWxldGVkR2xvYmFsVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkQ2FzZVNlcmllc1RhZ3M6IEpTT04uc3RyaW5naWZ5KHRhZ3NPYmouYWRkZWRDYXNlU2VyaWVzVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkR2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5hZGRlZEdsb2JhbFRhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICBleGVjQ29uZmlnSWQ6IGV4ZWNDb25maWdJZAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocGF5bG9hZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlT2JqLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ3N1Y2Nlc3MnLCAndG9wIHJpZ2h0JywgIlN1Y2Nlc3MiLCBwYXlsb2FkLm1lc3NhZ2UsIHthdXRvSGlkZURlbGF5OiAyMDAwfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ2Vycm9yJywgJ3RvcCByaWdodCcsICJFcnJvciIsIHBheWxvYWQubWVzc2FnZSwge2F1dG9IaWRlRGVsYXk6IDIwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2luZ2xlLWNhc2UtYWxlcnQtc3Bpbm5lcicpLmFkZENsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoJyNzaW5nbGUtY2FzZS1hbGVydC1zcGlubmVyJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIHBvcHVsYXRlQWR2YW5jZWRGaWx0ZXJTZWxlY3QgPSBmdW5jdGlvbiAoYWxlcnRUeXBlKSB7CgogICAgICAgICQoIi5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24iKS5zZWxlY3QyKHsKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICQuaTE4bi5fKCdzZWxlY3RPbmUnKSwKICAgICAgICAgICAgYWxsb3dDbGVhcjogdHJ1ZSwKICAgICAgICAgICAgYWpheDogewogICAgICAgICAgICAgICAgdXJsOiBmZXRjaEFkdkZpbHRlclVybCwKICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgIHF1aWV0TWlsbGlzOiA1MCwKICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydFR5cGU6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGVybTogcGFyYW1zLnRlcm0gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhcmFtcy5wYWdlIHx8IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heDogcGFyYW1zLm1heCB8fCAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGluZ1NjcmVlbjogY2FsbGluZ1NjcmVlbgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJvY2Vzc1Jlc3VsdHM6IGZ1bmN0aW9uIChkYXRhLCBwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMucGFnZSA9IHBhcmFtcy5wYWdlIHx8IDE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogJC5tYXAoZGF0YS5saXN0LCBmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGZpbHRlci5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWx0ZXIuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcmU6IChwYXJhbXMucGFnZSAqIDMwKSA8IGRhdGEudG90YWxDb3VudAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvL3NlbGVjdCBhZHZhbmNlZCBmaWx0ZXIgYmFzZWQgb24gY3VycmVudCB2aWV3CiAgICAgICAgaWYgKCQoJyNhZHZhbmNlZEZpbHRlclZpZXcnKS52YWwoKSkgewogICAgICAgICAgICB2YXIgYWR2YW5jZWRGaWx0ZXJWaWV3ID0gJC5wYXJzZUpTT04oJCgnI2FkdmFuY2VkRmlsdGVyVmlldycpLnZhbCgpKTsKICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oYWR2YW5jZWRGaWx0ZXJWaWV3Lm5hbWUsIGFkdmFuY2VkRmlsdGVyVmlldy5pZCwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICQoIi5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24iKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICB9CgogICAgICAgICQoJyNhZGRBZHZhbmNlZEZpbHRlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2lnbmFsLmFkdmFuY2VkRmlsdGVyLmluaXRpYWxpemVBZHZhbmNlZEZpbHRlcnMoJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwnKSk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNzZWxlY3RPcGVyYXRvcicpLmVtcHR5KCkuYXBwZW5kKCc8b3B0aW9uIHNlbGVjdGVkPSJzZWxlY3RlZCIgdmFsdWU9IiI+U2VsZWN0IE9wZXJhdG9yPC9vcHRpb24+Jyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNuYW1lJykudmFsKCcnKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2Rlc2NyaXB0aW9uJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3F1ZXJ5SlNPTicpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNhbGVydFR5cGUnKS52YWwoJycpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjYWR2YW5jZWRGaWx0ZXJTaGFyZWRXaXRoJykuZW1wdHkoKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2J1aWxkZXJBbGwnKS5maW5kKCcuZXhwcmVzc2lvbicpLnJlbW92ZSgpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZGVsZXRlQWR2RmlsdGVyJykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgLmRlbGV0ZUFkdkZpbHRlcicpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjYWRkRXhwcmVzc2lvbicpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZmlsdGVyc1dpdGhvdXRTYXZpbmcnKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuc2F2ZUFkdmFuY2VkRmlsdGVycycpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpLm1vZGFsKCdzaG93Jyk7CgogICAgICAgIH0pOwoKICAgICAgICAkKCcjZWRpdEFkdmFuY2VkRmlsdGVyJykudW5iaW5kKCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgYWR2YW5jZWRGaWx0ZXJJZCA9ICQoJy5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24nKS52YWwoKTsKICAgICAgICAgICAgaWYgKGFkdmFuY2VkRmlsdGVySWQpIHsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBmZXRjaEFkdmFuY2VkRmlsdGVySW5mb1VybCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7J2FkdmFuY2VkRmlsdGVyLmlkJzogYWR2YW5jZWRGaWx0ZXJJZH0sCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc0Rpc2FibGVkID0gKHJlc3VsdC5pc0ZpbHRlclVwZGF0ZUFsbG93ZWQgPT0gdHJ1ZSkgPyBmYWxzZSA6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3NlbGVjdE9wZXJhdG9yJykuZW1wdHkoKS5hcHBlbmQoJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iIj5TZWxlY3QgT3BlcmF0b3I8L29wdGlvbj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI25hbWUnKS52YWwocmVzdWx0Lm5hbWUpLmF0dHIoImRpc2FibGVkIiwgaXNEaXNhYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNuYW1lJykudmFsKHJlc3VsdC5uYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2Rlc2NyaXB0aW9uJykudmFsKHJlc3VsdC5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNxdWVyeUpTT04nKS52YWwocmVzdWx0LkpTT05RdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNhbGVydFR5cGUnKS52YWwoYWxlcnRUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2ZpbHRlcklkJykudmFsKGFkdmFuY2VkRmlsdGVySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjc2hhcmVBZHZGaWx0ZXJJZCcpLmh0bWwocmVzdWx0LnNoYXJlV2l0aEVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZmlsdGVyc1dpdGhvdXRTYXZpbmcnKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZGVsZXRlQWR2RmlsdGVyJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2FkZEV4cHJlc3Npb24nKS5hdHRyKCJkaXNhYmxlZCIsIGlzRGlzYWJsZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZGVsZXRlQWR2RmlsdGVyJykuYXR0cigiZGlzYWJsZWQiLCBpc0Rpc2FibGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgLnNhdmVBZHZhbmNlZEZpbHRlcnMnKS5hdHRyKCJkaXNhYmxlZCIsIGlzRGlzYWJsZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAubW9kYWwtdGl0bGUnKS5odG1sKCJFZGl0IEZpbHRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWR2YW5jZWRGaWx0ZXIuaW5pdGlhbGl6ZUFkdmFuY2VkRmlsdGVycygpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLm9uKCJjaGFuZ2UiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgb3BlbkFsZXJ0Q29tbWVudE1vZGFsOiBvcGVuQWxlcnRDb21tZW50TW9kYWwsCiAgICAgICAgb3BlbkNhc2VIaXN0b3J5TW9kYWw6IG9wZW5DYXNlSGlzdG9yeU1vZGFsLAogICAgICAgIHJlc3RhcnRSZXZpZXc6IHJlc3RhcnRSZXZpZXcsCiAgICAgICAgb3BlblNpbWlsYXJDYXNlc01vZGFsOiBvcGVuU2ltaWxhckNhc2VzTW9kYWwsCiAgICAgICAgYXBwbHlCdXNpbmVzc1J1bGVzOiBhcHBseUJ1c2luZXNzUnVsZXMsCiAgICAgICAgc2hvd0F0dGFjaG1lbnRNb2RhbDogb3BlbkF0dGFjaG1lbnRNb2RhbCwKICAgICAgICBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzOiBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzLAogICAgICAgIGVuYWJsZU1lbnVUb29sdGlwczogZW5hYmxlTWVudVRvb2x0aXBzLAogICAgICAgIGRpc2FibGVUb29sdGlwczogZGlzYWJsZVRvb2x0aXBzLAogICAgICAgIHNvcnRJY29uSGFuZGxlcjogc29ydEljb25IYW5kbGVyLAogICAgICAgIGlzQWxlcnRQZXJzaXN0ZWRJblNlc3Npb25TdG9yYWdlOiBpc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZSwKICAgICAgICByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlOiByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlLAogICAgICAgIG9wZW5TYXZlVmlld01vZGFsOiBvcGVuU2F2ZVZpZXdNb2RhbCwKICAgICAgICBjcmVhdGVTb3J0aW5nTWFwOiBjcmVhdGVTb3J0aW5nTWFwLAogICAgICAgIGNyZWF0ZUZpbHRlck1hcDogY3JlYXRlRmlsdGVyTWFwLAogICAgICAgIGNyZWF0ZUxpc3RPZkluZGV4OiBjcmVhdGVMaXN0T2ZJbmRleCwKICAgICAgICBvcGVuQWxlcnRUYWdNb2RhbDogb3BlbkFsZXJ0VGFnTW9kYWwsCiAgICAgICAgc2V0U29ydE9yZGVyOiBzZXRTb3J0T3JkZXIsCiAgICAgICAgb3BlblNpbmdsZUFsZXJ0VGFnTW9kYWw6IG9wZW5TaW5nbGVBbGVydFRhZ01vZGFsLAogICAgICAgIGdlbmVyYXRlVmlld0luZm86IGdlbmVyYXRlVmlld0luZm8sCiAgICAgICAgcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdDogcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdAogICAgfQoKfSkoKTsKCmZ1bmN0aW9uIHNob3dFcnJvck1lc3NhZ2VJbk1vZGFsKCRtb2RhbCwgdGV4dCkgewogICAgY2xlYXJfZXJyb3JzKCk7CiAgICBpZiAodGV4dCkgewogICAgICAgIHRleHQgPSB0ZXh0OwogICAgfSBlbHNlIHsKICAgICAgICB0ZXh0ID0gJ1BsZWFzZSBmaWxsICB0aGUgcmVxdWlyZWQgRmllbGRzJzsKICAgIH0KICAgIHZhciBhbGVydEh0bWwgPSBnZXRFcnJvck1lc3NhZ2VIdG1sKHRleHQpOwogICAgJG1vZGFsLmZpbmQoJy5tb2RhbC1ib2R5JykucHJlcGVuZChhbGVydEh0bWwpOwp9CgpmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2VIdG1sKG1zZykgewogICAgdmFyIGFsZXJ0SHRtbCA9ICc8ZGl2IGNsYXNzPSJhbGVydCBhbGVydC1kYW5nZXIgYWxlcnQtZGlzbWlzc2libGUiIHJvbGU9ImFsZXJ0Ij4gJyArCiAgICAgICAgJzxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0iYWxlcnQiPiAnICsKICAgICAgICAnPHNwYW4gYXJpYS1oaWRkZW49InRydWUiPiZ0aW1lczs8L3NwYW4+ICcgKwogICAgICAgICc8c3BhbiBjbGFzcz0ic3Itb25seSI+PGc6bWVzc2FnZSBjb2RlPSJkZWZhdWx0LmJ1dHRvbi5jbG9zZS5sYWJlbCIgLz48L3NwYW4+ICcgKwogICAgICAgICc8L2J1dHRvbj4gJyArIG1zZzsKICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGFsZXJ0SHRtbDsKfQoKdmFyIGNsZWFyX2Vycm9ycyA9IGZ1bmN0aW9uICgpIHsKICAgICQoJy5tb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKTsKfTsKCmZ1bmN0aW9uIHNlYXJjaChuYW1lS2V5LCBteUFycmF5KSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG15QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobXlBcnJheVtpXS5uYW1lID09PSBuYW1lS2V5KSB7CiAgICAgICAgICAgIHJldHVybiBteUFycmF5W2ldOwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwsIHRvcGljT2JqKSB7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnZhbCh0b3BpY09iai5zdGFydERhdGUpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKHRvcGljT2JqLmVuZERhdGUpOwogICAgJG1vZGFsLmZpbmQoJy5wcm9kdWN0LXNwYW4nKS50ZXh0KGdldFByb2R1Y3ROYW1lTGlzdChKU09OLnBhcnNlKHRvcGljT2JqLnByb2R1Y3RzKSkpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS5hdHRyKCJkaXNhYmxlZCIsICIiKTsKICAgICRtb2RhbC5maW5kKCcjZW5kRGF0ZScpLmF0dHIoImRpc2FibGVkIiwgIiIpOwogICAgaWYgKHRvcGljT2JqLnByb2R1Y3RzKSB7CiAgICAgICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykuYXR0cigiZGlzYWJsZWQiLCAiIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGRlcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwpIHsKICAgIHZhciBwcm9kdWN0SnNvbiA9ICRtb2RhbC5maW5kKCcucHJvZHVjdC1qc29uLWNvbnRhaW5lcicpLnZhbCgpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS52YWwoIiIpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKCIiKTsKICAgICRtb2RhbC5maW5kKCcjcHJvZHVjdCcpLnZhbCgiIik7CiAgICAkbW9kYWwuZmluZCgnLnByb2R1Y3Qtc3BhbicpLnRleHQoZ2V0UHJvZHVjdE5hbWVMaXN0KEpTT04ucGFyc2UocHJvZHVjdEpzb24pKSk7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAkbW9kYWwuZmluZCgnI2VuZERhdGUnKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVQcm9kdWN0SnNvbihwcm9kdWN0SWQsIHByb2R1Y3ROYW1lLCBsZXZlbCkgewogICAgdmFyIHRvcGljUHJvZHVjdFZhbHVlcyA9IHsiMSI6IFtdLCAiMiI6IFtdLCAiMyI6IFtdLCAiNCI6IFtdLCAiNSI6IFtdfTsKICAgIHRvcGljUHJvZHVjdFZhbHVlc1tsZXZlbF0ucHVzaCh7bmFtZTogcHJvZHVjdE5hbWUsIGlkOiBwcm9kdWN0SWR9KTsKICAgIHJldHVybiB0b3BpY1Byb2R1Y3RWYWx1ZXM7Cn0KCmZ1bmN0aW9uIGdldFByb2R1Y3ROYW1lTGlzdChvYmopIHsKICAgIHZhciBwcm9kdWN0QXJyYXkgPSBbXTsKICAgIHZhciBvYmpBcnJheSA9IG9ialsnMyddOwogICAgJC5lYWNoKG9iakFycmF5LCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgcHJvZHVjdEFycmF5LnB1c2godmFsdWUubmFtZSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9kdWN0QXJyYXkuam9pbignLCcpOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0SnNvbihhcHBsaWNhdGlvbk5hbWUsIHJvdykgewogICAgdmFyIHByb2R1Y3RKc29uOwogICAgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PSAiQWQtSG9jIEFsZXJ0IikgewogICAgICAgIGlmIChyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpCiAgICAgICAgICAgIHByb2R1Y3RKc29uID0gSlNPTi5wYXJzZShyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJwcm9kdWN0TmFtZSJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgIHZhciBwcm9kdWN0SWQgPSByb3cuZmluZCgnLnJvdy1wcm9kdWN0LWlkJykudmFsKCk7CiAgICAgICAgdmFyIGxldmVsID0gcm93LmZpbmQoJy5yb3ctbGV2ZWwtaWQnKS52YWwoKTsKICAgICAgICBpZiAoIWxldmVsKSB7CiAgICAgICAgICAgIGxldmVsID0gMzsKICAgICAgICB9CiAgICAgICAgcHJvZHVjdEpzb24gPSBnZW5lcmF0ZVByb2R1Y3RKc29uKHByb2R1Y3RJZCwgcHJvZHVjdE5hbWUsIGxldmVsKTsKICAgIH0KICAgIHJldHVybiBwcm9kdWN0SnNvbjsKfQoKZnVuY3Rpb24gYXBwbHlTZWxlY3QyRm9yVGFncygkc2VsZWN0b3IsIHVybCwgcGxhY2VIb2xkZXJUZXh0LCBpc0Nhc2VTZXJpZXNUYWcpIHsKICAgICRzZWxlY3Rvci5zZWxlY3QyKHsKICAgICAgICBtaW5pbXVtSW5wdXRMZW5ndGg6IDAsCiAgICAgICAgbXVsdGlwbGU6IHRydWUsCiAgICAgICAgdGFnczogdHJ1ZSwKICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2VIb2xkZXJUZXh0LAogICAgICAgIGFsbG93Q2xlYXI6IHRydWUsCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBjcmVhdGVUYWc6IGZ1bmN0aW9uICh0YWcpIHsKCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBvcHRpb24gaXMgYWxyZWFkeSB0aGVyZQogICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAkc2VsZWN0b3IuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoJC50cmltKHRhZy50ZXJtKS50b1VwcGVyQ2FzZSgpID09PSAkLnRyaW0oJCh0aGlzKS50ZXh0KCkpLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICBwcmV2VGFnID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gaWYgaXQncyBub3QgdGhlcmUsIHRoZW4gc2hvdyB0aGUgc3VnZ2VzdGlvbgogICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0odGFnLnRlcm0pLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbSh0YWcudGVybSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0ocHJldlRhZy50ZXh0KCkpLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbShwcmV2VGFnLnRleHQoKSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFqYXg6IHsKICAgICAgICAgICAgcXVpZXRNaWxsaXM6IDI1MCwKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdGVybTogcGFyYW1zLnRlcm0sCiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFyYW1zLnBhZ2UgfHwgMSwKICAgICAgICAgICAgICAgICAgICBtYXg6IDMwLAogICAgICAgICAgICAgICAgICAgIGxhbmc6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgaXNDYXNlU2VyaWVzVGFnOiBpc0Nhc2VTZXJpZXNUYWcKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByb2Nlc3NSZXN1bHRzOiBmdW5jdGlvbiAoZGF0YSwgcGFyYW1zKSB7CiAgICAgICAgICAgICAgICBwYXJhbXMucGFnZSA9IHBhcmFtcy5wYWdlIHx8IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IGRhdGEubGlzdCwKICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vcmU6IChwYXJhbXMucGFnZSAqIDMwKSA8IGRhdGEudG90YWxDb3VudAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gc2hvd0NvbW1lbnRJY29uKGN1cnJlbnRSb3cpIHsKICAgIHZhciAkYnRuR3JvdXAgPSAkKGN1cnJlbnRSb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuZHJvcGRvd24tdG9nZ2xlJykuYWZ0ZXIoJzxpIGNsYXNzPSJtZGkgbWRpLWNoYXQgYmx1ZS0yIGZvbnQtMTMgcG9zLWFiIGNvbW1lbnQiIHRpdGxlPSInICsgJC5pMThuLl8oJ2NvbW1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nKTsKICAgIH0KfQoKZnVuY3Rpb24gcmVtb3ZlQ29tbWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLm5leHQoJ2knKS5yZW1vdmUoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlQXR0YWNobWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICBpZiAoJCgkYnRuR3JvdXApLmZpbmQoJy5jb21tZW50JykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgJCgkYnRuR3JvdXApLmZpbmQoJy5kcm9wZG93bi10b2dnbGUnKS5uZXh0KCdpJykucmVtb3ZlKCk7CiAgICB9IGVsc2UgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLm5leHQoJ2knKS5yZW1vdmUoKTsKICAgIH0KfQoKZnVuY3Rpb24gc2hvd0F0dGFjaG1lbnRJY29uKHRyUm93KSB7CiAgICB2YXIgJGJ0bkdyb3VwID0gJCh0clJvdykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuYXR0YWNoJykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0KICAgIH0KfQoKdmFyIGlzU2FmZXR5TGVhZEFsbG93ZWQgPSBmdW5jdGlvbiAobGlzdFByb2R1Y3RJZHMsIHNlbGVjdGVkUHJvZHVjdElkKSB7CiAgICByZXR1cm4gbGlzdFByb2R1Y3RJZHMuaW5kZXhPZihzZWxlY3RlZFByb2R1Y3RJZCkgIT09IC0xCn07Cgp2YXIgc2V0Q29sdW1uU2VxID0gZnVuY3Rpb24gKG1hcFNlcSkgewogICAgY29sdW1uU2VxID0gbWFwU2VxCn0KCnZhciB1cGRhdGVFeGlzdGluZ1ZpZXcgPSBmdW5jdGlvbih2aWV3SW5mbyl7CiAgICB2YXIgcmVxdWVzdCA9IG5ldyBPYmplY3QoKQogICAgdmFyIHNoYXJlZFdpdGhEYXRhID0gJCgnI3ZpZXdTaGFyZWRXaXRoRWRpdCcpLnZhbCgpID8gSlNPTi5zdHJpbmdpZnkoJCgnI3ZpZXdTaGFyZWRXaXRoRWRpdCcpLnZhbCgpKSA6IG51bGw7CiAgICByZXF1ZXN0WyduYW1lJ10gPSAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKTsKICAgIHJlcXVlc3RbJ2ZpbHRlck1hcCddID0gSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKTsKICAgIHJlcXVlc3RbJ2NvbHVtbkxpc3QnXSA9IHZpZXdJbmZvLm5vdFZpc2libGVDb2x1bW4udG9TdHJpbmcoKTsKICAgIHJlcXVlc3RbJ2FsZXJ0VHlwZSddID0gYXBwbGljYXRpb25OYW1lOwogICAgcmVxdWVzdFsnaWQnXSA9ICQoJy52aWV3U2VsZWN0JykudmFsKCk7CiAgICByZXF1ZXN0Wydzb3J0aW5nJ10gPSBKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pOwogICAgcmVxdWVzdFsnYWR2YW5jZWRGaWx0ZXInXSA9IHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyOwogICAgcmVxdWVzdFsndmlld1NoYXJlZFdpdGgnXSA9IHNoYXJlZFdpdGhEYXRhOwogICAgcmVxdWVzdFsnZGVmYXVsdFZpZXcnXSA9ICgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkuaW5kZXhPZigiKGRlZmF1bHQpIikgIT0gLTEpCiAgICAkLmFqYXgoewogICAgICAgIHVybDogdXBkYXRlVmlld1VybCwKICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgZGF0YTogcmVxdWVzdCwKICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgIHZhciBwYWdlVVJMID0gJChsb2NhdGlvbikuYXR0cigiaHJlZiIpOwogICAgICAgICAgICBpZiAocGFnZVVSTC5pbmRleE9mKCJ2aWV3SWQiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcGFnZVVSTC5zbGljZSgwLCBwYWdlVVJMLmluZGV4T2YoInZpZXdJZCIpICsgNykgKyBkYXRhLnZpZXdJZAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigiIyIpICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZVVSTCA9IHBhZ2VVUkwuc2xpY2UoMCwgcGFnZVVSTC5pbmRleE9mKCIjIikpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBwYWdlVVJMICsgIiZ2aWV3SWQ9IiArIGRhdGEudmlld0lkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoZGF0YS5lcnJvck1lc3NhZ2UgIT0gJycpewogICAgICAgICAgICAgICAgc2hvd0Vycm9yTm90aWZpY2F0aW9uKGRhdGEuZXJyb3JNZXNzYWdlLCAxMDAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KQp9Cgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKc2lnbmFsLmFyY2hpdmVkX3V0aWxzID0gKGZ1bmN0aW9uICgpIHsKICAgIHZhciBhcmNoaXZlZF90YWJsZTsKICAgIHZhciBzb3J0aW5nQ291bnQgPSAxOwoKICAgIHZhciBpbml0X2FyY2hpdmVkX3RhYmxlID0gZnVuY3Rpb24gKHRhYmxlLCB1cmwsIGFwcFR5cGUsIGFsZXJ0RGV0YWlsVXJsKSB7CiAgICAgICAgaWYgKCEkLmZuLmRhdGFUYWJsZS5pc0RhdGFUYWJsZSh0YWJsZSkpIHsKICAgICAgICAgICAgYXJjaGl2ZWRfdGFibGUgPSAkKHRhYmxlKS5EYXRhVGFibGUoewogICAgICAgICAgICAgICAgInNQYWdpbmF0aW9uVHlwZSI6ICJib290c3RyYXAiLAoKICAgICAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpewogICAgICAgICAgICAgICAgICAgIGNvbEVsbGlwc2lzKCk7CiAgICAgICAgICAgICAgICAgICAgd2ViVWlQb3BJbml0KCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6IHVybCwKICAgICAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImFhU29ydGluZyI6IFtbc29ydGluZ0NvdW50LCAiZGVzYyJdXSwKICAgICAgICAgICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDEwLAogICAgICAgICAgICAgICAgImJBdXRvV2lkdGgiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJhb0NvbHVtbnMiOiBjcmVhdGVfYXJjaGl2ZWRfY29sdW1uX2RhdGEoYXBwVHlwZSwgYWxlcnREZXRhaWxVcmwpLAogICAgICAgICAgICAgICAgInNjcm9sbFgiOiB0cnVlLAogICAgICAgICAgICAgICAgInNjcm9sbFkiOiJjYWxjKDEwMHZoIC0gMjk2cHgpIiwKICAgICAgICAgICAgICAgICJhdXRvV2lkdGgiOiB0cnVlLAogICAgICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICAgICAicmVuZGVyIjogJC5mbi5kYXRhVGFibGUucmVuZGVyLnRleHQoKQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBhcmNoaXZlZF90YWJsZTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBnZW5BbGVydE5hbWVMaW5rID0gZnVuY3Rpb24gKHZhbHVlLCBpZCwgYWxlcnREZXRhaWxVcmwpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgKyAoYWxlcnREZXRhaWxVcmwgKyAnPycgKyAnY2FsbGluZ1NjcmVlbj1yZXZpZXcmYXJjaGl2ZWQ9dHJ1ZSYnICsKICAgICAgICAgICAgICAgIHNpZ25hbC51dGlscy5jb21wb3NlUGFyYW1zKHtjb25maWdJZDogaWR9KSkgKyAnIiArIHRhcmdldD0iX2JsYW5rIj4nICsgdmFsdWUgKyAnPC9hPicKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBjcmVhdGVfYXJjaGl2ZWRfY29sdW1uX2RhdGEgPSBmdW5jdGlvbiAoYXBwVHlwZSwgYWxlcnREZXRhaWxVcmwpIHsKCiAgICAgICAgdmFyIGFvQ29sdW1uczsKICAgICAgICBpZihhcHBUeXBlID09IEFMRVJUX0NPTkZJR19UWVBFLkxJVEVSQVRVUkVfU0VBUkNIX0FMRVJUKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucyA9IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnROYW1lIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdlbkFsZXJ0TmFtZUxpbmsoZXNjYXBlSFRNTChyb3cuYWxlcnROYW1lKSwgcm93LmV4Q29uZmlnSWQsIGFsZXJ0RGV0YWlsVXJsKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIGZ1bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRhdGVSYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgZnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgICAgIH0sICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAic2VsZWN0ZWREYXRhc291cmNlIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xNTAgY2VsbC1icmVhaycKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibGFzdE1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFvQ29sdW1ucyA9IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnROYW1lIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdlbkFsZXJ0TmFtZUxpbmsoZXNjYXBlSFRNTChyb3cuYWxlcnROYW1lKSwgcm93LmV4Q29uZmlnSWQsIGFsZXJ0RGV0YWlsVXJsKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInZlcnNpb24iLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIGZ1bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcm9kdWN0IiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbEVsZW1lbnQgPSAnPGRpdiBjbGFzcz0iY29sLWNvbnRhaW5lciI+PGRpdiBjbGFzcz0iY29sLWhlaWdodCI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSByb3cucHJvZHVjdDsKICAgICAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInICsgcm93LnByb2R1Y3QgKyAnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xFbGVtZW50CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1taW4tMTUwIGNlbGwtYnJlYWsnCiAgICAgICAgICAgICAgICB9LHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIGZ1bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFkZEVsbGlwc2lzKGRhdGEpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICAgICAgfSwgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY2FzZUNvdW50IiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJyZXZpZXdlZENhc2VzIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGF0ZVJhbmdlIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibGFzdE1vZGlmaWVkIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYW9Db2x1bW5zCiAgICB9OwoKICAgIHZhciByZWxvYWRfYXJjaGl2ZWRfdGFibGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhcmNoaXZlZF90YWJsZSAhPSAidW5kZWZpbmVkIiAmJiBhcmNoaXZlZF90YWJsZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGFyY2hpdmVkX3RhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIlVuYWJsZSB0byByZWxvYWQgdGhlIGFyY2hpdmVkIHRhYmxlLiBQbGVhc2UgcmVmcmVzaCB0aGUgcGFnZS4iKTsKICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgaW5pdF9hcmNoaXZlZF90YWJsZTogaW5pdF9hcmNoaXZlZF90YWJsZSwKICAgICAgICByZWxvYWRfYXJjaGl2ZWRfdGFibGU6IHJlbG9hZF9hcmNoaXZlZF90YWJsZQogICAgfQp9KSgpOwp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9Owp2YXIgZXhpc3RpbmdSb3dzID0gW107CgpzaWduYWwuY29tbW9uVGFnID0gKGZ1bmN0aW9uICgpIHsKICAgIHZhciBvcGVuQ29tbW9uQWxlcnRUYWdNb2RhbCA9IGZ1bmN0aW9uIChtb2R1bGUsIGRvbWFpbiwgdGFncykgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZWRpdEFsZXJ0VGFncycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIHZhciByb3dPYmplY3QgPSB0YWJsZS5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIHZhciBhbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICB2YXIgY29tbW9uVGFnTW9kYWxPYmogPSAkKCcjY29tbW9uVGFnTW9kYWwnKTsKICAgICAgICAgICAgZmlsbEFsZXJ0VGFncyhjb21tb25UYWdNb2RhbE9iaiwgZmlsbENvbW1vblRhZ1VybCwgbW9kdWxlLCBkb21haW4sIHRhZ3MsIGFsZXJ0SWQpOwogICAgICAgICAgICBjb21tb25UYWdNb2RhbE9iai5tb2RhbCgnc2hvdycpOwogICAgICAgIH0pOwogICAgfTsKICAgIHJldHVybiB7CiAgICAgICAgb3BlbkNvbW1vbkFsZXJ0VGFnTW9kYWw6IG9wZW5Db21tb25BbGVydFRhZ01vZGFsCiAgICB9Cn0pKCk7Cgp2YXIgZmlsbEFsZXJ0VGFncyA9IGZ1bmN0aW9uICh0YWdNb2RhbCwgZmlsbENvbW1vblRhZ1VybCwgbW9kdWxlLCBkb21haW4sIHRhZ3MsIGFsZXJ0SWQpIHsKICAgIHZhciBkYXRhVXJsID0gZmlsbENvbW1vblRhZ1VybCArICIvIittb2R1bGUrIj9kb21haW49Iitkb21haW4gKyAiJmFsZXJ0SWQ9IithbGVydElkICsgJyZpc0FyY2hpdmVkPScgKyBpc0FyY2hpdmVkOwogICAgY2F0ZWdvcnlNb2RhbFRhYmxlID0gJCgiI2NhdGVnb3J5TW9kYWxUYWJsZSIpLkRhdGFUYWJsZSh7CiAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgfSwKICAgICAgICAiY3JlYXRlZFJvdyI6IGZ1bmN0aW9uICggcm93LCBkYXRhLCBpbmRleCApIHsKICAgICAgICAgICAgdmFyIHRhZ3NFbmFibGVkID0gbm9uQ29uZmlndXJlZEVuYWJsZWQgIT0gInRydWUiID8gZmFsc2UgOiB0cnVlOwogICAgICAgICAgICB2YXIgY2F0ZWdvcmllcyA9IFtdOwogICAgICAgICAgICB0YWdzLmZvckVhY2goZnVuY3Rpb24gKG1hcCkgewogICAgICAgICAgICAgICAgaWYobWFwLnBhcmVudElkID09MCB8fCBtYXAucGFyZW50SWQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMucHVzaCh7aWQ6IG1hcC5pZCwgdGV4dDogbWFwLnRleHR9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQoJ3NlbGVjdCcsIHJvdykuZXEoMCkuc2VsZWN0Mih7CiAgICAgICAgICAgICAgICB0YWdzOiB0YWdzRW5hYmxlZCwKICAgICAgICAgICAgICAgIGRhdGE6IGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogIlNlbGVjdCBDYXRlZ29yeSIKICAgICAgICAgICAgfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uKG9iaikgewoKICAgICAgICAgICAgICAgIHZhciBzdWJ0YWdzRW5hYmxlZCA9IG5vbkNvbmZpZ3VyZWRFbmFibGVkICE9ICJ0cnVlIiA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciBzdWJjYXRlZ29yaWVzID0gW107CiAgICAgICAgICAgICAgICB0YWdzLmZvckVhY2goZnVuY3Rpb24gKG1hcCkgewogICAgICAgICAgICAgICAgICAgIGlmKG1hcC5wYXJlbnRJZCA9PSBvYmouY3VycmVudFRhcmdldC52YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJjYXRlZ29yaWVzLnB1c2goe2lkOiBtYXAuaWQsIHRleHQ6IG1hcC50ZXh0fSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYoZGF0YS5hY3Rpb24gPT0gMSkgewogICAgICAgICAgICAgICAgICAgICQoJ3NlbGVjdCcsIHJvdykuZXEoMSkuZW1wdHkoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBpZiBubyBzdWJjYXRlZ29yeSBjb25maWd1cmUgdGhlbiBjYW4gbm90IGFkZCBvbiBmbHkgc3ViY2F0ZWdvcnkKICAgICAgICAgICAgICAgIGlmKHN1YmNhdGVnb3JpZXMubGVuZ3RoIDw9IDApewogICAgICAgICAgICAgICAgICAgIHN1YnRhZ3NFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBzdWJ0YWdzRW5hYmxlZCA9IChzdWJ0YWdzRW5hYmxlZCAmJiB0cnVlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkKCdzZWxlY3QnLCByb3cpLmVxKDEpLnNlbGVjdDIoewogICAgICAgICAgICAgICAgICAgIHRhZ3M6IHN1YnRhZ3NFbmFibGVkLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHN1YmNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICJTZWxlY3QgU3ViIENhdGVnb3J5IgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAkKCdzZWxlY3QnLCByb3cpLmVxKDEpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgc2V0U2VsZWN0V2lkdGgoJCh0aGlzKSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYoZGF0YS5hY3Rpb24gIT0gMSkgewogICAgICAgICAgICAgICAgJCgnaW5wdXQnLCByb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgiOmlucHV0IikuYXR0cignZGlzYWJsZWQnLCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmKGRhdGEuc3ViY2F0ZWdvcnkubGVuZ3RoIDw9IDApCiAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXQnLCByb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgiOmlucHV0W2NsYXNzPXNlbGVjdDItc2VhcmNoX19maWVsZF0iKS5hdHRyKCJwbGFjZWhvbGRlciIsICIiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJCgiLmVkaXQtcm93Iiwgcm93KS51bmJpbmQoKS5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyIGlzRGlzYWJsZWQgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuZmluZCgiOmlucHV0Om5vdCg6Zmlyc3QpIikuYXR0cignZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndHInKS5maW5kKCI6aW5wdXQ6bm90KDpmaXJzdCkiKS5hdHRyKCdkaXNhYmxlZCcsICFpc0Rpc2FibGVkKTsKICAgICAgICAgICAgICAgIGlmKGlzRGlzYWJsZWQgJiYgZGF0YS5zdWJjYXRlZ29yeS5sZW5ndGggPD0gMCkKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuZmluZCgiOmlucHV0W2NsYXNzPXNlbGVjdDItc2VhcmNoX19maWVsZF0iKS5hdHRyKCJwbGFjZWhvbGRlciIsICJTZWxlY3QgU3ViIENhdGVnb3J5Iik7CiAgICAgICAgICAgICAgICBlbHNlIGlmKGlzRGlzYWJsZWQgJiYgZGF0YS5zdWJjYXRlZ29yeS5sZW5ndGggPiAwKQogICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndHInKS5maW5kKCI6aW5wdXRbY2xhc3M9c2VsZWN0Mi1zZWFyY2hfX2ZpZWxkXSIpLmF0dHIoInBsYWNlaG9sZGVyIiwgIiIpOwogICAgICAgICAgICAgICAgZWxzZSBpZighaXNEaXNhYmxlZCAmJiBkYXRhLnN1YmNhdGVnb3J5Lmxlbmd0aCA8PSAwKQogICAgICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndHInKS5maW5kKCI6aW5wdXRbY2xhc3M9c2VsZWN0Mi1zZWFyY2hfX2ZpZWxkXSIpLmF0dHIoInBsYWNlaG9sZGVyIiwgIiIpOwoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkKCIuZGVsZXRlLXJvdyIsIHJvdykudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGNhdGVnb3J5TW9kYWxUYWJsZQogICAgICAgICAgICAgICAgICAgIC5yb3coICQodGhpcykucGFyZW50cygndHInKSApCiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZSgpCiAgICAgICAgICAgICAgICAgICAgLmRyYXcoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkKCIudXAtcm93Iiwgcm93KS51bmJpbmQoKS5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgY29uc3QgJHJvdyA9ICQodGhpcykucGFyZW50cygndHInKTsKICAgICAgICAgICAgICAgIGlmICgkcm93LmluZGV4KCkgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkcm93LnByZXYoKS5iZWZvcmUoJHJvdy5nZXQoMCkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICQoIi5kb3duLXJvdyIsIHJvdykudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGNvbnN0ICRyb3cgPSAkKHRoaXMpLnBhcmVudHMoJ3RyJyk7CiAgICAgICAgICAgICAgICAkcm93Lm5leHQoKS5hZnRlcigkcm93LmdldCgwKSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9LAogICAgICAgIGRyYXdDYWxsYmFjazogZnVuY3Rpb24gKHNldHRpbmdzKSB7CiAgICAgICAgICAgIHNldFNlbGVjdFdpZHRoKCQoIi5keW5hbWljU2VsZWN0RmllbGRTdWJDYXRlZ29yeSIpKTsKICAgICAgICB9LAogICAgICAgIHJvd0NhbGxiYWNrOiBmdW5jdGlvbiggcm93LCBkYXRhLCBpbmRleCApIHsKICAgICAgICAgICAgaWYgKGRhdGFbJ3ByaXZhdGUnXSA9PSB0cnVlICYmIGRhdGFbJ3ByaXZhdGVBY2Nlc3MnXSAhPSB0cnVlKSB7CiAgICAgICAgICAgICAgICAkKHJvdykuaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBpbml0Q29tcGxldGU6IGZ1bmN0aW9uKHNldHRpbmdzLCBqc29uKXsKICAgICAgICAgICAgZXhpc3RpbmdSb3dzID0gW107CiAgICAgICAgICAgIGNhdGVnb3J5TW9kYWxUYWJsZS5yb3dzKCkuZXZlcnkoZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5kYXRhKCk7CiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFJvdyA9IHtjYXRlZ29yeTogdmFsdWUuY2F0ZWdvcnksIHN1YmNhdGVnb3J5OiB2YWx1ZS5zdWJjYXRlZ29yeSwgYWxlcnQ6IHZhbHVlLmFsZXJ0LCBwcml2YXRlOiB2YWx1ZS5wcml2YXRlLAogICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRCeTogdmFsdWUuY3JlYXRlZEJ5LCBjcmVhdGVkRGF0ZTogdmFsdWUuY3JlYXRlZERhdGUsIHByaW9yaXR5OiB2YWx1ZS5wcmlvcml0eSwgdXBkYXRlZERhdGVJbml0OiB2YWx1ZS51cGRhdGVkRGF0ZUluaXQsCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEJ5SW5pdDogdmFsdWUudXBkYXRlZEJ5SW5pdCwgY3JlYXRlZERhdGVJbml0OiB2YWx1ZS5jcmVhdGVkRGF0ZUluaXQsCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEJ5SW5pdDogdmFsdWUuY3JlYXRlZEJ5SW5pdH07CiAgICAgICAgICAgICAgICBpZihjdXJyZW50Um93LmNhdGVnb3J5LmlkICE9IDApCiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdSb3dzLnB1c2goY3VycmVudFJvdyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICJ1cmwiOiBkYXRhVXJsLAogICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgfSwKICAgICAgICBzZWFyY2hpbmc6IHRydWUsCiAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICJwYWdpbmciOiAgIGZhbHNlLAogICAgICAgICJvcmRlcmluZyI6IGZhbHNlLAogICAgICAgICJzZWFyY2hpbmciOiBmYWxzZSwKICAgICAgICAiaW5mbyI6IGZhbHNlLAogICAgICAgICJiRGVzdHJveSI6IHRydWUsCiAgICAgICAgc3RhdGVTYXZlOiB0cnVlLAogICAgICAgICJzY3JvbGxZIjogICAgICAgICIzNTBweCIsCiAgICAgICAgInNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY2F0ZWdvcnkiLAogICAgICAgICAgICAgICAgIndpZHRoIjogIjI1JSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2R0LWNlbnRlcicsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9ICc8c2VsZWN0IG5hbWU9InNlbGVjdEZpZWxkIiBpZD0iZHluYW1pY1NlbGVjdEZpZWxkQ2F0ZWdvcnkiIGNsYXNzPSJkeW5hbWljU2VsZWN0RmllbGRDYXRlZ29yeSBmb3JtLWNvbnRyb2wiPic7CiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8b3B0aW9uIHNlbGVjdGVkPSJzZWxlY3RlZCIgdmFsdWU9IicgKyBkYXRhLmlkICsgJyI+JyArIGRhdGEubmFtZSArICc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8L3NlbGVjdD4nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBodG1sOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3ViY2F0ZWdvcnkiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdC1jZW50ZXInLAogICAgICAgICAgICAgICAgIndpZHRoIjogIjM1JSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPHNlbGVjdCBuYW1lPSJzZWxlY3RGaWVsZCIgaWQ9ImR5bmFtaWNTZWxlY3RGaWVsZFN1YkNhdGVnb3J5IiBtdWx0aXBsZT0ibXVsdGlwbGUiIGNsYXNzPSJkeW5hbWljU2VsZWN0RmllbGRTdWJDYXRlZ29yeSBmb3JtLWNvbnRyb2wiPic7CiAgICAgICAgICAgICAgICAgICAgcm93LnN1YmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9ICc8b3B0aW9uIHNlbGVjdGVkPSJzZWxlY3RlZCIgdmFsdWU9Iicrb2JqLmlkKyciPicrb2JqLm5hbWUrJzwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPC9zZWxlY3Q+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaHRtbAoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImFsZXJ0IiwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAianVzdGlmaWNhdGlvbi1jZWxsIGRhdGFUYWJsZUNvbHVtbkNlbnRlciB0ZXh0LWNlbnRlciIsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiMTUlIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjaGVja2VkID0gcm93LmFsZXJ0ID09IHRydWUgPyAiY2hlY2tlZCI6ICIiOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjbGFzcz0iYWxlcnQtY2hlY2stYm94IiAnICsgY2hlY2tlZCArJyBkYXRhLWlkPScgKyByb3cuYWxlcnQgKyAnIC8+JzsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcml2YXRlIiwKICAgICAgICAgICAgICAgICJ3aWR0aCI6ICIxMiUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSByb3cucHJpdmF0ZSA9PSB0cnVlID8gImNoZWNrZWQiOiAiIjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2xhc3M9InByaXZhdGUtY2hlY2stYm94IiAnICsgY2hlY2tlZCAgKycgZGF0YS1pZD0nICsgcm93LnByaXZhdGUgKyAnIC8+JzsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2R0LWNlbnRlciBkYXRhVGFibGVDb2x1bW5DZW50ZXIgdGV4dC1jZW50ZXInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhY3Rpb24iLAogICAgICAgICAgICAgICAgIndpZHRoIjogIjEzJSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogInRkLWFjdGlvbiIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICBpZihkYXRhID09PSAxKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8aSBjbGFzcz0iZmEgZmEtdHJhc2gtbyBkZWxldGUtcm93IHRhZy1hY3Rpb24gYmx1ZS0xIj48L2k+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGV0YWlscyA9ICc8Yj5DcmVhdGVkIEJ5OjwvYj4gJytyb3cuY3JlYXRlZEJ5ICsnPGhyLz4gPGI+Q3JlYXRlZCBEYXRlOjwvYj4gJytyb3cuY3JlYXRlZERhdGUgKyc8aHIvPiA8Yj5MYXN0IE1vZGlmaWVkIEJ5OjwvYj4gJytyb3cudXBkYXRlZEJ5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICArJzxoci8+IDxiPkxhc3QgTW9kaWZpZWQgRGF0ZTo8L2I+ICcrcm93LnVwZGF0ZWREYXRlOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxpIGlkPSJ0YWctcG9wdXAiIGNsYXNzPSJmYSBmYS1pbmZvIHBvcG92ZXJNZXNzYWdlIHRhZy1hY3Rpb24gYmx1ZS0xIiB0aXRsZT0iRGV0YWlscyIgZGF0YS1jb250ZW50PSInICsgZGV0YWlscyArICciPjwvaT4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxpIGNsYXNzPSJmYSBmYS1wZW5jaWwgZWRpdC1yb3cgdGFnLWFjdGlvbiBibHVlLTEiID48L2k+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8aSBjbGFzcz0iZmEgZmEtdHJhc2gtbyBkZWxldGUtcm93IHRhZy1hY3Rpb24gYmx1ZS0xIj48L2k+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAicmVuZGVyIjogJC5mbi5kYXRhVGFibGUucmVuZGVyLnRleHQoKQogICAgICAgIH1dCiAgICB9KTsKICAgICQoICIjY2F0ZWdvcnlNb2RhbFRhYmxlIiApLnNvcnRhYmxlKHsKICAgICAgICBpdGVtczogJ3RyOm5vdCg6Zmlyc3QpJywKICAgICAgICBvcGFjaXR5OiAwLjYsCiAgICAgICAgc2Nyb2xsU3BlZWQ6IDQwLAogICAgICAgIGNhbmNlbDogInRoZWFkIiwKICAgICAgICBjb250YWlubWVudCA6ICJwYXJlbnQiCiAgICB9KTsKCiAgICBpZihwcml2YXRlRW5hYmxlZCAhPSAidHJ1ZSIpIHsKICAgICAgICBjYXRlZ29yeU1vZGFsVGFibGUuY29sdW1uKDMpLnZpc2libGUoZmFsc2UpOwogICAgfWVsc2V7CiAgICAgICAgY2F0ZWdvcnlNb2RhbFRhYmxlLmNvbHVtbigzKS52aXNpYmxlKHRydWUpOwogICAgfQogICAgJCgnI2NhdGVnb3J5TW9kYWxUYWJsZScpLm9uKCdtb3VzZW92ZXInLCAndHInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnLnBvcG92ZXJNZXNzYWdlJykucG9wb3Zlcih7CiAgICAgICAgICAgIHBsYWNlbWVudDogJ2xlZnQnLAogICAgICAgICAgICB0cmlnZ2VyOiAnaG92ZXIgZm9jdXMnLAogICAgICAgICAgICB2aWV3cG9ydDogJ2JvZHknLAogICAgICAgICAgICBodG1sOiB0cnVlCiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAkKCIjYWRkLXJvdyIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbGFzdFJvdyA9IGNhdGVnb3J5TW9kYWxUYWJsZS5yb3coJzpsYXN0JykuZGF0YSgpOwogICAgICAgIHZhciBsYXN0Um93Q2F0ZWdvcnkgPSAkKCcjY2F0ZWdvcnlNb2RhbFRhYmxlQm9keSB0cjpsYXN0JykuZmluZCgidGQgc2VsZWN0LmR5bmFtaWNTZWxlY3RGaWVsZENhdGVnb3J5IikudmFsKCk7CiAgICAgICAgaWYobGFzdFJvd0NhdGVnb3J5ICE9IDApIHsKICAgICAgICAgICAgY2F0ZWdvcnlNb2RhbFRhYmxlLnJvdy5hZGQoewogICAgICAgICAgICAgICAgImNhdGVnb3J5Ijoge2lkOiAwLCBuYW1lOiAiU2VsZWN0IENhdGVnb3J5In0sCiAgICAgICAgICAgICAgICAic3ViY2F0ZWdvcnkiOiBbXSwKICAgICAgICAgICAgICAgICJhbGVydCI6IGZhbHNlLAogICAgICAgICAgICAgICAgInByaXZhdGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJhY3Rpb24iOiAxLAogICAgICAgICAgICAgICAgInByaW9yaXR5IjogOTk5OSwKICAgICAgICAgICAgICAgICJuZXciOiB0cnVlCiAgICAgICAgICAgIH0pLmRyYXcoZmFsc2UpOwogICAgICAgICAgICB2YXIgJHNjcm9sbEJvZHkgPSAkKGNhdGVnb3J5TW9kYWxUYWJsZS50YWJsZSgpLm5vZGUoKSkucGFyZW50KCk7CiAgICAgICAgICAgICRzY3JvbGxCb2R5LnNjcm9sbFRvcCgkc2Nyb2xsQm9keS5nZXQoMCkuc2Nyb2xsSGVpZ2h0KTsKICAgICAgICB9CiAgICAgICAgJCgnI2NhdGVnb3J5TW9kYWxUYWJsZUJvZHkgdHI6bGFzdCBzZWxlY3QnKS5lcSgwKS5mb2N1cygpOwogICAgfSk7CgogICAgJCgiLmFkZFRhZ3MiKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG5ld1Jvd3MgPSBbXTsKICAgICAgICB2YXIgY291bnQgPSAxOwogICAgICAgICQoJyNjYXRlZ29yeU1vZGFsVGFibGVCb2R5IHRyJykuZWFjaChmdW5jdGlvbigpewogICAgICAgICAgICB2YXIgdGggPSAkKHRoaXMpOwogICAgICAgICAgICB2YXIgY2F0ZWdvcnlJZCA9ICQodGgpLmZpbmQoInRkIHNlbGVjdC5keW5hbWljU2VsZWN0RmllbGRDYXRlZ29yeSIpLnZhbCgpOwogICAgICAgICAgICB2YXIgY2F0ZWdvcnlUZXh0ID0gJCh0aCkuZmluZCgidGQgc2VsZWN0LmR5bmFtaWNTZWxlY3RGaWVsZENhdGVnb3J5IG9wdGlvbjpzZWxlY3RlZCIpLnRleHQoKTsKICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0ge2lkOiBjYXRlZ29yeUlkLCBuYW1lOiBjYXRlZ29yeVRleHR9OwogICAgICAgICAgICB2YXIgc3ViY2F0ZWdvcmllcyA9IFtdOwogICAgICAgICAgICAkKHRoKS5maW5kKCJ0ZCBzZWxlY3QuZHluYW1pY1NlbGVjdEZpZWxkU3ViQ2F0ZWdvcnkgb3B0aW9uOnNlbGVjdGVkIikuZWFjaChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgc3ViY2F0ZWdvcmllcy5wdXNoKHtpZDogJCh0aGlzKS52YWwoKSwgbmFtZTokKHRoaXMpLnRleHQoKX0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGFsZXJ0ID0gJCh0aCkuZmluZCgidGQgaW5wdXQuYWxlcnQtY2hlY2stYm94IikuaXMoIjpjaGVja2VkIik7CiAgICAgICAgICAgIHZhciBwcml2YXRlID0gJCh0aCkuZmluZCgidGQgaW5wdXQucHJpdmF0ZS1jaGVjay1ib3giKS5pcygiOmNoZWNrZWQiKTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3cgPSB7Y2F0ZWdvcnk6IGNhdGVnb3J5LCBzdWJjYXRlZ29yeTogc3ViY2F0ZWdvcmllcywgYWxlcnQ6IGFsZXJ0LCBwcml2YXRlOiBwcml2YXRlLCBwcmlvcml0eTogY291bnR9OwogICAgICAgICAgICBpZihjdXJyZW50Um93LmNhdGVnb3J5Lm5hbWUgIT0gJ1NlbGVjdCBDYXRlZ29yeScgJiYgY3VycmVudFJvdy5jYXRlZ29yeS5uYW1lICE9ICcnKSB7CiAgICAgICAgICAgICAgICBuZXdSb3dzLnB1c2goY3VycmVudFJvdyk7CiAgICAgICAgICAgICAgICBjb3VudCA9IGNvdW50ICsgMTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZGF0YSA9IHsKICAgICAgICAgICAgbmV3Um93czogSlNPTi5zdHJpbmdpZnkobmV3Um93cyksCiAgICAgICAgICAgIGV4aXN0aW5nUm93czogSlNPTi5zdHJpbmdpZnkoZXhpc3RpbmdSb3dzKSwKICAgICAgICAgICAgYWxlcnRJZDogYWxlcnRJZCwKICAgICAgICAgICAgdHlwZTogZG9tYWluLAogICAgICAgICAgICBpc0FyY2hpdmVkOiBpc0FyY2hpdmVkCiAgICAgICAgfTsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6IHNhdmVDb21tb25UYWdzVXJsLAogICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgIGFzeW5jOmZhbHNlLAogICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkYXRhKSwKICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JywKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIHRhYmxlLmFqYXgucmVsb2FkKCkKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gY2F0ZWdvcnlNb2RhbFRhYmxlCn07CgoKCgovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9jb21tb24uanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfYWxlcnRfdXRpbHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfbGlzdF91dGlscy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2FjdGl2aXR5L2FjdGl2aXRpZXMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9hY3Rpb25zL2FjdGlvbnMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy91c2Vycy91c2Vycy5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9oYW5kbGViYXJfZXh0LmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvYWxlcnRDb21tZW50cy9hbGVydENvbW1lbnRzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvYWxlcnRzX3Jldmlldy9hbGVydF9yZXZpZXcuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9hbGVydHNfcmV2aWV3L2FyY2hpdmVkQWxlcnRzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uX3RhZy5qcwoKdmFyIHVzZXJMb2NhbGUgPSAiZW4iOwp2YXIgYXBwbGljYXRpb25OYW1lID0gZW5jb2RlVG9IVE1MKCJTaW5nbGUgQ2FzZSBBbGVydCIpOwp2YXIgYXBwbGljYXRpb25MYWJlbCA9IGVuY29kZVRvSFRNTCgiUXVhbGl0YXRpdmUgQWxlcnQiKTsKdmFyIHRhYmxlOwp2YXIgZXhlY3V0ZWRJZExpc3QgPSBbXTsKdmFyIHRhZ3NPYmogPSB7CiAgICBhZGRlZENhc2VTZXJpZXNUYWdzOiBbXSwKICAgIGFkZGVkR2xvYmFsVGFnczogW10sCiAgICBkZWxldGVkQ2FzZVNlcmllc1RhZ3M6IFtdLAogICAgZGVsZXRlZEdsb2JhbFRhZ3M6IFtdCn07CnZhciB0YWdzID0gW107Cgp2YXIgaXNEeW5hbWljRmlsdGVyQXBwbGllZCA9IGZhbHNlOwp2YXIgZGlyID0gJyc7CnZhciBpbmRleCA9IC0xOwp2YXIgZGV0YWlsc1BhcmFtZXRlcnMgPSB7fTsKCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgIHZhciBjdXN0b21GaWVsZHNFbmFibGVkID0gSlNPTi5wYXJzZSgkKCIjY3VzdG9tRmllbGRzRW5hYmxlZCIpLnZhbCgpKTsKCiAgICAkKCdhW2hyZWY9IiNkZXRhaWxzIl0nKS5vbigic2hvd24uYnMudGFiIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCkuY29sdW1ucy5hZGp1c3QoKTsKICAgICAgICBhZGRHcmlkU2hvcnRjdXRzKCcjYWxlcnRzRGV0YWlsc1RhYmxlJyk7CiAgICAgICAgcmVtb3ZlR3JpZFNob3J0Y3V0cygnI2FjdGl2aXRpZXNUYWJsZScpOwogICAgfSk7CgogICAgJCgnYVtocmVmPSIjYXJjaGl2ZWRBbGVydHMiXScpLm9uKCJzaG93bi5icy50YWIiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICQoJyNhcmNoaXZlZEFsZXJ0c1RhYmxlJykuRGF0YVRhYmxlKCkuY29sdW1ucy5hZGp1c3QoKTsKICAgICAgICBhZGRHcmlkU2hvcnRjdXRzKCcjYXJjaGl2ZWRBbGVydHNUYWJsZScpOwogICAgICAgIHJlbW92ZUdyaWRTaG9ydGN1dHMoJyNhY3Rpdml0aWVzVGFibGUnKTsKICAgICAgICByZW1vdmVHcmlkU2hvcnRjdXRzKCcjYWxlcnRzRGV0YWlsc1RhYmxlJyk7CiAgICB9KTsKCiAgICB2YXIgYWN0aXZpdGllc190YWJsZTsKICAgICQoJyNhY3Rpdml0eV90YWInKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGFjdGl2aXRpZXNfdGFibGUgPT0gbnVsbCB8fCBhY3Rpdml0aWVzX3RhYmxlID09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAoY2FsbGluZ1NjcmVlbiA9PSBDQUxMSU5HX1NDUkVFTi5SRVZJRVcpIHsKICAgICAgICAgICAgICAgIGFjdGl2aXRpZXNfdGFibGUgPSBzaWduYWwuYWN0aXZpdGllc191dGlscy5pbml0X2FjdGl2aXRpZXNfdGFibGUoJCgiI2FjdGl2aXRpZXNUYWJsZSIpLAogICAgICAgICAgICAgICAgICAgICcvc2lnbmFsL2FjdGl2aXR5L2xpc3RCeUV4ZUNvbmZpZz8nICsgJ2V4ZWN1dGVkSWRMaXN0PScgKyBleGVjdXRlZElkTGlzdCArICImYXBwVHlwZT0iICsgYXBwbGljYXRpb25OYW1lLCBhcHBsaWNhdGlvbk5hbWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWN0aXZpdGllc190YWJsZSA9IHNpZ25hbC5hY3Rpdml0aWVzX3V0aWxzLmluaXRfYWN0aXZpdGllc190YWJsZSgkKCIjYWN0aXZpdGllc1RhYmxlIiksCiAgICAgICAgICAgICAgICAgICAgJy9zaWduYWwvYWN0aXZpdHkvbGlzdEFjdGl2aXRpZXM/JyArICJhcHBUeXBlPSIgKyBhcHBsaWNhdGlvbk5hbWUsIGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKCiAgICAkKCdhW2hyZWY9IiNhcmNoaXZlZEFsZXJ0cyJdJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLlJFVklFVykgewogICAgICAgICAgICBhcmNoaXZlZF90YWJsZSA9IHNpZ25hbC5hcmNoaXZlZF91dGlscy5pbml0X2FyY2hpdmVkX3RhYmxlKCIjYXJjaGl2ZWRBbGVydHNUYWJsZSIsIGFyY2hpdmVkQWxlcnRVcmwsIGFwcGxpY2F0aW9uTmFtZSwgc2luZ2xlQ2FzZURldGFpbHNVcmwpOwogICAgICAgIH0KICAgIH0pOwoKICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLlJFVklFVyB8fCBjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLkRBU0hCT0FSRCkgewogICAgICAgICQod2luZG93KS5vbignYmVmb3JldW5sb2FkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiBkaXNjYXJkVGVtcENoYW5nZXNVcmwsCiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnCiAgICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICB9CgogICAgLy9iYWNrIGJ1dHRvbiB0YWcgc2NyZWVuCiAgICBpZiAoY2FsbGluZ1NjcmVlbiAhPSBDQUxMSU5HX1NDUkVFTi5UQUdTKSB7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgiYmFja191cmwiLCB3aW5kb3cubG9jYXRpb24uaHJlZikKICAgIH0KICAgICQoJy50YWctc2NyZWVuLWJhY2stYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnYmFja191cmwnKQogICAgfSk7CgogICAgdmFyIGZpeGVkQ29sdW1ucyA9IDY7CiAgICB2YXIgZmlsdGVySW5kZXggPSBbOCwgOSwgMTAsIDExLCAxMiwgMTQsIDE2XTsKICAgIGlmKGN1c3RvbUZpZWxkc0VuYWJsZWQpewogICAgICAgIGZpbHRlckluZGV4LnB1c2guYXBwbHkoZmlsdGVySW5kZXgsIFsyOSwgMzAsIDMxLCAzMiwgMzMsIDM0LCAzNSwgMzZdKQogICAgfQogICAgdmFyIGxpc3RPZkluZGV4ID0gWzEzLCAxNCwgMjEsIDIyLCAyMywgMjUsIDI2LCAyNywgMjgsIDI5LCAzMCwgMzEsIDMyXTsKICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLkRBU0hCT0FSRCkgewogICAgICAgIGZpeGVkQ29sdW1ucyA9IDc7CiAgICAgICAgZmlsdGVySW5kZXggPSBbOSwgMTAsIDExLCAxMiwgMTMsIDE1LCAxN107CiAgICAgICAgaWYoY3VzdG9tRmllbGRzRW5hYmxlZCl7CiAgICAgICAgICAgIGZpbHRlckluZGV4LnB1c2guYXBwbHkoZmlsdGVySW5kZXgsIFszMCwgMzEsIDMyLCAzMywgMzQsIDM1LCAzNiwgMzddKQogICAgICAgIH0KICAgIH0KICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLlRSSUdHRVJFRF9BTEVSVFMpIHsKICAgICAgICBmaXhlZENvbHVtbnMgPSA2OwogICAgICAgIGZpbHRlckluZGV4ID0gWzQsIDgsIDksIDEwLCAxMSwgMTQsIDE1LCAxN107CiAgICAgICAgbGlzdE9mSW5kZXggPSBbMTMsIDE0LCAyMSwgMjIsIDIzLCAyNSwgMjYsIDI3LCAyOCwgMjksIDMwLCAzMSwgMzJdOwogICAgICAgIGlmKGN1c3RvbUZpZWxkc0VuYWJsZWQpewogICAgICAgICAgICBmaWx0ZXJJbmRleC5wdXNoLmFwcGx5KGZpbHRlckluZGV4LCBbMjksIDMwLCAzMSwgMzIsIDMzLCAzNCwgMzUsIDM2XSkKICAgICAgICB9CiAgICB9CiAgICBpZiAoJCgiI2lzRmFlcnMiKS52YWwoKSA9PSAidHJ1ZSIpIHsKICAgICAgICBmaXhlZENvbHVtbnMgPSAzOwogICAgICAgIGZpbHRlckluZGV4ID0gWzUsIDYsIDcsIDgsIDksIDEwLCAxMV07CiAgICAgICAgaWYoY3VzdG9tRmllbGRzRW5hYmxlZCl7CiAgICAgICAgICAgIGZpbHRlckluZGV4LnB1c2guYXBwbHkoZmlsdGVySW5kZXgsIFsyMywgMjQsIDI1LCAyNiwgMjcsIDI4LCAyOSwgMzBdKQogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoJCgiI2lzQ2FzZVNlcmllcyIpLnZhbCgpID09ICJ0cnVlIikgewogICAgICAgIGZpeGVkQ29sdW1ucyA9IDY7CiAgICAgICAgZmlsdGVySW5kZXggPSBbNywgOCwgOSwgMTAsIDExLCAxMywgMTVdOwogICAgICAgIGlmIChjdXN0b21GaWVsZHNFbmFibGVkKSB7CiAgICAgICAgICAgIGZpbHRlckluZGV4LnB1c2guYXBwbHkoZmlsdGVySW5kZXgsIFsyOCwgMjksIDMwLCAzMSwgMzIsIDMzLCAzNCwgMzVdKQogICAgICAgIH0KICAgIH0KICAgIHZhciBhbGVydERldGFpbHNUYWJsZTsKCiAgICB2YXIgY2hlY2tlZElkTGlzdCA9IFtdOwogICAgdmFyIGNoZWNrZWRSb3dMaXN0ID0gW107CgogICAgc2lnbmFsLmFsZXJ0UmV2aWV3Lm9wZW5BbGVydENvbW1lbnRNb2RhbCgiU2luZ2xlIENhc2UgQWxlcnQiLCBhcHBsaWNhdGlvbk5hbWUsIGFwcGxpY2F0aW9uTGFiZWwsIGNoZWNrZWRJZExpc3QsIGNoZWNrZWRSb3dMaXN0KTsKICAgIHNpZ25hbC5hbGVydFJldmlldy5zaG93QXR0YWNobWVudE1vZGFsKCk7CiAgICBzaWduYWwuYWxlcnRSZXZpZXcucG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdChhcHBsaWNhdGlvbk5hbWUpOwogICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnNldFNvcnRPcmRlcigpOwogICAgc2lnbmFsLmxpc3RfdXRpbHMuZmxhZ19oYW5kbGVyKCJzaW5nbGVDYXNlQWxlcnQiLCAidG9nZ2xlRmxhZyIpOwogICAgLy9UaGUgY2FzZSBoaXN0b3J5IG1vZGFsLgogICAgc2lnbmFsLmFsZXJ0UmV2aWV3Lm9wZW5DYXNlSGlzdG9yeU1vZGFsKCk7CiAgICAvL1RoZSByZXN0YXJ0IGNhc2UgcmV2aWV3LgogICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnJlc3RhcnRSZXZpZXcoY2FzZVJldmlld1ByZXZpb3VzVXJsKTsKICAgIC8vVGhlIHNpbWlsYXIgY2FzZXMgbW9kYWwuCiAgICBzaWduYWwuYWxlcnRSZXZpZXcub3BlblNpbWlsYXJDYXNlc01vZGFsKGNhc2VJbmZvVXJsKTsKCiAgICAvL2FwcGx5IHRoZSBmaWx0ZXIgdmFsdWVzIHRvIGNvbHVtbnMgYmFzZWQgb24gc2F2ZWQgdmlldwogICAgdmFyIGZpbHRlclZhbHVlID0gc2lnbmFsLmFsZXJ0UmV2aWV3LmNyZWF0ZUZpbHRlck1hcCgnc2NhX2ZpbHRlck1hcF8nICsgZXhlY3V0ZWRDb25maWdJZCwgJ3NjYV92aWV3TmFtZV8nICsgZXhlY3V0ZWRDb25maWdJZCk7CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNhZGRDYXNlJywgZnVuY3Rpb24gKCkgewogICAgICAgIGluaXRfYWRkX2Nhc2VfbW9kYWwoKQogICAgfSk7CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5idWxrRGlzcG9zaXRpb24nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2Rpc3Bvc2l0aW9uU2lnbmFsUG9wb3ZlcicpLm1vZGFsKCdzaG93Jyk7CiAgICB9KTsKCiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnI2FkZENhc2VCdXR0b24nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgYWRkX2Nhc2VfdG9fbGlzdCgpCiAgICB9KTsKCiAgICAvL2FwcGx5IHRoZSBzb3J0aW5nIHRvIGNvbHVtbiBiYXNlZCBvbiBzYXZlZCB2aWV3CiAgICB2YXIgc29ydGluZ01hcCA9IHNpZ25hbC5hbGVydFJldmlldy5jcmVhdGVTb3J0aW5nTWFwKCdzY2Ffc29ydGVkQ29sdW1uXycgKyBleGVjdXRlZENvbmZpZ0lkLCAnc2NhX3ZpZXdOYW1lXycgKyBleGVjdXRlZENvbmZpZ0lkKTsKICAgIGlmIChzb3J0aW5nTWFwICE9ICd1bmRlZmluZWQnICYmIHNvcnRpbmdNYXAubGVuZ3RoID4gMCkgewogICAgICAgIGluZGV4ID0gc29ydGluZ01hcFswXVswXTsKICAgICAgICBkaXIgPSBzb3J0aW5nTWFwWzBdWzFdCiAgICB9CgogICAgdmFyIGdldEFsZXJ0VHlwZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsKICAgICAgICBpZih1cmxQYXJhbXMuZ2V0KCdpc0ZhZXJzJykgIT0gbnVsbCAmJiB1cmxQYXJhbXMuZ2V0KCdpc0ZhZXJzJykgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgIHJldHVybiBBTEVSVF9UWVBFLlNJTkdMRV9DQVNFX0FMRVJUX0ZBRVJTOwogICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGFwcGxpY2F0aW9uTmFtZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFwcGxpY2F0aW9uTmFtZTsKICAgIH07CgogICAgaWYgKGNhbGxpbmdTY3JlZW4gPT0gQ0FMTElOR19TQ1JFRU4uUkVWSUVXKSB7CiAgICAgICAgLy9zYXZpbmcgbmV3IFZpZXdJbnN0YW5jZSBtb2RhbAogICAgICAgIHZhciBhbGVydFR5cGUgPSBnZXRBbGVydFR5cGUoKTsKICAgICAgICBpZiAoJCgnI2lzQ2FzZVNlcmllcycpLnZhbCgpID09ICJ0cnVlIikgewogICAgICAgICAgICBhbGVydFR5cGUgPSBBTEVSVF9DT05GSUdfVFlQRS5TSU5HTEVfQ0FTRV9BTEVSVF9EUklMTF9ET1dOCiAgICAgICAgfQogICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5vcGVuU2F2ZVZpZXdNb2RhbChmaWx0ZXJJbmRleCwgYWxlcnRUeXBlLCB2aWV3SWQpCiAgICB9IGVsc2UgaWYgKGNhbGxpbmdTY3JlZW4gPT0gQ0FMTElOR19TQ1JFRU4uREFTSEJPQVJEKSB7CiAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3Lm9wZW5TYXZlVmlld01vZGFsKGZpbHRlckluZGV4LCBBTEVSVF9DT05GSUdfVFlQRS5TSU5HTEVfQ0FTRV9BTEVSVF9EQVNIQk9BUkQsIHZpZXdJZCkKICAgIH0KCiAgICAkKHdpbmRvdykuYmluZCgnYmVmb3JldW5sb2FkJywgZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdpc1ZpZXdDYWxsJykgPT0gJ3RydWUnIHx8ICQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpICE9ICdTeXN0ZW0gVmlldycpIHsKICAgICAgICAgICAgdmFyIGJhY2tVcmwgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdiYWNrX3VybCcpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5jbGVhcigpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdiYWNrX3VybCcsIGJhY2tVcmwpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHZpZXdJbmZvID0gc2lnbmFsLmFsZXJ0UmV2aWV3LmdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdzY2FfZmlsdGVyTWFwXycgKyBleGVjdXRlZENvbmZpZ0lkLCBKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5maWx0ZXJNYXApKTsKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnc2NhX3NvcnRlZENvbHVtbl8nICsgZXhlY3V0ZWRDb25maWdJZCwgSlNPTi5zdHJpbmdpZnkodmlld0luZm8uc29ydGVkQ29sdW1uKSk7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NjYV9ub3RWaXNpYmxlQ29sdW1uXycgKyBleGVjdXRlZENvbmZpZ0lkLCB2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnc2NhX3ZpZXdOYW1lXycgKyBleGVjdXRlZENvbmZpZ0lkLCAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSkKICAgICAgICB9CiAgICB9KTsKCiAgICAkKCcjYWxlcnQtbGlzdC1maWx0ZXItYXBwbHktYnQnKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgJCgnI2FsZXJ0LWxpc3QtZmlsdGVyJykuZmluZCgnI2ZpbHRlclVzZWQnKS52YWwodHJ1ZSk7CiAgICAgICAgdmFyIG5ld1VybCA9IGxpc3RDb25maWdVcmwgKyAiJiIgKyAkKCcjYWxlcnQtbGlzdC1maWx0ZXInKS5zZXJpYWxpemUoKSArICImej0iICsgdHJ1ZTsKICAgICAgICAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCkuYWpheC51cmwobmV3VXJsKS5sb2FkKCkKICAgIH0pOwoKICAgICQoIiNkZXRhaWwtdGFicyBhW2hyZWY9JyNkZXRhaWxzJ10iKS5vbigiY2xpY2siLCBmdW5jdGlvbiAoZSkgewogICAgICAgICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKS5jb2x1bW5zLmFkanVzdCgpOwogICAgfSk7CgogICAgZmV0Y2hUYWdzKCk7CgogICAgdmFyIGluaXRBbGVydERldGFpbHNUYWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcHJlZml4ID0gInNjYV8iOwogICAgICAgIHZhciBpc0ZpbHRlclJlcXVlc3QgPSB0cnVlOwogICAgICAgIHZhciBmaWx0ZXJBcnJheSA9IFtdOwogICAgICAgIHZhciBmaWx0ZXJWYWx1ZXMgPSBbXTsKICAgICAgICBpZiAod2luZG93LnNlc3Npb25TdG9yYWdlICYmIHNpZ25hbC5hbGVydFJldmlldy5pc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZShwcmVmaXgpKSB7CiAgICAgICAgICAgIGZpbHRlclZhbHVlcyA9IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShwcmVmaXggKyAiZmlsdGVyc192YWx1ZSIpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzaWduYWwuYWxlcnRSZXZpZXcucmVtb3ZlRmlsdGVyc0Zyb21TZXNzaW9uU3RvcmFnZShwcmVmaXgpOwogICAgICAgICAgICBpc0ZpbHRlclJlcXVlc3QgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIGFvQ29sdW1ucyA9IGNyZWF0ZV9zaW5nbGVfY2FzZV90YWJsZV9jb2x1bW5zKGNhbGxpbmdTY3JlZW4sIGN1c3RvbUZpZWxkc0VuYWJsZWQpOwogICAgICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnNldF9hY3Rpb25fbGlzdF9tb2RhbCgkKCcjYWN0aW9uLW1vZGFsJykpOwogICAgICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnNldF9hY3Rpb25fY3JlYXRlX21vZGFsKCQoJyNhY3Rpb24tY3JlYXRlLW1vZGFsJykpOwoKICAgICAgICB0YWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImJvb3RzdHJhcCIsCiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoc2V0dGluZ3MpIHsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzLmpzb24gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAkKCIjZnVsbENhc2VMaXN0IikudmFsKEpTT04uc3RyaW5naWZ5KHNldHRpbmdzLmpzb24uZnVsbENhc2VMaXN0KSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0R5bmFtaWNGaWx0ZXJBcHBsaWVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzRHluYW1pY0ZpbHRlckFwcGxpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWxlcnRSZXZpZXcuYmluZEdyaWREeW5hbWljRmlsdGVycyhzZXR0aW5ncy5qc29uLmZpbHRlcnMsIHByZWZpeCwgc2V0dGluZ3MuanNvbi5jb25maWdJZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGFnRWxsaXBzaXMoKTsKICAgICAgICAgICAgICAgIGNvbEVsbGlwc2lzKCk7CiAgICAgICAgICAgICAgICB3ZWJVaVBvcEluaXQoKTsKICAgICAgICAgICAgICAgIGNsb3NlUG9wdXBPblNjcm9sbCgpOwogICAgICAgICAgICAgICAgZW50ZXJLZXlBbGVydERldGFpbCgpOwogICAgICAgICAgICAgICAgaWYgKGlzQ2FzZURldGFpbFZpZXcgPT0gInRydWUiKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd0Nhc2VEZXRhaWxzVmlldygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnNvcnRJY29uSGFuZGxlcigpOwogICAgICAgICAgICAgICAgaWYgKGZpbHRlclZhbHVlLmxlbmd0aCA9PT0gMCAmJiAhJCh0YWJsZS50YWJsZSgpLmJvZHkoKSkuaGFzQ2xhc3MoJ2RldGFpbHNUYWJsZUJvZHknKSkgewogICAgICAgICAgICAgICAgICAgICQodGFibGUudGFibGUoKS5ib2R5KCkpLmFkZENsYXNzKCdkZXRhaWxzVGFibGVCb2R5Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkKCdbZGF0YS10b2dnbGU9InRvb2x0aXAiXScpLnRvb2x0aXAoeyB0cmlnZ2VyOiAiaG92ZXIiIH0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiBjcmVhdGVBbGVydExpc3RVcmwoaXNGaWx0ZXJSZXF1ZXN0LCBmaWx0ZXJWYWx1ZXMpLAogICAgICAgICAgICAgICAgInR5cGUiOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICJhYURhdGEiLAogICAgICAgICAgICAgICAgImNhY2hlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZGF0YSI6IGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuc29ydCA9IGQuY29sdW1uc1tpbmRleF0uZGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgZC5kaXJlY3Rpb24gPSBkaXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkKCcjYWR2YW5jZWQtZmlsdGVyJykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5hZHZhbmNlZEZpbHRlcklkID0gJCgnI2FkdmFuY2VkLWZpbHRlcicpLnZhbCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgkKCcjcXVlcnlKU09OJykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5xdWVyeUpTT04gPSAkKCcjcXVlcnlKU09OJykudmFsKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZC5jYWxsaW5nU2NyZWVuID0gY2FsbGluZ1NjcmVlbjsKICAgICAgICAgICAgICAgICAgICBkZXRhaWxzUGFyYW1ldGVycyA9IGQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGluaXRDb21wbGV0ZTogZnVuY3Rpb24gKHNldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyVmFsdWUubGVuZ3RoID09PSAwICYmICFpc0R5bmFtaWNGaWx0ZXJBcHBsaWVkKSB7CiAgICAgICAgICAgICAgICAgICAgaXNEeW5hbWljRmlsdGVyQXBwbGllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LmJpbmRHcmlkRHluYW1pY0ZpbHRlcnMoanNvbi5maWx0ZXJzLCBwcmVmaXgsIGpzb24uY29uZmlnSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJzQXJyYXkgPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiKSk7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGZpbHRlcnNBcnJheSwgZnVuY3Rpb24gKGluZGV4LCBvYmopIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2ZpbHRlcicgKyBpbmRleCkucHJvcCgiY2hlY2tlZCIsIG9iaiA9PSB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5lbmFibGVNZW51VG9vbHRpcHMoKTsKICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5kaXNhYmxlVG9vbHRpcHMoKTsKICAgICAgICAgICAgICAgIGFkZEdyaWRTaG9ydGN1dHMoJyNhbGVydHNEZXRhaWxzVGFibGUnKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiY2FjaGUiOiB0cnVlLAogICAgICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAogICAgICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAogICAgICAgICAgICAiY29sUmVvcmRlciI6IHsKICAgICAgICAgICAgICAgICJyZWFsdGltZSI6IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJvTGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAic1Byb2Nlc3NpbmciOiAnPGRpdiBjbGFzcz0iZ3JpZC1sb2FkaW5nIj48aW1nIHNyYz0iL3NpZ25hbC9hc3NldHMvc3Bpbm5lci5naWYiIHdpZHRoPSIzMCIgYWxpZ249Im1pZGRsZSIgLz48L2Rpdj4nLAogICAgICAgICAgICAgICAgInNaZXJvUmVjb3JkcyI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFMZW5ndGhNZW51IjogW1s1MCwgMTAwLCAyMDAsIDUwMF0sIFs1MCwgMTAwLCAyMDAsIDUwMF1dLAogICAgICAgICAgICAicGFnaW5hdGlvbiI6IHRydWUsCiAgICAgICAgICAgICJpVG90YWxEaXNwbGF5UmVjb3JkcyI6ICI1MCIsCiAgICAgICAgICAgICJhb0NvbHVtbnMiOiBhb0NvbHVtbnMsCiAgICAgICAgICAgICJyZXNwb25zaXZlIjogdHJ1ZSwKICAgICAgICAgICAgImRlZmVyTG9hZGluZyI6IGZpbHRlclZhbHVlLmxlbmd0aCA+IDAgPyAwIDogbnVsbCwKICAgICAgICAgICAgInNjcm9sbFgiOiB0cnVlLAogICAgICAgICAgICAicm93Q2FsbGJhY2siOiBmdW5jdGlvbiAocm93LCBkYXRhLCBpbmRleCkgewogICAgICAgICAgICAgICAgJChyb3cpLmFkZENsYXNzKCJkYXRhLXRhYmxlLXJvdyIpOwogICAgICAgICAgICAgICAgc2lnbmFsLnVzZXJfZ3JvdXBfdXRpbHMuYmluZF9hc3NpZ25Ub190b19ncmlkX3JvdygkKHJvdyksIHNlYXJjaFVzZXJHcm91cExpc3RVcmwsIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBkYXRhLmFzc2lnbmVkVG9Vc2VyLmZ1bGxOYW1lLAogICAgICAgICAgICAgICAgICAgIGlkOiBkYXRhLmFzc2lnbmVkVG9Vc2VyLmlkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgICAgICB9KTsKCiAgICAgICAgc2lnbmFsLnVzZXJfZ3JvdXBfdXRpbHMuYmluZF9hc3NpZ25Ub19zZWxlY3Rpb24oYXNzaWduVG9Hcm91cFVybCwgdGFibGUpOwogICAgICAgIGluaXRfZmlsdGVyKHRhYmxlKTsKCiAgICAgICAgcmV0dXJuIHRhYmxlCiAgICB9OwoKCiAgICB2YXIgaW5pdF9maWx0ZXIgPSBmdW5jdGlvbiAoZGF0YV90YWJsZSkgewoKICAgICAgICB2YXIgY3VtdWxhdGl2ZSA9ICQoIiNjdW11bGF0aXZlIikudmFsKCk7CiAgICAgICAgdmFyIGZpbHRlck9wdGlvbnMgPSBudWxsOwogICAgICAgIGlmIChjdW11bGF0aXZlID09ICJ0cnVlIikgewogICAgICAgICAgICBmaWx0ZXJPcHRpb25zID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDQsCiAgICAgICAgICAgICAgICB9LCAvL25hbWUKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA4LAogICAgICAgICAgICAgICAgfSwgLy9wcm9kdWN0TmFtZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDksCiAgICAgICAgICAgICAgICB9LCAvL3B0CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTAsCiAgICAgICAgICAgICAgICB9LCAvL2xpc3RlZAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDExLAogICAgICAgICAgICAgICAgfSwgLy9vdXRjb21lCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTQsCiAgICAgICAgICAgICAgICB9LCAvL3NpZ25hbC90b3BpYwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE1LAogICAgICAgICAgICAgICAgfSwgLy9jdXJyZW50IGRpc3Bvc2l0aW9uCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTcsCiAgICAgICAgICAgICAgICB9LCAvL2R1ZUluCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjksICAvL01lZGljYXRpb24gRXJyb3JzIFBUcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMCwgIC8vQWdlCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICBpZiAoY3VzdG9tRmllbGRzRW5hYmxlZCkgewogICAgICAgICAgICAgICAgZmlsdGVyT3B0aW9ucy5wdXNoLmFwcGx5KGZpbHRlck9wdGlvbnMsIFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMxLCAvL0Nhc2UgVHlwZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMiwgLy9Db21wbGV0ZW5lc3MgU2NvcmUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzMsIC8vUHJpbWFyeSBJTkQjCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM0LCAvL0FwcGxpY2F0aW9uIFR5cGUgJiBOdW1iZXIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzUsIC8vY29tcG91bmRpbmcgZmxhZwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNiwgIC8vU3VibWl0dGVyCiAgICAgICAgICAgICAgICAgICAgfV0pCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGNhbGxpbmdTY3JlZW4gPT0gQ0FMTElOR19TQ1JFRU4uREFTSEJPQVJEKSB7CiAgICAgICAgICAgIGZpbHRlck9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOSwKICAgICAgICAgICAgICAgIH0sIC8vcHJvZHVjdE5hbWUKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMCwKICAgICAgICAgICAgICAgIH0sIC8vcHQKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMSwKICAgICAgICAgICAgICAgIH0sIC8vbGlzdGVkbmVzcwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDEyLAogICAgICAgICAgICAgICAgfSwgLy9vdXRjb21lCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTMsCiAgICAgICAgICAgICAgICB9LCAvL3NpZ25hbCAvIHRvcGljCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTUsCiAgICAgICAgICAgICAgICB9LCAvL2N1cnJlbnQgZGlzcG9zaXRpb24KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxNywKICAgICAgICAgICAgICAgIH0sIC8vRHVlIGluYAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMwLCAgLy9NZWRpY2F0aW9uIEVycm9ycyBQVHMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzEsICAvL0FnZQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgaWYgKGN1c3RvbUZpZWxkc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbnMucHVzaC5hcHBseShmaWx0ZXJPcHRpb25zLCBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMiwgLy9DYXNlIFR5cGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzMsIC8vQ29tcGxldGVuZXNzIFNjb3JlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM0LCAvL1ByaW1hcnkgSU5EIwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNSwgLy9BcHBsaWNhdGlvbiBUeXBlICYgTnVtYmVyCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM2LCAvL2NvbXBvdW5kaW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzcsICAvL1N1Ym1pdHRlcgogICAgICAgICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgkKCIjaXNGYWVycyIpLnZhbCgpID09ICJ0cnVlIikgewogICAgICAgICAgICBmaWx0ZXJPcHRpb25zID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDUsCiAgICAgICAgICAgICAgICB9LCAvL3Byb2R1Y3ROYW1lCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogNiwKICAgICAgICAgICAgICAgIH0sIC8vcHQKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA3LAogICAgICAgICAgICAgICAgfSwgLy9saXN0ZWRuZXNzCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOCwKICAgICAgICAgICAgICAgIH0sIC8vb3V0Y29tZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDksCiAgICAgICAgICAgICAgICB9LCAvL3NpZ25hbCAvIHRvcGljCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTAsCiAgICAgICAgICAgICAgICB9LCAvL2N1cnJlbnQgZGlzcG9zaXRpb24KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMSwKICAgICAgICAgICAgICAgIH0sIC8vU3VzcCBQcm9kdWN0cwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDIzLCAgLy9NZWRpY2F0aW9uIEVycm9ycyBQVHMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjQsICAvL0FnZQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgaWYgKGN1c3RvbUZpZWxkc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbnMucHVzaC5hcHBseShmaWx0ZXJPcHRpb25zLCBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyNSwgLy9DYXNlIFR5cGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjYsIC8vQ29tcGxldGVuZXNzIFNjb3JlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDI3LCAvL1ByaW1hcnkgSU5EIwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyOCwgLy9BcHBsaWNhdGlvbiBUeXBlICYgTnVtYmVyCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDI5LCAvL2NvbXBvdW5kaW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzAsICAvL1N1Ym1pdHRlcgogICAgICAgICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgkKCcjaXNDYXNlU2VyaWVzJykudmFsKCkgPT0gInRydWUiKSB7CiAgICAgICAgICAgIGZpbHRlck9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogNywKICAgICAgICAgICAgICAgIH0sIC8vcHQKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiA4LAogICAgICAgICAgICAgICAgfSwgLy9saXN0ZWRuZXNzCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOSwKICAgICAgICAgICAgICAgIH0sIC8vb3V0Y29tZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDEwLAogICAgICAgICAgICAgICAgfSwgLy9zaWduYWwgLyB0b3BpYwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDExLAogICAgICAgICAgICAgICAgfSwgLy9jdXJyZW50IGRpc3Bvc2l0aW9uCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTMsCiAgICAgICAgICAgICAgICB9LCAvL0R1ZSBpbgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE1LAogICAgICAgICAgICAgICAgfSwgLy9TZXJpb3VzCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjgsICAvL01lZGljYXRpb24gRXJyb3JzIFBUcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAyOSwgIC8vQWdlCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICBpZiAoY3VzdG9tRmllbGRzRW5hYmxlZCkgewogICAgICAgICAgICAgICAgZmlsdGVyT3B0aW9ucy5wdXNoLmFwcGx5KGZpbHRlck9wdGlvbnMsIFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMwLCAvL0Nhc2UgVHlwZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMSwgLy9Db21wbGV0ZW5lc3MgU2NvcmUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzIsIC8vUHJpbWFyeSBJTkQjCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMzLCAvL0FwcGxpY2F0aW9uIFR5cGUgJiBOdW1iZXIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzQsIC8vY29tcG91bmRpbmcgZmxhZwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNSwgIC8vU3VibWl0dGVyCiAgICAgICAgICAgICAgICAgICAgfV0pCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaWx0ZXJPcHRpb25zID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDgsCiAgICAgICAgICAgICAgICB9LCAvL3B0CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogOSwKICAgICAgICAgICAgICAgIH0sIC8vbGlzdGVkbmVzcwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDEwLAogICAgICAgICAgICAgICAgfSwgLy9vdXRjb21lCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTEsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgIH0sIC8vc2lnbmFsIC8gdG9waWMKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMiwKICAgICAgICAgICAgICAgIH0sIC8vY3VycmVudCBkaXNwb3NpdGlvbgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE0LAogICAgICAgICAgICAgICAgfSwgLy9EdWUgaW4KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxNiwKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogJ3RleHQnLAogICAgICAgICAgICAgICAgfSwgLy9TZXJpb3VzCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMjksICAvL01lZGljYXRpb24gRXJyb3JzIFBUcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMCwgIC8vQWdlCiAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgaWYgKGN1c3RvbUZpZWxkc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGZpbHRlck9wdGlvbnMucHVzaC5hcHBseShmaWx0ZXJPcHRpb25zLCBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzMSwgLy9DYXNlIFR5cGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzIsIC8vQ29tcGxldGVuZXNzIFNjb3JlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDMzLCAvL1ByaW1hcnkgSU5EIwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAzNCwgLy9BcHBsaWNhdGlvbiBUeXBlICYgTnVtYmVyCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDM1LCAvL2NvbXBvdW5kaW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMzYsICAvL1N1Ym1pdHRlcgogICAgICAgICAgICAgICAgICAgIH1dKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHlhZGNmLmluaXQoZGF0YV90YWJsZSwgZmlsdGVyT3B0aW9ucywKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICB9KTsKICAgICAgICBpZiAoZmlsdGVyVmFsdWUubGVuZ3RoID4gMCkgewogICAgICAgICAgICB5YWRjZi5leEZpbHRlckNvbHVtbihkYXRhX3RhYmxlLCBmaWx0ZXJWYWx1ZSwgdHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJCgnLnlhZGNmLWZpbHRlci13cmFwcGVyJykuaGlkZSgpCiAgICAgICAgfQogICAgICAgIHdpbmRvdy5zY2FfZGF0YV90YWJsZSA9IHRhYmxlOwogICAgICAgIHNpZ25hbC5maWVsZE1hbmFnZW1lbnQuaW5pdCgkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCksICcjYWxlcnRzRGV0YWlsc1RhYmxlJywgZml4ZWRDb2x1bW5zKTsKICAgICAgICBzaWduYWwuY29tbW9uVGFnLm9wZW5Db21tb25BbGVydFRhZ01vZGFsKCJQVlMiLCJRdWFsaXRhdGl2ZSIsIHRhZ3MpOwogICAgICAgICQoIiN0b2dnbGUtY29sdW1uLWZpbHRlcnMiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBlbGUgPSAkKCcueWFkY2YtZmlsdGVyLXdyYXBwZXInKTsKICAgICAgICAgICAgdmFyIGlucHV0RWxlID0gJCgnLnlhZGNmLWZpbHRlcicpOwogICAgICAgICAgICBpZiAoZWxlLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICBlbGUuaGlkZSgpOwogICAgICAgICAgICAgICAgaW5wdXRFbGUudmFsKCcnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVsZS5zaG93KCk7CiAgICAgICAgICAgICAgICBpbnB1dEVsZS5maXJzdCgpLmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YV90YWJsZS5jb2x1bW5zLmFkanVzdCgpLmZpeGVkQ29sdW1ucygpLnJlbGF5b3V0KCkKICAgICAgICB9KTsKCiAgICB9OwoKICAgIHZhciBjcmVhdGVfc2luZ2xlX2Nhc2VfdGFibGVfY29sdW1ucyA9IGZ1bmN0aW9uIChjYWxsaW5nU2NyZWVuLCBjdXN0b21GaWVsZHNFbmFibGVkKSB7CgogICAgICAgIHZhciBhb0NvbHVtbnMgPSBbCgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic2VsZWN0ZWQiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCQuaW5BcnJheShyb3cuZXhlY0NvbmZpZ0lkLCBleGVjdXRlZElkTGlzdCkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZWRJZExpc3QucHVzaChyb3cuZXhlY0NvbmZpZ0lkKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxpbnB1dCBjbGFzcz0iZXhlY0NvbmZpZ0lkIiBpZD0iZXhlY0NvbmZpZ0lkIiB0eXBlPSJoaWRkZW4iIHZhbHVlPSInICsgcm93LmV4ZWNDb25maWdJZCArICciIC8+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICc8aW5wdXQgY2xhc3M9ImFsZXJ0Q29uZmlnSWQiIGlkPSJhbGVydENvbmZpZ0lkIiB0eXBlPSJoaWRkZW4iIHZhbHVlPSInICsgcm93LmFsZXJ0Q29uZmlnSWQgKyAnIiAvPicgKwogICAgICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGRhdGEtZmllbGQgPSJwcm9kdWN0RmFtaWx5IiBkYXRhLWlkPSInICsgZW5jb2RlVG9IVE1MKHJvdy5wcm9kdWN0RmFtaWx5KSArICciIHR5cGU9ImhpZGRlbiIgdmFsdWU9IicgKyBlbmNvZGVUb0hUTUwocm93LnByb2R1Y3RGYW1pbHkpICsgJyIgLz4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBkYXRhLWZpZWxkID0icHJpbWFyeUV2ZW50IiBkYXRhLWlkPSInICsgZW5jb2RlVG9IVE1MKHJvdy5wcmltYXJ5RXZlbnQpICsgJyIgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyArIGVuY29kZVRvSFRNTChyb3cucHJpbWFyeUV2ZW50KSArICciIC8+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJhbGVydC1jaGVjay1ib3ggZWRpdG9yLWFjdGl2ZSBjb3B5LXNlbGVjdCIgZGF0YS1pZD0nICsgcm93LmlkICsgJyAvPic7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiLAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkcm9wZG93biIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uQnV0dG9uID0gJzxkaXYgc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyIgY2xhc3M9ImJ0bi1ncm91cCBkcm9wZG93biBkYXRhVGFibGVIaWRlQ2VsbENvbnRlbnQiIGFsaWduPSJjZW50ZXIiPiBcCiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biIgdGFiaW5kZXg9IjAiPiBcCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Zm9udC1zaXplOiAxMjUlOyIgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tb3B0aW9uLXZlcnRpY2FsIj48L3NwYW4+PHNwYW4gY2xhc3M9InNyLW9ubHkiPlRvZ2dsZSBEcm9wZG93bjwvc3Bhbj4gXAogICAgICAgICAgICAgICAgICAgICAgICA8L2E+ICc7CgogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY29tbWVudHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8aSBjbGFzcz0ibWRpIG1kaS1jaGF0IGJsdWUtMiBmb250LTEzIHBvcy1hYiBjb21tZW50IiB0aXRsZT0iJyArICQuaTE4bi5fKCdjb21tZW50QXZhaWxhYmxlJykgKyAnIj48L2k+JzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuaXNBdHRhY2htZW50ID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+JzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiArPSAnPHVsIGNsYXNzPSJkcm9wZG93bi1tZW51IG1lbnUtY29zeSIgcm9sZT0ibWVudSI+IDxsaSByb2xlPSJwcmVzZW50YXRpb24iPjxhIGNsYXNzPSJyZXZpZXctcm93LWljb24gY2FzZS1oaXN0b3J5LWljb24iIHRhYmluZGV4PSIwIj48c3BhbiBjbGFzcz0iZmEgZmEtbGlzdCBtLXItMTAiPjwvc3Bhbj5IaXN0b3J5PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gJzxsaSByb2xlPSJwcmVzZW50YXRpb24iPjxhIGNsYXNzPSJyZXZpZXctcm93LWljb24gY29tbWVudC1pY29uICIgZGF0YS1pbmZvPSJyb3ciIHRhYmluZGV4PSIwIj48c3BhbiBjbGFzcz0iZmEgZmEtY29tbWVudCBtLXItMTAiPjwvc3Bhbj5Db21tZW50czwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8bGkgcm9sZT0icHJlc2VudGF0aW9uIj48YSBjbGFzcz0icmV2aWV3LXJvdy1pY29uIHNob3ctYXR0YWNobWVudC1pY29uIiBkYXRhLWZpZWxkPSJhdHRhY2htZW50IiBkYXRhLWlkPSInICsgcm93LmlkICsgJyIgZGF0YS1jb250cm9sbGVyPSJzaW5nbGVDYXNlQWxlcnQiIHRhYmluZGV4PSIwIj48c3BhbiBjbGFzcz0iZmEgZmEtZmlsZSBtLXItMTAiPjwvc3Bhbj5BdHRhY2htZW50PC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gJzwvdWw+PC9kaXY+JzsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbkJ1dHRvbjsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImRyb3BEb3duIgogICAgICAgICAgICB9CiAgICAgICAgXTsKICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFt7CiAgICAgICAgICAgICJtRGF0YSI6ICJiYWRnZSIsCiAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgdmFyIGZsYWdFbGVtZW50ID0gIiI7CiAgICAgICAgICAgICAgICB2YXIgZmxhZyA9IHJvdy5iYWRnZSA/IHJvdy5iYWRnZS5zcGxpdCgnLCcpIDogbnVsbDsKICAgICAgICAgICAgICAgIGlmIChmbGFnKSB7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGZsYWcsIGZ1bmN0aW9uIChpZHgsIHZhbCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsID09PSBCQURHRVMuTkVXKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnRWxlbWVudCArPSAnPGkgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tdGFnIG0tci01IiBzdHlsZT0iY29sb3I6IG9yYW5nZSI+PC9pPicKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwgPT09IEJBREdFUy5BVVRPX0ZMQUdHRUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdFbGVtZW50ICs9ICc8aSBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi10YWcgbS1yLTUiIHN0eWxlPSJjb2xvcjogZ3JlZW4iPjwvaT4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsID09PSBCQURHRVMuUEVORElOR19SRVZJRVcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdFbGVtZW50ICs9ICc8aSBjbGFzcz0iZ2x5cGhpY29uIGdseXBoaWNvbi10YWcgbS1yLTUiIHN0eWxlPSJjb2xvcjogcHVycGxlIj48L2k+JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmxhZ0VsZW1lbnQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImNsYXNzTmFtZSI6ICcnLAogICAgICAgICAgICAidmlzaWJsZSI6ICQoIiNpc0Nhc2VTZXJpZXMiKS52YWwoKSA9PSAidHJ1ZSIgPyBmYWxzZSA6IHRydWUKICAgICAgICB9CiAgICAgICAgXSk7CiAgICAgICAgaWYgKCQoIiNpc0ZhZXJzIikudmFsKCkgIT0gInRydWUiKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5wdXNoLmFwcGx5KGFvQ29sdW1ucywgW3sKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcmlvcml0eSIsCiAgICAgICAgICAgICAgICAiYVRhcmdldHMiOiBbInByaW9yaXR5Il0sCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNQcmlvcnR5Q2hhbmdlQWxsb3dlZCA9IChpc1Byb2R1Y3RTZWN1cml0eSA9PSAndHJ1ZScgJiYgYWxsb3dlZFByb2R1Y3RzQXNTYWZldHlMZWFkLmluZGV4T2Yocm93LnByb2R1Y3ROYW1lKSkgfHwgaXNQcm9kdWN0U2VjdXJpdHkgPT0gJ2ZhbHNlJzsgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMucmVuZGVyKCdwcmlvcml0eScsIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlWYWx1ZTogcm93LnByaW9yaXR5LnZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eUNsYXNzOiByb3cucHJpb3JpdHkuaWNvbkNsYXNzLAogICAgICAgICAgICAgICAgICAgICAgICBpc1ByaW9yaXR5Q2hhbmdlQWxsb3dlZDogaXNQcmlvcnR5Q2hhbmdlQWxsb3dlZAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAndGV4dC1jZW50ZXIgY29sLW1pbi0zMCBwcmlvcml0eVBhcmVudCcsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYWN0aW9ucyIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTMwIHRleHQtY2VudGVyIGFjdGlvbi1jb2wnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLmFjdGlvbnNfdXRpbHMuYnVpbGRfYWN0aW9uX3JlbmRlcihyb3cpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAid2lkdGgiOiAnMzVweCcsCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlCiAgICAgICAgICAgICAgICB9XSk7CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLkRBU0hCT0FSRCkgewogICAgICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFt7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnROYW1lIiwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xNTAgY29sLW1heC0zMDAgY2VsbC1icmVhaycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gZW5jb2RlVG9IVE1MKHJvdy5hbGVydE5hbWUpOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyArIGVuY29kZVRvSFRNTChyb3cuYWxlcnROYW1lKSArICciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xFbGVtZW50CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICB9CiAgICAgICAgYW9Db2x1bW5zLnB1c2guYXBwbHkoYW9Db2x1bW5zLCBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlTnVtYmVyIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi03NScsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaXNGYWVycyA9ICQoIiNpc0ZhZXJzIikudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmtQcmUgPSAnPGEgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJzY2FDYXNlTnVtYmVyIiBocmVmPSInICsgKGNhc2VEZXRhaWxVcmwgKyAnPycgKwogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwudXRpbHMuY29tcG9zZVBhcmFtcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlTnVtYmVyOiByb3cuY2FzZU51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb246IHJvdy5jYXNlVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbGxvd1VwTnVtYmVyOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRJZDogcm93LmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNBcmNoaXZlZDogaXNBcmNoaXZlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRmFlcnM6IGlzRmFlcnMKICAgICAgICAgICAgICAgICAgICAgICAgfSkpICsgJyI+JzsKCiAgICAgICAgICAgICAgICAgICAgdmFyIGNhc2VOdW0gPSAiPHNwYW4gZGF0YS1maWVsZCA9J2Nhc2VOdW1iZXInIGRhdGEtaWQ9JyIgKyByb3cuY2FzZU51bWJlciArICInPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAocm93LmNhc2VOdW1iZXIpICsgIjwvc3Bhbj48c3BhbiBkYXRhLWZpZWxkID0nY2FzZVZlcnNpb24nIGRhdGEtaWQ9JyIgKyByb3cuY2FzZVZlcnNpb24gKwogICAgICAgICAgICAgICAgICAgICAgICAiJz48L3NwYW4+PHNwYW4gZGF0YS1maWVsZCA9J2V4ZWNDb25maWdJZCcgZGF0YS1pZD0nIiArIHJvdy5leGVjQ29uZmlnSWQgKyAiJz48c3BhbiBkYXRhLWZpZWxkID0nYWxlcnRJZCcgZGF0YS1pZD0nIiArIHJvdy5pZCArICInPjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIHZhciBsaW5rU3VmID0gIig8c3BhbiBkYXRhLWZpZWxkID0nZm9sbG93VXBOdW1iZXInIGRhdGEtaWQ9JyIgKyByb3cuZm9sbG93VXBOdW1iZXIgKyAiJz4iICsKICAgICAgICAgICAgICAgICAgICAgICAgKChyb3cuZm9sbG93VXBOdW1iZXIgPCAxKSA/IDAgOiByb3cuZm9sbG93VXBOdW1iZXIpICsgIjwvc3Bhbj4pIjsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNGYWVycyAhPSAidHJ1ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpbmtQcmUgKyBjYXNlTnVtICsgbGlua1N1ZiArICI8L2E+IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsaW5rUHJlICsgY2FzZU51bSArICI8L2E+IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImRhdGEtdHlwZSI6ICJjYXNlTnVtYmVyIiwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnRUYWdzIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciB0YWdzRWxlbWVudCA9IHNpZ25hbC5hbGVydHNfdXRpbHMuZ2V0X3RhZ3NfZWxlbWVudChyb3cuYWxlcnRUYWdzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFnc0VsZW1lbnQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1tYXgtMzAwIHBvcy1yZWwnLAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdhbGVydFRhZ3MnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY2FzZUluaXRSZWNlaXB0RGF0ZSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkYXRhICE9IHVuZGVmaW5lZCkgPyBtb21lbnQudXRjKGRhdGEpLmZvcm1hdChERUZBVUxUX0RBVEVfRk9STUFUKSA6ICcnOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xMDAnLAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdjYXNlSW5pdFJlY2VpcHREYXRlJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInByb2R1Y3ROYW1lIiwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xMDAgY29sLW1heC0yMDAgY2VsbC1icmVhaycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGRhdGEtZmllbGQgPSdwcm9kdWN0TmFtZScgZGF0YS1pZD0nIiArIHJvdy5wcm9kdWN0TmFtZSArICInPiIgKwogICAgICAgICAgICAgICAgICAgICAgICByb3cucHJvZHVjdE5hbWUgKyAiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdwcm9kdWN0TmFtZScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwdCIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1taW4tNzUnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBkYXRhLWZpZWxkPSJtYXN0ZXJQcmVmVGVybUFsbCIgZGF0YS1pZD0iJyArIHJvdy5wdCArICciPicgKyByb3cucHQgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3B0JykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImxpc3RlZG5lc3MiLAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93Lmxpc3RlZG5lc3MgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2xpc3RlZG5lc3MnKQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAib3V0Y29tZSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cub3V0Y29tZSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnb3V0Y29tZScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICdzaWduYWxzQW5kVG9waWNzJywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBzaWduYWxBbmRUb3BpY3MgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkLmVhY2gocm93LnNpZ25hbHNBbmRUb3BpY3MsIGZ1bmN0aW9uIChpLCBvYmopIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IHNpZ25hbERldGFpbFVybCArICc/aWQ9JyArIG9ialsnc2lnbmFsSWQnXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCgnI2hhc1NpZ25hbE1hbmFnZW1lbnRBY2Nlc3MnKS52YWwoKSA9PSAndHJ1ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbEFuZFRvcGljcyA9IHNpZ25hbEFuZFRvcGljcyArICc8c3BhbiBjbGFzcz0iY2xpY2siPjxhIGNsYXNzPSJjZWxsLWJyZWFrIiBvbmNsaWNrPSJ2YWxpZGF0ZUFjY2VzcyhldmVudCwnICsgb2JqWydzaWduYWxJZCddICsgJykiIGhyZWY9IicgKyB1cmwgKyAnIj4nICsgZXNjYXBlSFRNTChvYmpbJ25hbWUnXSkgKyAnPC9hPjwvc3Bhbj4mbmJzcDsnCiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbEFuZFRvcGljcyA9IHNpZ25hbEFuZFRvcGljcyArICc8c3BhbiBjbGFzcz0iY2xpY2sgc2lnbmFsU3VtbWFyeUF1dGgiPjxhIGNsYXNzPSJjZWxsLWJyZWFrIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiPicgKyBlc2NhcGVIVE1MKG9ialsnbmFtZSddKSArICc8L2E+PC9zcGFuPiZuYnNwOycKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAiLCIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2lnbmFsQW5kVG9waWNzLmxlbmd0aCA+IDEpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdj4nICsgc2lnbmFsQW5kVG9waWNzLnN1YnN0cmluZygwLCBzaWduYWxBbmRUb3BpY3MubGVuZ3RoIC0gMSkgKyAnPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnLSc7CgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xNTAgY29sLW1heC0yMDAgc2lnbmFsSW5mb3JtYXRpb24nLAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdzaWduYWxzQW5kVG9waWNzJykKICAgICAgICAgICAgfV0pOwogICAgICAgIGlmICgkKCIjaXNGYWVycyIpLnZhbCgpICE9ICJ0cnVlIikgewogICAgICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY3VycmVudERpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25hbC51dGlscy5yZW5kZXIoJ2Rpc3Bvc2l0aW9uJywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZERpc3Bvc2l0aW9uOiBkaXNwb3NpdGlvbkluY29taW5nT3V0Z29pbmdNYXBbcm93LmRpc3Bvc2l0aW9uXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnREaXNwb3NpdGlvbjogcm93LmRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VKdXN0aWZpY2F0aW9uOiBmb3JjZUp1c3RpZmljYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1Jldmlld2VkOiByb3cuaXNSZXZpZXdlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVmFsaWRhdGlvblN0YXRlQWNoaWV2ZWQ6IHJvdy5pc1ZhbGlkYXRpb25TdGF0ZUFjaGlldmVkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdjdXJyZW50RGlzcG9zaXRpb24nKSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3MiOiAnY29sLW1heC0yNTAgZGlzcG9zaXRpb25BY3Rpb24nCiAgICAgICAgICAgICAgICB9XSk7CiAgICAgICAgfQogICAgICAgIGFvQ29sdW1ucy5wdXNoLmFwcGx5KGFvQ29sdW1ucywgW3sKICAgICAgICAgICAgIm1EYXRhIjogImRpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcm93LmRpc3Bvc2l0aW9uCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1heC0yNTAgY3VycmVudERpc3Bvc2l0aW9uJywKICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdkaXNwb3NpdGlvbicpCiAgICAgICAgfV0pOwogICAgICAgIGlmICgkKCIjaXNGYWVycyIpLnZhbCgpICE9ICJ0cnVlIikgewogICAgICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXNzaWduZWRUb1VzZXIiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLmxpc3RfdXRpbHMuYXNzaWduZWRfdG9fY29tcChyb3cuaWQsIHJvdy5hc3NpZ25lZFRvVXNlcikKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xMDAgY29sLW1heC0xNTAgYXNzaWduZWRUbycsCiAgICAgICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnYXNzaWduZWRUb1VzZXInKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZHVlRGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdWVJbiBjb2wtbWluLTUwJywKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25hbC5saXN0X3V0aWxzLmR1ZV9pbl9jb21wKHJvdy5kdWVJbikKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnZHVlRGF0ZScpCiAgICAgICAgICAgICAgICB9XSk7CiAgICAgICAgfQoKICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInN1c3BQcm9kIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAgY29sLW1heC0yMDAgY2VsbC1icmVhaycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gZW5jb2RlVG9IVE1MKHJvdy5zdXNwUHJvZCk7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInICsgZW5jb2RlVG9IVE1MKHJvdy5zdXNwUHJvZCkgKyAnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sRWxlbWVudAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnc3VzcFByb2QnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY29uQ29taXQiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTEwMCBjb2wtbWF4LTIwMCcsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gcmVtb3ZlTGluZUJyZWFrKHJvdy5jb25Db21pdCk7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInICsgcmVtb3ZlTGluZUJyZWFrKHJvdy5jb25Db21pdCkgKyAnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sRWxlbWVudAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY29uQ29taXQnKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogIm1hc3RlclByZWZUZXJtQWxsIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAgY29sLW1heC0yMDAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHB0TGlzdCA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmIChyb3cubWFzdGVyUHJlZlRlcm1BbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHRMaXN0ID0gcm93Lm1hc3RlclByZWZUZXJtQWxsLnNwbGl0KCchQCMjQCEnKS5qb2luKCcgJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHB0TGlzdCA9IHB0TGlzdC5zcGxpdCgnIUAuQCEnKS5qb2luKCcpICcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gZW5jb2RlVG9IVE1MKHB0TGlzdCk7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInICsgZW5jb2RlVG9IVE1MKHB0TGlzdCkgKyAnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sRWxlbWVudAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnbWFzdGVyUHJlZlRlcm1BbGwnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic2VyaW91cyIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuc2VyaW91cyArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnc2VyaW91cycpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlUmVwb3J0VHlwZSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuY2FzZVJlcG9ydFR5cGUgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2Nhc2VSZXBvcnRUeXBlJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInJlcG9ydGVyc0hjcEZsYWciLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LnJlcG9ydGVyc0hjcEZsYWcgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3JlcG9ydGVyc0hjcEZsYWcnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY291bnRyeSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuY291bnRyeSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY291bnRyeScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhZ2UiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LmFnZSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnYWdlJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImdlbmRlciIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuZ2VuZGVyICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdnZW5kZXInKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicmVjaGFsbGVuZ2UiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LnJlY2hhbGxlbmdlICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdyZWNoYWxsZW5nZScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJsb2NrZWREYXRlIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkYXRhICYmIGRhdGEgIT0gdW5kZWZpbmVkICkgPyBtb21lbnQudXRjKGRhdGEpLmZvcm1hdChERUZBVUxUX0RBVEVfRk9STUFUKSA6ICcnOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnbG9ja2VkRGF0ZScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkZWF0aCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuZGVhdGggKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2RlYXRoJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogIm1lZEVycm9yc1B0IiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAgY29sLW1heC0yMDAgY2VsbC1icmVhaycsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gcm93Lm1lZEVycm9yc1B0OwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyArIHJvdy5tZWRFcnJvcnNQdCArICciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb2xFbGVtZW50CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdtZWRFcnJvcnNQdCcpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwYXRpZW50QWdlIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuJzxzcGFuPicrcm93LnBhdGllbnRBZ2UrJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdwYXRpZW50QWdlJykKICAgICAgICAgICAgfV0pOwoKICAgICAgICBpZiAoY3VzdG9tRmllbGRzRW5hYmxlZCkgewogICAgICAgICAgICBhb0NvbHVtbnMucHVzaC5hcHBseShhb0NvbHVtbnMsIFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY2FzZVR5cGUiLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnJywKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LmNhc2VUeXBlICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2Nhc2VUeXBlJykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbXBsZXRlbmVzc1Njb3JlIiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJycsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4+JyArIHJvdy5jb21wbGV0ZW5lc3NTY29yZSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdjb21wbGV0ZW5lc3NTY29yZScpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpbmROdW1iZXIiLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnJywKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgcm93LmluZE51bWJlciArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdpbmROdW1iZXInKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXBwVHlwZUFuZE51bSIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuYXBwVHlwZUFuZE51bSArICc8L3NwYW4+JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdhcHBUeXBlQW5kTnVtJykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbXBvdW5kaW5nRmxhZyIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTEwMCBjb2wtbWF4LTIwMCcsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb2xFbGVtZW50ID0gJzxkaXYgY2xhc3M9ImNvbC1jb250YWluZXIiPjxkaXYgY2xhc3M9ImNvbC1oZWlnaHQiPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gcm93LmNvbXBvdW5kaW5nRmxhZzsKICAgICAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInICsgcm93LmNvbXBvdW5kaW5nRmxhZyArICciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY29tcG91bmRpbmdGbGFnJykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInN1Ym1pdHRlciIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICcnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuc3VibWl0dGVyICsgJzwvc3Bhbj4nCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ3N1Ym1pdHRlcicpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0pCiAgICAgICAgfQogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09IENBTExJTkdfU0NSRUVOLlRSSUdHRVJFRF9BTEVSVFMpIHsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg0LCAwLCB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAibmFtZSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyBlbmNvZGVUb0hUTUwocm93LmFsZXJ0TmFtZSkgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhb0NvbHVtbnMKICAgIH07CgogICAgdmFyIGNyZWF0ZUFsZXJ0TGlzdFVybCA9IGZ1bmN0aW9uIChpc0ZpbHRlclJlcXVlc3QsIGZpbHRlclZhbHVlcykgewogICAgICAgIHZhciBsaXN0VXJsID0gbGlzdENvbmZpZ1VybCArICcmaXNGaWx0ZXJSZXF1ZXN0PScgKyBpc0ZpbHRlclJlcXVlc3QgKyAnJmZpbHRlcnM9JyArIGVuY29kZVVSSShKU09OLnN0cmluZ2lmeShmaWx0ZXJWYWx1ZXMpKTsKICAgICAgICBpZiAoJCgnI2lzRmFlcnMnKS52YWwoKSkgewogICAgICAgICAgICBsaXN0VXJsICs9ICcmaXNGYWVycz0nICsgJCgnI2lzRmFlcnMnKS52YWwoKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlzdFVybAogICAgfTsKCiAgICB2YXIgc2hvd0FsbFNlbGVjdGVkQ2FzZU51bWJlcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2NvcHlDYXNlTnVtYmVyTW9kZWwnKS5tb2RhbCh7CiAgICAgICAgICAgIHNob3c6IHRydWUKICAgICAgICB9KTsKCiAgICAgICAgdmFyIG51bWJlcnMgPSBfLm1hcCgkKCdpbnB1dC5jb3B5LXNlbGVjdDpjaGVja2VkJykucGFyZW50KCkucGFyZW50KCkuZmluZCgndGQ6bnRoLWNoaWxkKDUpJyksIGZ1bmN0aW9uIChpdCkgewogICAgICAgICAgICByZXR1cm4gJChpdCkudGV4dCgpCiAgICAgICAgfSk7CiAgICAgICAgJCgiI2Nhc2VOdW1iZXJzIikudGV4dChudW1iZXJzKTsKICAgIH07CgogICAgdmFyIGluaXRVcGRhdGVBc3NpZ25lZFRvID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAkKCIjdXBkYXRlQXNzaWduZWRUb0J0biIpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgIHVybDogJCgiI2NoYW5nZS11c2VyLXVybCIpLnZhbCgpLAogICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIGFsZXJ0SWQ6ICQoIiNhc3NpZ25lZFRvTW9kYWwgI2FsZXJ0SWQiKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZFRvOiAkKCIjX2Fzc2lnbmVkVG8iKS5maW5kKCJvcHRpb246c2VsZWN0ZWQiKS52YWwoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAkKCIjYXNzaWduZWRUb01vZGFsIikuZmluZCgnLmZvcm0tY29udHJvbCcpLnZhbCgiIikKICAgICAgICAgICAgICAgICQoIiNhc3NpZ25lZFRvTW9kYWwiKS5tb2RhbCgnaGlkZScpCiAgICAgICAgICAgICAgICBhbGVydERldGFpbHNUYWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGluaXRfYWRkX2Nhc2VfbW9kYWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqID0gJCgnI2FkZENhc2VNb2RhbCcpOwogICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCdpbnB1dDp0ZXh0JykudmFsKCcnKTsKICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2p1c3RpZmljYXRpb24nKS52YWwoIiIpOwogICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjaW1wb3J0Q2FzZXNFeGNlbCcpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNpbXBvcnRDYXNlc1NlY3Rpb24nKS5hdHRyKCdoaWRkZW4nLCAnaGlkZGVuJyk7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNjYXNlTnVtYmVyJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSkuc2libGluZ3MoJ2xhYmVsJykuZmluZCgnc3BhbicpLnNob3coKQogICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjanVzdGlmaWNhdGlvbkxpc3RQcmlvcml0eScpLnZhbCgnJyk7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNhZGRDYXNlQnV0dG9uJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7CiAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLm1vZGFsKCdzaG93Jyk7CgogICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjaW1wb3J0Q2FzZXNFeGNlbCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKGFkZENhc2VNb2RhbE9iai5maW5kKCcjaW1wb3J0Q2FzZXNFeGNlbCcpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2ltcG9ydENhc2VzU2VjdGlvbicpLnJlbW92ZUF0dHIoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyN2ZXJzaW9uTnVtYmVyLCAjY2FzZU51bWJlcicpLnZhbCgnJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKS5zaWJsaW5ncygnbGFiZWwnKS5maW5kKCdzcGFuJykuaGlkZSgpOwogICAgICAgICAgICAgICAgJCgnLmFkZC1jYXNlLXRvLWxpc3QnKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJyNpbXBvcnRDYXNlc1NlY3Rpb24nKS5hdHRyKCdoaWRkZW4nLCAnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnOmZpbGUnKS52YWwoJycpLnBhcmVudHMoJy5pbnB1dC1ncm91cCcpLmZpbmQoJzp0ZXh0JykudmFsKCcnKTsKICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjdmVyc2lvbk51bWJlciwgI2Nhc2VOdW1iZXInKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpLnNpYmxpbmdzKCdsYWJlbCcpLmZpbmQoJ3NwYW4nKS5zaG93KCk7CiAgICAgICAgICAgICAgICAkKCcuYWRkLWNhc2UtdG8tbGlzdCcpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjaGFuZ2UnLCAnI2p1c3RpZmljYXRpb25MaXN0UHJpb3JpdHknLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9ICQodGhpcykudmFsKCk7CiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSAiIikgewogICAgICAgICAgICAgICAgdmFyIHRleHQgPSBqdXN0aWZpY2F0aW9uT2JqLmZpbHRlcihmdW5jdGlvbiAoYXJyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyci5pZCA9PSB2YWx1ZQogICAgICAgICAgICAgICAgfSlbMF0udGV4dDsKICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjanVzdGlmaWNhdGlvbicpLnZhbCh0ZXh0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjanVzdGlmaWNhdGlvbicpLnZhbCgnJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCgogICAgICAgIGFkZENhc2VNb2RhbE9iai5vbignY2hhbmdlJywgJzpmaWxlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpOwogICAgICAgICAgICB2YXIgbnVtRmlsZXMgPSBpbnB1dC5nZXQoMCkuZmlsZXMgPyBpbnB1dC5nZXQoMCkuZmlsZXMubGVuZ3RoIDogMDsKICAgICAgICAgICAgdmFyIGxhYmVsID0gaW5wdXQudmFsKCkucmVwbGFjZSgvXFwvZywgJy8nKS5yZXBsYWNlKC8uKlwvLywgJycpOwogICAgICAgICAgICB2YXIgdmFsaWRFeHRzID0gbmV3IEFycmF5KCIueGxzeCIsICIueGxzIik7CiAgICAgICAgICAgIHZhciBmaWxlRXh0ID0gbGFiZWwuc3Vic3RyaW5nKGxhYmVsLmxhc3RJbmRleE9mKCcuJykpOwogICAgICAgICAgICBpZiAobnVtRmlsZXMgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsaWRFeHRzLmluZGV4T2YoZmlsZUV4dC50b0xvd2VyQ2FzZSgpKSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAkKCcjZmlsZUZvcm1hdEVycm9yJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICQoJy5hZGQtY2FzZS10by1saXN0JykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJCgnI2ZpbGVGb3JtYXRFcnJvcicpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAkKCcuYWRkLWNhc2UtdG8tbGlzdCcpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCcjZmlsZUZvcm1hdEVycm9yJykuaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlucHV0LnRyaWdnZXIoJ2ZpbGVzZWxlY3QnLCBbbnVtRmlsZXMsIGxhYmVsXSk7CiAgICAgICAgfSk7CgogICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCc6ZmlsZScpLm9uKCdmaWxlc2VsZWN0JywgZnVuY3Rpb24gKGV2ZW50LCBudW1GaWxlcywgbGFiZWwpIHsKICAgICAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKS5wYXJlbnRzKCcuaW5wdXQtZ3JvdXAnKS5maW5kKCc6dGV4dCcpOwogICAgICAgICAgICB2YXIgbG9nID0gbnVtRmlsZXMgPiAwID8gbGFiZWwgOiAiIjsKCiAgICAgICAgICAgIGlmIChpbnB1dC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlucHV0LnZhbChsb2cpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBhZGRfY2FzZV90b19saXN0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjYWRkQ2FzZUJ1dHRvbicpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7CiAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKGFkZENhc2VNb2RhbE9iai5maW5kKCcjYWRkTmV3Q2FzZScpWzBdKTsKICAgICAgICBpZiAoYWRkQ2FzZU1vZGFsT2JqLmZpbmQoJzpmaWxlJykudmFsKCkpIHsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCJmaWxlIiwgJCgnI2ZpbGVfaW5wdXQnKS5nZXQoMCkuZmlsZXNbMF0pOwogICAgICAgIH0KICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL3NpbmdsZUNhc2VBbGVydC9hZGRDYXNlVG9TaW5nbGVDYXNlQWxlcnQiLAogICAgICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLAogICAgICAgICAgICBtaW1lVHlwZTogIm11bHRpcGFydC9mb3JtLWRhdGEiLAogICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsCiAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgaWYgKCFKU09OLnBhcnNlKGRhdGEpLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2FkZENhc2VCdXR0b24nKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOwogICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcuYWxlcnQtZGFuZ2VyJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnLmVycm9yTWVzc2FnZVNwYW4nKS5odG1sKEpTT04ucGFyc2UoZGF0YSkubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcuYWxlcnQtZGFuZ2VyJykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhZGRDYXNlTW9kYWxPYmouZmluZCgnI2FkZENhc2VCdXR0b24nKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpOwogICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjaW1wb3J0Q2FzZXNTZWN0aW9uJykuYXR0cignaGlkZGVuJywgJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCc6ZmlsZScpLnZhbCgnJykucGFyZW50cygnLmlucHV0LWdyb3VwJykuZmluZCgnOnRleHQnKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGFkZENhc2VNb2RhbE9iai5maW5kKCcjdmVyc2lvbk51bWJlciwgI2Nhc2VOdW1iZXInKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpLnNpYmxpbmdzKCdsYWJlbCcpLmZpbmQoJ3NwYW4nKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgYWRkQ2FzZU1vZGFsT2JqLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgcmVsb2FkRGF0YSgiIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgc2hvd1N1Y2Nlc3NOb3RpZmljYXRpb24oSlNPTi5wYXJzZShkYXRhKS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICBmdW5jdGlvbiBzaG93U3VjY2Vzc05vdGlmaWNhdGlvbihtZXNzYWdlKSB7CiAgICAgICAgJCgiLmFsZXJ0LXN1Y2Nlc3MiKS5hbGVydCgnY2xvc2UnKTsKICAgICAgICBpZiAobWVzc2FnZSAhPSB1bmRlZmluZWQgJiYgbWVzc2FnZSAhPSAiIikKICAgICAgICAgICAgJCgnI2RldGFpbHNUYWInKS5wcmVwZW5kKAogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImFsZXJ0IGFsZXJ0LXN1Y2Nlc3MgYWxlcnQtZGlzbWlzc2FibGUiPicgKwogICAgICAgICAgICAgICAgJzxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiICcgKwogICAgICAgICAgICAgICAgJ2RhdGEtZGlzbWlzcz0iYWxlcnQiIGFyaWEtaGlkZGVuPSJ0cnVlIj4nICsKICAgICAgICAgICAgICAgICcmdGltZXM7JyArCiAgICAgICAgICAgICAgICAnPC9idXR0b24+JyArCiAgICAgICAgICAgICAgICBlbmNvZGVUb0hUTUwobWVzc2FnZSkgKwogICAgICAgICAgICAgICAgJzwvZGl2PicKICAgICAgICAgICAgKTsKICAgIH0KCgogICAgdmFyIHJlbG9hZERhdGEgPSBmdW5jdGlvbiAocm93SWQsIHJlc2V0UGFnaW5hdGlvbikgewogICAgICAgIGlmIChyZXNldFBhZ2luYXRpb24gIT0gdHJ1ZSkgewogICAgICAgICAgICByZXNldFBhZ2luYXRpb24gPSBmYWxzZQogICAgICAgIH0KICAgICAgICB2YXIgZGF0YVRhYmxlID0gJCgiI2FsZXJ0c0RldGFpbHNUYWJsZSIpLkRhdGFUYWJsZSgpOwogICAgICAgIGRhdGFUYWJsZS5hamF4LnJlbG9hZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGhpZ2hsaWdodFJvdyhyb3dJZCwgZGF0YVRhYmxlKTsKICAgICAgICB9LCByZXNldFBhZ2luYXRpb24pOwogICAgfTsKCiAgICB2YXIgaGlnaGxpZ2h0Um93ID0gZnVuY3Rpb24gKHJvd0lkLCBkYXRhVGFibGUpIHsKICAgICAgICBpZiAocm93SWQgIT0gdW5kZWZpbmVkICYmIHJvd0lkICE9ICIiKSB7CiAgICAgICAgICAgIGRhdGFUYWJsZS5yb3coJyMnICsgcm93SWQpLm5vZGVzKCkKICAgICAgICAgICAgICAgIC50byQoKQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCdmbGFzaC1yb3cnKTsKICAgICAgICB9CiAgICB9OwoKCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnBvcHVsYXRlQ29sdW1uTGlzdChncmlkQ29sdW1uc1ZpZXdVcmwsIGdyaWRDb2x1bW5zVmlld1VwZGF0ZVVybCk7CiAgICAgICAgYWxlcnREZXRhaWxzVGFibGUgPSBpbml0QWxlcnREZXRhaWxzVGFibGUoKTsKCiAgICAgICAgJCgnaSNjb3B5U2VsZWN0aW9uJykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzaG93QWxsU2VsZWN0ZWRDYXNlTnVtYmVycygpCiAgICAgICAgfSk7CgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdpbnB1dCNzZWxlY3QtYWxsJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCIuY29weS1zZWxlY3QiKS5wcm9wKCdjaGVja2VkJywgdGhpcy5jaGVja2VkKTsKICAgICAgICB9KTsKCiAgICAgICAgaW5pdFVwZGF0ZUFzc2lnbmVkVG8oKQoKICAgIH07CgogICAgaW5pdCgpOwoKICAgICQoJyNleHBvcnRUeXBlcyBhW2hyZWZdJykuY2xpY2soZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgY2xpY2tlZFVSTCA9IGUuY3VycmVudFRhcmdldC5ocmVmOwogICAgICAgIHZhciB1cGRhdGVkRXhwb3J0VXJsID0gY2xpY2tlZFVSTDsKICAgICAgICB2YXIgaWRzID0gW107CiAgICAgICAgJCgnLmFsZXJ0LWNoZWNrLWJveCcpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoJCh0aGlzKVswXVsnY2hlY2tlZCddKSB7CiAgICAgICAgICAgICAgICBpZHMucHVzaCgkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKSkKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgY2hlY2tlZENvbHVtbnMgPSB7fTsKICAgICAgICAkKCcjdGFibGVDb2x1bW5zIHRyICcpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZmllbGROYW1lID0gJCh0aGlzKS5jaGlsZHJlbigpLmNoaWxkcmVuKCkuYXR0cignZGF0YS1maWVsZCcpOwogICAgICAgICAgICBpZiAoZmllbGROYW1lKSB7CiAgICAgICAgICAgICAgICBjaGVja2VkQ29sdW1uc1tmaWVsZE5hbWVdID0gJCh0aGlzKS5jaGlsZHJlbigpWzFdLmZpcnN0Q2hpbGQuY2hlY2tlZAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgoKICAgICAgICBpZiAoaWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdXBkYXRlZEV4cG9ydFVybCA9IGNsaWNrZWRVUkwgKyAiJnNlbGVjdGVkQ2FzZXM9IiArIGlkcyArICImdmlld0lkPSIgKyB2aWV3SWQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgdmFyIHByZWZpeCA9ICJzY2FfIjsKICAgICAgICAgICAgdmFyIGlzRmlsdGVyUmVxdWVzdCA9IHRydWU7CiAgICAgICAgICAgIHZhciBmaWx0ZXJWYWx1ZXMgPSBbXTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5zZXNzaW9uU3RvcmFnZSkgewogICAgICAgICAgICAgICAgaWYgKHNpZ25hbC5hbGVydFJldmlldy5pc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZShwcmVmaXgpKSB7CiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVzID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHByZWZpeCArICJmaWx0ZXJzX3ZhbHVlIikpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWxlcnRSZXZpZXcucmVtb3ZlRmlsdGVyc0Zyb21TZXNzaW9uU3RvcmFnZShwcmVmaXgpOwogICAgICAgICAgICAgICAgICAgIGlzRmlsdGVyUmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZmlsdGVyTGlzdCA9IHt9OwogICAgICAgICAgICAkKCIueWFkY2YtZmlsdGVyLXdyYXBwZXIiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJWYWwgPSAkKHRoaXMpLmNoaWxkcmVuKCkudmFsKCk7CiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyVmFsKSB7CiAgICAgICAgICAgICAgICAgICAgZmlsdGVyTGlzdFskKHRoaXMpLnByZXYoKS5hdHRyKCdkYXRhLWZpZWxkJyldID0gZmlsdGVyVmFsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgZmlsdGVyTGlzdEpzb24gPSBKU09OLnN0cmluZ2lmeShmaWx0ZXJMaXN0KTsKICAgICAgICAgICAgdXBkYXRlZEV4cG9ydFVybCA9IGNsaWNrZWRVUkwgKyAnJmlzRmlsdGVyUmVxdWVzdD0nICsgaXNGaWx0ZXJSZXF1ZXN0ICsgJyZmaWx0ZXJzPScgKyBKU09OLnN0cmluZ2lmeShmaWx0ZXJWYWx1ZXMpICsgIiZ2aWV3SWQ9IiArIHZpZXdJZCArICImZmlsdGVyTGlzdD0iICsgZW5jb2RlVVJJKGZpbHRlckxpc3RKc29uKSArICImaXNGYWVycz0iICsgJCgnI2lzRmFlcnMnKS52YWwoKTsKICAgICAgICAgICAgaWYgKCQoJyNhZHZhbmNlZC1maWx0ZXInKS52YWwoKSkgewogICAgICAgICAgICAgICAgdXBkYXRlZEV4cG9ydFVybCArPSAiJmFkdmFuY2VkRmlsdGVySWQ9IiArICQoJyNhZHZhbmNlZC1maWx0ZXInKS52YWwoKQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVwZGF0ZWRFeHBvcnRVcmw7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9KTsKCiAgICAkKCIuZXhwb3J0QWxlcnRIaXN0b3JpZXMiKS5jbGljayhmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI2Nhc2VIaXN0b3J5TW9kYWwnKTsKICAgICAgICB2YXIgY2FzZVZhbCA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VOdW1iZXIiKS5odG1sKCk7CiAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNwcm9kdWN0RmFtaWx5IikuaHRtbCgpOwogICAgICAgIHZhciBhbGVydENvbmZpZ0lkID0gY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjYWxlcnRDb25maWdJZCIpLnZhbCgpOwogICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VWZXJzaW9uIikudmFsKCk7CiAgICAgICAgdmFyIHNlbGVjdGVkQ2FzZSA9IGUuY3VycmVudFRhcmdldC5ocmVmICsgIiZjYXNlTnVtYmVyPSIgKyBjYXNlVmFsICsgIiZwcm9kdWN0RmFtaWx5PSIgKyBwcm9kdWN0RmFtaWx5ICsgIiZhbGVydENvbmZpZ0lkPSIgKyBhbGVydENvbmZpZ0lkICsgIiZjYXNlVmVyc2lvbj0iICsgY2FzZVZlcnNpb247CiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBzZWxlY3RlZENhc2U7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9KTsKCiAgICAkKCIjYWxlcnRzRGV0YWlsc1RhYmxlX2ZpbHRlciIpLmhpZGUoKTsKCgogICAgJCgnLnNhdmVDYXNlcycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCIjc2hvd0NvbmZpZ05hbWVNb2RhbCIpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgJCgiI3NhdmUtY2FzZXMtYnRuIikub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCcjc2F2ZS1jYXNlcy1idG4sICNjYW5jZWwtYnRuJykuYXR0cigiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKTsKICAgICAgICAgICAgdmFyIHNhdmVTY2FDYXNlc1VybCA9IHNhdmVDYXNlc1VybCArICImY29uZmlnTmFtZT0iICsgJCgnI2NvbmZpZ05hbWUnKS52YWwoKTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogc2F2ZVNjYUNhc2VzVXJsLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWxlcnRNZXNzYWdlJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzYXZlLWNhc2VzLWJ0biwgI2NhbmNlbC1idG4nKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NvbmZpZ05hbWUnKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Nob3dDb25maWdOYW1lTW9kYWwnKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKCcjZXJyb3JNZXNzYWdlJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzYXZlLWNhc2VzLWJ0biwgI2NhbmNlbC1idG4nKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NvbmZpZ05hbWUnKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2Vycm9yTWVzc2FnZScpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7CgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgfSk7CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNkZXRhaWxlZC12aWV3LWNoZWNrYm94JywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgdmFyIHJlbG9hZFVybCA9ICR0aGlzLmRhdGEoJ3VybCcpICsgJz9hcmNoaXZlZD0nICsgaXNBcmNoaXZlZCsgJyZjYWxsaW5nU2NyZWVuPScgKyAkdGhpcy5kYXRhKCdjYWxsaW5nU2NyZWVuJykgKyAnJmNvbmZpZ0lkPScgKyAkdGhpcy5kYXRhKCdjb25maWdJZCcpICsgIiZ2aWV3SWQ9IiArIHZpZXdJZCArICcmaXNDYXNlRGV0YWlsVmlldz0nICsgJHRoaXMuZGF0YSgnaXNDYXNlRGV0YWlsVmlldycpOwogICAgICAgIGlmICgkKCIjaXNGYWVycyIpLnZhbCgpKSB7CiAgICAgICAgICAgIHJlbG9hZFVybCArPSAnJmlzRmFlcnM9JyArICQoIiNpc0ZhZXJzIikudmFsKCk7CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVsb2FkVXJsCgogICAgfSk7CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zY2FDYXNlTnVtYmVyJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIHNjYUFsZXJ0SWQgPSAkKHRoaXMpLmZpbmQoInNwYW5bZGF0YS1maWVsZD1hbGVydElkXSIpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSAkKHRoaXMpLmZpbmQoInNwYW5bZGF0YS1maWVsZD1jYXNlVmVyc2lvbl0iKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSAkKHRoaXMpLmZpbmQoInNwYW5bZGF0YS1maWVsZD1jYXNlTnVtYmVyXSIpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICB2YXIgZXhlY0NvbmZpZ0lkID0gJCh0aGlzKS5maW5kKCJzcGFuW2RhdGEtZmllbGQ9ZXhlY0NvbmZpZ0lkXSIpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6IHVwZGF0ZUF1dG9Sb3V0ZURpc3Bvc2l0aW9uVXJsLAogICAgICAgICAgICBkYXRhOiB7J2lkJzogc2NhQWxlcnRJZCwnaXNBcmNoaXZlZCc6IGlzQXJjaGl2ZWR9LAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cykgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0RGV0YWlsc1RhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaWduYWwudXRpbHMucG9zdFVybChjYXNlRGV0YWlsVXJsLCB7CiAgICAgICAgICAgICAgICAgICAgY2FzZU51bWJlcjogY2FzZU51bWJlciwKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBjYXNlVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICBmb2xsb3dVcE51bWJlcjogbnVsbCwKICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBzY2FBbGVydElkLAogICAgICAgICAgICAgICAgICAgIGlzRmFlcnM6ICQoIiNpc0ZhZXJzIikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgZnVsbENhc2VMaXN0OiAkKCIjZnVsbENhc2VMaXN0IikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgZXhlY0NvbmZpZ0lkIDogZXhlY0NvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgIGlzQXJjaGl2ZWQ6IGlzQXJjaGl2ZWQsCiAgICAgICAgICAgICAgICAgICAgdG90YWxDb3VudCA6IHRhYmxlLnBhZ2UuaW5mbygpLnJlY29yZHNUb3RhbCwKICAgICAgICAgICAgICAgICAgICBkZXRhaWxzUGFyYW1ldGVyczogSlNPTi5zdHJpbmdpZnkoZGV0YWlsc1BhcmFtZXRlcnMpCiAgICAgICAgICAgICAgICB9LCB0cnVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlNvbWUgZXJyb3Igb2NjdXJlZCB3aGlsZSB1cGRhdGluZyBBdXRvUm91dGUgRGlzcG9zaXRpb24iKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgcmVnaXN0ZXJVbnNlbGVjdEV2ZW50Rm9yQ2FzZVNlcmllc1RhZygpOwogICAgcmVnaXN0ZXJVbnNlbGVjdEV2ZW50Rm9yR2xvYmFsVGFnKCk7CiAgICByZWdpc3RlclNlbGVjdEV2ZW50Rm9yQ2FzZVNlcmllc1RhZygpOwogICAgcmVnaXN0ZXJTZWxlY3RFdmVudEZvckdsb2JhbFRhZygpOwogICAgJCgnI2FsZXJ0VGFnTW9kYWwnKS5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGFnc09iai5hZGRlZENhc2VTZXJpZXNUYWdzID0gW107CiAgICAgICAgdGFnc09iai5hZGRlZEdsb2JhbFRhZ3MgPSBbXTsKICAgICAgICB0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncyA9IFtdOwogICAgICAgIHRhZ3NPYmouZGVsZXRlZEdsb2JhbFRhZ3MgPSBbXTsKICAgIH0pCn0pOwoKdmFyIGZvcm1hdCA9IGZ1bmN0aW9uIChkLCBjbGFzc05hbWUpIHsKICAgIHZhciBwcm9kdWN0TGlzdCA9IGQucHJvZHVjdExpc3Q7CiAgICB2YXIgcHJvZHVjdEFycmF5ID0gcHJvZHVjdExpc3Quc3BsaXQoJywnKTsKICAgIHZhciBwdEFycmF5ID0gZC5wdExpc3Quc3BsaXQoJyFAIyNAIScpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9kdWN0QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAocHJvZHVjdEFycmF5W2ldID09IGQucHJvZHVjdE5hbWUpIHsKICAgICAgICAgICAgcHJvZHVjdEFycmF5W2ldID0gcHJvZHVjdEFycmF5W2ldICsgIiAoUHJpbWFyeSkiCiAgICAgICAgfQogICAgfQogICAgdmFyIHJlc3VsdGVkT2JqID0gewogICAgICAgIHByb2R1Y3RMaXN0OiBwcm9kdWN0QXJyYXkuam9pbignLCcpLAogICAgICAgIHB0TGlzdDogcHRBcnJheSwKICAgICAgICBjYXNlTmFycmF0aXZlOiBkLmNhc2VOYXJyYXRpdmUsCiAgICAgICAgY29uTWVkczogcmVtb3ZlTGluZUJyZWFrKGQuY29uTWVkcyksCiAgICAgICAgbWVkRXJyb3JzUHQgOiBkLm1lZEVycm9yc1B0CiAgICB9OwogICAgaHRtbCA9IHNpZ25hbC51dGlscy5yZW5kZXIoImNhc2VfZGV0YWlsc19jaGlsZF92aWV3IiwgcmVzdWx0ZWRPYmopOwogICAgcmV0dXJuIGh0bWw7Cn07CgpmdW5jdGlvbiBzaG93Q2FzZURldGFpbHNWaWV3KCkgewogICAgJCgidHIuZGF0YS10YWJsZS1yb3ciKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgIHZhciB0ciA9ICQodGhpcyk7CiAgICAgICAgdmFyIHJvdyA9IHdpbmRvdy5zY2FfZGF0YV90YWJsZS5yb3codHIpOwogICAgICAgIHZhciBjbGFzc05hbWUgPSAkKHRoaXMpLmhhc0NsYXNzKCdvZGQnKSA/ICdvZGQnIDogJ2V2ZW4nOwogICAgICAgIHJvdy5jaGlsZChmb3JtYXQocm93LmRhdGEoKSksIGNsYXNzTmFtZSkuc2hvdygpOwogICAgfSk7Cn0KCmZ1bmN0aW9uIHJlZ2lzdGVyVW5zZWxlY3RFdmVudEZvckNhc2VTZXJpZXNUYWcoKSB7CiAgICAkKGRvY3VtZW50KS5vbigic2VsZWN0Mjp1bnNlbGVjdCIsICcjc2luZ2xlQWxlcnRUYWdzJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdGFnID0gZS5wYXJhbXMuZGF0YS50ZXh0OwogICAgICAgIGlmICghdGFnc09iai5kZWxldGVkQ2FzZVNlcmllc1RhZ3MuaW5jbHVkZXModGFnKSkgewogICAgICAgICAgICB0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncy5wdXNoKHRhZyk7CiAgICAgICAgICAgIHRhZ3NPYmouYWRkZWRDYXNlU2VyaWVzVGFncyA9IHRhZ3NPYmouYWRkZWRDYXNlU2VyaWVzVGFncy5yZW1vdmUodGFnKTsKICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gcmVnaXN0ZXJVbnNlbGVjdEV2ZW50Rm9yR2xvYmFsVGFnKCkgewogICAgJChkb2N1bWVudCkub24oInNlbGVjdDI6dW5zZWxlY3QiLCAnI2dsb2JhbFRhZ3MnLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0YWcgPSBlLnBhcmFtcy5kYXRhLnRleHQ7CiAgICAgICAgaWYgKCF0YWdzT2JqLmRlbGV0ZWRHbG9iYWxUYWdzLmluY2x1ZGVzKHRhZykpIHsKICAgICAgICAgICAgdGFnc09iai5kZWxldGVkR2xvYmFsVGFncy5wdXNoKHRhZyk7CiAgICAgICAgICAgIHRhZ3NPYmouYWRkZWRHbG9iYWxUYWdzID0gdGFnc09iai5hZGRlZEdsb2JhbFRhZ3MucmVtb3ZlKHRhZyk7CiAgICAgICAgfQogICAgfSk7Cn0KCmZ1bmN0aW9uIHJlZ2lzdGVyU2VsZWN0RXZlbnRGb3JDYXNlU2VyaWVzVGFnKCkgewogICAgJChkb2N1bWVudCkub24oInNlbGVjdDI6c2VsZWN0aW5nIiwgJyNzaW5nbGVBbGVydFRhZ3MnLCBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciB0YWcgPSBlLnBhcmFtcy5hcmdzLmRhdGEuaWQ7CiAgICAgICAgaWYgKCF0YWdzT2JqLmFkZGVkQ2FzZVNlcmllc1RhZ3MuaW5jbHVkZXModGFnKSkgewogICAgICAgICAgICB0YWdzT2JqLmFkZGVkQ2FzZVNlcmllc1RhZ3MucHVzaCh0YWcpOwogICAgICAgICAgICB0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncyA9IHRhZ3NPYmouZGVsZXRlZENhc2VTZXJpZXNUYWdzLnJlbW92ZSh0YWcpOwogICAgICAgIH0KICAgIH0pOwp9CgpmdW5jdGlvbiByZWdpc3RlclNlbGVjdEV2ZW50Rm9yR2xvYmFsVGFnKCkgewogICAgJChkb2N1bWVudCkub24oInNlbGVjdDI6c2VsZWN0aW5nIiwgJyNnbG9iYWxUYWdzJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICB2YXIgdGFnID0gZS5wYXJhbXMuYXJncy5kYXRhLmlkOwogICAgICAgIGlmICghdGFnc09iai5hZGRlZEdsb2JhbFRhZ3MuaW5jbHVkZXModGFnKSkgewogICAgICAgICAgICB0YWdzT2JqLmFkZGVkR2xvYmFsVGFncy5wdXNoKHRhZyk7CiAgICAgICAgICAgIHRhZ3NPYmouZGVsZXRlZEdsb2JhbFRhZ3MgPSB0YWdzT2JqLmRlbGV0ZWRHbG9iYWxUYWdzLnJlbW92ZSh0YWcpOwogICAgICAgIH0KICAgIH0pOwp9CgokKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNpZ25hbFN1bW1hcnlBdXRoJywgZnVuY3Rpb24gKGV2dCkgewogICAgJC5Ob3RpZmljYXRpb24ubm90aWZ5KCd3YXJuaW5nJywndG9wIHJpZ2h0JywgIldhcm5pbmciLCAiWW91IGRvbid0IGhhdmUgYWNjZXNzIHRvIHZpZXcgc2lnbmFsIHN1bW1hcnkiLCB7YXV0b0hpZGVEZWxheTogMjAwMH0pOwp9KTsKCnZhciBmZXRjaFRhZ3MgPSBmdW5jdGlvbiAoKSB7CiAgICAkLmFqYXgoewogICAgICAgIHVybDogZmV0Y2hDb21tb25UYWdzVXJsLAogICAgICAgIGFzeW5jOmZhbHNlLAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgcmVzdWx0LmNvbW1vblRhZ0xpc3QuZm9yRWFjaChmdW5jdGlvbihtYXApewogICAgICAgICAgICAgICAgdGFncy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBpZDogbWFwLmlkLAogICAgICAgICAgICAgICAgICAgIHRleHQ6IG1hcC50ZXh0LAogICAgICAgICAgICAgICAgICAgIHBhcmVudElkOiBtYXAucGFyZW50SWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9KTsKfTsKCg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="773237937" offset="0" length="8192" />
        <PacketInfo time="773237953" offset="8192" length="16384" />
        <PacketInfo time="773237968" offset="24576" length="16190" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>