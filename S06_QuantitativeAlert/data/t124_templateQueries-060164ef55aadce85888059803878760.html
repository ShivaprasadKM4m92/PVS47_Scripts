$(document).ready(function(){var e=$("#templateQueryList").attr("data-counter"),g=function(){c(!1);$("#templateQueryList").find(".form-control.selectTemplate").last().focus()},f=function(){c(!0);$("#templateQueryList").find(".form-control.selectTemplate").last().focus()},c=function(b){var d=$("#templateQuery_clone").clone(),a="templateQueries["+e+"].",h=d.find("select[id$=template]"),f=d.find("i[id$=deleteButton]"),c=d.find("select[id$=query]"),g=d.find("select[id$=operator]"),n=d.find("select[id$=queryLevel]"),
p=d.find("select[id$=dateRangeInformationForTemplateQuery\\.dateRangeEnum]"),m=d.find("div[id$=datePickerFromDiv]"),H=d.find("div[id$=datePickerToDiv]"),q=d.find("input[id$=dateRangeInformationForTemplateQuery\\.dateRangeStartAbsolute]"),r=d.find("input[id$=dateRangeInformationForTemplateQuery\\.dateRangeEndAbsolute]"),t=d.find("input[id$=dateRangeInformationForTemplateQuery\\.relativeDateRangeValue]"),u=d.find("input[id$=header]"),v=d.find("textarea[id$=footer]"),w=d.find("input[id$=title]"),x=d.find("input[id$=headerProductSelection]"),
y=d.find("input[id$=headerDateRange]"),z=d.find("input[id$=blindProtected]"),A=d.find("input[id$=privacyProtected]"),k=d.find("input[id$=templateName]"),B=d.find("input[id$=queryName]");d.find("input[id$=version]").attr("id",a+"version").attr("name",a+"version");d.find("input[id$=id]").attr("id",a+"id").attr("name",a+"id");d.find("input[id$=dynamicFormEntryDeleted]").attr("id",a+"dynamicFormEntryDeleted").attr("name",a+"dynamicFormEntryDeleted");d.find("input[id$=rptTempId]").attr("id",a+"rptTempId").attr("name",
a+"rptTempId");d.find("input[id$=queryId]").attr("id",a+"queryId").attr("name",a+"queryId");d.find("input[id$=new]").attr("id",a+"new").attr("name",a+"new").attr("value","true");d.find(".validQueries").attr("id",a+"validQueries").attr("name",a+"validQueries");h.attr("id",a+"template").attr("name",a+"template");k.attr("id",a+"templateName").attr("name",a+"templateName");B.attr("id",a+"queryName").attr("name",a+"queryName");c.attr("id",a+"query").attr("name",a+"query");g.attr("id",a+"operator").attr("name",
a+"operator");n.attr("id",a+"queryLevel").attr("name",a+"queryLevel");f.attr("id",a+"deleteButton").attr("name",a+"deleteButton");t.attr("id",a+"dateRangeInformationForTemplateQuery.relativeDateRangeValue").attr("name",a+"dateRangeInformationForTemplateQuery.relativeDateRangeValue");p.attr("id",a+"dateRangeInformationForTemplateQuery.dateRangeEnum").attr("name",a+"dateRangeInformationForTemplateQuery.dateRangeEnum");m.attr("id",a+"datePickerFromDiv");H.attr("id",a+"datePickerToDiv");q.attr("id",a+
"dateRangeInformationForTemplateQuery.dateRangeStartAbsolute").attr("name",a+"dateRangeInformationForTemplateQuery.dateRangeStartAbsolute");r.attr("id",a+"dateRangeInformationForTemplateQuery.dateRangeEndAbsolute").attr("name",a+"dateRangeInformationForTemplateQuery.dateRangeEndAbsolute");u.attr("id",a+"header").attr("name",a+"header");v.attr("id",a+"footer").attr("name",a+"footer");w.attr("id",a+"title").attr("name",a+"title");x.attr("id",a+"headerProductSelection").attr("name",a+"headerProductSelection");
y.attr("id",a+"headerDateRange").attr("name",a+"headerDateRange");z.attr("id",a+"blindProtected").attr("name",a+"blindProtected");A.attr("id",a+"privacyProtected").attr("name",a+"privacyProtected");d.attr("id","templateQuery"+e);bindTemplateSelect2(h).on("change",function(a){selectTemplateOnChange(this,cioms1Id)});bindQuerySelect2(c).on("change",function(a){selectQueryOnChange(this)});g.select2();n.select2();p.select2().on("change",function(a){dataRangeEnumClassOnChange(this)});$("#templateQueryList").append(d);
if(b){var l=0;for(b=0;b<e;b++)"false"==$("#templateQueries\\["+b+"\\]\\.dynamicFormEntryDeleted").val()&&(l=b);var C=e;b=getQueryWrapperRow(c);var D=getExpressionValues(b);$(D).on("loadBlankAndCustomSqlFieldsComplete",function(){E(l,C)});b=getTemplateContainer(h);var F=getTemplateValues(b);$(F).on("loadCustomSQLValuesForTemplateComplete",function(){E(l,C)});b="templateQueries\\["+l+"\\]\\.";a=$("#"+b+"template");k.val($("#"+b+"templateName").val());B.val($("#"+b+"queryName").val());a.val()&&(k=new Option(a.select2("data")[0].text,
a.val(),!0,!0),h.append(k).trigger("change"));h.one("change",function(){$(F).off("loadCustomSQLValuesForTemplateComplete")});h=$("#"+b+"query");h.val()&&(h=new Option(h.select2("data")[0].text,h.val(),!0,!0),c.append(h).trigger("change"));c.one("change",function(){$(D).off("loadBlankAndCustomSqlFieldsComplete")});g.val($("#"+b+"operator").val()).trigger("change");n.val($("#"+b+"queryLevel").val()).trigger("change");p.val($("#"+b+"dateRangeInformationForTemplateQuery\\.dateRangeEnum").val()).trigger("change");
q.val($("#"+b+"dateRangeInformationForTemplateQuery\\.dateRangeStartAbsolute").val());r.val($("#"+b+"dateRangeInformationForTemplateQuery\\.dateRangeEndAbsolute").val());t.val($("#"+b+"dateRangeInformationForTemplateQuery\\.relativeDateRangeValue").val());u.val($("#"+b+"header").val());v.val($("#"+b+"footer").val());w.val($("#"+b+"title").val());x.prop("checked",$("#"+b+"headerProductSelection").prop("checked"));y.prop("checked",$("#"+b+"headerDateRange").prop("checked"));z.prop("checked",$("#"+b+
"blindProtected").prop("checked"));A.prop("checked",$("#"+b+"privacyProtected").prop("checked"))}d.show();if(0!=e)d.find(".showHeaderFooterArea").on("click",G);e++;1<$(".templateQuery-div:visible").length&&$.each($(".templateQuery-div:visible"),function(){$($(this).find(".templateQueryDeleteButton")).show()})},E=function(b,d){b=$("[name^='templateQuery"+b+".'][name$='].value'],[name^='templateQuery"+b+".'][name$='].copyPasteValue']");_.each(b,function(a){a=$(a);var b="templateQuery"+d+a.attr("name").substring(a.attr("name").indexOf("."));
if(a.val()){var e=$("[name='"+b+"']");if(a.hasClass("expressionValueSelectAuto")){var c=[];_.each(a.val().split(";"),function(a){c.push({id:a,text:a});e.select2("data",c)})}else e.val(a.val()).trigger("change");a.hasClass("expressionValueText")&&(e=$("[name='"+b.replace("value","copyPasteValue")+"']"),b=e.closest(".toAddContainerQEV")[0])&&(e.val(a.val()),$(b).find(".isFromCopyPaste").val("true"),showHideValue(EDITOR_TYPE_TEXT,b))}})},m=function(b){b=$(b).find("i.templateQueryDeleteButton");$(b).hide()},
G=function(){var b=$(this),b=$(b).parent().parent().parent().find(".headerFooterArea");b.toggle();b.is(":visible")?$(this).text(LABELS.labelHideAdvancedOptions):$(this).text(LABELS.labelShowAdvancedOptions)};(function(){if(0==e)g(),focusFirst();else{for(var b=[],d=[],a=0;a<e;a++)$("#templateQueries\\["+a+"\\]\\.rptTempId").val()&&b.push($("#templateQueries\\["+a+"\\]\\.rptTempId").val()),$("#templateQueries\\["+a+"\\]\\.queryId").val()&&d.push($("#templateQueries\\["+a+"\\]\\.queryId").val());bindExistingTemplate(e,
b);bindExistingTemplateQuery(e,d);b=$("#templateQueryList").find(".selectQueryLevel").select2();b.attr("readonly")&&b.select2("readonly",!0);$("#templateQueryList").find(".dateRangeEnumClass").select2().on("change",function(a){dataRangeEnumClassOnChange(this)});$("#templateQueryList").find(".expressionField").select2();$("#templateQueryList").find(".expressionOp").select2();$("#templateQueryList").find(".expressionValueSelect").select2();$("#templateQueryList").find(".expressionValueSelectAuto").select2()}$("#templateQueryList").on("click",
".templateQueryDeleteButton",function(){var a=$(this).parents(".templateQuery-div");a.find("input[id$=dynamicFormEntryDeleted]").attr("value","true");a.find(".relativeDateRangeValue")[0].value=1;a.hide();1==$(".templateQuery-div:visible").length&&m($(".templateQuery-div:visible"))});1==$(".templateQuery-div:visible").length&&m($(".templateQuery-div:visible"));$(".addTemplateQueryLineItemButton").on("click",g);$(".copyTemplateQueryLineItemButton").on("click",f);$(".showHeaderFooterArea").on("click",
G);var c=$("#enableSpotfire");0<c.length&&(c.on("change",function(){c.is(":checked")?($(".spotfire_control").attr("disabled",!1),$(".spotfire").show()):($(".spotfire_control").attr("disabled",!0),$(".spotfire").hide())}).trigger("change"),$(".spotfire_control").select2(),$spotfireDaterange=$("#spotfireDaterange"),$spotfireDaterange.on("select2:unselecting",function(a){if(1==$spotfireDaterange.parent().find(".select2-selection__choice").length)return!1}),$spotfireDaterange.val()||$spotfireDaterange.val($spotfireDaterange.find("option:eq(1)").val()).trigger("change"))})();
$("#templateQueryList").on("click",".createTemplateQueryButton",function(){var b=$(this),d=b.attr("data-url"),a=b.attr("data-message"),d=d+(-1<d.indexOf("?")?"&templateQueryIndex=":"?templateQueryIndex=");a:{for(var b=$(b).closest(".templateQuery-div"),c=0,e=$("#templateQueryList").find(".templateQuery-div"),f=0;f<e.length;f++){if($(e[f]).is(b)){b=c;break a}"false"==$(e[f]).find("input[id$=dynamicFormEntryDeleted]").val()&&c++}b=c}showWarningOrSubmit(d+b,a)})});
function bindTemplateSelect2(e,g){return bindSelect2WithUrl(e,templateList,g)}function bindQuerySelect2(e,g){return bindSelect2WithUrl(e,queryList,g)}function bindExistingTemplate(e,g){$.ajax({url:templateIdNameListUrl,type:"POST",dataType:"json",data:{templateIdList:g.join(",")},success:function(f){bindExistingTemplateSuccessCallback(e,f.templateIdNameList)}})}
function bindExistingTemplateQuery(e,g){$.ajax({url:queryIdNameListUrl,type:"POST",dataType:"json",data:{queryIdList:g.join(",")},success:function(f){bindExistingTemplateQuerySuccessCallback(e,f.queryIdNameList)}})}
function bindExistingTemplateSuccessCallback(e,g){for(var f={},c=0;c<e;c++)if(f={},$("#templateQueries\\["+c+"\\]\\.rptTempId").val())f.id=$("#templateQueries\\["+c+"\\]\\.rptTempId").val(),f.text=$.grep(g,function(c){return c.id==f.id})[0].text,bindTemplateSelect2($("#templateQueryList").find("#templateQueries\\["+c+"\\]\\.template"),f).on("change",function(c){selectTemplateOnChange(this,cioms1Id)});else bindTemplateSelect2($("#templateQueryList").find("#templateQueries\\["+c+"\\]\\.template")).on("change",
function(c){selectTemplateOnChange(this,cioms1Id)})}
function bindExistingTemplateQuerySuccessCallback(e,g){for(var f={},c=0;c<e;c++)if(f={},$("#templateQueries\\["+c+"\\]\\.queryId").val())f.id=$("#templateQueries\\["+c+"\\]\\.queryId").val(),f.text=$.grep(g,function(c){return c.id==f.id})[0].text,bindQuerySelect2($("#templateQueryList").find("#templateQueries\\["+c+"\\]\\.query"),f).on("change",function(c){selectQueryOnChange(this)});else bindQuerySelect2($("#templateQueryList").find("#templateQueries\\["+c+"\\]\\.query")).on("change",function(c){selectQueryOnChange(this)})}
;