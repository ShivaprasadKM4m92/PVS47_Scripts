var signal=signal||{};
signal.alertComments=function(){var f=function(a,d,b){var e=$("#commentbox").val();$.ajax({url:"/signal/alertComment/listComments",data:d,success:function(c){c?(a.find("#no-comments").addClass("hide"),a.find("#commentbox").removeClass("hide"),a.find(".add-comments").html("Update"),e.length>=c.comments.length?a.find("#commentbox").val(e):a.find("#commentbox").val(c.comments),a.find("#commentId").val(c.id),a.find(".createdBy").text("Last Modified by "+c.modifiedBy+" on "+c.dateUpdated),a.find(".add-comments").prop("disabled",
!0)):"undefined"!=typeof isCommentAdded&&isCommentAdded&&b?(a.find("#commentId").val(""),a.find(".add-comments").html("Add"),a.find("#commentbox").val(""),a.find("#no-comments").removeClass("hide"),a.find(".add-comments").prop("disabled",!0),a.find(".createdBy").text("")):"undefined"!=typeof isCommentAdded&&isCommentAdded?(a.find("#commentId").val(""),a.find(".add-comments").html("Add"),a.find("#commentbox").val(""),a.find("#no-comments").removeClass("hide"),a.find(".add-comments").prop("disabled",
!0),a.find("#commentbox").addClass("hide"),a.find(".createdBy").text("")):(a.find("#commentId").val(""),a.find(".createdBy").text(""),a.find(".add-comments").html("Add"),a.find(".add-comments").prop("disabled",!0));a.find("#commentbox").on("keyup",function(){""==a.find("#commentId").val()&&""==a.find("#commentbox").val()?a.find(".add-comments").prop("disabled",!0):a.find(".add-comments").prop("disabled",!1)})},error:function(){console.log("Unable to load previous comments.")}})},g=function(a){a.find(".add-comments").unbind().click(function(){var d=
[],b=$("#application").html(),e=$("#validatedSignalId").html();$("#topicId").html();""==b&&(b=a.find("#application").html(),e=a.find("#validatedSignalId").html(),a.find("#topicId").html());var c;c={alertType:b,productName:a.find("#productName").html(),eventName:a.find("#eventName").html(),comments:a.find("#commentbox").val(),validatedSignalId:e,assignedTo:a.find("#assignedTo").html(),executedConfigId:a.find("#executedConfigId").html(),configId:a.find("#configId").html(),topicId:a.find("#topicId").html(),
productFamily:a.find("#prodFamily").html(),caseNumber:a.find("#caseNo").html(),productId:parseInt(a.find("#productId").html()),ptCode:parseInt(a.find("#ptCode").html())};d.push(c);a.find("#commentId").val()?(c="/signal/alertComment/updateComment",b={alertType:b,comment:a.find("#commentbox").val(),id:a.find("#commentId").val(),executedConfigId:a.find("#executedConfigId").html(),validatedSignalId:e}):(c="/signal/alertComment/saveComment",b={caseJsonObjArray:JSON.stringify(d)});$.ajax({url:c,data:b,
type:"POST",async:!1,success:function(b){b.success&&(a.find("#isUpdated").val("true"),f(a,d[0]),$("#commentbox").val("").blur())},error:function(){}})})};return{list_comments:function(a){var d=$("#commentModal");f(d,a);var b;b="Aggregate Case Alert"==a.alertType?'<span id="productName">'+a.productName+'</span> - <span id="eventName">'+a.eventName+"</span>":'<span id="caseNumber">'+a.caseNumber+'</span> - <span id="productFamily">'+a.productFamily+"</span>";d.find("#comment-meta-info").html(b);d.find("#application").html(a.alertType);
d.modal("show");g(d)},populate_comments:f,save_comment:g}}();