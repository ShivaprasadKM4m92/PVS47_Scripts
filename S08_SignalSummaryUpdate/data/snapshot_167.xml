<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="167">
  <HTTPTask id="838" hostname="10.100.22.24:8181" path="/signal/assets/app/pvs/validated_signal/actionManagement-f820db355f55ab6e392ac1989dd91a74.js" url="http://10.100.22.24:8181/signal/assets/app/pvs/validated_signal/actionManagement-f820db355f55ab6e392ac1989dd91a74.js" ip="10.100.22.24" port="8181" connectionId="28" origin="Primary" frame="1" startDateTime="2020-05-25T16:45:47.851+05:30" startTime="9190625" endTime="9191000">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0OjgxODE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgxLjAuNDA0NC4xMzggU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC92YWxpZGF0ZWRTaWduYWwvZGV0YWlscz9pZD04NDc5</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj04NjVkZTBjYy1iMmY3LTRlMGMtYjYzNC1kZDQ3ODE3ZmY5YTE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9zaWduYWwvYXNzZXRzL2FwcC9wdnMvdmFsaWRhdGVkX3NpZ25hbC9hY3Rpb25NYW5hZ2VtZW50LWY4MjBkYjM1NWY1NWFiNmUzOTJhYzE5ODlkZDkxYTc0LmpzIEhUVFAvMS4xDQpIb3N0OiAxMC4xMDAuMjIuMjQ6ODE4MQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgxLjAuNDA0NC4xMzggU2FmYXJpLzUzNy4zNg0KQWNjZXB0OiAqLyoNClJlZmVyZXI6IGh0dHA6Ly8xMC4xMDAuMjIuMjQ6ODE4MS9zaWduYWwvdmFsaWRhdGVkU2lnbmFsL2RldGFpbHM/aWQ9ODQ3OQ0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTLGVuO3E9MC45DQpDb29raWU6IFNFU1NJT049ODY1ZGUwY2MtYjJmNy00ZTBjLWI2MzQtZGQ0NzgxN2ZmOWExDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ODY1ZGUwY2MtYjJmNy00ZTBjLWI2MzQtZGQ0NzgxN2ZmOWEx</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>18146</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Last-Modified" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyMSBNYXkgMjAyMCAwODoxNzo1MiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ImFwcC9wdnMvdmFsaWRhdGVkX3NpZ25hbC9hY3Rpb25NYW5hZ2VtZW50LWY4MjBkYjM1NWY1NWFiNmUzOTJhYzE5ODlkZDkxYTc0LmpzIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTgxNDY=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyNSBNYXkgMjAyMCAxMToxMDoxMiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KTGFzdC1Nb2RpZmllZDogVGh1LCAyMSBNYXkgMjAyMCAwODoxNzo1MiBHTVQNCkVUYWc6ICJhcHAvcHZzL3ZhbGlkYXRlZF9zaWduYWwvYWN0aW9uTWFuYWdlbWVudC1mODIwZGIzNTVmNTVhYjZlMzkyYWMxOTg5ZGQ5MWE3NC5qcyINClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KQ2FjaGUtQ29udHJvbDogcHVibGljLCBtYXgtYWdlPTMxNTM2MDAwDQpDb250ZW50LUVuY29kaW5nOiBnemlwDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQ7Y2hhcnNldD1VVEYtOA0KQ29udGVudC1MZW5ndGg6IDE4MTQ2DQpEYXRlOiBNb24sIDI1IE1heSAyMDIwIDExOjEwOjEyIEdNVA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCi8vIGEgY29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHBhcnNpbmcgc3RyaW5nIG5hbWVzcGFjZXMgYW5kCi8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGluZyBuZXN0ZWQgbmFtZXNwYWNlcwpmdW5jdGlvbiBleHRlbmQoIG5zLCBuc19zdHJpbmcgKSB7CiAgICB2YXIgcGFydHMgPSBuc19zdHJpbmcuc3BsaXQoJy4nKSwKICAgICAgICBwYXJlbnQgPSBucywKICAgICAgICBwbCwgaTsKICAgIGlmIChwYXJ0c1swXSA9PSAic2lnbmFsIikgewogICAgICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7CiAgICB9CiAgICBwbCA9IHBhcnRzLmxlbmd0aDsKICAgIGZvciAoaSA9IDA7IGkgPCBwbDsgaSsrKSB7CiAgICAgICAgLy9jcmVhdGUgYSBwcm9wZXJ0eSBpZiBpdCBkb2VzbnQgZXhpc3QKICAgICAgICBpZiAodHlwZW9mIHBhcmVudFtwYXJ0c1tpXV0gPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcGFyZW50W3BhcnRzW2ldXSA9IHt9OwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbcGFydHNbaV1dOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKfQoKLy9Qcm90b3R5cGUgbWV0aG9kcwpEYXRlLnByb3RvdHlwZS5hZGREYXlzID0gZnVuY3Rpb24oZGF5cykgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTsKICAgIHJldHVybiBkYXRlOwp9OwoKQXJyYXkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGYpe2YgIT0gdmFsdWV9KTsKfTsKClNDQV9XT1JLRkxPV19TVEFUVVNfRU5VTSA9IHsgTkVXOiAnTmV3JywKICAgIEFTU09DSUFURV9SRVZJRVdFRDogJ0Fzc29jaWF0ZVJldmlld2VkJywKICAgIFBIWVNJQ0lBTl9SRVZJRVdFRDogJ1BoeXNpY2lhblJldmlld2VkJywKICAgIFJFUVVJUkVEX0VWQUxVQVRJT046ICdSZXF1aXJlZEV2YWx1YXRpb24nLAogICAgQ09OVElOVUVEX01PTklUT1JJTkc6ICdDb250aW51ZWRNb25pdG9yaW5nJwp9OwoKU0NBX0RJU1BPU0lUSU9OX0VOVU0gPSB7CiAgICBWQUxJREFURURfU0lHTkFMIDogJ1ZhbGlkYXRlZFNpZ25hbCcsCiAgICBWQUxJREFURURfTk9OX0NPTkZJUk1FRF9TSUdOQUwgOiAnVmFsaWRhdGVkTm9uQ29uZmlybWVkU2lnbmFsJywKICAgIFZBTElEQVRFRF9VTkRFUl9JTlZFU1RJR0FUSU9OIDogJ1ZhbGlkYXRlZFVuZGVySW52ZXN0aWdhdGlvbicsCiAgICBDT01NVU5JQ0FURURfU0lHTkFMIDogJ0NvbW11bmljYXRlZFNpZ25hbCcsCiAgICBOT05fVkFMSUQ6ICdOb25WYWxpZCcKfTsKClNDQV9QUklPUklUWV9FTlVNID0gewogICAgSElHSDogIkhpZ2giLAogICAgTUVESVVNOiAiTWVkaXVtIiwKICAgIExPVzogIkxPVyIKfTsKCkRBVEVfRk1UX1RaID0gIllZWVktTU0tREQiOwoKc2lnbmFsLnV0aWxzID0gKGZ1bmN0aW9uKCkgewoKICAgIHZhciBzdGFja2VkID0gZnVuY3Rpb24odG9wVmFsdWUsIGJvdHRvbVZhbHVlKSB7CiAgICAgICAgdmFyIHRvcENvbXAgPSAiIjsKICAgICAgICB2YXIgYm90dG9tQ29tcCA9ICIiOwoKICAgICAgICBpZihfLmlzRnVuY3Rpb24odG9wVmFsdWUpKSB7CiAgICAgICAgICAgIHRvcENvbXAgPSB0b3BWYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9wQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLXRvcCI+JyArIHRvcFZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oYm90dG9tVmFsdWUpKSB7CiAgICAgICAgICAgIGJvdHRvbUNvbXAgPSBib3R0b21WYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm90dG9tQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLWJvdHRvbSI+JyArIGJvdHRvbVZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3BDb21wICsgYm90dG9tQ29tcAogICAgfTsKCiAgICAvLyBBbmQgdGhpcyBpcyB0aGUgZGVmaW5pdGlvbiBvZiB0aGUgY3VzdG9tIGZ1bmN0aW9uIOKAiwogICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRtcGxfbmFtZSwgdG1wbF9kYXRhKSB7CgogICAgICAgIGlmICggIXJlbmRlci50bXBsX2NhY2hlICkgewoKCgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZSA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoIXJlbmRlci50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgdmFyIHRtcGxfZGlyID0gJy9zaWduYWwvYXNzZXRzL2FwcC9wdnMvaGJzLXRlbXBsYXRlcyc7CiAgICAgICAgICAgIHZhciB0bXBsX3VybCA9IHRtcGxfZGlyICsgJy8nICsgdG1wbF9uYW1lICsgJy5oYnMnOwoKICAgICAgICAgICAgdmFyIHRtcGxfc3RyaW5nID0gIiI7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHRtcGxfdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0bXBsX3N0cmluZyA9IGRhdGEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKHRtcGxfc3RyaW5nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdKHRtcGxfZGF0YSkKICAgIH07CgogICAgdmFyIGhic19wYXJ0aWFsID0gZnVuY3Rpb24odG1wbF9uYW1lKSB7CiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlKSB7CiAgICAgICAgICAgIGhic19wYXJ0aWFsLnRtcGxfY2FjaGUgPSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgIHZhciB0bXBsX2RpciA9ICcvc2lnbmFsL2Fzc2V0cy9hcHAvcHZzL2hicy10ZW1wbGF0ZXMnOwogICAgICAgICAgICB2YXIgdG1wbF91cmwgPSB0bXBsX2RpciArICcvJyArIHRtcGxfbmFtZSArICcuaGJzJzsKCiAgICAgICAgICAgIHZhciB0bXBsX3N0cmluZyA9ICIiOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB0bXBsX3VybCwKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdG1wbF9zdHJpbmcgPSBkYXRhCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaGJzX3BhcnRpYWwudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gdG1wbF9zdHJpbmcKICAgICAgICB9CgogICAgICAgIHJldHVybiBoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0KICAgIH07CgogICAgdmFyIGNvbXBvc2VVcmwgPSBmdW5jdGlvbihjb250cm9sbGVyLCBhY3Rpb24sIHBhcmFtcykgewogICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC8iICsgY29udHJvbGxlciArICIvIiArIGFjdGlvbiArIChfLmlzTnVsbChwYXJhbXMpID8gJycgOiAnPycgKyBjb21wb3NlUGFyYW1zKHBhcmFtcykpOwoKICAgICAgICByZXR1cm4gdXJsCiAgICB9OwoKICAgIC8vVE9ETyA6IE5lZWQgdG8gY2hhbmdlIHRoaXMgdG8gaGFuZGxlYmFyIGZvcm0sIFdpbGwgYmUgZG9uZSBsYXRlcgogICAgdmFyIHBvc3RVcmwgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBuZXdXaW5kb3cpIHsKCiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKICAgICAgICBmb3JtLm1ldGhvZCA9ICJwb3N0IjsKICAgICAgICBmb3JtLmFjdGlvbiA9IHBhdGg7CiAgICAgICAgZm9ybS5lbmN0eXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgaWYgKG5ld1dpbmRvdykgZm9ybS50YXJnZXQgPSAiX2JsYW5rIjsKCiAgICAgICAgdmFyIHRva2VuID0gJCgibWV0YVtuYW1lPSdfY3NyZiddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHZhciBwYXJhbWV0ZXIgPSAkKCJtZXRhW25hbWU9J19jc3JmX3BhcmFtZXRlciddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHBhcmFtc1twYXJhbWV0ZXJdID0gdG9rZW47CiAgICAgICAgZm9yIChsZXQga2V5IGluIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLnR5cGUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLm5hbWUgPSBrZXk7CiAgICAgICAgICAgICAgICBoaWRkZW5GaWVsZC52YWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChoaWRkZW5GaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmb3JtKTsKICAgICAgICBmb3JtLnN1Ym1pdCgpOwogICAgfQoKICAgIHZhciBjb21wb3NlUGFyYW1zID0gZnVuY3Rpb24obykgewogICAgICAgIHJldHVybiBfLm1hcChfLnBhaXJzKG8pLCBmdW5jdGlvbihwKXtyZXR1cm4gcC5qb2luKCc9Jyl9ICkuam9pbignJicpCiAgICB9OwoKICAgIHZhciBjYXBpdGFsSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgJiYgc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKTsKICAgIH07CgogICAgdmFyIGJyZWFrSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgPyBzLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCcgJykgOiBzCiAgICB9OwoKICAgIHZhciBlbmFibGVfbG9hZF9idXR0b24gPSBmdW5jdGlvbihlbGUsIGVuYWJsZWQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXRFbGUgPSBlbGUuZmluZCgnLmdseXBoaWNvbicpOwogICAgICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgICAgICAgJCh0YXJnZXRFbGUpLmFkZENsYXNzKCdyZWZyZXNoLWFuaW1hdGUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQodGFyZ2V0RWxlKS5yZW1vdmVDbGFzcygncmVmcmVzaC1hbmltYXRlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNldEluTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24ocHJvcCwgZGF0YSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHByb3AsIGRhdGEpOwogICAgfTsKCiAgICB2YXIgZ2V0RnJvbUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKHByb3ApIHsKICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvcCk7CiAgICB9OwoKICAgIHZhciBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbihwcm9wLCBkYXRhKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvcCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgfTsKCiAgICB2YXIgZ2V0SlNPTkZyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb3ApKTsKICAgIH07CgogICAgdmFyIGxvY2FsU3RvcmFnZVV0aWwgPSB7CiAgICAgICAgc2V0UHJvcCA6IHNldEluTG9jYWxTdG9yYWdlLAogICAgICAgIGdldFByb3AgOiBnZXRGcm9tTG9jYWxTdG9yYWdlLAogICAgICAgIHNldEpTT04gOiBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UsCiAgICAgICAgZ2V0SlNPTiA6IGdldEpTT05Gcm9tTG9jYWxTdG9yYWdlCiAgICB9OwoKICAgIHZhciBnZXRRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBrZXkgPSBmYWxzZSwgcmVzID0ge30sIGl0bSA9IG51bGw7CiAgICAgICAgLy8gZ2V0IHRoZSBxdWVyeSBzdHJpbmcgd2l0aG91dCB0aGUgPwogICAgICAgIHZhciBxcyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgLy8gY2hlY2sgZm9yIHRoZSBrZXkgYXMgYW4gYXJndW1lbnQKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIGtleSA9IGFyZ3VtZW50c1swXTsKICAgICAgICAvLyBtYWtlIGEgcmVnZXggcGF0dGVybiB0byBncmFiIGtleS92YWx1ZQogICAgICAgIHZhciBwYXR0ZXJuID0gLyhbXiY9XSspPShbXiZdKikvZzsKICAgICAgICAvLyBsb29wIHRoZSBpdGVtcyBpbiB0aGUgcXVlcnkgc3RyaW5nLCBlaXRoZXIKICAgICAgICAvLyBmaW5kIGEgbWF0Y2ggdG8gdGhlIGFyZ3VtZW50LCBvciBidWlsZCBhbiBvYmplY3QKICAgICAgICAvLyB3aXRoIGtleS92YWx1ZSBwYWlycwogICAgICAgIHdoaWxlIChpdG0gPSBwYXR0ZXJuLmV4ZWMocXMpKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09IGZhbHNlICYmIGRlY29kZVVSSUNvbXBvbmVudChpdG1bMV0pID09PSBrZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICByZXNbZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ga2V5ID09PSBmYWxzZSA/IHJlcyA6IG51bGw7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgcmVuZGVyIDogcmVuZGVyLAogICAgICAgIHN0YWNrZWQ6IHN0YWNrZWQsCiAgICAgICAgY29tcG9zZVVybDogY29tcG9zZVVybCwKICAgICAgICBwb3N0VXJsOiBwb3N0VXJsLAogICAgICAgIGNvbXBvc2VQYXJhbXM6IGNvbXBvc2VQYXJhbXMsCiAgICAgICAgY2FwaXRhbEl0OiBjYXBpdGFsSXQsCiAgICAgICAgYnJlYWtJdDogYnJlYWtJdCwKICAgICAgICBoYnNfcGFydGlhbDogaGJzX3BhcnRpYWwsCiAgICAgICAgZW5hYmxlX2xvYWRfYnV0dG9uOiBlbmFibGVfbG9hZF9idXR0b24sCiAgICAgICAgbG9jYWxTdG9yYWdlVXRpbDogbG9jYWxTdG9yYWdlVXRpbCwKICAgICAgICBnZXRRdWVyeVN0cmluZzogZ2V0UXVlcnlTdHJpbmcKICAgIH0KfSkoKTsKCgoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaTE4bicsCiAgICBmdW5jdGlvbihzdHIpewogICAgICAgIHJldHVybiAoICh0eXBlb2YgaTE4bikgIT09ICd1bmRlZmluZWQnID8gc3RyIDogc3RyKQogICAgfQopOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2VsZWN0JywgZnVuY3Rpb24obmFtZSwgc2VsZWN0ZWRWYWx1ZSwgb3B0aW9ucywgZGlzcF9maWVsZCwgdmFsdWVfZmllbGQpIHsKICAgIHZhciBvdXQgPSAiPHNlbGVjdCBjbGFzcz0nZm9ybS1jb250cm9sIHNlbGVjdEJveCcgaWQ9XCciICsgbmFtZSArICJcJyBuYW1lPSIgKyBuYW1lICsgIj5cbiI7CiAgICBfLmVhY2gob3B0aW9ucywgZnVuY3Rpb24odikgewogICAgICAgIG91dCArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIHZbdmFsdWVfZmllbGRdICsgIiciICsKICAgICAgICAgICAgKHZbdmFsdWVfZmllbGRdID09IHNlbGVjdGVkVmFsdWVbdmFsdWVfZmllbGRdID8gIiBzZWxlY3RlZCAiIDogIiIpICsgIiA+IiArCiAgICAgICAgICAgIGVzY2FwZUhUTUwodltkaXNwX2ZpZWxkXSkgKyAiPC9vcHRpb24+XG4iCiAgICB9KTsKICAgIG91dCArPSAiPC9zZWxlY3Q+IjsKCiAgICByZXR1cm4gbmV3IEhhbmRsZWJhcnMuU2FmZVN0cmluZyhvdXQpCn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlclBhcnRpYWwoJ2RhdGVfcGlja2VyX3RlbXBsYXRlJywgc2lnbmFsLnV0aWxzLmhic19wYXJ0aWFsKCdkYXRlX3BpY2tlcl90ZW1wbGF0ZScpKTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZiBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2VxJywgZnVuY3Rpb24oYSwgYiwgb3B0cykgewogICAgaWYgKGEgPT0gYikgewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfQp9KTsKCi8vSGFuZGxlYmFyIGhlbHBlciB0byBpbWl0YXRlIHRoZSBpZi4uZWxzZSBjb25kaXRpb25zCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2Vsc2VfZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSA9PSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfdGFnX2V4aXN0JywgZnVuY3Rpb24oa2V5LCB2YWx1ZSx0YWdzLCBvcHRzKSB7CiAgICBpZih2YWx1ZS50YWdUZXh0ID09IHRhZ3Nba2V5LTFdLnRhZ1RleHQgJiYgdmFsdWUuc3ViVGFnVGV4dCE9bnVsbCAmJiB2YWx1ZS5zdWJUYWdUZXh0ICE9IHRhZ3Nba2V5LTFdLnN1YlRhZ1RleHQpewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfSBlbHNlewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfZWxzZV9uZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSAhPSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBvcHRzLmludmVyc2UodGhpcyk7CiAgICB9Cn0pOwoKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfaGFuZGxlYmFyX2V4dC5qcwoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCnNpZ25hbC5hbGVydHNfdXRpbHMgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgcHJpb3JpdGllczsKICAgIHZhciB3b3JrZmxvd1N0YXRlczsKCiAgICB2YXIgZ2V0X3ByaW9yaXRpZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL3dvcmtmbG93L3ByaW9yaXRpZXMiLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgcHJpb3JpdGllcyA9IHJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBwcmlvcml0aWVzCiAgICB9OwoKICAgIHZhciBnZXRfd29ya2Zsb3dTdGF0ZXMgPSBmdW5jdGlvbihpbml0RGF0YSkgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvd29ya2Zsb3cvd29ya2Zsb3dTdGF0ZSIsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgZGF0YTogaW5pdERhdGEsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgd29ya2Zsb3dTdGF0ZXMgPSByZXN1bHQKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gd29ya2Zsb3dTdGF0ZXMKICAgIH07CgogICAgdmFyIHByaW9yaXRpZXNfc2VsZWN0aW9ucyA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgIHZhciBuZXdfc2VsZWN0ID0gJzxkaXY+PHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGFkZC1jdXJzb3IiICcgKwogICAgICAgICAgICAnc3R5bGU9ImhlaWdodDogMzBweDsiIG9uY2hhbmdlPSJ1cGRhdGVQcmlvcml0eSh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgcHJpb3JpdHkgPSByb3cucHJpb3JpdHk7CgogICAgICAgIHZhciB0aGVfc2VsZWN0ID0gXy5yZWR1Y2UocHJpb3JpdGllcywgZnVuY3Rpb24obSwgcCl7CiAgICAgICAgICAgIGlmIChwLnZhbHVlID09IHByaW9yaXR5KQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIiBzZWxlY3RlZD4gJyArIHAuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHAudmFsdWUgKyAnIj4nICsgcC5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nCiAgICAgICAgfSwgbmV3X3NlbGVjdCk7CiAgICAgICAgdGhlX3NlbGVjdCA9IHRoZV9zZWxlY3QgKyAnPC9zZWxlY3Q+PC9kaXY+JzsKICAgICAgICByZXR1cm4gdGhlX3NlbGVjdDsKICAgIH07CgogICAgdmFyIHdvcmtmbG93X3NlbGVjdGlvbnMgPSBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICB2YXIgbmV3X3NlbGVjdCA9ICc8ZGl2PjxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBhZGQtY3Vyc29yIiBzdHlsZT0iaGVpZ2h0OiAzMHB4OyIgb25jaGFuZ2U9InVwZGF0ZVN0YXR1cyh0aGlzLnZhbHVlLCcgKyByb3cuaWQgKyAnKSI+JzsKICAgICAgICB2YXIgd29ya2Zsb3dTdGF0ZSA9IHJvdy53b3JrZmxvd1N0YXRlOwoKICAgICAgICB2YXIgdGhlX3NlbGVjdCA9IF8ucmVkdWNlKHdvcmtmbG93U3RhdGVzLCBmdW5jdGlvbihtLCB3cyl7CiAgICAgICAgICAgIGlmICh3cy52YWx1ZSA9PSB3b3JrZmxvd1N0YXRlKQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHdzLnZhbHVlICsgJyIgc2VsZWN0ZWQ+ICcgKyB3cy5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbSArICc8b3B0aW9uIHZhbHVlPSInICsgd3MudmFsdWUgKyAnIj4nICsgd3MuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JwogICAgICAgIH0sIG5ld19zZWxlY3QpOwogICAgICAgIHRoZV9zZWxlY3QgPSB0aGVfc2VsZWN0ICsgJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIHRoZV9zZWxlY3Q7CiAgICB9OwoKICAgIHZhciBjb21wb3NlX2VkaXRfc3RhdGVfbGluayA9IGZ1bmN0aW9uKHZhbHVlLCByb3dJZCwgZmlsZWROYW1lKSB7CiAgICAgICAgcmV0dXJuICI8c3Bhbj4iICsgdmFsdWUgKyAiPC9zcGFuPiIgKyAiPGEgaHJlZj0nIycgY2xhc3M9J2VkaXQtc3RhdGUnID4iICsKICAgICAgICAgICAgIjxpIGNsYXNzPSdmYSBmYS1zaGFyZS1hbHQgcHVsbC1yaWdodCcgZGF0YS1maWVsZD0nIiAgKyBmaWxlZE5hbWUgKwogICAgICAgICAgICAiJyBkYXRhLWlkPSciICsgcm93SWQgKyAiJy8+PC9hPiIKICAgIH07CgogICAgdmFyIHN0YXRlX2NoYW5nZWQgPSBmdW5jdGlvbihleHRyYV92YWx1ZXMpIHsKICAgICAgICAkKCIjdmFsdWVTZWxlY3QiKS5jaGFuZ2UoZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciBhdmFpbGFibGVfZXh0cmFfdmFsdWVzID0gZXh0cmFfdmFsdWVzWyQodmFsdWVTZWxlY3QpLnZhbCgpXQogICAgICAgIH0pCiAgICB9OwoKICAgIC8vVE9ETyB0aGlzIGlzIGEgdGVtcCBzb2x1dGlvbiBmb3IgdGhlIEpTT04gZm9ybWF0LiBJdCBzaG91bGQgY29tZSBmcm9tIHNlcnZlciBzaWRlCiAgICAvL0Z1bmN0aW9uIHRoYXQgY29udmVydHMgdGhlIGpzb24gaW5uZXJodG1sIHRvIHRoZSBjc3YgdmFsdWVzLgogICAgLy9JdCBjb252ZXJ0cyB0aGUgcHJvcGVydGllcyB3aGljaCBhcmUgbm90IGlkLgogICAgdmFyIHNob3dfanNvbl9hc19jc3YgPSBmdW5jdGlvbiAoZWxlbWVudENsYXNzKSB7CiAgICAgICAgJCgiLiIgKyBlbGVtZW50Q2xhc3MpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKGlzTmFOKCQodGhpcykuaHRtbCgpKSkgewogICAgICAgICAgICAgICAgICB2YXIgbW9kaWZpZWRWYWwgPSAiIjsKICAgICAgICAgICAgICAgICAgdmFyIGpzb25WYWwgPSBKU09OLnBhcnNlKCQodGhpcykuaHRtbCgpKTsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgb2JqIGluIGpzb25WYWwpIHsKICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb25WYWwuaGFzT3duUHJvcGVydHkob2JqKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGpzb25WYWxbb2JqXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvblZhbFtvYmpdLmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wICE9ICdpZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kaWZpZWRWYWwgPSBtb2RpZmllZFZhbCArIGpzb25WYWxbb2JqXVtwcm9wXSArICIsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgJCh0aGlzKS5odG1sKG1vZGlmaWVkVmFsLnNsaWNlKDAsIC0xKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgLy9EbyBub3RoaW5nCiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhlcnIpCiAgICAgICAgICAgfQogICAgICAgICAgICQodGhpcykuaHRtbCgpCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRfbWF0Y2hlZF9hbGVydHNfdGFibGUgPSBmdW5jdGlvbih0YWJsZUVsZSwgdXJsKSB7CiAgICAgICAgdmFyIHRhYmxlID0gdGFibGVFbGUuRGF0YVRhYmxlKHsKICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgInVybCI6ICIvc2lnbmFsL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhamF4OiB7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGFTcmM6ICcnLAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHhocixzdGF0dXMsZXJyb3Ipe30KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFvQ29sdW1uczpbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICduYW1lJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ3Byb2R1Y3RTZWxlY3Rpb24nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAndG9waWMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAnZGV0ZWN0ZWREYXRlJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ2Rpc3Bvc2l0aW9uJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBkb206ICcnCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YWJsZQogICAgfTsKCiAgICB2YXIgZ2V0U2lnbmFsTmFtZUxpc3QgPSBmdW5jdGlvbihzaWduYWxzQW5kVG9waWNzKSB7CiAgICAgICAgdmFyIHNpZ25hbEFuZFRvcGljcyA9ICcnOwogICAgICAgICQuZWFjaChzaWduYWxzQW5kVG9waWNzLCBmdW5jdGlvbihpLCBvYmopewogICAgICAgICAgICB2YXIgdXJsID0gc2lnbmFsRGV0YWlsVXJsICsgJz9pZD0nICsgb2JqWydzaWduYWxJZCddOwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAnPHNwYW4gY2xhc3M9ImNsaWNrIj48YSBocmVmPSInICsgdXJsICsgJyI+JyArIG9ialsnbmFtZSddICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAiLCIKICAgICAgICB9KTsKICAgICAgICBpZihzaWduYWxBbmRUb3BpY3MubGVuZ3RoID4gMSkKICAgICAgICAgICAgcmV0dXJuICc8ZGl2PicgKyBzaWduYWxBbmRUb3BpY3Muc3Vic3RyaW5nKDAsIHNpZ25hbEFuZFRvcGljcy5sZW5ndGggLSAxKSArICc8L2Rpdj4nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuICctJzsKICAgIH07CgogICAgLy8gRm9yIHNoYXJlZCB3aXRoIG1vZGFsCiAgICB2YXIgaW5pdGlhbGl6ZVNoYXJlV2l0aFNlbGVjdDIgPSBmdW5jdGlvbigpewogICAgICAgICQoJyNzaGFyZVdpdGgnKS5zZWxlY3QyKCkub24oImNoYW5nZSIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICQoJyNzaGFyZVdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBpbml0aWFsaXplU2hhcmVXaXRoVmFsdWVzID0gZnVuY3Rpb24oKXsKICAgICAgICAkKCcjc2hhcmVkV2l0aE1vZGFsJykub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gZS5yZWxhdGVkVGFyZ2V0LmlkOwogICAgICAgICAgICAkKCcjZXhlY3V0ZWRDb25maWdJZCcpLnZhbChleGVjdXRlZENvbmZpZ0lkKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnaGFzLWVycm9yJyk7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsCiAgICAgICAgICAgICAgICB1cmw6IGdldFNoYXJlZFdpdGggKyAnP2lkPScgKyBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJlc3VsdC51c2VycywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzICs9IHRoaXMubmFtZSArICc8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhVc2VyTGlzdCcpLmh0bWwodXNlcnMpOwogICAgICAgICAgICAgICAgICAgIHZhciBncm91cHMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0Lmdyb3VwcywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwcyArPSAgdGhpcy5uYW1lICsgJyA8YnIgLz4nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGhHcm91cExpc3QnKS5odG1sKGdyb3Vwcyk7CgogICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXN1bHQuYWxsLCBmdW5jdGlvbihpLCBkYXRhKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oZGF0YS5uYW1lLCBkYXRhLmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBzaGFyZWRXaXRoTW9kYWxTaG93ID0gdHJ1ZTsKCiAgICAgICAgfSkub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgc2hhcmVkV2l0aE1vZGFsU2hvdyA9IGZhbHNlOwogICAgICAgICAgICAkKCcjc2hhcmVkV2l0aCcpLnZhbChudWxsKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS5maW5kKCdvcHRpb24nKS5yZW1vdmUoKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGdldFRhZ3NFbGVtZW50ID0gZnVuY3Rpb24odGFncykgewogICAgICAgIHZhciB0YWdzRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJ0YWctY29udGFpbmVyIGJsb2NrLWVsbGlwc2lzIj48ZGl2IGNsYXNzPSJ0YWctbGVuZ3RoIj4nOwogICAgICAgIHZhciBnbG9iYWxUYWdzQXJyYXkgPSBbXTsKICAgICAgICB2YXIgYWxlcnRUYWdzcnJheSA9IFtdOwogICAgICAgIHZhciBwcml2YXRlVGFnc0FycmF5ID0gW107CiAgICAgICAgJC5lYWNoKHRhZ3MsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5wcml2YXRlVXNlciA9PSAnKFApJykgewogICAgICAgICAgICAgICAgcHJpdmF0ZVRhZ3NBcnJheS5wdXNoKHZhbHVlKQogICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLnRhZ1R5cGUgPT0gJyhBKScpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VGFnc3JyYXkucHVzaCh2YWx1ZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsb2JhbFRhZ3NBcnJheS5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YWdzRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHMnLCB7CiAgICAgICAgICAgICAgICBrZXk6IGtleSwKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgIHRhZ3M6dGFncywKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHZpZXdBbGxFbGVtZW50cyA9IGZldGNoVmlld0FsbFRhZ3MoZ2xvYmFsVGFnc0FycmF5ICwgYWxlcnRUYWdzcnJheSAsIHByaXZhdGVUYWdzQXJyYXkpOwoKICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSJBZGQvRWRpdCBDYXRlZ29yaWVzIiBjbGFzcz0iZWRpdEFsZXJ0VGFncyBidG4tZWRpdC10YWcgbWlkIj48aSBjbGFzcz0ibWRpIG1kaS1wZW5jaWwtYm94IGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgIHRhZ3NFbGVtZW50ICs9ICc8YSB0YWJpbmRleD0iMCIgdGl0bGU9IicgKyAkLmkxOG4uXygnYXBwTGFiZWwudmlld0FsbCcpICsgJyIgY2xhc3M9Imljby1kb3RzIHZpZXctYWxsIiBtb3JlLWRhdGE9Iicrdmlld0FsbEVsZW1lbnRzKyciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICB0YWdzRWxlbWVudCArPSAnPC9kaXY+PC9kaXY+JzsKICAgICAgICByZXR1cm4gdGFnc0VsZW1lbnQKICAgIH07CgogICAgdmFyIGZldGNoVmlld0FsbFRhZ3MgPSBmdW5jdGlvbihnbG9iYWxUYWdzQXJyYXkgLCBhbGVydFRhZ3NBcnJheSAsIHByaXZhdGVUYWdzQXJyYXkpIHsKICAgICAgICB2YXIgcmV0dXJuRWxlbWVudCA9ICIiOwogICAgICAgIGlmIChnbG9iYWxUYWdzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXR1cm5FbGVtZW50ID0gIjxwIGNsYXNzPSdwYnInIHN0eWxlPSdtYXJnaW4tdG9wOjdweCc+PGI+R2xvYmFsIENhdGVnb3J5PC9iPjxociBjbGFzcz0ndGFnZWhyJz4iOwogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlsc192aWV3X2FsbCcsIHt0YWdzOiBnbG9iYWxUYWdzQXJyYXl9KSArICI8L3A+IiAgOwogICAgICAgIH0KICAgICAgICBpZiAoYWxlcnRUYWdzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9ICI8cCBjbGFzcz0ncGJyJyBzdHlsZT0nbWFyZ2luLXRvcDo3cHgnPjxiPkFsZXJ0IFNwZWNpZmljIENhdGVnb3J5PC9iPjxociBjbGFzcz0ndGFnZWhyJz4iOwogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlsc192aWV3X2FsbCcsIHsKICAgICAgICAgICAgICAgIHRhZ3M6IGFsZXJ0VGFnc0FycmF5LAogICAgICAgICAgICB9KSAgKyAiPC9wPiIgOwogICAgICAgIH0KICAgICAgICBpZiAocHJpdmF0ZVRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gIjxwIGNsYXNzPSdwYnInIHN0eWxlPSdtYXJnaW4tdG9wOjdweCc+PGI+UHJpdmF0ZSBDYXRlZ29yeTwvYj48aHIgY2xhc3M9J3RhZ2Vocic+IjsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHNfdmlld19hbGwnLCB7dGFnczogcHJpdmF0ZVRhZ3NBcnJheX0pICArICI8L3A+IiA7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXR1cm5FbGVtZW50CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgICBnZXRfcHJpb3JpdGllczogZ2V0X3ByaW9yaXRpZXMsCiAgICAgICAgcHJpb3JpdGllc19zZWxlY3Rpb25zOiBwcmlvcml0aWVzX3NlbGVjdGlvbnMsCiAgICAgICAgZ2V0X3dvcmtmbG93U3RhdGVzOiBnZXRfd29ya2Zsb3dTdGF0ZXMsCiAgICAgICAgd29ya2Zsb3dfc2VsZWN0aW9uczogd29ya2Zsb3dfc2VsZWN0aW9ucywKICAgICAgICBjb21wb3NlX2VkaXRfc3RhdGVfbGluazogY29tcG9zZV9lZGl0X3N0YXRlX2xpbmssCiAgICAgICAgc3RhdGVfY2hhbmdlOiBzdGF0ZV9jaGFuZ2VkLAogICAgICAgIHNob3dfanNvbl9hc19jc3Y6IHNob3dfanNvbl9hc19jc3YsCiAgICAgICAgaW5pdF9tYXRjaGVkX2FsZXJ0c190YWJsZTogaW5pdF9tYXRjaGVkX2FsZXJ0c190YWJsZSwKICAgICAgICBnZXRTaWduYWxOYW1lTGlzdDogZ2V0U2lnbmFsTmFtZUxpc3QsCiAgICAgICAgaW5pdGlhbGl6ZVNoYXJlV2l0aFNlbGVjdDIgOiBpbml0aWFsaXplU2hhcmVXaXRoU2VsZWN0MiwKICAgICAgICBpbml0aWFsaXplU2hhcmVXaXRoVmFsdWVzOmluaXRpYWxpemVTaGFyZVdpdGhWYWx1ZXMsCiAgICAgICAgZ2V0X3RhZ3NfZWxlbWVudCA6IGdldFRhZ3NFbGVtZW50CiAgICB9Cn0pKCk7Cgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKc2lnbmFsLmxpc3RfdXRpbHMgPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIGZsYWdfaXQgPSBmdW5jdGlvbiAoZmxhZywgaWQpIHsKICAgICAgICB2YXIgdGhlSHRtbCA9ICc8aSBjbGFzcz0iZmEgZmEtZmxhZy1vIHRleHQtbXV0ZWQgcngtbGlzdC1mbGFnIiBkYXRhLWlkPSInICsgaWQgKyAnIj48L2k+JwogICAgICAgIGlmIChmbGFnKSB7CiAgICAgICAgICAgIHRoZUh0bWwgPSAnPGkgY2xhc3M9ImZhIGZhLWZsYWcgdGV4dC1wcmltYXJ5IHJ4LWxpc3QtZmxhZyIgZGF0YS1pZD0iJyArIGlkICsgJyI+PC9pPicKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoZUh0bWwKICAgIH07CgogICAgdmFyIGZsYWdfaGFuZGxlciA9IGZ1bmN0aW9uIChjb250cm9sbGVyLCBhY3Rpb24pIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnJ4LWxpc3QtZmxhZycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBlbGUgPSBlLnRhcmdldDsKICAgICAgICAgICAgdmFyIGlkID0gJChlbGUpLmF0dHIoJ2RhdGEtaWQnKTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICIvc2lnbmFsLyIgKyBjb250cm9sbGVyICsgIi8iICsgYWN0aW9uICsgIj9pZD0iICsgaWQsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5mbGFnZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlKS5yZW1vdmVDbGFzcygnZmEtZmxhZy1vJykucmVtb3ZlQ2xhc3MoJ3RleHQtbXV0ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLmFkZENsYXNzKCdmYS1mbGFnJykuYWRkQ2xhc3MoJ3RleHQtcHJpbWFyeScpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlKS5hZGRDbGFzcygnZmEtZmxhZy1vJykuYWRkQ2xhc3MoJ3RleHQtbXV0ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLnJlbW92ZUNsYXNzKCdmYS1mbGFnJykucmVtb3ZlQ2xhc3MoJ3RleHQtcHJpbWFyeScpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBwcmlvcml0eV9saW5rID0gZnVuY3Rpb24gKHByaW9yaXR5LCBpZCkgewogICAgICAgIHZhciBpY29uX3VybCA9IGNvbXBvc2VfcHJpb3JpdHlfaWNvbihwcmlvcml0eSk7CiAgICAgICAgcmV0dXJuICc8YSBocmVmPSIjIiBjbGFzcz0iY2hhbmdlLXByaW9yaXR5Ij48aW1nIGRhdGEtZmllbGQ9InByaW9yaXR5IiBkYXRhLWluZm89InJvdyIgZGF0YS1pZD0iJyArCiAgICAgICAgICAgIGlkICsgJyIgZGF0YS12YWx1ZT0iJyArIHByaW9yaXR5ICsgJyIgc3JjPSInICsgaWNvbl91cmwgKyAnIi8+PC9hPicKICAgIH07CgogICAgdmFyIGNvbXBvc2VfcHJpb3JpdHlfaWNvbiA9IGZ1bmN0aW9uIChwcmlvcml0eSkgewogICAgICAgIHZhciBpY29uX3VybCA9ICIvc2lnbmFsL2Fzc2V0cy9pY29ucy9kZWZhdWx0X3ByaW9yaXR5LnBuZyI7CgogICAgICAgIGlmIChfLmNvbnRhaW5zKFsnaGlnaCcsICdsb3cnLCAnbWVkaXVtJ10sIHByaW9yaXR5LnRvTG93ZXJDYXNlKCkpKSB7CiAgICAgICAgICAgIGljb25fdXJsID0gIi9zaWduYWwvYXNzZXRzL2ljb25zLyIgKyBwcmlvcml0eS50b0xvd2VyQ2FzZSgpICsgIl9wcmlvcml0eS5wbmciOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaWNvbl91cmw7CiAgICB9OwoKICAgIHZhciBjaGFuZ2VfcHJpb3JpdHkgPSBmdW5jdGlvbiAocHJpb3JpdHlFbGUsIHByaW9yaXR5KSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gY29tcG9zZV9wcmlvcml0eV9pY29uKHByaW9yaXR5KTsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJzcmMiLCBpY29uX3VybCk7CiAgICAgICAgJChwcmlvcml0eUVsZSkuYXR0cigiZGF0YS12YWx1ZSIsIHByaW9yaXR5KTsKICAgIH07CgogICAgdmFyIGNoYW5nZV9wcmlvcml0eVRlc3QgPSBmdW5jdGlvbiAocHJpb3JpdHlFbGUsIHByaW9yaXR5KSB7CiAgICAgICAgJChwcmlvcml0eUVsZSkuYXR0cigiZGF0YS12YWx1ZSIsIHByaW9yaXR5KTsKICAgIH07CgogICAgY2hhbmdlX3ByaW9yaXR5VGVzdAoKICAgIHZhciBmaW5kX2ZpZWxkID0gZnVuY3Rpb24gKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSkgewogICAgICAgIHJldHVybiAkKHRhYmxlX3Jvd19lbGUpLmZpbmQoIltkYXRhLWF0dHJpYnV0ZS1uYW1lPSciICsgYXR0cl9uYW1lICsgIiddIikKICAgIH07CgogICAgdmFyIHNldF92YWx1ZSA9IGZ1bmN0aW9uICh0YWJsZV9yb3dfZWxlLCBhdHRyX25hbWUsIGlkLCBkYXRhX2Z1biwgYXBwX25hbWUpIHsKICAgICAgICB2YXIgZWxlID0gZmluZF9maWVsZCh0YWJsZV9yb3dfZWxlLCBhdHRyX25hbWUpOwogICAgICAgIGVsZS5odG1sKGRhdGFfZnVuKGlkLCBhcHBfbmFtZSkpOwogICAgfTsKCiAgICB2YXIgZ2V0X2R1ZV9pbiA9IGZ1bmN0aW9uIChpZCwgYXBwX25hbWUpIHsKICAgICAgICB2YXIgZHVlSW4gPSAwOwogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvYWxlcnQvZHVlSW4/YWxlcnRJZD0iICsgaWQgKyAiJmFwcE5hbWU9IiArIGFwcF9uYW1lLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICBkdWVJbiA9IGRhdGEucmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGR1ZUluCiAgICB9OwoKICAgIHZhciBkdWVfaW5fY29tcCA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAiPGRpdiBkYXRhLWF0dHJpYnV0ZS1uYW1lPSdkdWVJbicgc3R5bGUgPSAnY29sb3I6cmVkJz4iICsgdmFsdWUgKyAiPC9kaXY+IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gIjxkaXYgZGF0YS1hdHRyaWJ1dGUtbmFtZT0nZHVlSW4nPiIgKyB2YWx1ZSArICI8L2Rpdj4iOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGFzc2lnbmVkX3RvX2NvbXAgPSBmdW5jdGlvbiAoaWQsIGFzc2lnbmVkVG8pIHsKICAgICAgICB2YXIgaHRtbCA9ICc8ZGl2IGNsYXNzPSJhc3NpZ25lZFRvQ29udGFpbmVyIj48c2VsZWN0IGNsYXNzPSJhc3NpZ25lZFRvU2VsZWN0IGZvcm0tY29udHJvbCBzZWxlY3QyIj48L3NlbGVjdD48aSBjbGFzcz0ibWRpIG1kaS1zcGluIG1kaS1sb2FkaW5nIGFzc2lnblRvUHJvY2Vzc2luZyIgc3R5bGU9ImRpc3BsYXk6IG5vbmUiPjwvaT48L2Rpdj4nOwogICAgICAgIHJldHVybiBodG1sCiAgICB9OwoKICAgIHZhciB0cnVuY2F0ZVRleHRBbmRTaG93VG9vbHRpcCA9IGZ1bmN0aW9uIChjdXRvZmYsIHdvcmRicmVhaywgZXNjYXBlSHRtbCkgewogICAgICAgIHZhciBlc2MgPSBmdW5jdGlvbiAodCkgewogICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JykKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JykKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csICcmZ3Q7JykKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgICAgICB9OwoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGQsIHR5cGUsIHJvdykgewogICAgICAgICAgICAvLyBPcmRlciwgc2VhcmNoIGFuZCB0eXBlIGdldCB0aGUgb3JpZ2luYWwgZGF0YQogICAgICAgICAgICBpZiAodHlwZSAhPT0gJ2Rpc3BsYXknKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHR5cGVvZiBkICE9PSAnbnVtYmVyJyAmJiB0eXBlb2YgZCAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkID0gZC50b1N0cmluZygpOyAvLyBjYXN0IG51bWJlcnMKCiAgICAgICAgICAgIGlmIChkLmxlbmd0aCA8PSBjdXRvZmYpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlc2MoZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzaG9ydGVuZWQgPSBkLnN1YnN0cigwLCBjdXRvZmYgLSAxKTsKCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIGxhc3Qgd2hpdGUgc3BhY2UgY2hhcmFjdGVyIGluIHRoZSBzdHJpbmcKICAgICAgICAgICAgaWYgKHdvcmRicmVhaykgewogICAgICAgICAgICAgICAgc2hvcnRlbmVkID0gc2hvcnRlbmVkLnJlcGxhY2UoL1xzKFteXHNdKikkLywgJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBQcm90ZWN0IGFnYWluc3QgdW5jb250cm9sbGVkIEhUTUwgaW5wdXQKICAgICAgICAgICAgaWYgKGVzY2FwZUh0bWwpIHsKICAgICAgICAgICAgICAgIHNob3J0ZW5lZCA9IGVzYyhzaG9ydGVuZWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSJlbGxpcHNpcyIgdGl0bGU9IicgKyBlc2MoZCkgKyAnIj4nICsgc2hvcnRlbmVkICsgJyYjODIzMDs8L3NwYW4+JzsKICAgICAgICB9OwogICAgfTsKCiAgICB2YXIgYWRkX2ZpbHRlcnMgPSBmdW5jdGlvbiAodGFibGUsIGZpbHRlcnMsIGZpbHRlcl90b2dnbGVfYnRfY29udGFpbmVyKSB7CgogICAgICAgIHZhciB5YWRjZl9maWx0ZXJzID0gXy5maWx0ZXIoZmlsdGVycywgZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgaWYgKGZbMV0gIT0gJ2N1c3RvbWl6ZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgY3VzdF9maWx0ZXJzID0gXy5kaWZmZXJlbmNlKGZpbHRlcnMsIHlhZGNmX2ZpbHRlcnMpOwoKICAgICAgICB5YWRjZi5pbml0KHRhYmxlLCBfLm1hcCh5YWRjZl9maWx0ZXJzLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBpZiAoaXRlbVsyXSA9PSB0cnVlKQogICAgICAgICAgICAgICAgcmV0dXJuIHtjb2x1bW5fbnVtYmVyOiBpdGVtWzBdLCBmaWx0ZXJfdHlwZTogaXRlbVsxXSwgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiAneCd9OwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4ge2NvbHVtbl9udW1iZXI6IGl0ZW1bMF0sIGZpbHRlcl90eXBlOiBpdGVtWzFdLCBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlfTsKICAgICAgICB9KSk7CgogICAgICAgIGlmIChmaWx0ZXJfdG9nZ2xlX2J0X2NvbnRhaW5lcikgewogICAgICAgICAgICBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b24oJ2lkeHh4eHh4JywgZmlsdGVyX3RvZ2dsZV9idF9jb250YWluZXIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGN1c3RfZmlsdGVycykgewogICAgICAgICAgICBfLmVhY2goY3VzdF9maWx0ZXJzLCBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgJCh0YWJsZS5jb2x1bW4oZlswXSkuaGVhZGVyKCkpLmFwcGVuZChjcmVhdGVfc3RhY2tlZF9maWx0ZXIoZlswXSkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBjcmVhdGVfc3RhY2tlZF9maWx0ZXIgPSBmdW5jdGlvbiAoaWR4KSB7CiAgICAgICAgcmV0dXJuICQoIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLWluZGV4PSciICsgaWR4ICsgIicgY2xhc3M9J2NvbHVtbi1maWx0ZXInIHBsYWNlaG9sZGVyPSdUeXBlIHRvIGZpbHRlcic+IiArCiAgICAgICAgICAgICI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1pbmRleD0nIiArIGlkeCArICInIGNsYXNzPSdjb2x1bW4tZmlsdGVyJyBwbGFjZWhvbGRlcj0nVHlwZSB0byBmaWx0ZXInPiIpOwogICAgfTsKCiAgICB2YXIgYWRkX2ZpbHRlcl90b2dnbGVfYnV0dG9uID0gZnVuY3Rpb24gKHRhYmxlX2lkLCBjb250YWluZXIpIHsKICAgICAgICAkKCcueWFkY2YtZmlsdGVyLXdyYXBwZXIsIC5jb2x1bW4tZmlsdGVyJykuaGlkZSgpOwogICAgICAgICQoJy5jb2x1bW4tZmlsdGVyJykuY2xpY2soZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pOwogICAgICAgICQoJy5jb2x1bW4tZmlsdGVyJykub24oJ2tleXVwJywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAvLyBQZXJmb3JtIHNlYXJjaAogICAgICAgICAgICB2YXIgaW5kZXggPSAkKHRoaXMpLmRhdGEoJ2luZGV4Jyk7CiAgICAgICAgICAgICQodGFibGVfaWQpLkRhdGFUYWJsZSgpLmNvbHVtbihpbmRleCkuc2VhcmNoKCQodGhpcykudmFsKCkpLmRyYXcoKTsKICAgICAgICB9KTsKICAgICAgICB2YXIgZmlsdGVyVG9nZ2xlID0gIjxpIGNsYXNzPSd0YWJsZS1maWx0ZXItdG9nZ2xlIGdseXBoaWNvbiBnbHlwaGljb24tZmlsdGVyJyBkYXRhLXRhYmxlPSciICsgdGFibGVfaWQgKwogICAgICAgICAgICAiJyBvbmNsaWNrPSdzaWduYWwubGlzdF91dGlscy5oYW5kbGVfZmlsdGVyX3RvZ2dsZScgZGF0YS1zaG93LWZpbHRlcj0ndHJ1ZSc+PC9pPiI7CiAgICAgICAgdmFyIHRvZ2dsZV9idXR0b24gPSAkLnBhcnNlSFRNTChmaWx0ZXJUb2dnbGUpOwogICAgICAgIGlmICghKF8uaXNVbmRlZmluZWQoY29udGFpbmVyKSAmJiBfLmlzTnVsbChjb250YWluZXIpKSkgewogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kKHRvZ2dsZV9idXR0b24pOwogICAgICAgIH0KCiAgICAgICAgJChkb2N1bWVudCkub24oJ2ZpbHRlci10b2dnbGUtaW5pdCcsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgJCgnLnRhYmxlLWZpbHRlci10b2dnbGUnKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgaGlkZV9zaG93X2ZpdGxlciA9IGZ1bmN0aW9uICh0YWJsZUlkLCBoaWRlT3JTaG93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhpZGVPclNob3cgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGFibGVJZCArICdfd3JhcHBlciAueWFkY2YtZmlsdGVyLXdyYXBwZXIsLmNvbHVtbi1maWx0ZXInKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0YWJsZUlkICsgJ193cmFwcGVyIC55YWRjZi1maWx0ZXItd3JhcHBlciwuY29sdW1uLWZpbHRlcicpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHZhciB0YXJnZXRGaWx0ZXJUb2dnbGUgPSAkKGV2dC50YXJnZXQpOwogICAgICAgICAgICAgICAgdmFyIHRhYmxlSWQgPSB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgndGFibGUnKTsKICAgICAgICAgICAgICAgIHZhciBzaG93RmlsdGVyID0gdGFyZ2V0RmlsdGVyVG9nZ2xlLmRhdGEoJ3Nob3ctZmlsdGVyJyk7CiAgICAgICAgICAgICAgICBpZiAoc2hvd0ZpbHRlciA9PT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RmlsdGVyVG9nZ2xlLmRhdGEoJ3Nob3dGaWx0ZXInLCAnZmFsc2UnKTsKICAgICAgICAgICAgICAgICAgICBoaWRlX3Nob3dfZml0bGVyKHRhYmxlSWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RmlsdGVyVG9nZ2xlLmRhdGEoJ3Nob3dGaWx0ZXInLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgICAgIGhpZGVfc2hvd19maXRsZXIodGFibGVJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICAkKGRvY3VtZW50KS50cmlnZ2VyKCdmaWx0ZXItdG9nZ2xlLWluaXQnKTsKICAgICAgICByZXR1cm4gJCh0b2dnbGVfYnV0dG9uKTsKICAgIH07CgogICAgdmFyIGhhbmRsZV9maWx0ZXJfdG9nZ2xlID0gZnVuY3Rpb24gKGV2dCkgewogICAgICAgICQodGhpcykuYXR0cigndGFyZ2V0LXRhYmxlJyk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgZmxhZ19pdDogZmxhZ19pdCwKICAgICAgICBmbGFnX2hhbmRsZXI6IGZsYWdfaGFuZGxlciwKICAgICAgICBwcmlvcml0eV9saW5rOiBwcmlvcml0eV9saW5rLAogICAgICAgIGNoYW5nZV9wcmlvcml0eTogY2hhbmdlX3ByaW9yaXR5LAogICAgICAgIGZpbmRfZmllbGQ6IGZpbmRfZmllbGQsCiAgICAgICAgc2V0X3ZhbHVlOiBzZXRfdmFsdWUsCiAgICAgICAgZ2V0X2R1ZV9pbjogZ2V0X2R1ZV9pbiwKICAgICAgICBkdWVfaW5fY29tcDogZHVlX2luX2NvbXAsCiAgICAgICAgYXNzaWduZWRfdG9fY29tcDogYXNzaWduZWRfdG9fY29tcCwKICAgICAgICB0cnVuY2F0ZVRleHRBbmRTaG93VG9vbHRpcDogdHJ1bmNhdGVUZXh0QW5kU2hvd1Rvb2x0aXAsCiAgICAgICAgYWRkX2ZpbHRlcnM6IGFkZF9maWx0ZXJzLAogICAgICAgIGhhbmRsZV9maWx0ZXJfdG9nZ2xlOiBoYW5kbGVfZmlsdGVyX3RvZ2dsZSwKICAgICAgICBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b246IGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbgogICAgfQp9KSgpOwp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKc2lnbmFsLmFjdGlvbnNfdXRpbHMgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgYWN0aW9uX2xpc3RfdGFibGU7CiAgICB2YXIgY3VycmVudF9jcmVhdGVfYnQ7CiAgICB2YXIgYWRob2NfdmFsaWRhdGVkX3RhYmxlOwoKICAgIHZhciBzZXRfYWN0aW9uX2NyZWF0ZV9tb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcjY3JlYXRlQWN0aW9uTW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgJCh0aGlzKQogICAgICAgICAgICAgICAgLmZpbmQoJyNjb25maWcnKS52YWwoJycpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnI3R5cGUnKS52YWwoJycpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnI21lZXRpbmdFbGVtZW50JykudmFsKCcnKS5lbmQoKQogICAgICAgICAgICAgICAgLmZpbmQoJy5hc3NpZ25lZFRvVmFsdWUnKS52YWwoJycpLnRyaWdnZXIoJ2NoYW5nZScpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnLmFzc2lnbmVkVG9WYWx1ZScpLmVtcHR5KCkuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCJpbnB1dFt0eXBlPXRleHRdLHRleHRhcmVhIikudmFsKCcnKQogICAgICAgICAgICAgICAgLmVuZCgpOwoKICAgICAgICAgICAgJCgnI2NyZWF0ZUFjdGlvbk1vZGFsIC5zZWxlY3QyLXNlbGVjdGlvbl9fcmVuZGVyZWQnKS5ob3ZlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoJ3RpdGxlJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9KTsKCiAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsJykub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNsZWFyX2VkaXRfZXJyb3JzKCk7CiAgICAgICAgICAgICQodGhpcykKICAgICAgICAgICAgICAgIC5maW5kKCJpbnB1dFt0eXBlPXRleHRdLHRleHRhcmVhLHNlbGVjdCIpCiAgICAgICAgICAgICAgICAudmFsKCcnKQogICAgICAgICAgICAgICAgLmVuZCgpCiAgICAgICAgfSk7CgogICAgICAgICQoJyNlZGl0QWN0aW9uTW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY2xlYXJfZWRpdF9zaWduYWwoKTsKICAgICAgICAgICAgJCh0aGlzKQogICAgICAgICAgICAgICAgLmZpbmQoImlucHV0W3R5cGU9dGV4dF0sdGV4dGFyZWEsc2VsZWN0IikKICAgICAgICAgICAgICAgIC52YWwoJycpCiAgICAgICAgICAgICAgICAuZW5kKCkKICAgICAgICB9KTsKCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5hY3Rpb24tY3JlYXRlJywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICB2YXIgc3JjRWxlID0gJChldnQudGFyZ2V0KTsKICAgICAgICAgICAgY3VycmVudF9jcmVhdGVfYnQgPSBzcmNFbGU7CiAgICAgICAgICAgIHZhciBhbGVydElkID0gYWxlcnRJZDsKICAgICAgICAgICAgaWYgKHR5cGVvZiAoc3JjRWxlLmF0dHIoJ2FsZXJ0LWlkJykpICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgYWxlcnRJZCA9IHNyY0VsZS5hdHRyKCdhbGVydC1pZCcpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNyZWF0ZUFjdGlvbk1vZGFsID0gJCgnI2NyZWF0ZUFjdGlvbk1vZGFsJyk7CiAgICAgICAgICAgIHZhciBjcmVhdGVBY3Rpb25CdXR0b24gPSAkKCIjY3JlYXRlLWFjdGlvbi1idG4iKTsKICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwuZmluZCgnLmlkLWVsZW1lbnQnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CgogICAgICAgICAgICAvL1NldCB0aGUgYWxlcnRJZCBpbiB0aGUgaGlkZGVuIGZpZWxkIG9mIHRoZSBtb2RhbC4KICAgICAgICAgICAgaWYgKHR5cGVvZiBhbGVydElkICE9ICJ1bmRlZmluZWQiICYmIGFsZXJ0SWQgIT0gJycpIHsKICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbk1vZGFsLmZpbmQoIi5hbGVydElkIikudmFsKGFsZXJ0SWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjcmVhdGVBY3Rpb25Nb2RhbC5maW5kKCcjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcigpOwogICAgICAgICAgICBjcmVhdGVBY3Rpb25CdXR0b24uYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAkKCcuYWN0aW9uLXR5cGUtbGlzdCcpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgJCgnLm1lZXRpbmctbGlzdCcpLmFkZENsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwubW9kYWwoe30pOwoKICAgICAgICAgICAgLy9FdmVudCBiaW5kIHdoZW4gdGhlIHNhdmUvY3JlYXRlIGJ1dHRvbiBpcyBjbGljawogICAgICAgICAgICAvLyBrZWQgaW4gdGhlIGFjdGlvbiBldmVudCBtb2RhbC4KICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLnVuYmluZCgnY2xpY2snKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbkJ1dHRvbi5hdHRyKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1pZCcpOwogICAgICAgICAgICAgICAgdmFyIGFjdGlvbk1vZGFsSWQgPSAkKCIjY3JlYXRlQWN0aW9uTW9kYWwgI3RlbXBGb3JtIik7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbmFsL2FjdGlvbi9zYXZlJywKICAgICAgICAgICAgICAgICAgICBkYXRhOiBnZXRBY3Rpb25EZXRhaWxzKGFjdGlvbk1vZGFsSWQpLAogICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhcl9lcnJvcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gIjxkaXYgY2xhc3M9J2FsZXJ0IGFsZXJ0LWRhbmdlcic+IjsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlT2JqID0gcmVzcG9uc2UuZGF0YVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSBlcnJvck1lc3NhZ2VPYmo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAnPC9icj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICI8L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWN0aW9uTW9kYWwgLm1vZGFsLWJvZHknKS5wcmVwZW5kKGVycm9yTXNnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbk1vZGFsLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfY3JlYXRlX2J0LnBhcmVudHNVbnRpbCgidGQiKS5maW5kKCcuZGVmYXVsdC12YWx1ZScpLmh0bWwocmVzcG9uc2UuYWN0aW9uQ291bnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgPT09ICJDYXNlIERldGFpbCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhbGVydElkICE9ICJ1bmRlZmluZWQiICYmIGFsZXJ0SWQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRldGFpbF90YWJsZSAhPSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxfdGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNtZWV0aW5nLXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2lnbmFsQWN0aXZpdHlUYWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vUmVmcmVzaCB0aGUgYWN0aXZpdHkgdGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkNBU0VfREVUQUlMICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkVWRU5UX0RFVEFJTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGl2aXRpZXNfdXRpbHMucmVsb2FkX2FjdGl2aXR5X3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBwbGljYXRpb25MYWJlbCA9PSBBUFBMSUNBVElPTl9MQUJFTC5TSUdOQUxfTUFOQUdFTUVOVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5tZWV0aW5nX3V0aWxzLnJlbG9hZF9tZWV0aW5nX3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1zZyA9ICI8ZGl2IGNsYXNzPSdhbGVydCBhbGVydC1kYW5nZXInPiI7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIkVycm9yIG9jY3VyZWQgd2hpbGUgc2F2aW5nIEFjdGlvbi4iOwogICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICI8L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpOwogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUFjdGlvbkJ1dHRvbi5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGdldEFjdGlvbkRldGFpbHMgPSBmdW5jdGlvbihtb2RhbElkKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImNvbmZpZyI6IG1vZGFsSWQuZmluZCgiI2NvbmZpZyIpLnZhbCgpLAogICAgICAgICAgICAidHlwZSI6IG1vZGFsSWQuZmluZCgiI3R5cGUiKS52YWwoKSwKICAgICAgICAgICAgImFzc2lnbmVkVG9WYWx1ZSI6IG1vZGFsSWQuZmluZCgiI2Fzc2lnbmVkVG8iKS52YWwoKSwKICAgICAgICAgICAgImR1ZURhdGUiOiBtb2RhbElkLmZpbmQoIiNkdWVEYXRlIikudmFsKCksCiAgICAgICAgICAgICJkZXRhaWxzIjogbW9kYWxJZC5maW5kKCIjZGV0YWlscyIpLnZhbCgpLAogICAgICAgICAgICAiY29tbWVudHMiOiBtb2RhbElkLmZpbmQoIiNjb21tZW50cyIpLnZhbCgpLAogICAgICAgICAgICAiYWxlcnRJZCI6IG1vZGFsSWQuZmluZCgiI2FsZXJ0SWQiKS52YWwoKSwKICAgICAgICAgICAgImFwcFR5cGUiOiBtb2RhbElkLmZpbmQoIiNhcHBUeXBlIikudmFsKCksCiAgICAgICAgICAgICJleGVDb25maWdJZCI6IG1vZGFsSWQuZmluZCgiI2V4ZUNvbmZpZ0lkIikudmFsKCksCiAgICAgICAgICAgICJtZWV0aW5nSWQiOiBtb2RhbElkLmZpbmQoIiNtZWV0aW5nRWxlbWVudCIpLnZhbCgpLAogICAgICAgICAgICAiYWN0aW9uU3RhdHVzIjogbW9kYWxJZC5maW5kKCIjYWN0aW9uU3RhdHVzIikudmFsKCksCiAgICAgICAgICAgICJhY3Rpb25JZCI6IG1vZGFsSWQuZmluZCgiI2FjdGlvbklkIikudmFsKCkKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBjbGVhcl9lcnJvcnMgPSBmdW5jdGlvbigpIHsKICAgICAgICAkKCcjY3JlYXRlQWN0aW9uTW9kYWwgLm1vZGFsLWJvZHkgLmFsZXJ0JykucmVtb3ZlKCkKICAgIH07CgogICAgdmFyIGNsZWFyX2VkaXRfZXJyb3JzID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKQogICAgfTsKICAgIHZhciBjbGVhcl9lZGl0X3NpZ25hbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCcjZWRpdEFjdGlvbk1vZGFsIC5tb2RhbC1ib2R5IC5hbGVydCcpLnJlbW92ZSgpCiAgICB9OwoKLy9TaW5nbGUgYW5kIEFnZ3JlZ2F0ZSBBY3Rpb24gbGlzdCBkYXRhCiAgICB2YXIgc2V0X2FjdGlvbl9saXN0X21vZGFsID0gZnVuY3Rpb24oY29tcCkgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcubGlzdC1hY3Rpb24nLCBmdW5jdGlvbihldnQpIHsKICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbXAubW9kYWwoJ3RvZ2dsZScsICQodGhpcykpOwogICAgICAgIH0pOwogICAgICAgIGNvbXAub24oJ3Nob3duLmJzLm1vZGFsJywgZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciBzcmNFbGUgPSBldnQucmVsYXRlZFRhcmdldDsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSAkKHNyY0VsZSkuYXR0cignZGF0YS1pZCcpOwogICAgICAgICAgICB2YXIgYXBwVHlwZSA9ICQoIiNjcmVhdGVBY3Rpb25Nb2RhbCAjdGVtcEZvcm0iKS5maW5kKCIjYXBwVHlwZSIpLnZhbCgpOwogICAgICAgICAgICB2YXIgYWN0aW9uVXJsID0gIi9zaWduYWwvYWN0aW9uL2xpc3RCeUFsZXJ0P2FsZXJ0SWQ9IiArIGFsZXJ0SWQgKyImYXBwVHlwZT0iICsgYXBwVHlwZTsKICAgICAgICAgICAgYWN0aW9uX2xpc3RfdGFibGUgPSAkKCcjYWN0aW9uLXRhYmxlJykuRGF0YVRhYmxlKHsKICAgICAgICAgICAgICAgIGRlc3Ryb3kgOiB0cnVlLAogICAgICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICQoJy5lZGl0LWFjdGlvbi1saW5rJykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC9hY3Rpb24vZ2V0QnlJZD9pZD0iICsgJCh0aGlzKS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWN0aW9uX3R5cGVzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMudHlwZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvbl9jb25maWdzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMuY29uZmlnczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWxsX3N0YXR1cyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLmFsbFN0YXR1czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWxlcnRJZCA9IGFsZXJ0SWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvblN0YXR1cyA9IHtuYW1lOiBkYXRhLmFjdGlvblN0YXR1c307CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWxfY29udGVudCA9IHNpZ25hbC51dGlscy5yZW5kZXIoJ2FjdGlvbl9lZGl0b3InLCBkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lcicpLmh0bWwoaHRtbF9jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lciAjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogZGF0YS5kdWVEYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5rZXlkb3duKHByZXZlbnRFbnRlcktleVN1Ym1pdCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGR1ZURhdGUgPSBtb21lbnQoZGF0YS5kdWVEYXRlLCAiREQtTU1NLVlZWVkiKS5mb3JtYXQoREVGQVVMVF9EQVRFX0ZPUk1BVCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKS5maW5kKCcjZHVlLWRhdGUtcGlja2VyJykuZmluZCgnI2R1ZURhdGUnKS52YWwoZHVlRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKS5maW5kKCcjYXBwVHlwZScpLnZhbChhcHBUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fZWRpdG9yID0gJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdEFjdGlvbk1vZGFsID0gJCgnI2FjdGlvbi1lZGl0LW1vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgnLmlkLWVsZW1lbnQnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgnLmFzc2lnbmVkVG9WYWx1ZScpLnZhbChudWxsKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tbW9kYWwnKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLm1vZGFsKHt9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI2NhbmNlbC1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI3VwZGF0ZS1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJmbkluaXRDb21wbGV0ZSI6IGZ1bmN0aW9uKG9TZXR0aW5ncywganNvbikgewogICAgICAgICAgICAgICAgICAgICQoJy5hY3Rpb24tY3JlYXRlJykuYXR0cignZGF0YS1pZCcsIGFsZXJ0SWQpOwogICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnNldF9hY3Rpb25fY3JlYXRlX21vZGFsKCk7CiAgICAgICAgICAgICAgICAgICAgJCgnI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJhamF4IjogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiBhY3Rpb25VcmwsCiAgICAgICAgICAgICAgICAgICAgY2FjaGU6ZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJzZWFyY2hpbmciOiB0cnVlLAogICAgICAgICAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJvTGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAgICAgInNQcm9jZXNzaW5nIjogJzxkaXYgY2xhc3M9ImdyaWQtbG9hZGluZyI+PGltZyBzcmM9Ii9zaWduYWwvYXNzZXRzL3NwaW5uZXIuZ2lmIiB3aWR0aD0iMzAiIGFsaWduPSJtaWRkbGUiIC8+PC9kaXY+JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUsCiAgICAgICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzUsIDEwLCAyMCwgLTFdLCBbNSwgMTAsIDIwLCAiQWxsIl1dLAogICAgICAgICAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8YSBocmVmPScjJyBjbGFzcz0nZWRpdC1hY3Rpb24tbGluaycgZGF0YS1pZD0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93LmlkICsgIic+IiArIHJvdy5pZCArICI8YT4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInR5cGUiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb25maWciCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkZXRhaWxzIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ImNvbC1taW4tMjAwIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZHVlRGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiJjb2wtbWluLTEwMCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImFzc2lnbmVkVG8iLAogICAgICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjoiY29sLW1pbi0xMDAiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSIgOiAiYWN0aW9uU3RhdHVzIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY29tcGxldGVkRGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiJjb2wtbWluLTE1MCIsCiAgICAgICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUscm93KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3cuY29tcGxldGVkRGF0ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIHNjcm9sbFg6IHRydWUsCiAgICAgICAgICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KQogICAgICAgIH0pOwoKICAgICAgICBjb21wLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbihldnQpIHsKICAgICAgICAgIGNvbXAuZmluZCgiI2FjdGlvbi10YWJsZSIpLmVtcHR5KCk7CiAgICAgICAgIH0pOwogICAgICAgIHJldHVybiBhY3Rpb25fbGlzdF90YWJsZQogICAgfTsKICAgIHZhciBzZXRFZGl0TW9kYWxWYWx1ZXMgPSBmdW5jdGlvbiAoZWRpdEFjdGlvbk1vZGFsLCBkYXRhKSB7CiAgICAgICAgdmFyIGFjdGlvblR5cGUgPSBkYXRhLnR5cGVPYmouaWQ7CiAgICAgICAgdmFyIG1lZXRpbmdJZCA9IGRhdGEubWVldGluZ0lkOwogICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKGRhdGEuYXNzaWduZWRUb09iai5mdWxsTmFtZSwgZGF0YS5hc3NpZ25lZFRvT2JqLmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2Fzc2lnbmVkVG8iKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICBpZighbWVldGluZ0lkKSB7CiAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjdHlwZSIpLnZhbChhY3Rpb25UeXBlKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjbWVldGluZ0VsZW1lbnQiKS52YWwobWVldGluZ0lkKTsKICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNtZWV0aW5nVmFsdWUiKS52YWwobWVldGluZ0lkKTsKICAgICAgICB9CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIi5zdGF0dXMtaWNvbiIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2NvbmZpZyIpLnZhbChkYXRhLmNvbmZpZ09iai5pZCk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNhY3Rpb25JZCIpLnZhbChkYXRhLmlkKTsKICAgICAgICB2YXIgZHVlRGF0ZSA9IG1vbWVudChkYXRhLmR1ZURhdGUsIERFRkFVTFRfREFURV9GT1JNQVQpLmZvcm1hdChERUZBVUxUX0RBVEVfRk9STUFUKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2R1ZS1kYXRlLXBpY2tlciIpLmRhdGVwaWNrZXIoewogICAgICAgICAgICBkYXRlOiAkKCIjZHVlLWRhdGUtcGlja2VyIikudmFsKCkgPyBuZXcgRGF0ZSgkKCIjZHVlLWRhdGUtcGlja2VyIikudmFsKCkpIDogbnVsbCwKICAgICAgICAgICAgbW9tZW50Q29uZmlnOiB7CiAgICAgICAgICAgICAgICBjdWx0dXJlOiB1c2VyTG9jYWxlLAogICAgICAgICAgICAgICAgZm9ybWF0OiBERUZBVUxUX0RBVEVfRElTUExBWV9GT1JNQVQKICAgICAgICAgICAgfQogICAgICAgIH0pLmtleXByZXNzKHByZXZlbnRFbnRlcktleVN1Ym1pdCk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNkdWVEYXRlIikudmFsKGR1ZURhdGUpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjY29tbWVudHMiKS52YWwoZGF0YS5jb21tZW50cyk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNkZXRhaWxzIikudmFsKGRhdGEuZGV0YWlscyk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNhY3Rpb25TdGF0dXMiKS52YWwoZGF0YS5hY3Rpb25TdGF0dXMpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuYWN0aW9uLXZhbHVlJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICB9OwogICAgdmFyIGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCA9IGZ1bmN0aW9uKGV2dCkgewogICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZhciBhY3Rpb25fbGlzdF90YWJsZSA9ICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKTsKICAgICAgICBhY3Rpb25fbGlzdF90YWJsZS5hamF4LnJlbG9hZCgpOwogICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCcpLm1vZGFsKCdoaWRlJykKICAgIH07CgogICAgdmFyIGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSA9IGZ1bmN0aW9uKGV2dCkgewogICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGlmICghZXZ0LmhhbmRsZWQpIHsKICAgICAgICAgICAgZXZ0LmhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICB2YXIganNvbiA9ICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lciBmb3JtI2FjdGlvbi1lZGl0b3ItZm9ybScpLnNlcmlhbGl6ZSgpICsgIiZhcHBUeXBlPSIgKyAkKCIjYXBwVHlwZSIpLnZhbCgpICsgIiZleGVDb25maWdJZD0iICsgJCgiI2V4ZUNvbmZpZ0lkIikudmFsKCk7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiAnL3NpZ25hbC9hY3Rpb24vdXBkYXRlQWN0aW9uJywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgZGF0YToganNvbiwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhcl9lZGl0X2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSAiPGRpdiBjbGFzcz0nYWxlcnQgYWxlcnQtZGFuZ2VyJz4iOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCByZXNwb25zZS5kYXRhLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZU9iaiA9IHJlc3BvbnNlLmRhdGFbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gZXJyb3JNZXNzYWdlT2JqOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gJzwvYnI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAiPC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsIC5tb2RhbC1ib2R5JykucHJlcGVuZChlcnJvck1zZykKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uX2xpc3RfdGFibGUgPSAkKCcjYWN0aW9uLXRhYmxlJykuRGF0YVRhYmxlKCkKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX2xpc3RfdGFibGUuYWpheC5yZWxvYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAvL1JlZnJlc2ggdGhlIGFjdGl2aXR5IHRhYmxlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkNBU0VfREVUQUlMICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkVWRU5UX0RFVEFJTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGl2aXRpZXNfdXRpbHMucmVsb2FkX2FjdGl2aXR5X3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsJykubW9kYWwoJ2hpZGUnKQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQogICAgLy9BZC1ob2MgYWxlcnQgYWN0aW9uIGxpc3QgZGF0YQogICAgdmFyIGluaXRfYWN0aW9uX3RhYmxlID0gZnVuY3Rpb24gKHRhYmxlX2lkLCBhcHBUeXBlKSB7CgogICAgICAgIHZhciBkYXRhVXJsID0gIi9zaWduYWwvYWN0aW9uL2xpc3RCeUFsZXJ0P2FsZXJ0SWQ9IiArIGFsZXJ0SWQgKyImYXBwVHlwZT0iICsgYXBwVHlwZTsKICAgICAgICBhZGhvY192YWxpZGF0ZWRfdGFibGUgPSAkKHRhYmxlX2lkKS5EYXRhVGFibGUoewogICAgICAgICAgICAvLyJzUGFnaW5hdGlvblR5cGUiOiAiYm9vdHN0cmFwIiwKCiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGZuRHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKCcuZWRpdC1hY3Rpb24tbGluaycpLmNsaWNrKGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC9hY3Rpb24vZ2V0QnlJZD9pZD0iICsgJCh0aGlzKS5hdHRyKCdkYXRhLWlkJykKICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXBwVHlwZSA9PSAiU2lnbmFsIE1hbmFnZW1lbnQiIHx8IGFwcFR5cGUgPT0gIlRvcGljIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRBY3Rpb25Nb2RhbCA9ICQoJyNlZGl0QWN0aW9uTW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEVkaXRNb2RhbFZhbHVlcyhlZGl0QWN0aW9uTW9kYWwsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLm1vZGFsKHt9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcudXBkYXRlLWFjdGlvbicpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uTW9kYWxJZCA9ICQoIiNlZGl0QWN0aW9uTW9kYWwgI3RlbXBGb3JtIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnLm1lZXRpbmctZGVjaWRlcicpLnZhbCgpID09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAnL3NpZ25hbC9hY3Rpb24vdXBkYXRlTWVldGluZ0FjdGlvbic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gJy9zaWduYWwvYWN0aW9uL3VwZGF0ZUFjdGlvbic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZ2V0QWN0aW9uRGV0YWlscyhhY3Rpb25Nb2RhbElkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2VkaXRfc2lnbmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gIjxkaXYgY2xhc3M9J2FsZXJ0IGFsZXJ0LWRhbmdlcic+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCByZXNwb25zZS5kYXRhLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlT2JqID0gcmVzcG9uc2UuZGF0YVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9IGVycm9yTWVzc2FnZU9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gJzwvYnI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIjwvZGl2PiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2VkaXRBY3Rpb25Nb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNtZWV0aW5nLXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9SZWZyZXNoIHRoZSBhY3Rpdml0eSB0YWJsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBhcHBsaWNhdGlvbkxhYmVsICE9ICd1bmRlZmluZWQnICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkNBU0VfREVUQUlMICYmIGFwcGxpY2F0aW9uTGFiZWwgIT09IEFQUExJQ0FUSU9OX0xBQkVMLkVWRU5UX0RFVEFJTCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvbl90eXBlcyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLnR5cGVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25fY29uZmlncyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLmNvbmZpZ3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFsbF9zdGF0dXMgPSBhY3Rpb25fc2VsZWN0X3ZhbHVlcy5hbGxTdGF0dXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFsZXJ0SWQgPSBhbGVydElkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25TdGF0dXMgPSB7bmFtZTogZGF0YS5hY3Rpb25TdGF0dXN9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWxfY29udGVudCA9IHNpZ25hbC51dGlscy5yZW5kZXIoJ2FjdGlvbl9lZGl0b3InLCBkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fZWRpdG9yID0gJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fZWRpdG9yLmh0bWwoaHRtbF9jb250ZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lciAjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogZGF0YS5kdWVEYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbWVudENvbmZpZzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdWx0dXJlOiB1c2VyTG9jYWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ejogdXNlclRpbWVab25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IERFRkFVTFRfREFURV9ESVNQTEFZX0ZPUk1BVAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmtleWRvd24ocHJldmVudEVudGVyS2V5U3VibWl0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9lZGl0b3IuZmluZCgnI2R1ZS1kYXRlLXBpY2tlcicpLmZpbmQoJyNkdWVEYXRlJykudmFsKGRhdGEuZHVlRGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fZWRpdG9yLmZpbmQoJyNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdEFjdGlvbk1vZGFsID0gJCgnI2FjdGlvbi1lZGl0LW1vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgnLmlkLWVsZW1lbnQnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoe30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJykuZmluZCgnI2FwcFR5cGUnKS52YWwoYXBwVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI2NhbmNlbC1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgI3VwZGF0ZS1idCcpLmNsaWNrKGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJmbkluaXRDb21wbGV0ZSI6IGZ1bmN0aW9uKG9TZXR0aW5ncywganNvbikgewogICAgICAgICAgICAgICAgJCgnLmFjdGlvbi1jcmVhdGUnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCkKICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnNldF9hY3Rpb25fY3JlYXRlX21vZGFsKCkKICAgICAgICAgICAgICAgICQoJyNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogZGF0YVVybCwKICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRhdGFTcmM6ICIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlYXJjaGluZzogdHJ1ZSwKICAgICAgICAgICAgZG9tOiAnQmZydGlwJywKICAgICAgICAgICAgYnV0dG9uczogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHRleHQ6ICdOZXcgQWN0aW9uJywKICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdidG4tcHJpbWFyeSBhY3Rpb24tY3JlYXRlJywKICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uICggZSwgZHQsIG5vZGUsIGNvbmZpZyApIHsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGFhU29ydGluZzogW1swLCAiZGVzYyJdXSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiAxMCwKICAgICAgICAgICAgImFMZW5ndGhNZW51IjogW1sxMCwgMjAsIDUwLCAtMV0sIFsxMCwgMjAsIDUwLCAiQWxsIl1dLAogICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPGEgaHJlZj0nIycgY2xhc3M9J2VkaXQtYWN0aW9uLWxpbmsnIGRhdGEtaWQ9JyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93LmlkICsgIic+IiArIHJvdy5pZCArICI8YT4iCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogIiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInR5cGUiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0nd29yZC13cmFwLWJyZWFrLXdvcmQnPiIgKyBlc2NhcGVIVE1MKHJvdy50eXBlKSArICI8L3NwYW4+IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb25maWciLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0nd29yZC13cmFwLWJyZWFrLXdvcmQnPiIgKyBlc2NhcGVIVE1MKHJvdy5jb25maWcpICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRldGFpbHMiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBjbGFzcz0nd29yZC13cmFwLWJyZWFrLXdvcmQnPiIgKyBlc2NhcGVIVE1MKHJvdy5kZXRhaWxzKSArICI8L3NwYW4+IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkdWVEYXRlIiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJywKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEocm93LmFjdGlvblN0YXR1cyA9PT0gJ0Nsb3NlZCcgJiYgcm93LmFjdGlvblN0YXR1cyA9PT0gJ0RlbGV0ZWQnKSAmJiByb3cucGFzc0R1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8ZGl2IGNsYXNzPSdjbG9zZWQnPiIgKyByb3cuZHVlRGF0ZSArICI8L2Rpdj4iCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxkaXY+IiArIHJvdy5kdWVEYXRlICsgIjwvZGl2PiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImFzc2lnbmVkVG8iLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXNjYXBlSFRNTChyb3cuYXNzaWduZWRUbykKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiY29sLW1pbi0xNTAiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICIiLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93LmFjdGlvblN0YXR1cwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb21wbGV0ZWREYXRlIiwKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbihkYXRhLCB0eXBlLHJvdyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3cuY29tcGxldGVkRGF0ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTE1MCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgc2Nyb2xsWCA6IHRydWUKICAgICAgICB9KTsKICAgICAgICBhZGhvY192YWxpZGF0ZWRfdGFibGUuYnV0dG9uKCkuZGlzYWJsZSgpOwogICAgICAgIHJldHVybiBhZGhvY192YWxpZGF0ZWRfdGFibGUKICAgIH07CgogICAgdmFyIGJ1aWxkX2FjdGlvbl9yZW5kZXIgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIGFjdGlvbl9kcm9wX2Rvd25faHRtbCA9IHNpZ25hbC51dGlscy5yZW5kZXIoImFjdGlvbl9kcm9wX2Rvd24iLCBkYXRhKTsKICAgICAgICByZXR1cm4gYWN0aW9uX2Ryb3BfZG93bl9odG1sCiAgICB9OwogICAgdmFyIHJlbG9hZF9hY3Rpb25fdGFibGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhZGhvY192YWxpZGF0ZWRfdGFibGUgIT0gInVuZGVmaW5lZCIgJiYgYWRob2NfdmFsaWRhdGVkX3RhYmxlICE9IG51bGwpIHsKICAgICAgICAgICAgYWRob2NfdmFsaWRhdGVkX3RhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIlVuYWJsZSB0byByZWxvYWQgdGhlIGFjdGl2aXR5IHRhYmxlLiBQbGVhc2UgcmVmcmVzaCB0aGUgcGFnZS4iKQogICAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBzZXRfYWN0aW9uX2xpc3RfbW9kYWw6IHNldF9hY3Rpb25fbGlzdF9tb2RhbCwKICAgICAgICBzZXRfYWN0aW9uX2NyZWF0ZV9tb2RhbDogc2V0X2FjdGlvbl9jcmVhdGVfbW9kYWwsCiAgICAgICAgYnVpbGRfYWN0aW9uX3JlbmRlcjogYnVpbGRfYWN0aW9uX3JlbmRlciwKICAgICAgICBpbml0X2FjdGlvbl90YWJsZTogaW5pdF9hY3Rpb25fdGFibGUsCiAgICAgICAgcmVsb2FkX2FjdGlvbl90YWJsZSA6IHJlbG9hZF9hY3Rpb25fdGFibGUsCiAgICAgICAgaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsOiBoYW5kbGVfYWN0aW9uX2VkaXRvcl9jYW5jZWwsCiAgICAgICAgaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlOiBoYW5kbGVfYWN0aW9uX2VkaXRvcl91cGRhdGUsCiAgICAgICAgY2xlYXJfZWRpdF9lcnJvcnM6IGNsZWFyX2VkaXRfZXJyb3JzCiAgICB9Cn0pKCk7Cgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKdmFyIG1lZXRpbmdEYXRhVGFibGU7CnZhciBzY2hlZHVsZXJEYXRhSnNvbjsKCnNpZ25hbC5tZWV0aW5nX3V0aWxzID0gKGZ1bmN0aW9uICgpIHsKCgogICAgdmFyIGN1cnJlbnRfY3JlYXRlX2J0CiAgICB2YXIgdGFibGUKICAgIHZhciBzZXRfbWVldGluZ19jcmVhdGVfbW9kYWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2NyZWF0ZU1lZXRpbmdNb2RhbCcpLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICQodGhpcykuZmluZCgnLmNsZWFyLWZpZWxkJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnI21lZXRpbmdBdHRlbmRlZXMtY3JlYXRlJykuc2VsZWN0MigidmFsIiwgIiIpOwogICAgICAgICAgICBjbGVhcl9lcnJvcnMoKTsKICAgICAgICAgICAgcHJvY2Vzc1NjaGVkdWxlcignY3JlYXRlJyk7CiAgICAgICAgfSk7CiAgICAgICAgJCgnI2NyZWF0ZU1lZXRpbmdNb2RhbCcpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB1blByb2Nlc3NTY2hlZHVsZXIoJ2NyZWF0ZScpOwogICAgICAgICAgICAkKCcubWVldGluZ1N1Z2dlc3Rpb25Db250YWluZXInKS5jb2xsYXBzZSgnaGlkZScpOwogICAgICAgIH0pOwoKICAgICAgICAkKCcjZWRpdE1lZXRpbmdNb2RhbCcpLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICBwcm9jZXNzU2NoZWR1bGVyKCdlZGl0Jywgc2NoZWR1bGVyRGF0YUpzb24pOwogICAgICAgIH0pOwogICAgICAgICQoJyNlZGl0TWVldGluZ01vZGFsJykub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHVuUHJvY2Vzc1NjaGVkdWxlcignZWRpdCcpOwogICAgICAgICAgICAkKCcubWVldGluZ1N1Z2dlc3Rpb25Db250YWluZXInKS5jb2xsYXBzZSgnaGlkZScpOwogICAgICAgIH0pOwoKICAgICAgICAkKCcubWVldGluZy1jcmVhdGUnKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CgogICAgICAgICAgICB2YXIgc3JjRWxlID0gJChldnQudGFyZ2V0KQogICAgICAgICAgICBjdXJyZW50X2NyZWF0ZV9idCA9IHNyY0VsZQogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IGFsZXJ0SWQKICAgICAgICAgICAgaWYgKHR5cGVvZiAoc3JjRWxlLmF0dHIoJ2FsZXJ0LWlkJykpICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgYWxlcnRJZCA9IHNyY0VsZS5hdHRyKCdhbGVydC1pZCcpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjcmVhdGVNZWV0aW5nTW9kYWwgPSAkKCcjY3JlYXRlTWVldGluZ01vZGFsJykKICAgICAgICAgICAgY3JlYXRlTWVldGluZ01vZGFsLmZpbmQoJy5pZC1lbGVtZW50JykuYXR0cignZGF0YS1pZCcsIGFsZXJ0SWQpOwoKICAgICAgICAgICAgLy9TZXQgdGhlIGFsZXJ0SWQgaW4gdGhlIGhpZGRlbiBmaWVsZCBvZiB0aGUgbW9kYWwuCiAgICAgICAgICAgIGlmICh0eXBlb2YgYWxlcnRJZCAhPSAidW5kZWZpbmVkIiAmJiBhbGVydElkICE9ICcnKSB7CiAgICAgICAgICAgICAgICBjcmVhdGVNZWV0aW5nTW9kYWwuZmluZCgiLmFsZXJ0SWQiKS52YWwoYWxlcnRJZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vY3JlYXRlTWVldGluZ01vZGFsLmZpbmQoJyNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCkKCiAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAkKCcuaXNSZWN1cnJpbmdNZWV0aW5nJykucmVtb3ZlQXR0cigiY2hlY2tlZCIpOwogICAgICAgICAgICAkKCcuaXNSZWN1cnJpbmdNZWV0aW5nJykudHJpZ2dlcigiY2hhbmdlIik7CiAgICAgICAgICAgIGNyZWF0ZU1lZXRpbmdNb2RhbC5tb2RhbCh7fSk7CgogICAgICAgICAgICBzaG93VGFnV2lkZ2V0KCIjbWVldGluZ0F0dGVuZGVlcy1jcmVhdGUiKTsKCiAgICAgICAgICAgIC8vRXZlbnQgYmluZCB3aGVuIHRoZSBzYXZlL2NyZWF0ZSBidXR0b24gaXMgY2xpY2tlZCBpbiB0aGUgYWN0aW9uIGV2ZW50IG1vZGFsLgogICAgICAgICAgICAkKCIjY3JlYXRlLW1lZXRpbmctYnRuLCNjcmVhdGUtaUNhbGFuZGVyIikuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50LmhhbmRsZWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaWNzRmlsZSA9ICQodGhpcykuZGF0YSgnaWNzRmlsZScpOwogICAgICAgICAgICAgICAgICAgIHZhciBhbGVydElkID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2RhdGEtaWQnKTsKICAgICAgICAgICAgICAgICAgICBldmVudC5oYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB2YXIgYXBwVHlwZSA9ICQoIiNhcHBUeXBlIikudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1lZXRpbmdNb2RhbCA9ICQoIiNjcmVhdGVNZWV0aW5nTW9kYWwgI3RlbXBGb3JtIik7CiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbmFsL21lZXRpbmcvc2F2ZT9kb3dubG9hZElDU0ZpbGU9JyArIGljc0ZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGdldE1lZXRpbmdEZXRhaWxzKG1lZXRpbmdNb2RhbCwgJ2NyZWF0ZScpLAogICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChwYXlsb2FkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLnN0YXR1cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRJQ1NGaWxlKGljc0ZpbGUsIHBheWxvYWQuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVNZWV0aW5nTW9kYWwuZmluZCgnLmZvcm0tY29udHJvbCcpLnZhbCgiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjbWVldGluZy10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVNZWV0aW5nTW9kYWwubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vUmVmcmVzaCB0aGUgYWN0aXZpdHkgdGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpdml0aWVzX3V0aWxzLnJlbG9hZF9hY3Rpdml0eV90YWJsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMucmVsb2FkX2FjdGlvbl90YWJsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLm1lZXRpbmdfdXRpbHMucmVsb2FkX21lZXRpbmdfdGFibGUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhcl9lcnJvcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1zZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLmNvZGUgPT0gNDAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnID0gc2hvd0Vycm9yTWVzc2FnZUluTWVldGluZ01vZGFsKCJFbnRlcmVkIEVtYWlsIGFkZHJlc3MgaXMgbm90IHZhbGlkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgPSBzaG93RXJyb3JNZXNzYWdlSW5NZWV0aW5nTW9kYWwoIlBsZWFzZSBwcm92aWRlIHZhbHVlIGZvciBhbGwgdGhlIG1hbmRhdG9yeSBmaWVsZHMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVNZWV0aW5nTW9kYWwgLm1vZGFsLWJvZHknKS5wcmVwZW5kKGVycm9yTXNnKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJfZXJyb3JzKCkKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gc2hvd0Vycm9yTWVzc2FnZUluTWVldGluZ01vZGFsKGRhdGEucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZU1lZXRpbmdNb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKCiAgICAgICAgfSkKICAgIH0KCiAgICB2YXIgZ2V0TWVldGluZ0RldGFpbHMgPSBmdW5jdGlvbiAobW9kYWxJZCwgdGV4dCkgewogICAgICAgIHZhciBtZWV0aW5nTWludXRlcyA9ICIiOwogICAgICAgIHZhciBkYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgaWYgKG1vZGFsSWQuZmluZCgiI21lZXRpbmdNaW51dGVzIikudmFsKCkpIHsKICAgICAgICAgICAgbWVldGluZ01pbnV0ZXMgPSBtb2RhbElkLmZpbmQoIiNtZWV0aW5nTWludXRlcyIpLnZhbCgpOwogICAgICAgICAgICBkYXRhLmFwcGVuZCgnbWVldGluZ01pbnV0ZXMnLCBtZWV0aW5nTWludXRlcyk7CiAgICAgICAgfQogICAgICAgIGlmKHRleHQgIT09ICdtZWV0aW5nTWludXRlcycpewogICAgICAgICAgICB2YXIgYXR0ZW5kZWVzQXJyYXkgPSBtb2RhbElkLmZpbmQoIiNtZWV0aW5nQXR0ZW5kZWVzLSIgKyB0ZXh0KS52YWwoKTsKICAgICAgICAgICAgaWYgKGF0dGVuZGVlc0FycmF5KSB7CiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZCgnbWVldGluZ0F0dGVuZGVlcycsIGF0dGVuZGVlc0FycmF5LnRvU3RyaW5nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdzY2hlZHVsZURhdGVKU09OJywgSlNPTi5zdHJpbmdpZnkoJCgnI215U2NoZWR1bGVyJykuc2NoZWR1bGVyKCd2YWx1ZScpKSk7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdpc1JlY3VycmluZ01lZXRpbmcnLCBtb2RhbElkLmZpbmQoIiNpc1JlY3VycmluZ01lZXRpbmciKS5pcygiOmNoZWNrZWQiKSk7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdkdXJhdGlvbicsIG1vZGFsSWQuZmluZCgiI2R1cmF0aW9uIikudmFsKCkpOwogICAgICAgICAgICBkYXRhLmFwcGVuZCgnbWVldGluZ0FnZW5kYScsIG1vZGFsSWQuZmluZCgiI21lZXRpbmdBZ2VuZGEiKS52YWwoKSk7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdtZWV0aW5nT3duZXInLCBtb2RhbElkLmZpbmQoIiNtZWV0aW5nT3duZXIiKS52YWwoKSk7CiAgICAgICAgICAgIHZhciBkYXRlVGltZSA9IG1vZGFsSWQuZmluZCgiI21lZXRpbmdEYXRlIikudmFsKCkgKyAiICIgKyBtb2RhbElkLmZpbmQoIiNtZWV0aW5nVGltZSIpLnZhbCgpOwogICAgICAgICAgICBkYXRhLmFwcGVuZCgnbWVldGluZ0RhdGUnLCBkYXRlVGltZSk7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdtZWV0aW5nVGl0bGUnLCBtb2RhbElkLmZpbmQoIiNtZWV0aW5nVGl0bGUiKS52YWwoKSk7CiAgICAgICAgfQogICAgICAgIGRhdGEuYXBwZW5kKCd0eXBlJywgbW9kYWxJZC5maW5kKCIjdHlwZSIpLnZhbCgpKTsKICAgICAgICBkYXRhLmFwcGVuZCgnYXBwVHlwZScsIG1vZGFsSWQuZmluZCgiI2FwcFR5cGUiKS52YWwoKSk7CiAgICAgICAgZGF0YS5hcHBlbmQoJ2FsZXJ0SWQnLCBtb2RhbElkLmZpbmQoIiNhbGVydElkIikudmFsKCkpOwogICAgICAgIGRhdGEuYXBwZW5kKCdhdHRhY2htZW50U2l6ZScsIG1vZGFsSWQuZmluZCgiI2F0dGFjaG1lbnRzIikucHJvcCgnZmlsZXMnKS5sZW5ndGgpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbW9kYWxJZC5maW5kKCIjYXR0YWNobWVudHMiKS5wcm9wKCdmaWxlcycpLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdhdHRhY2htZW50cycgKyBpLCBtb2RhbElkLmZpbmQoIiNhdHRhY2htZW50cyIpLnByb3AoJ2ZpbGVzJylbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGF0YQogICAgfQoKICAgIHZhciBjbGVhcl9lcnJvcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnLm1vZGFsIC5tb2RhbC1ib2R5IC5hbGVydCcpLnJlbW92ZSgpOwogICAgfQoKICAgIHZhciBmaWxsTW9kYWxEYXRhV2l0aFRleHQgPSAgZnVuY3Rpb24oZGF0YSxtb2RhbCxpc0VkaXRTZXJpZXMsdGV4dCl7CiAgICAgICAgdmFyIG1lZXRpbmdBdHRlbmRlZXMgPSBkYXRhLmF0dGVuZGVlczsKICAgICAgICB2YXIgYXR0ZW5kZWVzID0gIiI7CiAgICAgICAgY2xlYXJNb2RhbChtb2RhbCk7CiAgICAgICAgdmFyIGF0dGVuZGVlc0xpc3QgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lZXRpbmdBdHRlbmRlZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAgICAgICAgICAgYXR0ZW5kZWVzID0gbWVldGluZ0F0dGVuZGVlc1tpXS5pZAogICAgICAgICAgICAgICAgYXR0ZW5kZWVzTGlzdC5wdXNoKG1lZXRpbmdBdHRlbmRlZXNbaV0uaWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXR0ZW5kZWVzID0gYXR0ZW5kZWVzICsgIiwiICsgbWVldGluZ0F0dGVuZGVlc1tpXS5pZDsKICAgICAgICAgICAgICAgIGF0dGVuZGVlc0xpc3QucHVzaChtZWV0aW5nQXR0ZW5kZWVzW2ldLmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgc3BhbiA9ICIiCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLm1lZXRpbmdBdHRhY2htZW50cy5sZW5ndGg7IGkrKykgewoKICAgICAgICAgICAgdmFyIGxpbmsgPSAiL3NpZ25hbC9tZWV0aW5nL3ZpZXdBdHRhY2htZW50cz9hdHRhY2htZW50SWQ9IiArIGRhdGEubWVldGluZ0F0dGFjaG1lbnRzW2ldLmlkICsgIiZtZWV0aW5nSWQ9IiArIGRhdGEuaWQKICAgICAgICAgICAgc3BhbiA9IHNwYW4gKyAiPGEgY2xhc3M9J2F0dGFjaG1lbnQtbmFtZSBtLXQtMTUnIHRhcmdldD0nX2JsYW5rJyBocmVmPSciICsgbGluayArICInIGRvd25sb2FkPSciICsgZGF0YS5tZWV0aW5nQXR0YWNobWVudHNbaV0ubmFtZSArCiAgICAgICAgICAgICAgICAiJz4gPGkgY2xhc3M9J2ZhIGZhLWZpbGUgbS1yLTEwJyBhcmlhLWhpZGRlbj0ndHJ1ZSc+IDwvaT4iICsgZGF0YS5tZWV0aW5nQXR0YWNobWVudHNbaV0ubmFtZSArICI8L2E+PC9kaXY+IgogICAgICAgIH0KICAgICAgICBtb2RhbC5maW5kKCIuYXR0YWNobWVudHMgLmF0dGFjaG1lbnQtYm9keSIpLmh0bWwoc3BhbikKCiAgICAgICAgbW9kYWwuZmluZCgnLmlkLWVsZW1lbnQnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CiAgICAgICAgbW9kYWwuZmluZCgnLm1lZXRpbmctaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtaXMtZWRpdC1zZXJpZXMnLCBpc0VkaXRTZXJpZXMpOwogICAgICAgIGlmIChpc0VkaXRTZXJpZXMpIHsKICAgICAgICAgICAgbW9kYWwuZmluZCgnLm1lZXRpbmctaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtbWFzdGVyLWlkJywgZGF0YS5tYXN0ZXJJZCk7CiAgICAgICAgICAgICQoJyNjYW5jZWxNZWV0aW5nTGluaycpLmhpZGUoKTsKICAgICAgICAgICAgJCgnI2NhbmNlbE1lZXRpbmdTZXJpZXNMaW5rJykuc2hvdygpOwogICAgICAgICAgICBtb2RhbC5maW5kKCcucmVjdXJyZW5jZS1jaGVja2JveC1jb250YWluZXInKS5zaG93KCk7CiAgICAgICAgICAgICQoJyNlZGl0LW1lZXRpbmctdGl0bGUtY29udGFpbmVyJykudGV4dCgnRWRpdCBTZXJpZXMnKTsKICAgICAgICAgICAgJCgnLmlzUmVjdXJyaW5nTWVldGluZycpLmF0dHIoImNoZWNrZWQiLCJjaGVja2VkIik7CiAgICAgICAgICAgICQoIi5tZWV0aW5nRGF0ZSIpLmF0dHIoImRpc2FibGVkIiwgImRpc2FibGVkIik7CiAgICAgICAgICAgICQoIi5tZWV0aW5nVGltZSIpLmF0dHIoImRpc2FibGVkIiwgImRpc2FibGVkIik7CiAgICAgICAgICAgICQoJy5zY2hlZHVsYXItY29udGFpbmVyJykuY29sbGFwc2UoJ3Nob3cnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtb2RhbC5maW5kKCcubWVldGluZy1pZC1lbGVtZW50JykuYXR0cignZGF0YS1tZWV0aW5nLWlkJywgZGF0YS5pZCk7CiAgICAgICAgICAgICQoJyNjYW5jZWxNZWV0aW5nTGluaycpLnNob3coKTsKICAgICAgICAgICAgJCgnI2NhbmNlbE1lZXRpbmdTZXJpZXNMaW5rJykuaGlkZSgpOwogICAgICAgICAgICBtb2RhbC5maW5kKCcucmVjdXJyZW5jZS1jaGVja2JveC1jb250YWluZXInKS5oaWRlKCk7CiAgICAgICAgICAgICQoJyNlZGl0LW1lZXRpbmctdGl0bGUtY29udGFpbmVyJykudGV4dCgnRWRpdCBNZWV0aW5nJyk7CiAgICAgICAgICAgICQoJy5pc1JlY3VycmluZ01lZXRpbmcnKS5yZW1vdmVBdHRyKCJjaGVja2VkIik7CiAgICAgICAgICAgICQoIi5tZWV0aW5nRGF0ZSIpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAgICAgICAgICQoIi5tZWV0aW5nVGltZSIpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAgICAgICAgICQoJy5zY2hlZHVsYXItY29udGFpbmVyJykuY29sbGFwc2UoJ2hpZGUnKTsKICAgICAgICB9CiAgICAgICAgbW9kYWwuZmluZCgiI21lZXRpbmdUaXRsZSIpLnZhbChkYXRhLm1lZXRpbmdUaXRsZSk7CiAgICAgICAgbW9kYWwuZmluZCgiI21lZXRpbmdPd25lciIpLnZhbChkYXRhLm93bmVySWQpOwogICAgICAgIG1vZGFsLmZpbmQoIiNtZWV0aW5nRGF0ZSIpLnZhbChtb21lbnQoZGF0YS5tZWV0aW5nRGF0ZSwiREQtTU1NLVlZWVkgaDptbSBBIikuZm9ybWF0KCdNTS9ERC9ZWVlZJykpOwogICAgICAgIG1vZGFsLmZpbmQoIiNtZWV0aW5nVGltZSIpLnZhbChtb21lbnQoZGF0YS5tZWV0aW5nRGF0ZSwiREQtTU1NLVlZWVkgaDptbSBBIikuZm9ybWF0KCdISDptbScpKTsKICAgICAgICBtb2RhbC5maW5kKCcjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcigpOwogICAgICAgICQoIiNtZWV0aW5nQXR0ZW5kZWVzLSIgKyB0ZXh0KS5maW5kKCJvcHRpb25baXNHdWVzdD0ndHJ1ZSddIikucmVtb3ZlKCk7CiAgICAgICAgbW9kYWwuZmluZCgiI21lZXRpbmdBZ2VuZGEiKS52YWwoZGF0YS5tZWV0aW5nQWdlbmRhKTsKICAgICAgICBpZiAoZGF0YS5ndWVzdEF0dGVuZGVlcykgewogICAgICAgICAgICAkLmVhY2goZGF0YS5ndWVzdEF0dGVuZGVlcywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgbW9kYWwuZmluZCgiI21lZXRpbmdBdHRlbmRlZXMtIit0ZXh0KS5hcHBlbmQoIjxvcHRpb24gdmFsdWU9JyIgKyB2YWx1ZSArICInIGlzR3Vlc3Q9J3RydWUnPiIgKyB2YWx1ZSArICI8L29wdGlvbj4iKTsKICAgICAgICAgICAgICAgIGF0dGVuZGVlc0xpc3QucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBtb2RhbC5maW5kKCIjbWVldGluZ0F0dGVuZGVlcy0iK3RleHQpLnZhbCgiIik7CiAgICAgICAgbW9kYWwuZmluZCgnI21lZXRpbmdBdHRlbmRlZXMtJyt0ZXh0KS5maW5kKCdvcHRpb24uZ3Vlc3RBdHRlbmRlZScpLnJlbW92ZSgpOwogICAgICAgIG1vZGFsLmZpbmQoIiNtZWV0aW5nQXR0ZW5kZWVzLSIrdGV4dCkudmFsKGF0dGVuZGVlc0xpc3QpOwogICAgICAgIHNob3dUYWdXaWRnZXQoIiNtZWV0aW5nQXR0ZW5kZWVzLSIrdGV4dCk7CiAgICAgICAgbW9kYWwuZmluZCgnI2R1cmF0aW9uJykudmFsKGRhdGEuZHVyYXRpb24pOwogICAgfTsKCiAgICB2YXIgZmlsbE1vZGFsRGF0YSA9IGZ1bmN0aW9uIChkYXRhLCBtb2RhbCwgaXNFZGl0U2VyaWVzKSB7CiAgICAgICAgZmlsbE1vZGFsRGF0YVdpdGhUZXh0KGRhdGEsbW9kYWwsaXNFZGl0U2VyaWVzLCdlZGl0JykKICAgIH07CgogICAgdmFyIGluaXRfbWVldGluZ190YWJsZSA9IGZ1bmN0aW9uICh0YWJsZV9pZCkgewogICAgICAgIHZhciBkYXRhVXJsID0gIi9zaWduYWwvbWVldGluZy9saXN0P2FsZXJ0SWQ9IiArIGFsZXJ0SWQgKyAiJmFwcFR5cGU9IiArIGFwcFR5cGU7CiAgICAgICAgdGFibGUgPSAkKHRhYmxlX2lkKS5EYXRhVGFibGUoewogICAgICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZuRHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYXBwVHlwZSA9ICQoIiNhcHBUeXBlIikudmFsKCk7CiAgICAgICAgICAgICAgICBjb2xFbGxpcHNpcygpOwogICAgICAgICAgICAgICAgd2ViVWlQb3BJbml0KCk7CgogICAgICAgICAgICAgICAgJCgnLmVkaXQtbWVldGluZy1zZXJpZXMtbGluaycpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdE1lZXRpbmdTZXJpZXNNb2RhbDsKICAgICAgICAgICAgICAgICAgICB2YXIgbWFzdGVyTWVldGluZ0lkID0gJCh0aGlzKS5hdHRyKCdkYXRhLW1hc3Rlci1pZCcpOwogICAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC9tZWV0aW5nL2dldEJ5TWFzdGVySWQ/bWFzdGVySWQ9IiArIG1hc3Rlck1lZXRpbmdJZDsKICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlckRhdGFKc29uID0gSlNPTi5wYXJzZShkYXRhLnNjaGVkdWxhckpzb24pOwogICAgICAgICAgICAgICAgICAgICAgICBlZGl0TWVldGluZ1Nlcmllc01vZGFsID0gJCgnI2VkaXRNZWV0aW5nTW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE1vZGFsRGF0YShkYXRhLCBlZGl0TWVldGluZ1Nlcmllc01vZGFsLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWRpdE1lZXRpbmdTZXJpZXNNb2RhbC5tb2RhbCh7fSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCgnLnVwZGF0ZS1tZWV0aW5nLCNlZGl0LWlDYWxhbmRlcicpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljc0ZpbGUgPSAkKHRoaXMpLmRhdGEoJ2ljc0ZpbGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVwZGF0ZVVybCA9ICIvc2lnbmFsL21lZXRpbmcvdXBkYXRlTWVldGluZ1Nlcmllcz9tYXN0ZXJJZD0iICsgbWFzdGVyTWVldGluZ0lkICsgIiZhcHBUeXBlPSIgKyBhcHBUeXBlICsgIiZkb3dubG9hZElDU0ZpbGU9IiArIGljc0ZpbGU7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0TWVldGluZ01vZGFsRm9ybSA9ICQoIiNlZGl0TWVldGluZ01vZGFsICN0ZW1wRm9ybSIpOwogICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cGRhdGVVcmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBnZXRNZWV0aW5nRGV0YWlscyhlZGl0TWVldGluZ01vZGFsRm9ybSwgJ2VkaXQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocGF5bG9hZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBheWxvYWQuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRJQ1NGaWxlKGljc0ZpbGUsIHBheWxvYWQuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdE1lZXRpbmdNb2RhbEZvcm0uZmluZCgnLmZvcm0tY29udHJvbCcpLnZhbCgiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdE1lZXRpbmdNb2RhbEZvcm0uZmluZCgiI2F0dGFjaG1lbnRzIikudmFsKCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0TWVldGluZ1Nlcmllc01vZGFsLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGl2aXRpZXNfdXRpbHMucmVsb2FkX2FjdGl2aXR5X3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMucmVsb2FkX2FjdGlvbl90YWJsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5tZWV0aW5nX3V0aWxzLnJlbG9hZF9tZWV0aW5nX3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1zZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5jb2RlID09IDQwMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgPSBzaG93RXJyb3JNZXNzYWdlSW5NZWV0aW5nTW9kYWwoIkVudGVyZWQgRW1haWwgYWRkcmVzcyBpcyBub3QgdmFsaWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnID0gc2hvd0Vycm9yTWVzc2FnZUluTWVldGluZ01vZGFsKCJQbGVhc2UgcHJvdmlkZSB2YWx1ZSBmb3IgYWxsIHRoZSBtYW5kYXRvcnkgZmllbGRzIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdE1lZXRpbmdTZXJpZXNNb2RhbC5maW5kKCcubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgJCgnLmFkZC1tZWV0aW5nLW1pbnV0ZXMtbGluaycpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbW1Nb2RhbCA9ICQoJyNtZWV0aW5nTWludXRlc01vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9ICIvc2lnbmFsL21lZXRpbmcvZ2V0QnlJZD9tZWV0aW5nSWQ9IiArICQodGhpcykuYXR0cignZGF0YS1pZCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBtZWV0aW5nSWQgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgJGZvcm0gPSAkKCcjbWVldGluZ01vZGFsRm9ybScpOwogICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJwogICAgICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRtZWV0aW5nTWludXRlcyA9ICQoJy5tZWV0aW5nTWludXRlcycpOwogICAgICAgICAgICAgICAgICAgICAgICBmaWxsTW9kYWxEYXRhV2l0aFRleHQoZGF0YSxtbU1vZGFsLGZhbHNlLCdtZWV0aW5nLW1pbnV0ZXMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE1vZGFsRGF0YShkYXRhLCBtbU1vZGFsLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVGb3JtRmllbGRzKCRmb3JtKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lZXRpbmdNaW51dGVzLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRtZWV0aW5nTWludXRlcy52YWwoZGF0YS5tZWV0aW5nTWludXRlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1tTW9kYWwubW9kYWwoe30pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICQoJy51cGRhdGUtbWVldGluZycpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFwcFR5cGUgPSAkKCcjbWVldGluZ01vZGFsRm9ybSAjYXBwVHlwZScpLnZhbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxlcnRJZCA9ICQoJyNtZWV0aW5nTW9kYWxGb3JtICNhbGVydElkJykudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cGRhdGVVcmwgPSAiL3NpZ25hbC9tZWV0aW5nL3NhdmVNZWV0aW5nTWludXRlcz9tZWV0aW5nSWQ9IiArIG1lZXRpbmdJZDsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXBkYXRlVXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZ2V0TWVldGluZ0RldGFpbHMobW1Nb2RhbCwgJ21lZXRpbmdNaW51dGVzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1tTW9kYWwuZmluZCgnLmZvcm0tY29udHJvbCcpLnZhbCgiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtbU1vZGFsLmZpbmQoIiNhdHRhY2htZW50cyIpLnZhbCgiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtbU1vZGFsLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnJlbG9hZF9hY3Rpb25fdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICQoJy5lZGl0LW1lZXRpbmctbGluaycpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdE1lZXRpbmdNb2RhbDsKICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gIi9zaWduYWwvbWVldGluZy9nZXRCeUlkP21lZXRpbmdJZD0iICsgJCh0aGlzKS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1lZXRpbmdJZCA9ICQodGhpcykuYXR0cignZGF0YS1pZCcpOwogICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWRpdE1lZXRpbmdNb2RhbCA9ICQoJyNlZGl0TWVldGluZ01vZGFsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxNb2RhbERhdGEoZGF0YSwgZWRpdE1lZXRpbmdNb2RhbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBlZGl0TWVldGluZ01vZGFsLm1vZGFsKHt9KQogICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSBzaG93RXJyb3JNZXNzYWdlSW5NZWV0aW5nTW9kYWwoZGF0YS5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjZWRpdE1lZXRpbmdNb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICQoJy51cGRhdGUtbWVldGluZywjZWRpdC1pQ2FsYW5kZXInKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY3NGaWxlID0gJCh0aGlzKS5kYXRhKCdpY3NGaWxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cGRhdGVVcmwgPSAiL3NpZ25hbC9tZWV0aW5nL3VwZGF0ZU1lZXRpbmc/bWVldGluZ0lkPSIgKyBtZWV0aW5nSWQgKyAiJmRvd25sb2FkSUNTRmlsZT0iICsgaWNzRmlsZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVkaXRNZWV0aW5nTW9kYWxGb3JtID0gJCgiI2VkaXRNZWV0aW5nTW9kYWwgI3RlbXBGb3JtIik7CiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVwZGF0ZVVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGdldE1lZXRpbmdEZXRhaWxzKGVkaXRNZWV0aW5nTW9kYWxGb3JtLCAnZWRpdCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChwYXlsb2FkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihwYXlsb2FkLnN0YXR1cyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRJQ1NGaWxlKGljc0ZpbGUsIHBheWxvYWQuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdE1lZXRpbmdNb2RhbEZvcm0uZmluZCgnLmZvcm0tY29udHJvbCcpLnZhbCgiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdE1lZXRpbmdNb2RhbEZvcm0uZmluZCgiI2F0dGFjaG1lbnRzIikudmFsKCIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0TWVldGluZ01vZGFsLm1vZGFsKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGl2aXRpZXNfdXRpbHMucmVsb2FkX2FjdGl2aXR5X3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMucmVsb2FkX2FjdGlvbl90YWJsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5tZWV0aW5nX3V0aWxzLnJlbG9hZF9tZWV0aW5nX3RhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJfZXJyb3JzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLmNvZGUgPT0gNDAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyA9IHNob3dFcnJvck1lc3NhZ2VJbk1lZXRpbmdNb2RhbCgiRW50ZXJlZCBFbWFpbCBhZGRyZXNzIGlzIG5vdCB2YWxpZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgPSBzaG93RXJyb3JNZXNzYWdlSW5NZWV0aW5nTW9kYWwoIlBsZWFzZSBwcm92aWRlIHZhbHVlIGZvciBhbGwgdGhlIG1hbmRhdG9yeSBmaWVsZHMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0TWVldGluZ01vZGFsLmZpbmQoJy5tb2RhbC1ib2R5JykucHJlcGVuZChlcnJvck1zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICAiZm5Jbml0Q29tcGxldGUiOiBmdW5jdGlvbiAob1NldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICAkKCcubWVldGluZy1jcmVhdGUnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCkKICAgICAgICAgICAgICAgIHNpZ25hbC5tZWV0aW5nX3V0aWxzLnNldF9tZWV0aW5nX2NyZWF0ZV9tb2RhbCgpOwogICAgICAgICAgICAgICAgJCgnI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoKQogICAgICAgICAgICB9LAogICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiBkYXRhVXJsLAogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZGF0YVNyYzogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2VhcmNoaW5nOiB0cnVlLAogICAgICAgICAgICBkb206ICJCZnJ0aXAiLAogICAgICAgICAgICBidXR0b25zOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ05ldyBNZWV0aW5nJywKICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdidG4tcHJpbWFyeSBtZWV0aW5nLWNyZWF0ZScsCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoZSwgZHQsIG5vZGUsIGNvbmZpZykgewogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgYWFTb3J0aW5nOiBbWzYsICJkZXNjIl1dLAogICAgICAgICAgICAiYkxlbmd0aENoYW5nZSI6IHRydWUsCiAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDEwLAogICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyMCwgNTAsIC0xXSwgWzEwLCAyMCwgNTAsICJBbGwiXV0sCiAgICAgICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIm1lZXRpbmdUaXRsZSIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG1vbWVudChyb3cubWVldGluZ0RhdGUsICdERC1NTU0tWVlZWScpLmZvcm1hdCgnREQtTU1NLVlZWVknKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gZXNjYXBlSFRNTChyb3cubWVldGluZ1RpdGxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5pc1JlY3VycmVuY2VNZWV0aW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZSArPSAiKCIgKyBkYXRlICsgIikiOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cubWVldGluZ1N0YXR1cyA9PSAiQ0FOQ0VMTEVEIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUgKz0gIigiICsgcm93Lm1lZXRpbmdTdGF0dXMgKyAiKSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbkJ1dHRvbiA9ICc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAgZHJvcGRvd24gZGF0YVRhYmxlSGlkZUNlbGxDb250ZW50IiBhbGlnbj0ibGVmdCI+IFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+IFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICsgdGl0bGUgKyAnPHNwYW4gY2xhc3M9InNyLW9ubHkiPlRvZ2dsZSBEcm9wZG93bjwvc3Bhbj4gXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPiBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUiIHJvbGU9Im1lbnUiIHN0eWxlPSJtaW4td2lkdGg6IDgwcHggIWltcG9ydGFudDsgZm9udC1zaXplOiAxMnB4OyI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5pc01lZXRpbmdFZGl0YWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8bGkgcm9sZT0icHJlc2VudGF0aW9uIj48YSBjbGFzcz0iZWRpdC1tZWV0aW5nLWxpbmsiIHJvbGU9Im1lbnVpdGVtIiAgZGF0YS1pZD0iJyArIHJvdy5pZCArICciIGhyZWY9IiMiID4nICsgJ0VkaXQgTWVldGluZycgKyAnPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cuaXNSZWN1cnJlbmNlTWVldGluZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiArPSAnPGxpIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9ImVkaXQtbWVldGluZy1zZXJpZXMtbGluayIgcm9sZT0ibWVudWl0ZW0iICBkYXRhLW1hc3Rlci1pZD0iJyArIHJvdy5tYXN0ZXJJZCArICciIGhyZWY9IiMiID4nICsgJ0VkaXQgU2VyaWVzJyArICc8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiArPSAnPGxpIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9ImFkZC1tZWV0aW5nLW1pbnV0ZXMtbGluayIgcm9sZT0ibWVudWl0ZW0iIGRhdGEtaWQ9IicgKyByb3cuaWQgKyAnIiBocmVmPSIjIiA+JyArICdBZGQgTWludXRlcycgKyAnPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25CdXR0b247CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIm1lZXRpbmdEYXRlIiwKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQoZGF0YSwiREQtTU1NLVlZWVkiKS5mb3JtYXQoImRkZGQiKSArICIgIiArIG1vbWVudChkYXRhLCJERC1NTU0tWVlZWSBoOm1tIEEiKS5mb3JtYXQoIkRELU1NTS1ZWVlZIGg6bW0gQSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIm1lZXRpbmdNaW51dGVzIiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonY29sLW1pbi0xNTAgY2VsbC1icmVhayBjb2wtbWF4LTIwMCcsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiIDogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhZGRFbGxpcHNpcyhyb3cubWVldGluZ01pbnV0ZXMpOwoKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibWVldGluZ093bmVyIgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJtZWV0aW5nQWdlbmRhIiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonY29sLW1pbi0xNTAgY29sLW1heC0zMDAgY2VsbC1icmVhayAnLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIiA6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWRkRWxsaXBzaXMocm93Lm1lZXRpbmdBZ2VuZGEpOwoKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJtb2RpZmllZEJ5IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibGFzdE1vZGlmaWVkIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiIiwKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cuYWN0aW9uU3RhdHVzID09IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGltZyBzcmM9IicgKyAiL3NpZ25hbC9hc3NldHMvaWNvbnMvaGlnaF9wcmlvcml0eS5wbmciICsgJyIvPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm93LmFjdGlvblN0YXR1cyA9PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxpbWcgc3JjPSInICsgIi9zaWduYWwvYXNzZXRzL2ljb25zL21lZGl1bV9wcmlvcml0eS5wbmciICsgJyIvPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm93LmFjdGlvblN0YXR1cyA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxpbWcgc3JjPSInICsgIi9zaWduYWwvYXNzZXRzL2ljb25zL2xvd19wcmlvcml0eS5wbmciICsgJyIvPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICBdLAogICAgICAgICAgICBzY3JvbGxYOnRydWUsCiAgICAgICAgICAgIHNjcm9sbFk6JzI3MHB4JywKICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgICAgICB9KTsKICAgICAgICB0YWJsZS5idXR0b24oKS5kaXNhYmxlKCk7CiAgICAgICAgbWVldGluZ0RhdGFUYWJsZSA9IHRhYmxlOwogICAgICAgIHJldHVybiB0YWJsZQogICAgfQoKICAgIHZhciByZWxvYWRfbWVldGluZ190YWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBtZWV0aW5nRGF0YVRhYmxlLmFqYXgucmVsb2FkKCk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgc2V0X21lZXRpbmdfY3JlYXRlX21vZGFsOiBzZXRfbWVldGluZ19jcmVhdGVfbW9kYWwsCiAgICAgICAgaW5pdF9tZWV0aW5nX3RhYmxlOiBpbml0X21lZXRpbmdfdGFibGUsCiAgICAgICAgcmVsb2FkX21lZXRpbmdfdGFibGU6IHJlbG9hZF9tZWV0aW5nX3RhYmxlCiAgICB9Cn0pKCk7CgpmdW5jdGlvbiBzaG93RXJyb3JNZXNzYWdlSW5NZWV0aW5nTW9kYWwodGV4dCkgewogICAgdmFyIGVycm9yTXNnID0gIjxkaXYgY2xhc3M9J2FsZXJ0IGFsZXJ0LWRhbmdlcic+IjsKICAgIGlmICh0ZXh0KSB7CiAgICAgICAgZXJyb3JNc2cgKz0gdGV4dDsKICAgIH0gZWxzZSB7CiAgICAgICAgZXJyb3JNc2cgKz0gJ1BsZWFzZSBmaWxsICB0aGUgcmVxdWlyZWQgRmllbGRzJzsKICAgIH0KICAgIGVycm9yTXNnICs9ICI8L2Rpdj4iOwogICAgcmV0dXJuIGVycm9yTXNnOwp9CgokKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNsb3NlTWVldGluZ01vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgIGJvb3Rib3guY29uZmlybSh7CiAgICAgICAgbWVzc2FnZTogIlRoZXJlIGFyZSB1bnNhdmVkIGNoYW5nZXMgZm9yIHRoaXMgbWVldGluZy4gRG8geW91IHN0aWxsIHdhbnQgdG8gY2xvc2UgaXQ/IiwKICAgICAgICBidXR0b25zOiB7CiAgICAgICAgICAgIGNvbmZpcm06IHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnWWVzJywKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2J0bi1wcmltYXJ5JwogICAgICAgICAgICB9LAogICAgICAgICAgICBjYW5jZWw6IHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnTm8nLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnYnRuLWRlZmF1bHQnCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIGJvb3Rib3guaGlkZUFsbCgpOwogICAgICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAkKCcjY3JlYXRlTWVldGluZ01vZGFsJykubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwp9KTsKCmZ1bmN0aW9uIGNsZWFyTW9kYWwoJG1vZGFsKSB7CiAgICAkbW9kYWwuZmluZCgiaW5wdXRbdHlwZT10ZXh0XSIpLnZhbCgnJyk7CiAgICAkbW9kYWwuZmluZCgidGV4dGFyZWEiKS52YWwoJycpOwp9CgpmdW5jdGlvbiBkaXNhYmxlRm9ybUZpZWxkcygkZm9ybSkgewogICAgJGZvcm0uZmluZCgnc2VsZWN0JykuYXR0cignZGlzYWJsZWQnLCB0cnVlKTsKICAgICRmb3JtLmZpbmQoJ3RleHRhcmVhJykuYXR0cignZGlzYWJsZWQnLCB0cnVlKTsKICAgICRmb3JtLmZpbmQoJy5zZWFyY2hNZWV0aW5nVGltZXMnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTsKfQoKJChkb2N1bWVudCkub24oJ2NoYW5nZScsICIuaXNSZWN1cnJpbmdNZWV0aW5nIiwgZnVuY3Rpb24gKCkgewogICAgaWYgKCQodGhpcykuaXMoIjpjaGVja2VkIikpIHsKICAgICAgICAkKCcuc2NoZWR1bGFyLWNvbnRhaW5lcicpLmNvbGxhcHNlKCdzaG93Jyk7CiAgICAgICAgJCgiLm1lZXRpbmdEYXRlIikuYXR0cigiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKTsKICAgICAgICAkKCIubWVldGluZ1RpbWUiKS5hdHRyKCJkaXNhYmxlZCIsICJkaXNhYmxlZCIpOwogICAgfSBlbHNlIHsKICAgICAgICAkKCcuc2NoZWR1bGFyLWNvbnRhaW5lcicpLmNvbGxhcHNlKCdoaWRlJyk7CiAgICAgICAgJCgiLm1lZXRpbmdEYXRlIikucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKICAgICAgICAkKCIubWVldGluZ1RpbWUiKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgfQp9KTsKCmZ1bmN0aW9uIGludGlhbGl6ZVNjaGVkdWxhcigpIHsKICAgICQoJy5teVNjaGVkdWxlcicpLnNjaGVkdWxlcigndmFsdWUnLCB7CiAgICAgICAgc3RhcnREYXRlVGltZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgIHRpbWVab25lOiB7CiAgICAgICAgICAgIC8vIG9mZnNldDogJyswNTozMCcsCiAgICAgICAgICAgIG5hbWU6ICJBc2lhL0tvbGthdGEiCiAgICAgICAgfSwKICAgICAgICByZWN1cnJlbmNlUGF0dGVybjogJ0JZREFZPU1PJwogICAgfSk7Cn0KCiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuc2VhcmNoTWVldGluZ1RpbWVzJywgZnVuY3Rpb24gKCkgewogICAgJCh0aGlzKS5maW5kKCcudGltZS1zbG90LWNvbnRhaW5lcicpLmh0bWwoJycpOwogICAgJCgnLm1lZXRpbmdTdWdnZXN0aW9uQ29udGFpbmVyJykuY29sbGFwc2UoJ3RvZ2dsZScpOwp9KTsKCiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZmluZE1lZXRpbmdUaW1lcycsIGZ1bmN0aW9uICgpIHsKICAgICQodGhpcykuZmluZCgnLnRpbWUtc2xvdC1jb250YWluZXInKS5odG1sKCcnKTsKICAgIHZhciB0ZXh0ID0gJCh0aGlzKS5kYXRhKCd0ZXh0Jyk7CiAgICB2YXIgJG1vZGFsOwogICAgaWYgKHRleHQgPT0gJ2NyZWF0ZScpIHsKICAgICAgICAkbW9kYWwgPSAkKCcjY3JlYXRlTWVldGluZ01vZGFsJyk7CiAgICB9IGVsc2UgewogICAgICAgICRtb2RhbCA9ICQoJyNlZGl0TWVldGluZ01vZGFsJyk7CiAgICB9CiAgICB2YXIgbXlEYXRhID0gewogICAgICAgIGZtdFN0YXJ0RGF0ZTogJCgnI2ZtdFN0YXJ0RGF0ZS0nICsgdGV4dCkudmFsKCksCiAgICAgICAgZm10RW5kRGF0ZTogJCgnI2ZtdEVuZERhdGUtJyArIHRleHQpLnZhbCgpLAogICAgICAgIGR1cmF0aW9uOiAkKCcjZHVyYXRpb24nKS52YWwoKQogICAgfTsKICAgIHZhciBhdHRlbmRlZXNBcnJheSA9ICRtb2RhbC5maW5kKCIjbWVldGluZ0F0dGVuZGVlcy0iK3RleHQpLnZhbCgpOwogICAgaWYgKGF0dGVuZGVlc0FycmF5KSB7CiAgICAgICAgbXlEYXRhLm1lZXRpbmdBdHRlbmRlZXMgPSBhdHRlbmRlZXNBcnJheS50b1N0cmluZygpCiAgICB9CiAgICB2YXIgJG1zZ0NvbnRhaW5lciA9ICRtb2RhbC5maW5kKCcubW9kYWwtYm9keScpLmZpbmQoJyNtc2ctY29udGFpbmVyJyk7CiAgICAkLmFqYXgoewogICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICB1cmw6ICQoIiNmaW5kTWVldGluZ1RpbWVzVXJsIikudmFsKCksCiAgICAgICAgZGF0YTogJC5wYXJhbShteURhdGEpLAogICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHBheWxvYWQpIHsKICAgICAgICAgICAgaWYgKHBheWxvYWQuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAkbXNnQ29udGFpbmVyLmhpZGUoKTsKICAgICAgICAgICAgICAgIHNob3dUaW1lU3VnZ2VzdGlvbnMocGF5bG9hZC5kYXRhKTsKICAgICAgICAgICAgICAgICQoJy5tZWV0aW5nU3VnZ2VzdGlvbkNvbnRhaW5lcicpLmNvbGxhcHNlKCdzaG93Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSBzaG93RXJyb3JNZXNzYWdlSW5NZWV0aW5nTW9kYWwocGF5bG9hZC5tZXNzYWdlKTsKICAgICAgICAgICAgICAgICRtc2dDb250YWluZXIuaHRtbChlcnJvck1zZyk7CiAgICAgICAgICAgICAgICAkbXNnQ29udGFpbmVyLnNob3coKTsKICAgICAgICAgICAgICAgICQoJy50aW1lLXNsb3QtY29udGFpbmVyJykuaHRtbCgnJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfSk7CgokKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNlbGVjdFRpbWVTbG90JywgZnVuY3Rpb24gKCkgewogICAgJCgnLm1lZXRpbmdEYXRlJykudmFsKCQodGhpcykuZGF0YSgnc3RhcnREYXRlJykpOwogICAgJCgnLm1lZXRpbmdUaW1lJykudmFsKCQodGhpcykuZGF0YSgnc3RhcnRUaW1lJykpOwogICAgJCgnLm1lZXRpbmdTdWdnZXN0aW9uQ29udGFpbmVyJykuY29sbGFwc2UoJ2hpZGUnKTsKfSk7CgpmdW5jdGlvbiBzaG93VGltZVN1Z2dlc3Rpb25zKGRhdGEpIHsKICAgIHZhciBzdWdnZXN0aW9uTGlzdDsKICAgIGlmIChkYXRhKSB7CiAgICAgICAgc3VnZ2VzdGlvbkxpc3QgPSBkYXRhLm1lZXRpbmdUaW1lU3VnZ2VzdGlvbnM7CiAgICB9CiAgICB2YXIgZ2VuZXJhdGVkSHRtbCA9ICIiOwogICAgdmFyIHN0YXJ0RGF0ZTsKICAgIHZhciBzdGFydFRpbWU7CiAgICBpZiAoc3VnZ2VzdGlvbkxpc3QpIHsKICAgICAgICAkLmVhY2goc3VnZ2VzdGlvbkxpc3QsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgc3RhcnREYXRlID0gbW9tZW50KHZhbHVlLnRpbWVTbG90LnN0YXJ0RGF0ZVRpbWUpLmZvcm1hdCgnTU0vREQvWVlZWScpOwogICAgICAgICAgICBzdGFydFRpbWUgPSBtb21lbnQodmFsdWUudGltZVNsb3Quc3RhcnREYXRlVGltZSkuZm9ybWF0KCdISDptbTpzcycpOwogICAgICAgICAgICBnZW5lcmF0ZWRIdG1sICs9ICc8ZGl2IGNsYXNzPSJwYW5lbCBwYW5lbC13YXJuaW5nIG1lZXRpbmctc2xvdC1jb250YWluZXIiPicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9InBhbmVsLWJvZHkiPicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9Im1lZXRpbmctc3VnZ2VzdGlvbiByb3ciPicgKwogICAgICAgICAgICAgICAgLy8gJzxkaXYgY2xhc3M9ImNvbC1tZC0zIj4nCiAgICAgICAgICAgICAgICAvLyArIHZhbHVlLmF0dGVuZGVlc1swXS5lbWFpbCsKICAgICAgICAgICAgICAgIC8vICc8L2Rpdj4nICsKICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPSJjb2wtbWQtNCI+JwogICAgICAgICAgICAgICAgKyBtb21lbnQodmFsdWUudGltZVNsb3Quc3RhcnREYXRlVGltZSkuZm9ybWF0KCdERC1NTU0tWVlZWScpICsgJyAnCiAgICAgICAgICAgICAgICArIHN0YXJ0VGltZSArCiAgICAgICAgICAgICAgICAnPC9kaXY+JyArCiAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz0iY29sLW1kLTQiPicKICAgICAgICAgICAgICAgICsgbW9tZW50KHZhbHVlLnRpbWVTbG90LmVuZERhdGVUaW1lKS5mb3JtYXQoJ0RELU1NTS1ZWVlZJykgKyAnICcKICAgICAgICAgICAgICAgICsgbW9tZW50KHZhbHVlLnRpbWVTbG90LmVuZERhdGVUaW1lKS5mb3JtYXQoJ0hIOm1tOnNzJykgKwogICAgICAgICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9ImNvbC1tZC00Ij4nICsKICAgICAgICAgICAgICAgICc8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IHNlbGVjdFRpbWVTbG90IiBkYXRhLXN0YXJ0LWRhdGU9IicgKyBzdGFydERhdGUgKyAnIiBkYXRhLXN0YXJ0LXRpbWU9IicgKyBzdGFydFRpbWUgKyAnIj5TZWxlY3Q8L2E+PC9kaXY+JyArCiAgICAgICAgICAgICAgICAnPC9kaXY+PC9kaXY+PC9kaXY+JzsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgZ2VuZXJhdGVkSHRtbCArPSAnPGRpdiBjbGFzcz0icGFuZWwgcGFuZWwtd2FybmluZyBtZWV0aW5nLXNsb3QtY29udGFpbmVyIj4nICsKICAgICAgICAgICAgJzxkaXYgY2xhc3M9InBhbmVsLWJvZHkiPk5vIFRpbWUgU2xvdCBmb3VuZCBmb3IgZ2l2ZW4gZGF0ZS48L2Rpdj48L2Rpdj4nCiAgICB9CiAgICAkKCcudGltZS1zbG90LWNvbnRhaW5lcicpLmh0bWwoZ2VuZXJhdGVkSHRtbCk7Cn0KCiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY2FuY2VsTWVldGluZ0xpbmsnLCBmdW5jdGlvbiAoZSkgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgdmFyIGlzRWRpdFNlcmllcyA9ICQodGhpcykuZGF0YSgnaXNFZGl0U2VyaWVzJyk7CiAgICB2YXIgdXJsOwogICAgaWYgKGlzRWRpdFNlcmllcykgewogICAgICAgIHVybCA9ICQodGhpcykuYXR0cignaHJlZicpICsgIj9tYXN0ZXJJZD0iICsgJCh0aGlzKS5kYXRhKCdtYXN0ZXItaWQnKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdXJsID0gJCh0aGlzKS5hdHRyKCdocmVmJykgKyAiJmlkPSIgKyAkKHRoaXMpLmRhdGEoJ21lZXRpbmctaWQnKTsKICAgIH0KICAgICQuYWpheCh7CiAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgIHVybDogdXJsLAogICAgICAgIGRhdGE6IHt9LAogICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgJCgiI2VkaXRNZWV0aW5nTW9kYWwiKS5tb2RhbCgnaGlkZScpOwogICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMucmVsb2FkX2FjdGlvbl90YWJsZSgpOwogICAgICAgICAgICBtZWV0aW5nRGF0YVRhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgfQogICAgfSk7Cn0pOwoKZnVuY3Rpb24gcHJvY2Vzc1NjaGVkdWxlcih0ZXh0LCBqc29uKSB7CiAgICB2YXIgJHNjaGVkdWxhckNvbnRhaW5lciA9ICQoJyNzY2hlZHVsYXJDb250YWluZXInKTsKICAgIHZhciBodG1sID0gJHNjaGVkdWxhckNvbnRhaW5lci5odG1sKCk7CiAgICAkKCcuc2NoZWR1bGFyLWNvbnRhaW5lci0nICsgdGV4dCkuaHRtbChodG1sKTsKICAgICRzY2hlZHVsYXJDb250YWluZXIuaHRtbCgnJyk7CiAgICBpbml0aWFsaXplU2NoZWR1bGVyKGpzb24pOwp9CgpmdW5jdGlvbiB1blByb2Nlc3NTY2hlZHVsZXIodGV4dCkgewogICAgdmFyICRzY2hlZHVsZXJDbGFzc0NvbnRhaW5lciA9ICQoJy5zY2hlZHVsYXItY29udGFpbmVyLScgKyB0ZXh0KTsKICAgIHZhciBodG1sID0gJHNjaGVkdWxlckNsYXNzQ29udGFpbmVyLmh0bWwoKTsKICAgICQoJyNzY2hlZHVsYXJDb250YWluZXInKS5odG1sKGh0bWwpOwogICAgJHNjaGVkdWxlckNsYXNzQ29udGFpbmVyLmh0bWwoJycpOwp9CgpmdW5jdGlvbiBpbml0aWFsaXplU2NoZWR1bGVyKHZhbHVlKSB7CiAgICAkKCcjbXlTY2hlZHVsZXInKS5zY2hlZHVsZXIoKTsKICAgIGlmICgodHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJyB8fCB2YWx1ZSA9PT0gbnVsbCkpIHsKICAgICAgICBzZXRUb2RheSgpOwogICAgfSBlbHNlIHsKICAgICAgICAkKCcjbXlTY2hlZHVsZXInKS5zY2hlZHVsZXIoJ3ZhbHVlJywgewogICAgICAgICAgICBzdGFydERhdGVUaW1lOiB2YWx1ZS5zdGFydERhdGVUaW1lLAogICAgICAgICAgICB0aW1lWm9uZTogewogICAgICAgICAgICAgICAgLy8gbmFtZTogdmFsdWUudGltZVpvbmUubmFtZSwKICAgICAgICAgICAgICAgIG9mZnNldDogdmFsdWUudGltZVpvbmUub2Zmc2V0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlY3VycmVuY2VQYXR0ZXJuOiB2YWx1ZS5yZWN1cnJlbmNlUGF0dGVybgogICAgICAgIH0pCiAgICAgICAgdmFyIG5ld0luZm8gPSAkKCcjbXlTY2hlZHVsZXInKS5zY2hlZHVsZXIoJ3ZhbHVlJyk7CiAgICAgICAgJCgnI2NvbmZpZ1NlbGVjdGVkVGltZVpvbmUnKS52YWwobmV3SW5mby50aW1lWm9uZS5uYW1lKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI0OyBpKyspIHsKICAgICAgICAgICAgdmFyIG1pbiA9IDA7CiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgMjsgaisrKSB7CiAgICAgICAgICAgICAgICAkKCIjbXlTY2hlZHVsZXIgI3RpbWVTZWxlY3QgdWwiKS5hcHBlbmQoJzxsaT48YSBocmVmPSIjIj4nICsgY2FsY3VsYXRlQWxsSW50ZXJ2YWxzKGksIG1pbikgKyAnPC9hPjwvbGk+Jyk7CiAgICAgICAgICAgICAgICBtaW4gPSAzMAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgokKCcjbXlTY2hlZHVsZXInKS5vbignY2hhbmdlZC5mdS5zY2hlZHVsZXInLCBmdW5jdGlvbiAoZSwgZGF0YSkgewogICAgdmFyIG5ld0luZm8gPSAkKCcjbXlTY2hlZHVsZXInKS5zY2hlZHVsZXIoJ3ZhbHVlJyk7CiAgICAkKCcjc2NoZWR1bGVEYXRlSlNPTicpLnZhbChKU09OLnN0cmluZ2lmeShuZXdJbmZvKSk7CiAgICAkKCcjY29uZmlnU2VsZWN0ZWRUaW1lWm9uZScpLnZhbChuZXdJbmZvLnRpbWVab25lLm5hbWUpOwp9KTsKCiQoJyNteURhdGVQaWNrZXInKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICB2YXIgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHNlbGVjdGVkRGF0ZSA9ICQoIiNNeVN0YXJ0RGF0ZSIpLnZhbCgpOwogICAgdmFyIHNjaGVkdWxlckZyb20gPSAkKCcjc2NoZWR1bGVyRnJvbScpLnZhbCgpOwoKCiAgICBpZiAoY3VycmVudERhdGUgPCBuZXcgRGF0ZShzZWxlY3RlZERhdGUpKSB7CiAgICAgICAgJCgiI215U2NoZWR1bGVyICN0aW1lU2VsZWN0IHVsIikuZW1wdHkoKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI0OyBpKyspIHsKICAgICAgICAgICAgdmFyIG1pbiA9IDA7CiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgMjsgaisrKSB7CiAgICAgICAgICAgICAgICAkKCIjbXlTY2hlZHVsZXIgI3RpbWVTZWxlY3QgdWwiKS5hcHBlbmQoJzxsaT48YSBocmVmPSIjIj4nICsgY2FsY3VsYXRlQWxsSW50ZXJ2YWxzKGksIG1pbikgKyAnPC9hPjwvbGk+Jyk7CiAgICAgICAgICAgICAgICBtaW4gPSAzMAogICAgICAgICAgICB9CiAgICAgICAgICAgICQoIiNteVN0YXJ0VGltZSIpLnZhbCgxMiArICc6JyArICIwMCIgKyAnICcgKyAnQU0nKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHNldFRvZGF5KCkKCiAgICB9CiAgICB2YXIgbmV3SW5mbyA9ICQoJyNteVNjaGVkdWxlcicpLnNjaGVkdWxlcigndmFsdWUnKTsKICAgICQoJyNzY2hlZHVsZURhdGVKU09OJykudmFsKEpTT04uc3RyaW5naWZ5KG5ld0luZm8pKTsKICAgICQoJyNjb25maWdTZWxlY3RlZFRpbWVab25lJykudmFsKG5ld0luZm8udGltZVpvbmUubmFtZSk7Cn0pOwppZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVuYWJsZSIpKSB7CiAgICB2YXIgZW5hYmxlID0gJCgiI2VuYWJsZSIpLnZhbCgpOwogICAgaWYgKGVuYWJsZSkgewogICAgICAgICQoJyNzY2hlZHVsZSAqJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTsKICAgIH0KfQoKLy8gc2NoZWR1bGVEYXRlSlNPTkRlZmF1bHQgPSBKU09OLnN0cmluZ2lmeSgkKCcjbXlTY2hlZHVsZXInKS5zY2hlZHVsZXIoJ3ZhbHVlJykpOwoKZnVuY3Rpb24gY2FsY3VsYXRlTnh0SW50ZXJ2YWwoZGF0ZSwgaW50ZXJ2YWwpIHsKICAgIHZhciBob3VyID0gZGF0ZS5nZXRIb3VycygpICsgMDsKICAgIHZhciBtaW51dGUgPSBkYXRlLmdldE1pbnV0ZXMoKSArIGludGVydmFsOwogICAgaWYgKG1pbnV0ZSA+PSA2MCkgewogICAgICAgIGhvdXIgPSBob3VyICsgTWF0aC5mbG9vcihtaW51dGUgLyA2MCk7CiAgICAgICAgbWludXRlID0gbWludXRlICUgNjAKICAgIH0KICAgIHZhciBhbVBtID0gaG91ciA+PSAxMiA/ICJQTSIgOiAiQU0iOwogICAgaG91ciA9IGhvdXIgJSAxMjsKICAgIGhvdXIgPSBob3VyID8gaG91ciA6IDEyOwogICAgbWludXRlID0gKG1pbnV0ZSA+IDkgPyBtaW51dGUgOiAiMCIgKyBtaW51dGUpOwogICAgaG91ciA9IGhvdXIgPiA5ID8gaG91ciA6ICIwIiArIGhvdXI7CiAgICB2YXIgbm93ID0gaG91ciArICc6JyArIG1pbnV0ZSArICcgJyArIGFtUG07CiAgICByZXR1cm4gbm93Owp9CgpmdW5jdGlvbiBjYWxjdWxhdGVBbGxJbnRlcnZhbHMoaG91ciwgbWludXRlKSB7CiAgICB2YXIgYW1QbSA9IGhvdXIgPj0gMTIgPyAiUE0iIDogIkFNIjsKICAgIGhvdXIgPSBob3VyICUgMTI7CiAgICBob3VyID0gaG91ciA/IGhvdXIgOiAxMjsKICAgIG1pbnV0ZSA9IChtaW51dGUgPiA5ID8gbWludXRlIDogIjAiICsgbWludXRlKTsKICAgIGhvdXIgPSBob3VyID4gOSA/IGhvdXIgOiAiMCIgKyBob3VyOwogICAgdmFyIG5vdyA9IGhvdXIgKyAnOicgKyBtaW51dGUgKyAnICcgKyBhbVBtOwogICAgcmV0dXJuIG5vdzsKfQoKZnVuY3Rpb24gY2FsY3VsYXRlTnVtYmVyT2ZJbnRlcnZhbHMoaG91ciwgbWluLCBhbXBtKSB7CiAgICB2YXIgY291bnQgPSAoMTIgLSBob3VyKSAqIDI7CiAgICBpZiAoYW1wbSA9PSAiQU0iKSB7CiAgICAgICAgY291bnQgPSBjb3VudCArIDQ4CiAgICB9CiAgICB2YXIgbGlzdENvdW50ID0gbWluIDwgMzAgPyBjb3VudCA6IGNvdW50IC0gMTsKICAgIHJldHVybiBsaXN0Q291bnQKfQoKZnVuY3Rpb24gc2V0VG9kYXkoKSB7CgogICAgdmFyIHNjaGVkdWxlclRpbWUgPSAkKCIjc2NoZWR1bGVyVGltZSIpLnZhbCgpOwogICAgaWYgKHR5cGVvZiBzY2hlZHVsZXJUaW1lICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgc2NoZWR1bGVyVGltZSA9IHBhcnNlSW50KHNjaGVkdWxlclRpbWUpOwogICAgfQogICAgdmFyIHNjaGVkdWxlZERhdGUgPSBuZXcgRGF0ZSgpOyAvLyBnZXQgdGhlIGRhdGUgdGltZSBmcm9tIHNlcnZlcgogICAgdmFyIG5vdyA9IGNhbGN1bGF0ZU54dEludGVydmFsKHNjaGVkdWxlZERhdGUsIDApOwogICAgdmFyIGhvdXIgPSBub3cuc3BsaXQoIjoiKVswXTsKICAgIHZhciBub3dNaW4gPSBub3cuc3BsaXQoIjoiKVsxXS5zcGxpdCgiICIpWzBdOwogICAgdmFyIG54dEludGVydmFsID0gbm93TWluIDwgMzAgPyAzMCAtIG5vd01pbiA6IDYwIC0gbm93TWluOwogICAgJCgiI3RpbWUiKS50ZXh0KG5vdyk7CiAgICB2YXIgY291bnQgPSBjYWxjdWxhdGVOdW1iZXJPZkludGVydmFscyhob3VyLCBub3dNaW4sIG5vdy5zcGxpdCgiOiIpWzFdLnNwbGl0KCIgIilbMV0pOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudCAtIDE7IGkrKykgewogICAgICAgICQoIiNteVNjaGVkdWxlciAjdGltZVNlbGVjdCB1bCIpLmFwcGVuZCgnPGxpPjxhIGhyZWY9IiMiPicgKwogICAgICAgICAgICBjYWxjdWxhdGVOeHRJbnRlcnZhbChzY2hlZHVsZWREYXRlLCBueHRJbnRlcnZhbCkgKyAnPC9hPjwvbGk+Jyk7CiAgICAgICAgbnh0SW50ZXJ2YWwgKz0gMzAKICAgIH0KCiAgICB2YXIgcHJlZlRpbWV6b25lID0gJCgiI3RpbWV6b25lRnJvbVNlcnZlciIpLnZhbCgpOwoKICAgIHZhciB0aW1lWm9uZURhdGEgPSBudWxsOwogICAgaWYgKHR5cGVvZiBwcmVmVGltZXpvbmUgIT0gInVuZGVmaW5lZCIgJiYgcHJlZlRpbWV6b25lICE9IG51bGwpIHsKICAgICAgICB0aW1lWm9uZURhdGEgPSBwcmVmVGltZXpvbmUuc3BsaXQoIiwiKTsKICAgIH0KCiAgICBpZiAodGltZVpvbmVEYXRhKSB7CiAgICAgICAgdmFyIG5hbWUgPSB0aW1lWm9uZURhdGFbMF0uc3BsaXQoIjoiKVsxXS50cmltKCk7CiAgICAgICAgdmFyIG9mZnNldCA9IHRpbWVab25lRGF0YVsxXS5zdWJzdHJpbmcoOCkudHJpbSgpOwogICAgICAgICQoJyNteVNjaGVkdWxlcicpLnNjaGVkdWxlcigndmFsdWUnLCB7CiAgICAgICAgICAgIHN0YXJ0RGF0ZVRpbWU6IG1vbWVudChzY2hlZHVsZWREYXRlKS5mb3JtYXQoIllZWVktTU0tRERUSEg6bW06c3Muc1RaRCIpLAogICAgICAgICAgICB0aW1lWm9uZTogewogICAgICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgICAgIG9mZnNldDogb2Zmc2V0CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfQoKCn0KCmZ1bmN0aW9uIHNob3dUYWdXaWRnZXQoaWQpIHsKICAgIHZhciAkdGFnID0gJChpZCk7CiAgICAkdGFnLnNlbGVjdDIoewogICAgICAgIHRhZ3M6IHRydWUsCiAgICAgICAgcGxhY2Vob2xkZXI6ICJTZWxlY3QgQXR0ZW5kZWVzIiwKICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgY3JlYXRlVGFnOiBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgICAgICAgIHZhciB0ZXJtID0gJC50cmltKHBhcmFtcy50ZXJtKTsKICAgICAgICAgICAgaWYgKHRlcm0gIT0gIiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHRlcm0sCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGVybSwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICB9KQoKfQoKZnVuY3Rpb24gZG93bmxvYWRJQ1NGaWxlKGljc0ZpbGUsIGRhdGEpIHsKICAgIGlmIChpY3NGaWxlKSB7CiAgICAgICAgd2luZG93Lm9wZW4oImRhdGE6dGV4dC9jYWxlbmRhcjtjaGFyc2V0PXV0ZjgsIiArIGVzY2FwZShkYXRhKSk7CiAgICB9Cn0KCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2NvbW1vbi5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9oYW5kbGViYXJfZXh0LmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2FsZXJ0X3V0aWxzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2xpc3RfdXRpbHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9hY3Rpb25zL2FjdGlvbnMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9tZWV0aW5nL21lZXRpbmcuanMKCnZhciBhcHBsaWNhdGlvbk5hbWUgPSBBUFBMSUNBVElPTl9OQU1FLlNJR05BTF9NQU5BR0VNRU5UOwp2YXIgYXBwbGljYXRpb25MYWJlbCA9IEFQUExJQ0FUSU9OX0xBQkVMLlNJR05BTF9NQU5BR0VNRU5UOwp2YXIgYXBwVHlwZSA9IEFMRVJUX0NPTkZJR19UWVBFLlNJR05BTF9NQU5BR0VNRU5UOwp2YXIgc3RhdHVzSGlzdG9yeUxpc3QgPSBbXTsKCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgIHZhciBhY3Rpb25fdGFibGU7CiAgICB2YXIgbWVldGluZ190YWJsZTsKCiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBhY3Rpb25fdGFibGUgPSBzaWduYWwuYWN0aW9uc191dGlscy5pbml0X2FjdGlvbl90YWJsZSgkKCcjYWN0aW9uLXRhYmxlJyksIGFwcFR5cGUpOwogICAgICAgIG1lZXRpbmdfdGFibGUgPSBzaWduYWwubWVldGluZ191dGlscy5pbml0X21lZXRpbmdfdGFibGUoJCgnI21lZXRpbmctdGFibGUnKSk7CiAgICAgICAgc2V0Q3JlYXRlZERhdGUoKTsKICAgIH07CgogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNzaWduYWwtaGlzdG9yeS10YWJsZSAuYnRuLWFkZC1yb3cnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgaWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSB7CiAgICAgICAgICAgIHZhciBhZGRlZFN0YXR1cyA9IFtdOwogICAgICAgICAgICAkKCcuc3RhdHVzJykuZWFjaChmdW5jdGlvbiAoKXsKICAgICAgICAgICAgICAgIGlmKCEkKHRoaXMpLnByb3AoJ2Rpc2FibGVkJykgJiYgJCh0aGlzKS5pcygiOnZpc2libGUiKSl7CiAgICAgICAgICAgICAgICAgICAgYWRkZWRTdGF0dXMucHVzaCgkKHRoaXMpLnZhbCgpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyICRzaWduYWxIaXN0b3J5Um93ID0gJCh0aGlzKS5jbG9zZXN0KCcuc2lnbmFsSGlzdG9yeVJvdycpOwogICAgICAgICAgICAkc2lnbmFsSGlzdG9yeVJvdy5maW5kKCcuYnRuLWFkZC1yb3cnKS5yZW1vdmUoKTsKICAgICAgICAgICAgdmFyICR0ciA9ICQoJy50cl9jbG9uZScpOwogICAgICAgICAgICB2YXIgJGNsb25lID0gJHRyLmNsb25lKCk7CiAgICAgICAgICAgICRjbG9uZS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7CiAgICAgICAgICAgIGlmICgkc2lnbmFsSGlzdG9yeVJvdy5oYXNDbGFzcygnb2RkJykpIHsKICAgICAgICAgICAgICAgICRjbG9uZS5hZGRDbGFzcygnZXZlbicpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkY2xvbmUuYWRkQ2xhc3MoJ29kZCcpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGNsb25lLmZpbmQoInNlbGVjdFtuYW1lKj0nc2lnbmFsU3RhdHVzJ10gPiBvcHRpb24iKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYoJC5pbkFycmF5KCQodGhpcykudGV4dCgpLCBhZGRlZFN0YXR1cyApICE9IC0xKXsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGNsb25lLmZpbmQoJy5oaXN0b3J5RGF0ZVBpY2tlcicpLmRhdGVwaWNrZXIoewogICAgICAgICAgICAgICAgZGF0ZTogbnVsbCwKICAgICAgICAgICAgICAgIGFsbG93UGFzdERhdGVzOiB0cnVlLAogICAgICAgICAgICAgICAgbW9tZW50Q29uZmlnOiB7CiAgICAgICAgICAgICAgICAgICAgY3VsdHVyZTogdXNlckxvY2FsZSwKICAgICAgICAgICAgICAgICAgICB0ejogdXNlclRpbWVab25lLAogICAgICAgICAgICAgICAgICAgIGZvcm1hdDogREVGQVVMVF9EQVRFX0RJU1BMQVlfRk9STUFUCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzdHJpY3RlZDogW3tmcm9tOiBUT01PUlJPVyAsIHRvOiBJbmZpbml0eX1dCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkdHIuYWZ0ZXIoJGNsb25lKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnI3NpZ25hbC1oaXN0b3J5LXRhYmxlIC5zYXZlLWhpc3RvcnknLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgLy9lbmFibGluZyBkaXNhYmxlZCB2YWx1ZXMgYmVmb3JlIGFqYXggY2FsbCBpbiBvcmRlciB0byBnZXQgdGhlIHZhbHVlcyBvZiB0aGF0IGZpZWxkCiAgICAgICAgJCgnc2VsZWN0W25hbWU9c2lnbmFsU3RhdHVzXScpLmZpbmQoJ29wdGlvbicpLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICQodGhpcykuYXR0cigiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICB2YXIgJHRyID0gJCh0aGlzKS5jbG9zZXN0KCcuc2lnbmFsSGlzdG9yeVJvdycpOwogICAgICAgIHZhciBzaWduYWxTdGF0dXMgPSAkdHIuZmluZCgnLnN0YXR1cycpLnZhbCgpOwogICAgICAgIHZhciBjcmVhdGVkRGF0ZSA9ICR0ci5maW5kKCcuZGF0ZS1jcmVhdGVkJykudmFsKCk7CiAgICAgICAgdmFyIHN0YXR1c0NvbW1lbnQgPSAkdHIuZmluZCgnLmNvbW1lbnQnKS52YWwoKTsKICAgICAgICB2YXIgc2lnbmFsSGlzdG9yeUlkID0gJHRyLmZpbmQoJy5zaWduYWxIaXN0b3J5SWQnKS52YWwoKTsKICAgICAgICBpZiAoIXNpZ25hbFN0YXR1cyB8fCAhY3JlYXRlZERhdGUgfHwgIXN0YXR1c0NvbW1lbnQpIHsKICAgICAgICAgICAgJC5Ob3RpZmljYXRpb24ubm90aWZ5KCd3YXJuaW5nJywgJ3RvcCByaWdodCcsICJXYXJuaW5nIiwgJC5pMThuLl8oJ3NpZ25hbEhpc3Rvcnkuc2F2ZVdhcm5pbmcnKSwge2F1dG9IaWRlRGVsYXk6IDQwMDAwfSk7CiAgICAgICAgfSBlbHNlIGlmKCFzdGF0dXNIaXN0b3J5TGlzdC5pbmNsdWRlcyhzaWduYWxTdGF0dXMgKyBjcmVhdGVkRGF0ZSArIHN0YXR1c0NvbW1lbnQpKXsKICAgICAgICAgICAgc3RhdHVzSGlzdG9yeUxpc3QucHVzaChzaWduYWxTdGF0dXMgKyBjcmVhdGVkRGF0ZSArIHN0YXR1c0NvbW1lbnQpOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiBzYXZlU2lnbmFsU3RhdHVzSGlzdG9yeSwKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZERhdGUnOiBjcmVhdGVkRGF0ZSwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzQ29tbWVudCc6IHN0YXR1c0NvbW1lbnQsCiAgICAgICAgICAgICAgICAgICAgJ3NpZ25hbFN0YXR1cyc6IHNpZ25hbFN0YXR1cywKICAgICAgICAgICAgICAgICAgICAnc2lnbmFsSGlzdG9yeUlkJzogc2lnbmFsSGlzdG9yeUlkLAogICAgICAgICAgICAgICAgICAgICdzaWduYWxJZCc6ICQoIiNzaWduYWxJZFBhcnRuZXIiKS52YWwoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3NpZ25hbEhpc3RvcnknKS5odG1sKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRDcmVhdGVkRGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ3N1Y2Nlc3MnLCAndG9wIHJpZ2h0JywgIlN1Y2Nlc3MiLCAkLmkxOG4uXygnc2lnbmFsSGlzdG9yeS5zdWNjZXNzJyksIHthdXRvSGlkZURlbGF5OiAyMDAwMH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnZXJyb3InLCAndG9wIHJpZ2h0JywgIkVycm9yIiwgcmVzcG9uc2UubWVzc2FnZSwge2F1dG9IaWRlRGVsYXk6IDIwMDAwfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRpc2FibGVPcHRpb25zKGRpc2FibGVkVmFsdWVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgJCh0aGlzKS5hdHRyKCJkaXNhYmxlZCIsZmFsc2UpOwogICAgICAgIGRpc2FibGVPcHRpb25zKGRpc2FibGVkVmFsdWVzKTsKICAgIH0pOwoKICAgIGluaXQoKTsKfSk7CgpmdW5jdGlvbiBzZXRDcmVhdGVkRGF0ZSgpIHsKICAgICQoJy5oaXN0b3J5RGF0ZVBpY2tlcicpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RlZERhdGUgPSAkKHRoaXMpLmZpbmQoJy5kYXRlLWNyZWF0ZWQnKS52YWwoKTsKICAgICAgICAkKHRoaXMpLmRhdGVwaWNrZXIoewogICAgICAgICAgICBkYXRlOiBzZWxlY3RlZERhdGUgPyBzZWxlY3RlZERhdGUgOiBudWxsLAogICAgICAgICAgICBhbGxvd1Bhc3REYXRlczogdHJ1ZSwKICAgICAgICAgICAgbW9tZW50Q29uZmlnOiB7CiAgICAgICAgICAgICAgICBjdWx0dXJlOiB1c2VyTG9jYWxlLAogICAgICAgICAgICAgICAgdHo6IHVzZXJUaW1lWm9uZSwKICAgICAgICAgICAgICAgIGZvcm1hdDogREVGQVVMVF9EQVRFX0RJU1BMQVlfRk9STUFUCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlc3RyaWN0ZWQ6IFt7ZnJvbTogVE9NT1JST1cgLCB0bzogSW5maW5pdHl9XQogICAgICAgIH0pCiAgICB9KTsKfQoK</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="9191000" offset="0" length="8192" />
        <PacketInfo time="9191015" offset="8192" length="10304" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>