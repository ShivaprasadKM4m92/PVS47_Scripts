$(document).ready(function(){var b=!1;$(window).keydown(function(c){13==c.keyCode&&b&&c.preventDefault()});$("#productModal, #eventModal, #studyModal, #createActionModal").on("shown.bs.modal",function(c){b=!0;console.log("True")});$("#productModal, #eventModal, #studyModal, #createActionModal").on("hidden.bs.modal",function(c){b=!1;console.log("False")})});
var EVENT_DICTIONARY="event",PRODUCT_DICTIONARY="product",STUDY_DICTIONARY="study",SMQBROAD="Broad",DATASOURCE_PVA="pva",eventDictionaryObjAssessment,productDictionaryObjAssessment,studyDictionaryObj,selectedDictionaryValue=[],DictionaryAssessment=function(b,c,e,f,h,l,m){var k,a,g,d={};this.currentSelectedLevel=0;var n,p,q={},t,u,v=function(a){a&&(a.disabled=!0,a=a.style,document.location.href.split(),a.backgroundImage="url('"+u+"')",a.backgroundPosition="right center",a.backgroundRepeat="no-repeat")},
w=function(a,b){return _.filter(a,function(a){if(a.id&&b.id){if(a.id===b.id)return!1}else if(a.name===b.name)return!1;return!0})},r=function(a){for(var b={},g=1;g<=a;g++)b[g]=[];return b};this.setDictionaryLevelText=function(a,b){if(0<a){var g;switch(k){case EVENT_DICTIONARY:g=$(".selectedEventDictionaryValueAssessment")[0];break;case PRODUCT_DICTIONARY:g=$(".selectedProductDictionaryValueAssessment")[0]}g=$(g).find(".level"+a)[0];var d=$("<span class='dictionaryItem'>"+(" "==b.id?b.name:b.name+" ("+
b.id+")")+"<span class='closebtn removeSingleDictionaryValue'>\u00d7</span></span>"),c=d.find(".closebtn");c.attr("data-type",k);c.attr("data-level",a);c.attr("data-element",JSON.stringify(b));$(g).append(d)}};this.source=function(b,g,d,c,f,e){if(b){$(".addEventValuesAssessment").prop("disabled",!0);$(".addProductValuesAssessment").prop("disabled",!0);$(".addAllProductValuesAssessment").prop("disabled",!0);$(".addAllEventsAssessment").prop("disabled",!0);$(".addAllEventValuesAssessment").prop("disabled",
!0);$(".addAllProductsAssessment").prop("disabled",!0);$(".clearProductValuesAssessment").prop("disabled",!0);$(".clearEventValuesAssessment").prop("disabled",!0);$(".modal-footer .loading").css("display","inline");var n=this;$.ajax({type:"GET",url:a+b+"&dataSource="+DATASOURCE_PVA+"&dictionaryLevel="+d+(e?"&currentLang="+e:""),dataType:"json",success:function(a){c&&(selectedDictionaryValue.id=a.id,selectedDictionaryValue.name=a.name,selectedDictionaryValue.level=d,n.currentSelectedLevel=d,k===EVENT_DICTIONARY&&
4==d&&(a.primarySOC?(selectedDictionaryValue.primarySOC=a.primarySOC,selectedDictionaryValue.primaryHLT=a.primaryHLT,selectedDictionaryValue.primaryHLGT=a.primaryHLGT):(selectedDictionaryValue.primarySOC=null,selectedDictionaryValue.primaryHLT=null,selectedDictionaryValue.primaryHLGT=null)));a.nextLevelItems.length?g({items:a.nextLevelItems,lang:a.lang},d):g({items:[],lang:a.lang},d);$(".addEventValuesAssessment").prop("disabled",!1);$(".addProductValuesAssessment").prop("disabled",!1);$(".addAllProductValuesAssessment").prop("disabled",
!1);$(".addAllEventsAssessment").prop("disabled",!1);$(".addAllEventValuesAssessment").prop("disabled",!1);$(".addAllProductsAssessment").prop("disabled",!1);$(".clearProductValuesAssessment").prop("disabled",!1);$(".clearEventValuesAssessment").prop("disabled",!1);$(".modal-footer .loading").css("display","none")}})}};this.sourceParents=function(a,b,d,c){a&&$.ajax({type:"GET",url:g+a+"&dictionaryLevel="+b+(c?"&currentLang="+c:""),dataType:"json",success:function(a){0<a.length&&d({items:a,lang:c},
b)}})};this.forSearch=function(a,b,g,d,c,f){this.currentSelectedLevel=b;v(f);var e=$("#assesment_event_exactSearch").is(":checked");k===PRODUCT_DICTIONARY&&(e=$("#assesment_product_exactSearch").is(":checked"));a=null!=delimiter&&"string"==typeof delimiter?{contains:a,dictionaryLevel:b,delimiter:delimiter,ref_level:g,exact_search:e,imp:!1}:{contains:a,dictionaryLevel:b,ref_level:g,exact_search:e,imp:!1};if(d){var h={};$.each(d,function(a,b){h[b.key]=b.val});a.filters=JSON.stringify(h)}$.ajax({type:"GET",
url:n,data:a,dataType:"json",success:function(a){a&&addAllProductValues();c({items:a},b);f&&(f.disabled=!1,f.style.backgroundImage="none")}})};this.addAllOptions=function(a){var b=this;a.each(function(){var a=$(this).text(),g=$(this).attr("dictionarylevel"),c=$(this).attr("data-value"),a={name:a,id:c,level:g};a:{g=a.level;for(c=0;c<d[g].length;c++)if(d[g][c].id==a.id){g=!0;break a}g=!1}g||(d[a.level].push({name:a.name,id:a.id}),b.setDictionaryLevelText(a.level,a))})};this.clearSearchInputs=function(a){_.each($(p),
function(b,g){g==a||$(b).hasClass("additionalCriteria")||(b.value="")})};var x=function(){_.each($("#productModalAssessment").find(".additionalCriteria"),function(a,b){$(a).select2("val","")})};this.clearAdditionalFilters=function(){var a=$("#assesment_event_exactSearch");k==PRODUCT_DICTIONARY?(a=$("#assesment_product_exactSearch"),x()):k==EVENT_DICTIONARY&&$("#eventSmqSelectAssessment").select2("val","");a.prop("checked",!1)};this.clearAllText=function(){var a=$(".eventDictionaryValueAssessment");
k==PRODUCT_DICTIONARY&&(a=$(".productDictionaryValueAssessment"));_.each(a,function(a){a.innerHTML=""})};this.resetDictionaryList=function(){d=r(t)};this.setColumnViewText=function(a){var b=this,g;for(g in a)a.hasOwnProperty(g)&&_.each(a[g],function(a){b.setDictionaryLevelText(g,a)})};this.refresh=function(){var a=this,b;for(b in d)d.hasOwnProperty(b)&&_.each(d[b],function(g){a.setDictionaryLevelText(b,g)})};this.removeValue=function(a,b){d[a]=w(d[a],b);this.refresh()};this.getValues=function(){return d};
this.setValues=function(a){d=a};this.getLevels=function(){return q};this.setLevels=function(a){q=a};this.resetValues=function(){d=r(e)};this.construct=function(b,c,f,e,h,m,l){n=m;k=b;b===EVENT_DICTIONARY&&(a=e+"?eventId=",g=h+"?eventIds=",p="input.searchEvents");b===PRODUCT_DICTIONARY&&(a=e+"?productId=",g=h+"?productIds=",p="input.searchProducts");$.each(c.split(","),function(a,b){q[a+1]=b});t=f;d=r(f);u=l};return this.construct(b,c,e,f,h,l,m)};
function intializeDictionaries(b){b.event&&(eventDictionaryObjAssessment=new DictionaryAssessment(EVENT_DICTIONARY,b.event.levelNames,b.event.dicColumnCount,b.event.selectUrl,b.event.preLevelParentsUrl,b.event.searchUrl,b.spinnerPath));b.product&&(productDictionaryObjAssessment=new DictionaryAssessment(PRODUCT_DICTIONARY,b.product.levelNames,b.product.dicColumnCount,b.product.selectUrl,b.product.preLevelParentsUrl,b.product.searchUrl,b.spinnerPath))}
function getDictionaryObjectAssessment(b){if(b){if(b.toLowerCase()===EVENT_DICTIONARY)return eventDictionaryObjAssessment;if(b.toLowerCase()===PRODUCT_DICTIONARY)return productDictionaryObjAssessment}}function source(b,c,e,f,h,l,m){getDictionaryObjectAssessment(f).source(b,c,e,h,l,m)}function sourceParents(b,c,e,f,h){getDictionaryObjectAssessment(f).sourceParents(b,c,e,h)}function forSearch(b,c,e,f,h,l,m){getDictionaryObjectAssessment(l).forSearch(b,c,e,f,h,m)}
function addAllProductValues(){$(document).on("click",".addAllProductValuesAssessment",function(){var b=getDictionaryObjectAssessment(PRODUCT_DICTIONARY),c=$(this).parents("#productModalAssessment").find('[class*="dicLi"][dictionarylevel="'+b.currentSelectedLevel+'"]');b.addAllOptions(c)})}function clearSearchInputsAssessment(b,c){getDictionaryObjectAssessment(c).clearSearchInputs(b)}function clearAdditionalFilters(b){getDictionaryObjectAssessment(b).clearAdditionalFilters()}
function clearAllTextAssessment(b){getDictionaryObjectAssessment(b).clearAllText()}function resetDictionaryListAssessment(b){getDictionaryObjectAssessment(b).resetDictionaryList()}function resetMultiSearchModal(){var b=$("#copyAndPasteDicModal");b.find(".copyPasteContent").val("");b.find(".c_n_p_other_delimiter").val("");b.find(":radio[value=none]").prop("checked",!0)}function generateIdList(b){return _.map(b.items,function(b){return b.id.toString()})}
function generateColList(b){return _.map(b,function(b){return b.getAttribute("data-value")})}function collectNextCol(b){var c={},e=[];_.each(b,function(b){b={id:b.getAttribute("data-value"),name:b.innerText,level:b.getAttribute("dictionaryLevel")};e.push(b)});c.items=e;return c}
function generateNewDataForCol(b,c){var e=generateIdList(b),f=generateColList(c.querySelectorAll("li")),e=_.intersection(e,f),f=collectNextCol(c.querySelectorAll("li"));e?f.selectedPath=e[0]:(f=b,f.selectedPath=c.querySelector(".highlighted").getAttribute("data-value"));f.highlightedValue=c.querySelector(".highlighted").getAttribute("data-value");return f}
function setProductEventDictionary(){if(0<$("input[name=optradio]").size()){var b=$("input[name=optradio]:checked")[0];$(b).hasClass("productRadio")?$("#studySelection").val(""):$("#productSelection").val("").trigger("change")}}function getReportFieldLevel(){return $("#selectField option:selected").attr("data-level")}function getReportFieldDicType(){return $("#selectField option:selected").attr("data-dictionary")}function showEventDicIcon(b){b?$("#searchEvents").show():$("#searchEvents").hide()}
function showProductDicIcon(b){b?$("#searchProducts").show():$("#searchProducts").hide()}function showStudyDicIcon(b){b?$("#searchStudies").show():$("#searchStudies").hide()}function checkSuspectProduct(){checkProductDependedntCheckboxes("#suspectProduct")}function checkIncludeAllStudyDrugsCases(){checkProductDependedntCheckboxes("#includeAllStudyDrugsCases")}function checkHeaderProductSelection(){checkProductDependedntCheckboxes("input[id$='headerProductSelection']")}
function checkProductDependedntCheckboxes(b){""!==$("#productSelectionAssessment").val()||$("#isTemplate").is(":checked")?$(b).removeAttr("disabled"):($(b).prop("checked",!1),$(b).attr("disabled",!0))}function getFieldLevelFromExpression(b){return $(b.querySelector("select.expressionField")).find("option:selected").attr("data-level")}
function showDictionaryValues(b,c,e,f){var h="";b.innerHTML="";for(var l in c)c.hasOwnProperty(l)&&_.each(c[l],function(b){h+=b.name+" ("+e[l]+"), "});c=document.createElement("div");f&&(c.style.padding="5px");c.innerHTML=h.substring(0,h.length-2);b.appendChild(c);checkSuspectProduct();checkIncludeAllStudyDrugsCases();checkHeaderProductSelection()}
$(document).ready(function(){function b(a){var b=$("#eventSmqSelectAssessment").select2("data");if(b&&0<b.length)if(void 0!=a&&_.find(b,function(b){return a!=(f.type===SMQBROAD?7:8)}))$(".errorMessage").show();else{var d=getDictionaryObjectAssessment(EVENT_DICTIONARY),c=d.getValues();null==c[7]&&(c[7]=[]);null==c[8]&&(c[8]=[]);for(var e=0;e<b.length;e++){var f=b[e],h=f.type==SMQBROAD?7:8;if(!_.find(c[h],function(a){return a.id==f.code})){var k={name:f.name,id:f.code};c[h].push(k);d.setDictionaryLevelText(h,
k)}}d.setValues(c)}}function c(a){var b="",c=!0,e;for(e in a)a.hasOwnProperty(e)&&0<a[e].length&&(c=!1);c||(b=JSON.stringify(a));return b}function e(a){a=$(a).closest("[class*='toAddContainer']").first();if(0<a.size())return getFieldLevelFromExpression(a[0])}function f(a){resetDictionaryListAssessment(a);clearAllTextAssessment(a);clearSearchInputsAssessment(-1,a);clearAdditionalFilters(a);a==EVENT_DICTIONARY?$("ul.eventDictionaryColWidth").find("li").each(function(){$(this).remove()}):$("ul.productDictionaryColWidthCalc").find("li").each(function(){$(this).remove()});
$(".errorMessage").hide();resetMultiSearchModal()}function h(a){var b="";$.each(a,function(){b+=this.name+";"});return b.substring(0,b.length-1)}function l(a){var b=[];a&&$.each(a.split(";"),function(){b.push({name:this,id:" "})});return b}var m,k="true"===$("#editable").val();"true"!==$("#fromTemplate").val()&&(checkSuspectProduct(),checkIncludeAllStudyDrugsCases(),checkHeaderProductSelection());$("#productSearchIconLoading").remove();$("#productSearchIcon").show();$("input:radio[name=optradio]").prop("disabled",
!1);dictionaryBindMultipleSelect2WithUrl($(".eventSmqAssessment"),getSmqDropdownListUrl,!0);$(document).on("click",".addEventValuesAssessment",function(){var a=e(m),c=$(this).parents("#eventModalAssessment").find(".dicLi.selectedBackground");$(".errorMessage").hide();if(void 0!=a)for(var d=0;d<c.length;d++)if($(c[d]).attr("dictionarylevel")!=a){$(".errorMessage").show();return}b(a);getDictionaryObjectAssessment(EVENT_DICTIONARY).addAllOptions(c)});$(document).on("click",".clearEventValuesAssessment",
function(){f(EVENT_DICTIONARY)});$(document).on("click",".clearProductValuesAssessment",function(){f(PRODUCT_DICTIONARY)});$(document).on("click",".addProductValuesAssessment",function(){var a=$(this).parents("#productModalAssessment").find(".dicLi.selectedBackground");getDictionaryObjectAssessment(PRODUCT_DICTIONARY).addAllOptions(a)});$(document).on("click",".addAllProductValuesAssessment",function(){var a=getDictionaryObjectAssessment(PRODUCT_DICTIONARY),b=$(this).parents("#productModalAssessment").find('[class*="dicLi"][dictionarylevel="'+
a.currentSelectedLevel+'"]');a.addAllOptions(b)});$(document).on("click",".addAllEventsAssessment",function(){var a=m,b=getDictionaryObjectAssessment(EVENT_DICTIONARY),a=$(a).closest("[class*='toAddContainer']").first(),d=b.getValues();0<a.size()?(b=getFieldLevelFromExpression(a[0]),$(getValueTextFromExpression(a[0])).val(h(d[b]))):($("#eventSelectionAssessment").val(c(d)),showDictionaryValues(document.getElementById("showEventSelectionAssessment"),d,b.getLevels(),k))});$(document).on("click",".addAllEventValuesAssessment",
function(){var a=e(m),c=getDictionaryObjectAssessment(EVENT_DICTIONARY),d=$(this).parents("#eventModalAssessment").find('[class*="dicLi"][dictionarylevel="'+c.currentSelectedLevel+'"]');$(".errorMessage").hide();if(void 0!=a)for(var f=0;f<d.length;f++)if($(d[f]).attr("dictionarylevel")!=a){$(".errorMessage").show();return}b(a);c.addAllOptions(d)});$("#eventModalAssessment").on("hidden.bs.modal",function(a){resetDictionaryListAssessment(EVENT_DICTIONARY);clearAllTextAssessment(EVENT_DICTIONARY)});
$("#productModalAssessment").on("hidden.bs.modal",function(a){resetDictionaryListAssessment(PRODUCT_DICTIONARY);clearAllTextAssessment(PRODUCT_DICTIONARY)});$(document).on("click",".addAllProductsAssessment",function(){var a=getDictionaryObjectAssessment(PRODUCT_DICTIONARY);$("#productSelectionAssessment").val(c(a.getValues())).trigger("change");checkSuspectProduct();checkIncludeAllStudyDrugsCases();checkHeaderProductSelection();showDictionaryValues(document.getElementById("showProductSelectionAssessment"),
a.getValues(),a.getLevels(),k)});$("#productSelectionAssessment").change(function(){checkSuspectProduct();checkIncludeAllStudyDrugsCases();checkHeaderProductSelection()});(function(){if($("#eventSelectionAssessment").val()){var a=getDictionaryObjectAssessment(EVENT_DICTIONARY);a.setValues(JSON.parse($("#eventSelectionAssessment").val()));k&&a.setColumnViewText(a.getValues());showDictionaryValues(document.getElementById("showEventSelectionAssessment"),a.getValues(),a.getLevels(),k)}$("#productSelectionAssessment").val()&&
(a=getDictionaryObjectAssessment(PRODUCT_DICTIONARY),a.setValues(JSON.parse($("#productSelectionAssessment").val())),k&&a.setColumnViewText(a.getValues()),showDictionaryValues(document.getElementById("showProductSelectionAssessment"),a.getValues(),a.getLevels(),k))})();$("#eventModalAssessment").on("show.bs.modal",function(a){m=$(a.relatedTarget);$("#mainContent").trigger("columnView.reset."+EVENT_DICTIONARY);var b=m;a=getDictionaryObjectAssessment(EVENT_DICTIONARY);var c=$(b).closest("[class*='toAddContainer']").first();
a.resetValues();b=a.getValues();if(0<c.size()){var e=getFieldLevelFromExpression(c[0]),c=$(getValueTextFromExpression(c[0])).val();b[e]=l(c)}else $("#eventSelectionAssessment").val()&&(b=JSON.parse($("#eventSelectionAssessment").val()));a.setValues(b);a=getDictionaryObjectAssessment(EVENT_DICTIONARY);a.setColumnViewText(a.getValues())});$("#productModalAssessment").on("show.bs.modal",function(a){a=getDictionaryObjectAssessment(PRODUCT_DICTIONARY);a.resetValues();var b=a.getValues();$("#productSelectionAssessment").val()&&
(b=JSON.parse($("#productSelectionAssessment").val()));a.setValues(b);a.setColumnViewText(a.getValues())});$(document).on("click",".removeSingleDictionaryValue",function(a){var b=$(this),c=b.attr("data-type");a=b.attr("data-level");b=JSON.parse(b.attr("data-element"));c=getDictionaryObjectAssessment(c);c.clearAllText();c.removeValue(a,b)});$("ul").on("keypress","li",function(a){92===a.keyCode&&$(this).click()});$("#assessments").find(".iconSearch").click(function(){5<$("#productModalAssessment .modal-body .dicUlFormat").length&&
$("#productModalAssessment .modal-lg").addClass("modal-xl").removeClass("modal-lg")});$("#productModalAssessment").on("shown.bs.modal",function(a){5<$("#productModalAssessment .modal-body .dicUlFormat").length&&$("#productModalAssessment .modal-lg").addClass("modal-xl").removeClass("modal-lg")})});