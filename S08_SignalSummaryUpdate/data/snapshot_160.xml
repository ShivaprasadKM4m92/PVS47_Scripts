<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="160">
  <HTTPTask id="817" hostname="10.100.22.24:8181" path="/signal/assets/app/pvs/validated_signal/review-f2586ded5503b40004f22afda42c4971.js" url="http://10.100.22.24:8181/signal/assets/app/pvs/validated_signal/review-f2586ded5503b40004f22afda42c4971.js" ip="10.100.22.24" port="8181" connectionId="31" origin="Primary" frame="1" startDateTime="2020-05-25T16:45:47.639+05:30" startTime="9189671" endTime="9190328">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0OjgxODE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgxLjAuNDA0NC4xMzggU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC92YWxpZGF0ZWRTaWduYWwvZGV0YWlscz9pZD04NDc5</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj04NjVkZTBjYy1iMmY3LTRlMGMtYjYzNC1kZDQ3ODE3ZmY5YTE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9zaWduYWwvYXNzZXRzL2FwcC9wdnMvdmFsaWRhdGVkX3NpZ25hbC9yZXZpZXctZjI1ODZkZWQ1NTAzYjQwMDA0ZjIyYWZkYTQyYzQ5NzEuanMgSFRUUC8xLjENCkhvc3Q6IDEwLjEwMC4yMi4yNDo4MTgxDQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODEuMC40MDQ0LjEzOCBTYWZhcmkvNTM3LjM2DQpBY2NlcHQ6ICovKg0KUmVmZXJlcjogaHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC92YWxpZGF0ZWRTaWduYWwvZGV0YWlscz9pZD04NDc5DQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUNCkFjY2VwdC1MYW5ndWFnZTogZW4tVVMsZW47cT0wLjkNCkNvb2tpZTogU0VTU0lPTj04NjVkZTBjYy1iMmY3LTRlMGMtYjYzNC1kZDQ3ODE3ZmY5YTENCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ODY1ZGUwY2MtYjJmNy00ZTBjLWI2MzQtZGQ0NzgxN2ZmOWEx</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>28286</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Last-Modified" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyMSBNYXkgMjAyMCAwODoxNzo1NCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ImFwcC9wdnMvdmFsaWRhdGVkX3NpZ25hbC9yZXZpZXctZjI1ODZkZWQ1NTAzYjQwMDA0ZjIyYWZkYTQyYzQ5NzEuanMi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MjgyODY=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAyNSBNYXkgMjAyMCAxMToxMDoxMSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KTGFzdC1Nb2RpZmllZDogVGh1LCAyMSBNYXkgMjAyMCAwODoxNzo1NCBHTVQNCkVUYWc6ICJhcHAvcHZzL3ZhbGlkYXRlZF9zaWduYWwvcmV2aWV3LWYyNTg2ZGVkNTUwM2I0MDAwNGYyMmFmZGE0MmM0OTcxLmpzIg0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpDYWNoZS1Db250cm9sOiBwdWJsaWMsIG1heC1hZ2U9MzE1MzYwMDANCkNvbnRlbnQtRW5jb2Rpbmc6IGd6aXANCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04DQpDb250ZW50LUxlbmd0aDogMjgyODYNCkRhdGU6IE1vbiwgMjUgTWF5IDIwMjAgMTE6MTA6MTEgR01UDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCi8vIGEgY29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHBhcnNpbmcgc3RyaW5nIG5hbWVzcGFjZXMgYW5kCi8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGluZyBuZXN0ZWQgbmFtZXNwYWNlcwpmdW5jdGlvbiBleHRlbmQoIG5zLCBuc19zdHJpbmcgKSB7CiAgICB2YXIgcGFydHMgPSBuc19zdHJpbmcuc3BsaXQoJy4nKSwKICAgICAgICBwYXJlbnQgPSBucywKICAgICAgICBwbCwgaTsKICAgIGlmIChwYXJ0c1swXSA9PSAic2lnbmFsIikgewogICAgICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7CiAgICB9CiAgICBwbCA9IHBhcnRzLmxlbmd0aDsKICAgIGZvciAoaSA9IDA7IGkgPCBwbDsgaSsrKSB7CiAgICAgICAgLy9jcmVhdGUgYSBwcm9wZXJ0eSBpZiBpdCBkb2VzbnQgZXhpc3QKICAgICAgICBpZiAodHlwZW9mIHBhcmVudFtwYXJ0c1tpXV0gPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcGFyZW50W3BhcnRzW2ldXSA9IHt9OwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbcGFydHNbaV1dOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKfQoKLy9Qcm90b3R5cGUgbWV0aG9kcwpEYXRlLnByb3RvdHlwZS5hZGREYXlzID0gZnVuY3Rpb24oZGF5cykgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTsKICAgIHJldHVybiBkYXRlOwp9OwoKQXJyYXkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGYpe2YgIT0gdmFsdWV9KTsKfTsKClNDQV9XT1JLRkxPV19TVEFUVVNfRU5VTSA9IHsgTkVXOiAnTmV3JywKICAgIEFTU09DSUFURV9SRVZJRVdFRDogJ0Fzc29jaWF0ZVJldmlld2VkJywKICAgIFBIWVNJQ0lBTl9SRVZJRVdFRDogJ1BoeXNpY2lhblJldmlld2VkJywKICAgIFJFUVVJUkVEX0VWQUxVQVRJT046ICdSZXF1aXJlZEV2YWx1YXRpb24nLAogICAgQ09OVElOVUVEX01PTklUT1JJTkc6ICdDb250aW51ZWRNb25pdG9yaW5nJwp9OwoKU0NBX0RJU1BPU0lUSU9OX0VOVU0gPSB7CiAgICBWQUxJREFURURfU0lHTkFMIDogJ1ZhbGlkYXRlZFNpZ25hbCcsCiAgICBWQUxJREFURURfTk9OX0NPTkZJUk1FRF9TSUdOQUwgOiAnVmFsaWRhdGVkTm9uQ29uZmlybWVkU2lnbmFsJywKICAgIFZBTElEQVRFRF9VTkRFUl9JTlZFU1RJR0FUSU9OIDogJ1ZhbGlkYXRlZFVuZGVySW52ZXN0aWdhdGlvbicsCiAgICBDT01NVU5JQ0FURURfU0lHTkFMIDogJ0NvbW11bmljYXRlZFNpZ25hbCcsCiAgICBOT05fVkFMSUQ6ICdOb25WYWxpZCcKfTsKClNDQV9QUklPUklUWV9FTlVNID0gewogICAgSElHSDogIkhpZ2giLAogICAgTUVESVVNOiAiTWVkaXVtIiwKICAgIExPVzogIkxPVyIKfTsKCkRBVEVfRk1UX1RaID0gIllZWVktTU0tREQiOwoKc2lnbmFsLnV0aWxzID0gKGZ1bmN0aW9uKCkgewoKICAgIHZhciBzdGFja2VkID0gZnVuY3Rpb24odG9wVmFsdWUsIGJvdHRvbVZhbHVlKSB7CiAgICAgICAgdmFyIHRvcENvbXAgPSAiIjsKICAgICAgICB2YXIgYm90dG9tQ29tcCA9ICIiOwoKICAgICAgICBpZihfLmlzRnVuY3Rpb24odG9wVmFsdWUpKSB7CiAgICAgICAgICAgIHRvcENvbXAgPSB0b3BWYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9wQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLXRvcCI+JyArIHRvcFZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oYm90dG9tVmFsdWUpKSB7CiAgICAgICAgICAgIGJvdHRvbUNvbXAgPSBib3R0b21WYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm90dG9tQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLWJvdHRvbSI+JyArIGJvdHRvbVZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3BDb21wICsgYm90dG9tQ29tcAogICAgfTsKCiAgICAvLyBBbmQgdGhpcyBpcyB0aGUgZGVmaW5pdGlvbiBvZiB0aGUgY3VzdG9tIGZ1bmN0aW9uIOKAiwogICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRtcGxfbmFtZSwgdG1wbF9kYXRhKSB7CgogICAgICAgIGlmICggIXJlbmRlci50bXBsX2NhY2hlICkgewoKCgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZSA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoIXJlbmRlci50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgdmFyIHRtcGxfZGlyID0gJy9zaWduYWwvYXNzZXRzL2FwcC9wdnMvaGJzLXRlbXBsYXRlcyc7CiAgICAgICAgICAgIHZhciB0bXBsX3VybCA9IHRtcGxfZGlyICsgJy8nICsgdG1wbF9uYW1lICsgJy5oYnMnOwoKICAgICAgICAgICAgdmFyIHRtcGxfc3RyaW5nID0gIiI7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHRtcGxfdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0bXBsX3N0cmluZyA9IGRhdGEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKHRtcGxfc3RyaW5nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdKHRtcGxfZGF0YSkKICAgIH07CgogICAgdmFyIGhic19wYXJ0aWFsID0gZnVuY3Rpb24odG1wbF9uYW1lKSB7CiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlKSB7CiAgICAgICAgICAgIGhic19wYXJ0aWFsLnRtcGxfY2FjaGUgPSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgIHZhciB0bXBsX2RpciA9ICcvc2lnbmFsL2Fzc2V0cy9hcHAvcHZzL2hicy10ZW1wbGF0ZXMnOwogICAgICAgICAgICB2YXIgdG1wbF91cmwgPSB0bXBsX2RpciArICcvJyArIHRtcGxfbmFtZSArICcuaGJzJzsKCiAgICAgICAgICAgIHZhciB0bXBsX3N0cmluZyA9ICIiOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB0bXBsX3VybCwKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdG1wbF9zdHJpbmcgPSBkYXRhCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaGJzX3BhcnRpYWwudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gdG1wbF9zdHJpbmcKICAgICAgICB9CgogICAgICAgIHJldHVybiBoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0KICAgIH07CgogICAgdmFyIGNvbXBvc2VVcmwgPSBmdW5jdGlvbihjb250cm9sbGVyLCBhY3Rpb24sIHBhcmFtcykgewogICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC8iICsgY29udHJvbGxlciArICIvIiArIGFjdGlvbiArIChfLmlzTnVsbChwYXJhbXMpID8gJycgOiAnPycgKyBjb21wb3NlUGFyYW1zKHBhcmFtcykpOwoKICAgICAgICByZXR1cm4gdXJsCiAgICB9OwoKICAgIC8vVE9ETyA6IE5lZWQgdG8gY2hhbmdlIHRoaXMgdG8gaGFuZGxlYmFyIGZvcm0sIFdpbGwgYmUgZG9uZSBsYXRlcgogICAgdmFyIHBvc3RVcmwgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBuZXdXaW5kb3cpIHsKCiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKICAgICAgICBmb3JtLm1ldGhvZCA9ICJwb3N0IjsKICAgICAgICBmb3JtLmFjdGlvbiA9IHBhdGg7CiAgICAgICAgZm9ybS5lbmN0eXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgaWYgKG5ld1dpbmRvdykgZm9ybS50YXJnZXQgPSAiX2JsYW5rIjsKCiAgICAgICAgdmFyIHRva2VuID0gJCgibWV0YVtuYW1lPSdfY3NyZiddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHZhciBwYXJhbWV0ZXIgPSAkKCJtZXRhW25hbWU9J19jc3JmX3BhcmFtZXRlciddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHBhcmFtc1twYXJhbWV0ZXJdID0gdG9rZW47CiAgICAgICAgZm9yIChsZXQga2V5IGluIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLnR5cGUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLm5hbWUgPSBrZXk7CiAgICAgICAgICAgICAgICBoaWRkZW5GaWVsZC52YWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChoaWRkZW5GaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmb3JtKTsKICAgICAgICBmb3JtLnN1Ym1pdCgpOwogICAgfQoKICAgIHZhciBjb21wb3NlUGFyYW1zID0gZnVuY3Rpb24obykgewogICAgICAgIHJldHVybiBfLm1hcChfLnBhaXJzKG8pLCBmdW5jdGlvbihwKXtyZXR1cm4gcC5qb2luKCc9Jyl9ICkuam9pbignJicpCiAgICB9OwoKICAgIHZhciBjYXBpdGFsSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgJiYgc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKTsKICAgIH07CgogICAgdmFyIGJyZWFrSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgPyBzLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCcgJykgOiBzCiAgICB9OwoKICAgIHZhciBlbmFibGVfbG9hZF9idXR0b24gPSBmdW5jdGlvbihlbGUsIGVuYWJsZWQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXRFbGUgPSBlbGUuZmluZCgnLmdseXBoaWNvbicpOwogICAgICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgICAgICAgJCh0YXJnZXRFbGUpLmFkZENsYXNzKCdyZWZyZXNoLWFuaW1hdGUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQodGFyZ2V0RWxlKS5yZW1vdmVDbGFzcygncmVmcmVzaC1hbmltYXRlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNldEluTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24ocHJvcCwgZGF0YSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHByb3AsIGRhdGEpOwogICAgfTsKCiAgICB2YXIgZ2V0RnJvbUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKHByb3ApIHsKICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvcCk7CiAgICB9OwoKICAgIHZhciBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbihwcm9wLCBkYXRhKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvcCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgfTsKCiAgICB2YXIgZ2V0SlNPTkZyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb3ApKTsKICAgIH07CgogICAgdmFyIGxvY2FsU3RvcmFnZVV0aWwgPSB7CiAgICAgICAgc2V0UHJvcCA6IHNldEluTG9jYWxTdG9yYWdlLAogICAgICAgIGdldFByb3AgOiBnZXRGcm9tTG9jYWxTdG9yYWdlLAogICAgICAgIHNldEpTT04gOiBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UsCiAgICAgICAgZ2V0SlNPTiA6IGdldEpTT05Gcm9tTG9jYWxTdG9yYWdlCiAgICB9OwoKICAgIHZhciBnZXRRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBrZXkgPSBmYWxzZSwgcmVzID0ge30sIGl0bSA9IG51bGw7CiAgICAgICAgLy8gZ2V0IHRoZSBxdWVyeSBzdHJpbmcgd2l0aG91dCB0aGUgPwogICAgICAgIHZhciBxcyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgLy8gY2hlY2sgZm9yIHRoZSBrZXkgYXMgYW4gYXJndW1lbnQKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIGtleSA9IGFyZ3VtZW50c1swXTsKICAgICAgICAvLyBtYWtlIGEgcmVnZXggcGF0dGVybiB0byBncmFiIGtleS92YWx1ZQogICAgICAgIHZhciBwYXR0ZXJuID0gLyhbXiY9XSspPShbXiZdKikvZzsKICAgICAgICAvLyBsb29wIHRoZSBpdGVtcyBpbiB0aGUgcXVlcnkgc3RyaW5nLCBlaXRoZXIKICAgICAgICAvLyBmaW5kIGEgbWF0Y2ggdG8gdGhlIGFyZ3VtZW50LCBvciBidWlsZCBhbiBvYmplY3QKICAgICAgICAvLyB3aXRoIGtleS92YWx1ZSBwYWlycwogICAgICAgIHdoaWxlIChpdG0gPSBwYXR0ZXJuLmV4ZWMocXMpKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09IGZhbHNlICYmIGRlY29kZVVSSUNvbXBvbmVudChpdG1bMV0pID09PSBrZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICByZXNbZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ga2V5ID09PSBmYWxzZSA/IHJlcyA6IG51bGw7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgcmVuZGVyIDogcmVuZGVyLAogICAgICAgIHN0YWNrZWQ6IHN0YWNrZWQsCiAgICAgICAgY29tcG9zZVVybDogY29tcG9zZVVybCwKICAgICAgICBwb3N0VXJsOiBwb3N0VXJsLAogICAgICAgIGNvbXBvc2VQYXJhbXM6IGNvbXBvc2VQYXJhbXMsCiAgICAgICAgY2FwaXRhbEl0OiBjYXBpdGFsSXQsCiAgICAgICAgYnJlYWtJdDogYnJlYWtJdCwKICAgICAgICBoYnNfcGFydGlhbDogaGJzX3BhcnRpYWwsCiAgICAgICAgZW5hYmxlX2xvYWRfYnV0dG9uOiBlbmFibGVfbG9hZF9idXR0b24sCiAgICAgICAgbG9jYWxTdG9yYWdlVXRpbDogbG9jYWxTdG9yYWdlVXRpbCwKICAgICAgICBnZXRRdWVyeVN0cmluZzogZ2V0UXVlcnlTdHJpbmcKICAgIH0KfSkoKTsKCgoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fQoKc2lnbmFsLmNhc2VEcmlsbERvd24gPSAoZnVuY3Rpb24oKSB7CgogICAgdmFyIGluaXRfY2FzZV9kcmlsbF9kb3duX3RhYmxlID0gZnVuY3Rpb24odXJsLCBjYXNlRGV0YWlsVXJsKSB7CgogICAgICAgIHZhciB0YWJsZSA9ICQoJyNjYXNlLWRyaWxsLWRvd24tdGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICBsYW5ndWFnZTogewogICAgICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiB1cmwsCiAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAiYkxlbmd0aENoYW5nZSI6IHRydWUsCiAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwLAogICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzUwLCAxMDAsIDIwMCwgMTAwMCwgLTFdLCBbNTAsIDEwMCwgMjAwLCAxMDAwLCAiQWxsIl1dLAogICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlTnVtIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJysgKGNhc2VEZXRhaWxVcmwgKyAnPycgKyBzaWduYWwudXRpbHMuY29tcG9zZVBhcmFtcyh7Y2FzZU51bWJlcjogcm93LmNhc2VOdW0sIHZlcnNpb246IHJvdy5jYXNlVmVyc2lvbn0pKSsnIj4nKyI8c3BhbiBkYXRhLWZpZWxkID0nY2FzZU51bScgZGF0YS1pZD0nIiArIHJvdy5jYXNlTnVtICsgIic+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocm93LmNhc2VOdW0pICsgIjwvc3Bhbj48c3BhbiBkYXRhLWZpZWxkID0nY2FzZVZlcnNpb24nIGRhdGEtaWQ9JyIgKyByb3cuY2FzZVZlcnNpb24gKyAiJz4iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L3NwYW4+PC9hPiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAncHJvZHVjdE5hbWUnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJnZW5lcmljTmFtZSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogJ3B0JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAic29jIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibGlzdGVkbmVzcyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIm91dGNvbWUiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJzZXJpb3VzbmVzcyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRldGVybWluZWRDYXVzYWxpdHkiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJyZXBvcnRlZENhdXNhbGl0eSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgIH1dCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YWJsZTsKICAgIH07CgoKICAgIHZhciBiaW5kX2RyaWxsX2Rvd25fdGFibGUgPSBmdW5jdGlvbihjYXNlRGV0YWlsVXJsKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jYXNlLWRyaWxsLWRvd24tbGluaycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgLy9QcmVkZW50IGRlZmF1bHQgd2lsbCBtYWtlIHN1cmUgdGhhdCBkZWZhdWx0IGV2ZW50IGRvZXMgbm90IGhhcHBlbi4KICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCkKCiAgICAgICAgICAgIHZhciBzcmNFbGUgPSAkKGV2dC50YXJnZXQpCiAgICAgICAgICAgICQoJyNjYXNlLWRyaWxsLWRvd24tbW9kYWwnKS5hdHRyKCdkYXRhLXVybCcsIHNyY0VsZS5hdHRyKCdkYXRhLXVybCcpKQogICAgICAgICAgICAkKCcjY2FzZS1kcmlsbC1kb3duLW1vZGFsJykubW9kYWwoe30pCiAgICAgICAgfSkKCiAgICAgICAgJCgnI2Nhc2UtZHJpbGwtZG93bi1tb2RhbCcpLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkKCcjZHJpbGwtZG93bi10YWJsZS1jb250YWluZXInKS5yZW1vdmUoJyNjYXNlLWRyaWxsLWRvd24tdGFibGUnKQogICAgICAgICAgICB2YXIgZHJpbGxfZG93bl90YWJsZSA9IHNpZ25hbC51dGlscy5yZW5kZXIoJ2Nhc2VfZHJpbGxfZG93bl90YWJsZScsIHt9KQogICAgICAgICAgICAkKCcjZHJpbGwtZG93bi10YWJsZS1jb250YWluZXInKS5odG1sKGRyaWxsX2Rvd25fdGFibGUpCiAgICAgICAgICAgIHZhciB1cmwgPSAkKCcjY2FzZS1kcmlsbC1kb3duLW1vZGFsJykuYXR0cignZGF0YS11cmwnKQogICAgICAgICAgICB2YXIgY2FzZV9kcmlsbF9kb3duX3RhYmxlID0gaW5pdF9jYXNlX2RyaWxsX2Rvd25fdGFibGUodXJsLCBjYXNlRGV0YWlsVXJsKQogICAgICAgIH0pCiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBpbml0X2Nhc2VfZHJpbGxfZG93bl90YWJsZTogaW5pdF9jYXNlX2RyaWxsX2Rvd25fdGFibGUsCiAgICAgICAgYmluZF9kcmlsbF9kb3duX3RhYmxlIDogIGJpbmRfZHJpbGxfZG93bl90YWJsZQogICAgfQp9KSgpCgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9CgpzaWduYWwuYWxlcnRDb21tZW50cyA9IChmdW5jdGlvbiAoKSB7CgogICAgdmFyIGxpc3RDb21tZW50cyA9IGZ1bmN0aW9uIChjYXNlSnNvbikgewoKICAgICAgICAvL01vZGFsIG9iamVjdAogICAgICAgIHZhciBjb21tZW50TW9kYWwgPSAkKCcjY29tbWVudE1vZGFsJyk7CgogICAgICAgIC8vUG9wdWxhdGUgdGhlIGV4aXN0aW5nIGNvbW1lbnRzIGFuZCBiaW5kIGV2ZW50cyB0byB0aGVtLgogICAgICAgIHBvcHVsYXRlQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CgogICAgICAgIC8vU2V0IHZhbHVlcyB0byB0aGUgbW9kYWwgZWxlbWVudHMuCiAgICAgICAgdmFyIGNvbW1lbnRNZXRhSW5mbyA9ICIiCiAgICAgICAgaWYgKGNhc2VKc29uLmFsZXJ0VHlwZSA9PSAiQWdncmVnYXRlIENhc2UgQWxlcnQiKSB7CiAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0icHJvZHVjdE5hbWUiPicgKyBjYXNlSnNvbi5wcm9kdWN0TmFtZSArICc8L3NwYW4+IC0gPHNwYW4gaWQ9ImV2ZW50TmFtZSI+JyArIGNhc2VKc29uLmV2ZW50TmFtZSArICc8L3NwYW4+JwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0iY2FzZU51bWJlciI+JyArIGNhc2VKc29uLmNhc2VOdW1iZXIgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJwcm9kdWN0RmFtaWx5Ij4nICsgY2FzZUpzb24ucHJvZHVjdEZhbWlseSArICc8L3NwYW4+JwogICAgICAgIH0KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnQtbWV0YS1pbmZvIikuaHRtbChjb21tZW50TWV0YUluZm8pOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjYXBwbGljYXRpb24iKS5odG1sKGNhc2VKc29uLmFsZXJ0VHlwZSk7CiAgICAgICAgY29tbWVudE1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgYmluZFNhdmVDb21tZW50KGNvbW1lbnRNb2RhbCk7CiAgICB9OwoKICAgIHZhciBwb3B1bGF0ZUNvbW1lbnRzID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24sIG9uU2lnbmFsU2NyZWVuKSB7CiAgICAgICAgdmFyIHVwZGF0ZWRDb21tZW50cyA9ICQoIiNjb21tZW50Ym94IikudmFsKCk7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydENvbW1lbnQvbGlzdENvbW1lbnRzIiwKICAgICAgICAgICAgZGF0YTogY2FzZUpzb24sCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI25vLWNvbW1lbnRzIikuYWRkQ2xhc3MoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgiVXBkYXRlIik7CiAgICAgICAgICAgICAgICAgICAgaWYodXBkYXRlZENvbW1lbnRzLmxlbmd0aCA+PSByZXN1bHQuY29tbWVudHMubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKHVwZGF0ZWRDb21tZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbChyZXN1bHQuY29tbWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbChyZXN1bHQuaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgiTGFzdCBNb2RpZmllZCBieSAiICsgcmVzdWx0Lm1vZGlmaWVkQnkgKyAiIG9uICIgKyByZXN1bHQuZGF0ZVVwZGF0ZWQpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YgaXNDb21tZW50QWRkZWQgIT0gJ3VuZGVmaW5lZCcgJiYgaXNDb21tZW50QWRkZWQgJiYgb25TaWduYWxTY3JlZW4pewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNuby1jb21tZW50cyIpLnJlbW92ZUNsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CgogICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGlzQ29tbWVudEFkZGVkICE9ICd1bmRlZmluZWQnICYmIGlzQ29tbWVudEFkZGVkKXsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCJBZGQiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjbm8tY29tbWVudHMiKS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5hZGRDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5vbigia2V5dXAiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKT09IiIgJiYgY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94JykudmFsKCk9PSIiKQogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIGxvYWQgcHJldmlvdXMgY29tbWVudHMuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRTYXZlQ29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwpIHsKCiAgICAgICAgLy9BZGQgY2xpY2sgZXZlbnQgdG8gdGhlIGFkZCBjb21tZW50IGJ1dHRvbi4KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmFkZC1jb21tZW50cyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqQXJyYXkgPSBbXTsKICAgICAgICAgICAgdmFyIGFwcFR5cGUgPSAkKCIjYXBwbGljYXRpb24iKS5odG1sKCk7CiAgICAgICAgICAgIHZhciB2YWxpZGF0ZWRTaWduYWxJZCA9ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgdmFyIHRvcGljSWQgPSAkKCIjdG9waWNJZCIpLmh0bWwoKTsKCiAgICAgICAgICAgIGlmIChhcHBUeXBlID09ICcnKSB7CiAgICAgICAgICAgICAgICBhcHBUeXBlID0gY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIHZhbGlkYXRlZFNpZ25hbElkID0gY29tbWVudE1vZGFsLmZpbmQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIHRvcGljSWQgPSBjb21tZW50TW9kYWwuZmluZCgiI3RvcGljSWQiKS5odG1sKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqOwogICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICB2YXIgZGF0YTsKICAgICAgICAgICAgLy9DYXNlIEpTT04uCiAgICAgICAgICAgIGNhc2VKc29uT2JqID0gewogICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFwcFR5cGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBjb21tZW50TW9kYWwuZmluZCgiI3Byb2R1Y3ROYW1lIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV2ZW50TmFtZSI6IGNvbW1lbnRNb2RhbC5maW5kKCIjZXZlbnROYW1lIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImNvbW1lbnRzIjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiB2YWxpZGF0ZWRTaWduYWxJZCwKICAgICAgICAgICAgICAgICJhc3NpZ25lZFRvIjogY29tbWVudE1vZGFsLmZpbmQoIiNhc3NpZ25lZFRvIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2V4ZWN1dGVkQ29uZmlnSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiY29uZmlnSWQiIDogY29tbWVudE1vZGFsLmZpbmQoIiNjb25maWdJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJ0b3BpY0lkIjogY29tbWVudE1vZGFsLmZpbmQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgInByb2R1Y3RGYW1pbHkiOiBjb21tZW50TW9kYWwuZmluZCgiI3Byb2RGYW1pbHkiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY2FzZU5vIikuaHRtbCgpLAogICAgICAgICAgICAgICAgInByb2R1Y3RJZCI6IHBhcnNlSW50KGNvbW1lbnRNb2RhbC5maW5kKCIjcHJvZHVjdElkIikuaHRtbCgpKSwKICAgICAgICAgICAgICAgICJwdENvZGUiOiBwYXJzZUludChjb21tZW50TW9kYWwuZmluZCgiI3B0Q29kZSIpLmh0bWwoKSkKCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhc2VKc29uT2JqQXJyYXkucHVzaChjYXNlSnNvbk9iaik7CiAgICAgICAgICAgIGlmKGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCkpewogICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3VwZGF0ZUNvbW1lbnQiOwogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYXBwVHlwZSwKICAgICAgICAgICAgICAgICAgICAiY29tbWVudCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICJpZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2V4ZWN1dGVkQ29uZmlnSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogdmFsaWRhdGVkU2lnbmFsSWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3NhdmVDb21tZW50IjsKICAgICAgICAgICAgICAgIGRhdGEgPSB7ImNhc2VKc29uT2JqQXJyYXkiOiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KX0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2lzVXBkYXRlZCIpLnZhbCgidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25PYmpBcnJheVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjb21tZW50Ym94JykudmFsKCcnKS5ibHVyKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kRWRpdENvbW1lbnQgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsKSB7CgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcuZWRpdC1jb21tZW50JykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi51cGRhdGUtY29tbWVudCIpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudC1hcmVhIikuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7CiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoImhpZGRlbiIpCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kRGVsZXRlQ29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwsIGNhc2VKc29uKSB7CgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcuZGVsZXRlLWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpZCA9IHsKICAgICAgICAgICAgICAgICJpZCI6ICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnRJZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogJCgiI3ZhbGlkYXRlZFNpZ25hbElkIikudGV4dCgpLAogICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCIgOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogIi9zaWduYWwvYWxlcnRDb21tZW50L2RlbGV0ZUNvbW1lbnQiLAogICAgICAgICAgICAgICAgZGF0YTogaWQsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRVcGRhdGVDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pIHsKCgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcudXBkYXRlLWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5nbHlwaGljb24tcGVuY2lsIikucmVtb3ZlQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICAgICB2YXIgY29tbWVudERhdGEgPSB7CiAgICAgICAgICAgICAgICAiY29tbWVudCI6ICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnQtYXJlYSIpLnZhbCgpLAogICAgICAgICAgICAgICAgImlkIjogJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiAkKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS50ZXh0KCksCiAgICAgICAgICAgICAgICAidG9waWNJZCI6ICQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjYXNlSnNvbi5leGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCIgOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC91cGRhdGVDb21tZW50IiwKICAgICAgICAgICAgICAgIGRhdGE6IGNvbW1lbnREYXRhLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewoKICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIGxpc3RfY29tbWVudHM6IGxpc3RDb21tZW50cywKICAgICAgICBwb3B1bGF0ZV9jb21tZW50czogcG9wdWxhdGVDb21tZW50cywKICAgICAgICBzYXZlX2NvbW1lbnQ6IGJpbmRTYXZlQ29tbWVudAogICAgfQp9KSgpOwoKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CnNpZ25hbC5wcm9kdWN0RXZlbnRIaXN0b3J5VGFibGUgPSAoZnVuY3Rpb24gKCkgewoKICAgIHZhciBjdXJyZW50QWxlcnRIaXN0b3J5TW9kYWxUYWJsZSA9IG51bGw7CiAgICB2YXIgcHJvZHVjdEV2ZW50SGlzdG9yeUViZ21Nb2RhbFRhYmxlID0gbnVsbDsKICAgIHZhciBvdGhlckFsZXJ0c0hpc3RvcnlNb2RhbFRhYmxlID0gbnVsbDsKCiAgICB2YXIgaW5pdF9jdXJyZW50X2FsZXJ0X2hpc3RvcnlfdGFibGUgPSBmdW5jdGlvbiAodXJsLCBwcm9kdWN0TmFtZSwgZXZlbnROYW1lLCBjb25maWdJZCwgZXhlY3V0ZWRDb25maWdJZCkgewogICAgICAgIHZhciBkYXRhVXJsID0gdXJsICsgIj8iICsgc2lnbmFsLnV0aWxzLmNvbXBvc2VQYXJhbXMoewogICAgICAgICAgICBwcm9kdWN0TmFtZTogZW5jb2RlVVJJKHByb2R1Y3ROYW1lKSwKICAgICAgICAgICAgZXZlbnROYW1lOiBlbmNvZGVVUkkoZXZlbnROYW1lKSwKICAgICAgICAgICAgY29uZmlnSWQ6IGNvbmZpZ0lkLAogICAgICAgICAgICBleGVjdXRlZENvbmZpZ0lkOiBleGVjdXRlZENvbmZpZ0lkCiAgICAgICAgfSk7CgogICAgICAgIGlmICh0eXBlb2YgY3VycmVudEFsZXJ0SGlzdG9yeU1vZGFsVGFibGUgIT0gInVuZGVmaW5lZCIgJiYgY3VycmVudEFsZXJ0SGlzdG9yeU1vZGFsVGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICBjdXJyZW50QWxlcnRIaXN0b3J5TW9kYWxUYWJsZS5kZXN0cm95KCkKICAgICAgICB9CgogICAgICAgIC8vRGF0YSB0YWJsZSBmb3IgdGhlIGRvY3VtZW50IG1vZGFsIHdpbmRvdy4KICAgICAgICBjdXJyZW50QWxlcnRIaXN0b3J5TW9kYWxUYWJsZSA9ICQoIiNjdXJyZW50QWxlcnRIaXN0b3J5TW9kYWxUYWJsZSIpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm5Jbml0Q29tcGxldGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQoJ1tkYXRhLXRvZ2dsZT0idG9vbHRpcCJdJykudG9vbHRpcCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJhamF4IjogewogICAgICAgICAgICAgICAgInVybCI6IGRhdGFVcmwsCiAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlYXJjaGluZzogdHJ1ZSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICJhYVNvcnRpbmciOiBbXSwKICAgICAgICAgICAgImFMZW5ndGhNZW51IjogW1sxMCwgMjAsIDUwLCAtMV0sIFsxMCwgMjAsIDUwLCAiQWxsIl1dLAogICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydE5hbWUiLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnZHQtY2VudGVyJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGlzcG9zaXRpb24iLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnZHQtY2VudGVyJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAianVzdGlmaWNhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJkdC1jZW50ZXIganVzdGlmaWNhdGlvbi1jZWxsIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5qdXN0aWZpY2F0aW9uICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMucmVuZGVyKCdoaXN0b3J5SnVzdGlmaWNhdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdXN0aWZpY2F0aW9uOiByb3cuanVzdGlmaWNhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcmlvcml0eSIsCiAgICAgICAgICAgICAgICAgICAgImFUYXJnZXRzIjogWyJwcmlvcml0eSJdLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IiMiIGNsYXNzPSJmb250LTI0IiB0aXRsZT0iJyArIHJvdy5wcmlvcml0eS52YWx1ZSArICciPjxpIGNsYXNzPSInICsgcm93LnByaW9yaXR5Lmljb25DbGFzcyAgKyciPjwvaT48L2E+JwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdC1jZW50ZXInCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydFRhZ3MiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFnc0VsZW1lbnQgPSAnPGRpdiBjbGFzcz0idGFnLWNvbnRhaW5lciI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5hbGVydFRhZ3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbGVydFRhZ3MgPSBKU09OLnBhcnNlKHJvdy5hbGVydFRhZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGVydFRhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhbGVydFRhZ3NbaV0udHlwZSA9PT0gJ0dMT0JBTF9UQUcnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiBjbGFzcz0iYmFkZ2UgYmFkZ2UtaW5mbyBkZXRhaWxzLXRhZ3MiPicgKyBlc2NhcGVIVE1MKGFsZXJ0VGFnc1tpXS5uYW1lKSArJyZuYnNwOzwvaT48L2E+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUYWdzW2ldLnR5cGUgPT09ICdDQVNFX1NFUklFU19UQUcnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIGhyZWY9IiMiIGNsYXNzPSJiYWRnZSBiYWRnZS1pbmZvIGRldGFpbHMtdGFncyI+JyArIGVzY2FwZUhUTUwoYWxlcnRUYWdzW2ldLm5hbWUgKyAnIChBKScpICsgJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUYWdzW2ldLnR5cGUgPT09ICdQUklWQVRFX1RBR19BTEVSVCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiBjbGFzcz0iYmFkZ2UgYmFkZ2UtaW5mbyBkZXRhaWxzLXRhZ3MiPicgKyBlc2NhcGVIVE1MKGFsZXJ0VGFnc1tpXS5uYW1lICsgJyAoUCknICsgJyAoQSknKSArICcmbmJzcDs8L2k+PC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIGNsYXNzPSJiYWRnZSBiYWRnZS1pbmZvIGRldGFpbHMtdGFncyI+JyArIGVzY2FwZUhUTUwoYWxlcnRUYWdzW2ldLm5hbWUgKyAnIChQKScpICsgJyZuYnNwOzwvaT48L2E+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFnc0VsZW1lbnQKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnZHQtY2VudGVyJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYWxlcnRTdWJUYWdzIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZ3NFbGVtZW50ID0gJzxkaXYgY2xhc3M9InRhZy1jb250YWluZXIiPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cuYWxlcnRTdWJUYWdzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxlcnRTdWJUYWdzID0gSlNPTi5wYXJzZShyb3cuYWxlcnRTdWJUYWdzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYWxlcnRTdWJUYWdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiBjbGFzcz0iYmFkZ2UgYmFkZ2UtaW5mbyBkZXRhaWxzLXRhZ3MgYmctZ3JleS0zIj4nICsgZXNjYXBlSFRNTChhbGVydFN1YlRhZ3NbaV0ubmFtZSArICcgKFMpJykgKyAnJm5ic3A7JyAgKyAnPC9pPjwvYT4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhZ3NFbGVtZW50CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2R0LWNlbnRlcicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInVwZGF0ZWRCeSIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJkdC1jZW50ZXIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aW1lc3RhbXAiLAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiZHQtY2VudGVyIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgInRhcmdldHMiOiAnX2FsbCcsCiAgICAgICAgICAgICAgICAicmVuZGVyIjogJC5mbi5kYXRhVGFibGUucmVuZGVyLnRleHQoKQogICAgICAgICAgICB9XQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBjdXJyZW50QWxlcnRIaXN0b3J5TW9kYWxUYWJsZQogICAgfTsKCiAgICB2YXIgaW5pdF9vdGhlcl9hbGVydHNfaGlzdG9yeV90YWJsZSA9IGZ1bmN0aW9uICh1cmwsIHByb2R1Y3ROYW1lLCBldmVudE5hbWUsIGNvbmZpZ0lkKSB7CiAgICAgICAgdmFyIGRhdGFVcmwgPSB1cmwgKyAiPyIgKyBzaWduYWwudXRpbHMuY29tcG9zZVBhcmFtcyh7CiAgICAgICAgICAgIHByb2R1Y3ROYW1lOiBlbmNvZGVVUkkocHJvZHVjdE5hbWUpLAogICAgICAgICAgICBldmVudE5hbWU6IGVuY29kZVVSSShldmVudE5hbWUpLAogICAgICAgICAgICBjb25maWdJZDogY29uZmlnSWQKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHR5cGVvZiBvdGhlckFsZXJ0c0hpc3RvcnlNb2RhbFRhYmxlICE9ICJ1bmRlZmluZWQiICYmIG90aGVyQWxlcnRzSGlzdG9yeU1vZGFsVGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICBvdGhlckFsZXJ0c0hpc3RvcnlNb2RhbFRhYmxlLmRlc3Ryb3koKQogICAgICAgIH0KCiAgICAgICAgLy9EYXRhIHRhYmxlIGZvciB0aGUgZG9jdW1lbnQgbW9kYWwgd2luZG93LgogICAgICAgIG90aGVyQWxlcnRzSGlzdG9yeU1vZGFsVGFibGUgPSAkKCIjb3RoZXJBbGVydHNIaXN0b3J5TW9kYWxUYWJsZSIpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZm5Jbml0Q29tcGxldGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQoJ1tkYXRhLXRvZ2dsZT0idG9vbHRpcCJdJykudG9vbHRpcCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJhamF4IjogewogICAgICAgICAgICAgICAgInVybCI6IGRhdGFVcmwsCiAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlYXJjaGluZzogdHJ1ZSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICJhYVNvcnRpbmciOiBbXSwKICAgICAgICAgICAgImFMZW5ndGhNZW51IjogW1sxMCwgMjAsIDUwLCAtMV0sIFsxMCwgMjAsIDUwLCAiQWxsIl1dLAogICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydE5hbWUiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgKyBkZXRhaWxzVXJsICsgJz8nICsgJ2NhbGxpbmdTY3JlZW49cmV2aWV3JmNvbmZpZ0lkPScgKyByb3cuZXhlY3V0ZWRBbGVydENvbmZpZ0lkICsgJyIgdGFyZ2V0PSJfYmxhbmsiPicgKyBlc2NhcGVIVE1MKGRhdGEpICsgJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdC1jZW50ZXInCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkaXNwb3NpdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdC1jZW50ZXInCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJqdXN0aWZpY2F0aW9uIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImR0LWNlbnRlciBqdXN0aWZpY2F0aW9uLWNlbGwiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93Lmp1c3RpZmljYXRpb24gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25hbC51dGlscy5yZW5kZXIoJ2hpc3RvcnlKdXN0aWZpY2F0aW9uJywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp1c3RpZmljYXRpb246IHJvdy5qdXN0aWZpY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInByaW9yaXR5IiwKICAgICAgICAgICAgICAgICAgICAiYVRhcmdldHMiOiBbInByaW9yaXR5Il0sCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iIyIgY2xhc3M9ImZvbnQtMjQiIHRpdGxlPSInICsgcm93LnByaW9yaXR5LnZhbHVlICsgJyI+PGkgY2xhc3M9IicgKyByb3cucHJpb3JpdHkuaWNvbkNsYXNzICArJyI+PC9pPjwvYT4nCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2R0LWNlbnRlcicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImFsZXJ0VGFncyIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWdzRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJ0YWctY29udGFpbmVyIj4nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93LmFsZXJ0VGFncykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsZXJ0VGFncyA9IEpTT04ucGFyc2Uocm93LmFsZXJ0VGFncyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFsZXJ0VGFncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFsZXJ0VGFnc1tpXS50eXBlID09PSAnR0xPQkFMX1RBRycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIGNsYXNzPSJiYWRnZSBiYWRnZS1pbmZvIGRldGFpbHMtdGFncyI+JyArIGVzY2FwZUhUTUwoYWxlcnRUYWdzW2ldLm5hbWUpICsnJm5ic3A7PC9pPjwvYT4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhbGVydFRhZ3NbaV0udHlwZSA9PT0gJ0NBU0VfU0VSSUVTX1RBRycpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgaHJlZj0iIyIgY2xhc3M9ImJhZGdlIGJhZGdlLWluZm8gZGV0YWlscy10YWdzIj4nICsgZXNjYXBlSFRNTChhbGVydFRhZ3NbaV0ubmFtZSArICcgKEEpJykgKyAnPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhbGVydFRhZ3NbaV0udHlwZSA9PT0gJ1BSSVZBVEVfVEFHX0FMRVJUJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIGNsYXNzPSJiYWRnZSBiYWRnZS1pbmZvIGRldGFpbHMtdGFncyI+JyArIGVzY2FwZUhUTUwoYWxlcnRUYWdzW2ldLm5hbWUgKyAnIChQKScgKyAnIChBKScpICsgJyZuYnNwOzwvaT48L2E+JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NFbGVtZW50ICs9ICc8YSB0YWJpbmRleD0iMCIgY2xhc3M9ImJhZGdlIGJhZGdlLWluZm8gZGV0YWlscy10YWdzIj4nICsgZXNjYXBlSFRNTChhbGVydFRhZ3NbaV0ubmFtZSArICcgKFApJykgKyAnJm5ic3A7PC9pPjwvYT4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0YWdzRWxlbWVudAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdkdC1jZW50ZXInCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydFN1YlRhZ3MiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFnc0VsZW1lbnQgPSAnPGRpdiBjbGFzcz0idGFnLWNvbnRhaW5lciI+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5hbGVydFN1YlRhZ3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbGVydFN1YlRhZ3MgPSBKU09OLnBhcnNlKHJvdy5hbGVydFN1YlRhZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGVydFN1YlRhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIGNsYXNzPSJiYWRnZSBiYWRnZS1pbmZvIGRldGFpbHMtdGFncyBiZy1ncmV5LTMiPicgKyBlc2NhcGVIVE1MKGFsZXJ0U3ViVGFnc1tpXS5uYW1lICsgJyAoUyknKSArICcmbmJzcDsnICArICc8L2k+PC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFnc0VsZW1lbnQKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnZHQtY2VudGVyJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAidXBkYXRlZEJ5IiwKICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2R0LWNlbnRlcicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInRpbWVzdGFtcCIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJkdC1jZW50ZXIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG90aGVyQWxlcnRzSGlzdG9yeU1vZGFsVGFibGUKICAgIH07CgogICAgdmFyIGNsZWFyX3Byb2R1Y3RfZXZlbnRfaGlzdG9yeV90YWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBjdXJyZW50QWxlcnRIaXN0b3J5TW9kYWxUYWJsZS5kZXN0cm95KCk7CiAgICAgICAgcHJvZHVjdEV2ZW50SGlzdG9yeUViZ21Nb2RhbFRhYmxlLmRlc3Ryb3koKQogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIGluaXRfY3VycmVudF9hbGVydF9oaXN0b3J5X3RhYmxlOiBpbml0X2N1cnJlbnRfYWxlcnRfaGlzdG9yeV90YWJsZSwKICAgICAgICBpbml0X290aGVyX2FsZXJ0c19oaXN0b3J5X3RhYmxlOiBpbml0X290aGVyX2FsZXJ0c19oaXN0b3J5X3RhYmxlLAogICAgICAgIGNsZWFyX3Byb2R1Y3RfZXZlbnRfaGlzdG9yeV90YWJsZTogY2xlYXJfcHJvZHVjdF9ldmVudF9oaXN0b3J5X3RhYmxlCiAgICB9Cn0pKCk7CgpIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpMThuJywKICAgIGZ1bmN0aW9uKHN0cil7CiAgICAgICAgcmV0dXJuICggKHR5cGVvZiBpMThuKSAhPT0gJ3VuZGVmaW5lZCcgPyBzdHIgOiBzdHIpCiAgICB9Cik7CgpIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdzZWxlY3QnLCBmdW5jdGlvbihuYW1lLCBzZWxlY3RlZFZhbHVlLCBvcHRpb25zLCBkaXNwX2ZpZWxkLCB2YWx1ZV9maWVsZCkgewogICAgdmFyIG91dCA9ICI8c2VsZWN0IGNsYXNzPSdmb3JtLWNvbnRyb2wgc2VsZWN0Qm94JyBpZD1cJyIgKyBuYW1lICsgIlwnIG5hbWU9IiArIG5hbWUgKyAiPlxuIjsKICAgIF8uZWFjaChvcHRpb25zLCBmdW5jdGlvbih2KSB7CiAgICAgICAgb3V0ICs9ICI8b3B0aW9uIHZhbHVlPSciICsgdlt2YWx1ZV9maWVsZF0gKyAiJyIgKwogICAgICAgICAgICAodlt2YWx1ZV9maWVsZF0gPT0gc2VsZWN0ZWRWYWx1ZVt2YWx1ZV9maWVsZF0gPyAiIHNlbGVjdGVkICIgOiAiIikgKyAiID4iICsKICAgICAgICAgICAgZXNjYXBlSFRNTCh2W2Rpc3BfZmllbGRdKSArICI8L29wdGlvbj5cbiIKICAgIH0pOwogICAgb3V0ICs9ICI8L3NlbGVjdD4iOwoKICAgIHJldHVybiBuZXcgSGFuZGxlYmFycy5TYWZlU3RyaW5nKG91dCkKfSk7CgpIYW5kbGViYXJzLnJlZ2lzdGVyUGFydGlhbCgnZGF0ZV9waWNrZXJfdGVtcGxhdGUnLCBzaWduYWwudXRpbHMuaGJzX3BhcnRpYWwoJ2RhdGVfcGlja2VyX3RlbXBsYXRlJykpOwoKLy9IYW5kbGViYXIgaGVscGVyIHRvIGltaXRhdGUgdGhlIGlmIGNvbmRpdGlvbnMKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfZXEnLCBmdW5jdGlvbihhLCBiLCBvcHRzKSB7CiAgICBpZiAoYSA9PSBiKSB7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9Cn0pOwoKLy9IYW5kbGViYXIgaGVscGVyIHRvIGltaXRhdGUgdGhlIGlmLi5lbHNlIGNvbmRpdGlvbnMKSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignaWZfZWxzZV9lcScsIGZ1bmN0aW9uKGEsIGIsIG9wdHMpIHsKICAgIGlmIChhID09IGIpIHsKICAgICAgICByZXR1cm4gb3B0cy5mbih0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG9wdHMuaW52ZXJzZSh0aGlzKTsKICAgIH0KfSk7CgpIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpZl90YWdfZXhpc3QnLCBmdW5jdGlvbihrZXksIHZhbHVlLHRhZ3MsIG9wdHMpIHsKICAgIGlmKHZhbHVlLnRhZ1RleHQgPT0gdGFnc1trZXktMV0udGFnVGV4dCAmJiB2YWx1ZS5zdWJUYWdUZXh0IT1udWxsICYmIHZhbHVlLnN1YlRhZ1RleHQgIT0gdGFnc1trZXktMV0uc3ViVGFnVGV4dCl7CiAgICAgICAgcmV0dXJuIG9wdHMuZm4odGhpcyk7CiAgICB9IGVsc2V7CiAgICAgICAgcmV0dXJuIG9wdHMuaW52ZXJzZSh0aGlzKTsKICAgIH0KfSk7CgpIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpZl9lbHNlX25lcScsIGZ1bmN0aW9uKGEsIGIsIG9wdHMpIHsKICAgIGlmIChhICE9IGIpIHsKICAgICAgICByZXR1cm4gb3B0cy5mbih0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG9wdHMuaW52ZXJzZSh0aGlzKTsKICAgIH0KfSk7CgovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9oYW5kbGViYXJfZXh0LmpzCgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKc2lnbmFsLmFsZXJ0c191dGlscyA9IChmdW5jdGlvbigpIHsKICAgIHZhciBwcmlvcml0aWVzOwogICAgdmFyIHdvcmtmbG93U3RhdGVzOwoKICAgIHZhciBnZXRfcHJpb3JpdGllcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogIi9zaWduYWwvd29ya2Zsb3cvcHJpb3JpdGllcyIsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBwcmlvcml0aWVzID0gcmVzdWx0CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHByaW9yaXRpZXMKICAgIH07CgogICAgdmFyIGdldF93b3JrZmxvd1N0YXRlcyA9IGZ1bmN0aW9uKGluaXREYXRhKSB7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC93b3JrZmxvdy93b3JrZmxvd1N0YXRlIiwKICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICBkYXRhOiBpbml0RGF0YSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgICAgICB3b3JrZmxvd1N0YXRlcyA9IHJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB3b3JrZmxvd1N0YXRlcwogICAgfTsKCiAgICB2YXIgcHJpb3JpdGllc19zZWxlY3Rpb25zID0gZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgdmFyIG5ld19zZWxlY3QgPSAnPGRpdj48c2VsZWN0IGNsYXNzPSJmb3JtLWNvbnRyb2wgYWRkLWN1cnNvciIgJyArCiAgICAgICAgICAgICdzdHlsZT0iaGVpZ2h0OiAzMHB4OyIgb25jaGFuZ2U9InVwZGF0ZVByaW9yaXR5KHRoaXMudmFsdWUsJyArIHJvdy5pZCArICcpIj4nOwogICAgICAgIHZhciBwcmlvcml0eSA9IHJvdy5wcmlvcml0eTsKCiAgICAgICAgdmFyIHRoZV9zZWxlY3QgPSBfLnJlZHVjZShwcmlvcml0aWVzLCBmdW5jdGlvbihtLCBwKXsKICAgICAgICAgICAgaWYgKHAudmFsdWUgPT0gcHJpb3JpdHkpCiAgICAgICAgICAgICAgICByZXR1cm4gbSArICc8b3B0aW9uIHZhbHVlPSInICsgcC52YWx1ZSArICciIHNlbGVjdGVkPiAnICsgcC5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbSArICc8b3B0aW9uIHZhbHVlPSInICsgcC52YWx1ZSArICciPicgKyBwLmRpc3BsYXlOYW1lICsgJzwvb3B0aW9uPicKICAgICAgICB9LCBuZXdfc2VsZWN0KTsKICAgICAgICB0aGVfc2VsZWN0ID0gdGhlX3NlbGVjdCArICc8L3NlbGVjdD48L2Rpdj4nOwogICAgICAgIHJldHVybiB0aGVfc2VsZWN0OwogICAgfTsKCiAgICB2YXIgd29ya2Zsb3dfc2VsZWN0aW9ucyA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgIHZhciBuZXdfc2VsZWN0ID0gJzxkaXY+PHNlbGVjdCBjbGFzcz0iZm9ybS1jb250cm9sIGFkZC1jdXJzb3IiIHN0eWxlPSJoZWlnaHQ6IDMwcHg7IiBvbmNoYW5nZT0idXBkYXRlU3RhdHVzKHRoaXMudmFsdWUsJyArIHJvdy5pZCArICcpIj4nOwogICAgICAgIHZhciB3b3JrZmxvd1N0YXRlID0gcm93LndvcmtmbG93U3RhdGU7CgogICAgICAgIHZhciB0aGVfc2VsZWN0ID0gXy5yZWR1Y2Uod29ya2Zsb3dTdGF0ZXMsIGZ1bmN0aW9uKG0sIHdzKXsKICAgICAgICAgICAgaWYgKHdzLnZhbHVlID09IHdvcmtmbG93U3RhdGUpCiAgICAgICAgICAgICAgICByZXR1cm4gbSArICc8b3B0aW9uIHZhbHVlPSInICsgd3MudmFsdWUgKyAnIiBzZWxlY3RlZD4gJyArIHdzLmRpc3BsYXlOYW1lICsgJzwvb3B0aW9uPic7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiBtICsgJzxvcHRpb24gdmFsdWU9IicgKyB3cy52YWx1ZSArICciPicgKyB3cy5kaXNwbGF5TmFtZSArICc8L29wdGlvbj4nCiAgICAgICAgfSwgbmV3X3NlbGVjdCk7CiAgICAgICAgdGhlX3NlbGVjdCA9IHRoZV9zZWxlY3QgKyAnPC9zZWxlY3Q+PC9kaXY+JzsKICAgICAgICByZXR1cm4gdGhlX3NlbGVjdDsKICAgIH07CgogICAgdmFyIGNvbXBvc2VfZWRpdF9zdGF0ZV9saW5rID0gZnVuY3Rpb24odmFsdWUsIHJvd0lkLCBmaWxlZE5hbWUpIHsKICAgICAgICByZXR1cm4gIjxzcGFuPiIgKyB2YWx1ZSArICI8L3NwYW4+IiArICI8YSBocmVmPScjJyBjbGFzcz0nZWRpdC1zdGF0ZScgPiIgKwogICAgICAgICAgICAiPGkgY2xhc3M9J2ZhIGZhLXNoYXJlLWFsdCBwdWxsLXJpZ2h0JyBkYXRhLWZpZWxkPSciICArIGZpbGVkTmFtZSArCiAgICAgICAgICAgICInIGRhdGEtaWQ9JyIgKyByb3dJZCArICInLz48L2E+IgogICAgfTsKCiAgICB2YXIgc3RhdGVfY2hhbmdlZCA9IGZ1bmN0aW9uKGV4dHJhX3ZhbHVlcykgewogICAgICAgICQoIiN2YWx1ZVNlbGVjdCIpLmNoYW5nZShmdW5jdGlvbihldnQpIHsKICAgICAgICAgICAgdmFyIGF2YWlsYWJsZV9leHRyYV92YWx1ZXMgPSBleHRyYV92YWx1ZXNbJCh2YWx1ZVNlbGVjdCkudmFsKCldCiAgICAgICAgfSkKICAgIH07CgogICAgLy9UT0RPIHRoaXMgaXMgYSB0ZW1wIHNvbHV0aW9uIGZvciB0aGUgSlNPTiBmb3JtYXQuIEl0IHNob3VsZCBjb21lIGZyb20gc2VydmVyIHNpZGUKICAgIC8vRnVuY3Rpb24gdGhhdCBjb252ZXJ0cyB0aGUganNvbiBpbm5lcmh0bWwgdG8gdGhlIGNzdiB2YWx1ZXMuCiAgICAvL0l0IGNvbnZlcnRzIHRoZSBwcm9wZXJ0aWVzIHdoaWNoIGFyZSBub3QgaWQuCiAgICB2YXIgc2hvd19qc29uX2FzX2NzdiA9IGZ1bmN0aW9uIChlbGVtZW50Q2xhc3MpIHsKICAgICAgICAkKCIuIiArIGVsZW1lbnRDbGFzcykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoaXNOYU4oJCh0aGlzKS5odG1sKCkpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBtb2RpZmllZFZhbCA9ICIiOwogICAgICAgICAgICAgICAgICB2YXIganNvblZhbCA9IEpTT04ucGFyc2UoJCh0aGlzKS5odG1sKCkpOwogICAgICAgICAgICAgICAgICBmb3IgKHZhciBvYmogaW4ganNvblZhbCkgewogICAgICAgICAgICAgICAgICAgICBpZiAoanNvblZhbC5oYXNPd25Qcm9wZXJ0eShvYmopKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3AgaW4ganNvblZhbFtvYmpdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc29uVmFsW29ial0uaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3AgIT0gJ2lkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RpZmllZFZhbCA9IG1vZGlmaWVkVmFsICsganNvblZhbFtvYmpdW3Byb3BdICsgIiwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAkKHRoaXMpLmh0bWwobW9kaWZpZWRWYWwuc2xpY2UoMCwgLTEpKQogICAgICAgICAgICAgIH0KICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAvL0RvIG5vdGhpbmcKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGVycikKICAgICAgICAgICB9CiAgICAgICAgICAgJCh0aGlzKS5odG1sKCkKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgaW5pdF9tYXRjaGVkX2FsZXJ0c190YWJsZSA9IGZ1bmN0aW9uKHRhYmxlRWxlLCB1cmwpIHsKICAgICAgICB2YXIgdGFibGUgPSB0YWJsZUVsZS5EYXRhVGFibGUoewogICAgICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogIi9zaWduYWwvYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFqYXg6IHsKICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgZGF0YVNyYzogJycsCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oeGhyLHN0YXR1cyxlcnJvcil7fQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYW9Db2x1bW5zOlsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ25hbWUnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAncHJvZHVjdFNlbGVjdGlvbicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICd0b3BpYycKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICdkZXRlY3RlZERhdGUnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAnZGlzcG9zaXRpb24nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGRvbTogJycKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHRhYmxlCiAgICB9OwoKICAgIHZhciBnZXRTaWduYWxOYW1lTGlzdCA9IGZ1bmN0aW9uKHNpZ25hbHNBbmRUb3BpY3MpIHsKICAgICAgICB2YXIgc2lnbmFsQW5kVG9waWNzID0gJyc7CiAgICAgICAgJC5lYWNoKHNpZ25hbHNBbmRUb3BpY3MsIGZ1bmN0aW9uKGksIG9iail7CiAgICAgICAgICAgIHZhciB1cmwgPSBzaWduYWxEZXRhaWxVcmwgKyAnP2lkPScgKyBvYmpbJ3NpZ25hbElkJ107CiAgICAgICAgICAgIHNpZ25hbEFuZFRvcGljcyA9IHNpZ25hbEFuZFRvcGljcyArICc8c3BhbiBjbGFzcz0iY2xpY2siPjxhIGhyZWY9IicgKyB1cmwgKyAnIj4nICsgb2JqWyduYW1lJ10gKyAnPC9hPjwvc3Bhbj4mbmJzcDsnCiAgICAgICAgICAgIHNpZ25hbEFuZFRvcGljcyA9IHNpZ25hbEFuZFRvcGljcyArICIsIgogICAgICAgIH0pOwogICAgICAgIGlmKHNpZ25hbEFuZFRvcGljcy5sZW5ndGggPiAxKQogICAgICAgICAgICByZXR1cm4gJzxkaXY+JyArIHNpZ25hbEFuZFRvcGljcy5zdWJzdHJpbmcoMCwgc2lnbmFsQW5kVG9waWNzLmxlbmd0aCAtIDEpICsgJzwvZGl2Pic7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gJy0nOwogICAgfTsKCiAgICAvLyBGb3Igc2hhcmVkIHdpdGggbW9kYWwKICAgIHZhciBpbml0aWFsaXplU2hhcmVXaXRoU2VsZWN0MiA9IGZ1bmN0aW9uKCl7CiAgICAgICAgJCgnI3NoYXJlV2l0aCcpLnNlbGVjdDIoKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgJCgnI3NoYXJlV2l0aCcpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdoYXMtZXJyb3InKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGluaXRpYWxpemVTaGFyZVdpdGhWYWx1ZXMgPSBmdW5jdGlvbigpewogICAgICAgICQoJyNzaGFyZWRXaXRoTW9kYWwnKS5vbignc2hvdy5icy5tb2RhbCcsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdmFyIGV4ZWN1dGVkQ29uZmlnSWQgPSBlLnJlbGF0ZWRUYXJnZXQuaWQ7CiAgICAgICAgICAgICQoJyNleGVjdXRlZENvbmZpZ0lkJykudmFsKGV4ZWN1dGVkQ29uZmlnSWQpOwogICAgICAgICAgICAkKCcjc2hhcmVkV2l0aCcpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdoYXMtZXJyb3InKTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsCiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJywKICAgICAgICAgICAgICAgIHVybDogZ2V0U2hhcmVkV2l0aCArICc/aWQ9JyArIGV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0LnVzZXJzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcnMgKz0gdGhpcy5uYW1lICsgJzxiciAvPicKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkKCcjc2hhcmVkV2l0aFVzZXJMaXN0JykuaHRtbCh1c2Vycyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwcyA9ICcnOwogICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXN1bHQuZ3JvdXBzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzICs9ICB0aGlzLm5hbWUgKyAnIDxiciAvPicKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkKCcjc2hhcmVkV2l0aEdyb3VwTGlzdCcpLmh0bWwoZ3JvdXBzKTsKCiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJlc3VsdC5hbGwsIGZ1bmN0aW9uKGksIGRhdGEpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0gbmV3IE9wdGlvbihkYXRhLm5hbWUsIGRhdGEuaWQsIHRydWUsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2hhcmVkV2l0aCcpLmFwcGVuZChvcHRpb24pLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHNoYXJlZFdpdGhNb2RhbFNob3cgPSB0cnVlOwoKICAgICAgICB9KS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICBzaGFyZWRXaXRoTW9kYWxTaG93ID0gZmFsc2U7CiAgICAgICAgICAgICQoJyNzaGFyZWRXaXRoJykudmFsKG51bGwpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAkKCcjc2hhcmVkV2l0aCcpLmZpbmQoJ29wdGlvbicpLnJlbW92ZSgpOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgZ2V0VGFnc0VsZW1lbnQgPSBmdW5jdGlvbih0YWdzKSB7CiAgICAgICAgdmFyIHRhZ3NFbGVtZW50ID0gJzxkaXYgY2xhc3M9InRhZy1jb250YWluZXIgYmxvY2stZWxsaXBzaXMiPjxkaXYgY2xhc3M9InRhZy1sZW5ndGgiPic7CiAgICAgICAgdmFyIGdsb2JhbFRhZ3NBcnJheSA9IFtdOwogICAgICAgIHZhciBhbGVydFRhZ3NycmF5ID0gW107CiAgICAgICAgdmFyIHByaXZhdGVUYWdzQXJyYXkgPSBbXTsKICAgICAgICAkLmVhY2godGFncywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlLnByaXZhdGVVc2VyID09ICcoUCknKSB7CiAgICAgICAgICAgICAgICBwcml2YXRlVGFnc0FycmF5LnB1c2godmFsdWUpCiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUudGFnVHlwZSA9PSAnKEEpJykgewogICAgICAgICAgICAgICAgYWxlcnRUYWdzcnJheS5wdXNoKHZhbHVlKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ2xvYmFsVGFnc0FycmF5LnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRhZ3NFbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlscycsIHsKICAgICAgICAgICAgICAgIGtleToga2V5LAogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgdGFnczp0YWdzLAogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICB2YXIgdmlld0FsbEVsZW1lbnRzID0gZmV0Y2hWaWV3QWxsVGFncyhnbG9iYWxUYWdzQXJyYXkgLCBhbGVydFRhZ3NycmF5ICwgcHJpdmF0ZVRhZ3NBcnJheSk7CgogICAgICAgIHRhZ3NFbGVtZW50ICs9ICc8YSB0YWJpbmRleD0iMCIgdGl0bGU9IkFkZC9FZGl0IENhdGVnb3JpZXMiIGNsYXNzPSJlZGl0QWxlcnRUYWdzIGJ0bi1lZGl0LXRhZyBtaWQiPjxpIGNsYXNzPSJtZGkgbWRpLXBlbmNpbC1ib3ggZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJyt2aWV3QWxsRWxlbWVudHMrJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgIHRhZ3NFbGVtZW50ICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgIHJldHVybiB0YWdzRWxlbWVudAogICAgfTsKCiAgICB2YXIgZmV0Y2hWaWV3QWxsVGFncyA9IGZ1bmN0aW9uKGdsb2JhbFRhZ3NBcnJheSAsIGFsZXJ0VGFnc0FycmF5ICwgcHJpdmF0ZVRhZ3NBcnJheSkgewogICAgICAgIHZhciByZXR1cm5FbGVtZW50ID0gIiI7CiAgICAgICAgaWYgKGdsb2JhbFRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgPSAiPHAgY2xhc3M9J3Bicicgc3R5bGU9J21hcmdpbi10b3A6N3B4Jz48Yj5HbG9iYWwgQ2F0ZWdvcnk8L2I+PGhyIGNsYXNzPSd0YWdlaHInPiI7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzX3ZpZXdfYWxsJywge3RhZ3M6IGdsb2JhbFRhZ3NBcnJheX0pICsgIjwvcD4iICA7CiAgICAgICAgfQogICAgICAgIGlmIChhbGVydFRhZ3NBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gIjxwIGNsYXNzPSdwYnInIHN0eWxlPSdtYXJnaW4tdG9wOjdweCc+PGI+QWxlcnQgU3BlY2lmaWMgQ2F0ZWdvcnk8L2I+PGhyIGNsYXNzPSd0YWdlaHInPiI7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzX3ZpZXdfYWxsJywgewogICAgICAgICAgICAgICAgdGFnczogYWxlcnRUYWdzQXJyYXksCiAgICAgICAgICAgIH0pICArICI8L3A+IiA7CiAgICAgICAgfQogICAgICAgIGlmIChwcml2YXRlVGFnc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSAiPHAgY2xhc3M9J3Bicicgc3R5bGU9J21hcmdpbi10b3A6N3B4Jz48Yj5Qcml2YXRlIENhdGVnb3J5PC9iPjxociBjbGFzcz0ndGFnZWhyJz4iOwogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9IHNpZ25hbC51dGlscy5yZW5kZXIoJ3RhZ3NfZGV0YWlsc192aWV3X2FsbCcsIHt0YWdzOiBwcml2YXRlVGFnc0FycmF5fSkgICsgIjwvcD4iIDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldHVybkVsZW1lbnQKICAgIH07CiAgICByZXR1cm4gewogICAgICAgIGdldF9wcmlvcml0aWVzOiBnZXRfcHJpb3JpdGllcywKICAgICAgICBwcmlvcml0aWVzX3NlbGVjdGlvbnM6IHByaW9yaXRpZXNfc2VsZWN0aW9ucywKICAgICAgICBnZXRfd29ya2Zsb3dTdGF0ZXM6IGdldF93b3JrZmxvd1N0YXRlcywKICAgICAgICB3b3JrZmxvd19zZWxlY3Rpb25zOiB3b3JrZmxvd19zZWxlY3Rpb25zLAogICAgICAgIGNvbXBvc2VfZWRpdF9zdGF0ZV9saW5rOiBjb21wb3NlX2VkaXRfc3RhdGVfbGluaywKICAgICAgICBzdGF0ZV9jaGFuZ2U6IHN0YXRlX2NoYW5nZWQsCiAgICAgICAgc2hvd19qc29uX2FzX2Nzdjogc2hvd19qc29uX2FzX2NzdiwKICAgICAgICBpbml0X21hdGNoZWRfYWxlcnRzX3RhYmxlOiBpbml0X21hdGNoZWRfYWxlcnRzX3RhYmxlLAogICAgICAgIGdldFNpZ25hbE5hbWVMaXN0OiBnZXRTaWduYWxOYW1lTGlzdCwKICAgICAgICBpbml0aWFsaXplU2hhcmVXaXRoU2VsZWN0MiA6IGluaXRpYWxpemVTaGFyZVdpdGhTZWxlY3QyLAogICAgICAgIGluaXRpYWxpemVTaGFyZVdpdGhWYWx1ZXM6aW5pdGlhbGl6ZVNoYXJlV2l0aFZhbHVlcywKICAgICAgICBnZXRfdGFnc19lbGVtZW50IDogZ2V0VGFnc0VsZW1lbnQKICAgIH0KfSkoKTsKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CgpzaWduYWwubGlzdF91dGlscyA9IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgZmxhZ19pdCA9IGZ1bmN0aW9uIChmbGFnLCBpZCkgewogICAgICAgIHZhciB0aGVIdG1sID0gJzxpIGNsYXNzPSJmYSBmYS1mbGFnLW8gdGV4dC1tdXRlZCByeC1saXN0LWZsYWciIGRhdGEtaWQ9IicgKyBpZCArICciPjwvaT4nCiAgICAgICAgaWYgKGZsYWcpIHsKICAgICAgICAgICAgdGhlSHRtbCA9ICc8aSBjbGFzcz0iZmEgZmEtZmxhZyB0ZXh0LXByaW1hcnkgcngtbGlzdC1mbGFnIiBkYXRhLWlkPSInICsgaWQgKyAnIj48L2k+JwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhlSHRtbAogICAgfTsKCiAgICB2YXIgZmxhZ19oYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRyb2xsZXIsIGFjdGlvbikgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcucngtbGlzdC1mbGFnJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIGVsZSA9IGUudGFyZ2V0OwogICAgICAgICAgICB2YXIgaWQgPSAkKGVsZSkuYXR0cignZGF0YS1pZCcpOwoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogIi9zaWduYWwvIiArIGNvbnRyb2xsZXIgKyAiLyIgKyBhY3Rpb24gKyAiP2lkPSIgKyBpZCwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmZsYWdnZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLnJlbW92ZUNsYXNzKCdmYS1mbGFnLW8nKS5yZW1vdmVDbGFzcygndGV4dC1tdXRlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkuYWRkQ2xhc3MoJ2ZhLWZsYWcnKS5hZGRDbGFzcygndGV4dC1wcmltYXJ5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGUpLmFkZENsYXNzKCdmYS1mbGFnLW8nKS5hZGRDbGFzcygndGV4dC1tdXRlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkucmVtb3ZlQ2xhc3MoJ2ZhLWZsYWcnKS5yZW1vdmVDbGFzcygndGV4dC1wcmltYXJ5JykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIHByaW9yaXR5X2xpbmsgPSBmdW5jdGlvbiAocHJpb3JpdHksIGlkKSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gY29tcG9zZV9wcmlvcml0eV9pY29uKHByaW9yaXR5KTsKICAgICAgICByZXR1cm4gJzxhIGhyZWY9IiMiIGNsYXNzPSJjaGFuZ2UtcHJpb3JpdHkiPjxpbWcgZGF0YS1maWVsZD0icHJpb3JpdHkiIGRhdGEtaW5mbz0icm93IiBkYXRhLWlkPSInICsKICAgICAgICAgICAgaWQgKyAnIiBkYXRhLXZhbHVlPSInICsgcHJpb3JpdHkgKyAnIiBzcmM9IicgKyBpY29uX3VybCArICciLz48L2E+JwogICAgfTsKCiAgICB2YXIgY29tcG9zZV9wcmlvcml0eV9pY29uID0gZnVuY3Rpb24gKHByaW9yaXR5KSB7CiAgICAgICAgdmFyIGljb25fdXJsID0gIi9zaWduYWwvYXNzZXRzL2ljb25zL2RlZmF1bHRfcHJpb3JpdHkucG5nIjsKCiAgICAgICAgaWYgKF8uY29udGFpbnMoWydoaWdoJywgJ2xvdycsICdtZWRpdW0nXSwgcHJpb3JpdHkudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgICAgICAgaWNvbl91cmwgPSAiL3NpZ25hbC9hc3NldHMvaWNvbnMvIiArIHByaW9yaXR5LnRvTG93ZXJDYXNlKCkgKyAiX3ByaW9yaXR5LnBuZyI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpY29uX3VybDsKICAgIH07CgogICAgdmFyIGNoYW5nZV9wcmlvcml0eSA9IGZ1bmN0aW9uIChwcmlvcml0eUVsZSwgcHJpb3JpdHkpIHsKICAgICAgICB2YXIgaWNvbl91cmwgPSBjb21wb3NlX3ByaW9yaXR5X2ljb24ocHJpb3JpdHkpOwogICAgICAgICQocHJpb3JpdHlFbGUpLmF0dHIoInNyYyIsIGljb25fdXJsKTsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJkYXRhLXZhbHVlIiwgcHJpb3JpdHkpOwogICAgfTsKCiAgICB2YXIgY2hhbmdlX3ByaW9yaXR5VGVzdCA9IGZ1bmN0aW9uIChwcmlvcml0eUVsZSwgcHJpb3JpdHkpIHsKICAgICAgICAkKHByaW9yaXR5RWxlKS5hdHRyKCJkYXRhLXZhbHVlIiwgcHJpb3JpdHkpOwogICAgfTsKCiAgICBjaGFuZ2VfcHJpb3JpdHlUZXN0CgogICAgdmFyIGZpbmRfZmllbGQgPSBmdW5jdGlvbiAodGFibGVfcm93X2VsZSwgYXR0cl9uYW1lKSB7CiAgICAgICAgcmV0dXJuICQodGFibGVfcm93X2VsZSkuZmluZCgiW2RhdGEtYXR0cmlidXRlLW5hbWU9JyIgKyBhdHRyX25hbWUgKyAiJ10iKQogICAgfTsKCiAgICB2YXIgc2V0X3ZhbHVlID0gZnVuY3Rpb24gKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSwgaWQsIGRhdGFfZnVuLCBhcHBfbmFtZSkgewogICAgICAgIHZhciBlbGUgPSBmaW5kX2ZpZWxkKHRhYmxlX3Jvd19lbGUsIGF0dHJfbmFtZSk7CiAgICAgICAgZWxlLmh0bWwoZGF0YV9mdW4oaWQsIGFwcF9uYW1lKSk7CiAgICB9OwoKICAgIHZhciBnZXRfZHVlX2luID0gZnVuY3Rpb24gKGlkLCBhcHBfbmFtZSkgewogICAgICAgIHZhciBkdWVJbiA9IDA7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydC9kdWVJbj9hbGVydElkPSIgKyBpZCArICImYXBwTmFtZT0iICsgYXBwX25hbWUsCiAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIGR1ZUluID0gZGF0YS5yZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZHVlSW4KICAgIH07CgogICAgdmFyIGR1ZV9pbl9jb21wID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlIDw9IDApIHsKICAgICAgICAgICAgcmV0dXJuICI8ZGl2IGRhdGEtYXR0cmlidXRlLW5hbWU9J2R1ZUluJyBzdHlsZSA9ICdjb2xvcjpyZWQnPiIgKyB2YWx1ZSArICI8L2Rpdj4iOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAiPGRpdiBkYXRhLWF0dHJpYnV0ZS1uYW1lPSdkdWVJbic+IiArIHZhbHVlICsgIjwvZGl2PiI7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgYXNzaWduZWRfdG9fY29tcCA9IGZ1bmN0aW9uIChpZCwgYXNzaWduZWRUbykgewogICAgICAgIHZhciBodG1sID0gJzxkaXYgY2xhc3M9ImFzc2lnbmVkVG9Db250YWluZXIiPjxzZWxlY3QgY2xhc3M9ImFzc2lnbmVkVG9TZWxlY3QgZm9ybS1jb250cm9sIHNlbGVjdDIiPjwvc2VsZWN0PjxpIGNsYXNzPSJtZGkgbWRpLXNwaW4gbWRpLWxvYWRpbmcgYXNzaWduVG9Qcm9jZXNzaW5nIiBzdHlsZT0iZGlzcGxheTogbm9uZSI+PC9pPjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIGh0bWwKICAgIH07CgogICAgdmFyIHRydW5jYXRlVGV4dEFuZFNob3dUb29sdGlwID0gZnVuY3Rpb24gKGN1dG9mZiwgd29yZGJyZWFrLCBlc2NhcGVIdG1sKSB7CiAgICAgICAgdmFyIGVzYyA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgICAgICAgICAucmVwbGFjZSgvJi9nLCAnJmFtcDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgJyZsdDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoLyIvZywgJyZxdW90OycpOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoZCwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgIC8vIE9yZGVyLCBzZWFyY2ggYW5kIHR5cGUgZ2V0IHRoZSBvcmlnaW5hbCBkYXRhCiAgICAgICAgICAgIGlmICh0eXBlICE9PSAnZGlzcGxheScpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mIGQgIT09ICdudW1iZXInICYmIHR5cGVvZiBkICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGQgPSBkLnRvU3RyaW5nKCk7IC8vIGNhc3QgbnVtYmVycwoKICAgICAgICAgICAgaWYgKGQubGVuZ3RoIDw9IGN1dG9mZikgewogICAgICAgICAgICAgICAgcmV0dXJuIGVzYyhkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHNob3J0ZW5lZCA9IGQuc3Vic3RyKDAsIGN1dG9mZiAtIDEpOwoKICAgICAgICAgICAgLy8gRmluZCB0aGUgbGFzdCB3aGl0ZSBzcGFjZSBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZwogICAgICAgICAgICBpZiAod29yZGJyZWFrKSB7CiAgICAgICAgICAgICAgICBzaG9ydGVuZWQgPSBzaG9ydGVuZWQucmVwbGFjZSgvXHMoW15cc10qKSQvLCAnJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFByb3RlY3QgYWdhaW5zdCB1bmNvbnRyb2xsZWQgSFRNTCBpbnB1dAogICAgICAgICAgICBpZiAoZXNjYXBlSHRtbCkgewogICAgICAgICAgICAgICAgc2hvcnRlbmVkID0gZXNjKHNob3J0ZW5lZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9ImVsbGlwc2lzIiB0aXRsZT0iJyArIGVzYyhkKSArICciPicgKyBzaG9ydGVuZWQgKyAnJiM4MjMwOzwvc3Bhbj4nOwogICAgICAgIH07CiAgICB9OwoKICAgIHZhciBhZGRfZmlsdGVycyA9IGZ1bmN0aW9uICh0YWJsZSwgZmlsdGVycywgZmlsdGVyX3RvZ2dsZV9idF9jb250YWluZXIpIHsKCiAgICAgICAgdmFyIHlhZGNmX2ZpbHRlcnMgPSBfLmZpbHRlcihmaWx0ZXJzLCBmdW5jdGlvbiAoZikgewogICAgICAgICAgICBpZiAoZlsxXSAhPSAnY3VzdG9taXplZCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHZhciBjdXN0X2ZpbHRlcnMgPSBfLmRpZmZlcmVuY2UoZmlsdGVycywgeWFkY2ZfZmlsdGVycyk7CgogICAgICAgIHlhZGNmLmluaXQodGFibGUsIF8ubWFwKHlhZGNmX2ZpbHRlcnMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtWzJdID09IHRydWUpCiAgICAgICAgICAgICAgICByZXR1cm4ge2NvbHVtbl9udW1iZXI6IGl0ZW1bMF0sIGZpbHRlcl90eXBlOiBpdGVtWzFdLCBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6ICd4J307CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiB7Y29sdW1uX251bWJlcjogaXRlbVswXSwgZmlsdGVyX3R5cGU6IGl0ZW1bMV0sIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2V9OwogICAgICAgIH0pKTsKCiAgICAgICAgaWYgKGZpbHRlcl90b2dnbGVfYnRfY29udGFpbmVyKSB7CiAgICAgICAgICAgIGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbignaWR4eHh4eHgnLCBmaWx0ZXJfdG9nZ2xlX2J0X2NvbnRhaW5lcik7CiAgICAgICAgfQoKICAgICAgICBpZiAoY3VzdF9maWx0ZXJzKSB7CiAgICAgICAgICAgIF8uZWFjaChjdXN0X2ZpbHRlcnMsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAkKHRhYmxlLmNvbHVtbihmWzBdKS5oZWFkZXIoKSkuYXBwZW5kKGNyZWF0ZV9zdGFja2VkX2ZpbHRlcihmWzBdKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNyZWF0ZV9zdGFja2VkX2ZpbHRlciA9IGZ1bmN0aW9uIChpZHgpIHsKICAgICAgICByZXR1cm4gJCgiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtaW5kZXg9JyIgKyBpZHggKyAiJyBjbGFzcz0nY29sdW1uLWZpbHRlcicgcGxhY2Vob2xkZXI9J1R5cGUgdG8gZmlsdGVyJz4iICsKICAgICAgICAgICAgIjxpbnB1dCB0eXBlPSd0ZXh0JyBkYXRhLWluZGV4PSciICsgaWR4ICsgIicgY2xhc3M9J2NvbHVtbi1maWx0ZXInIHBsYWNlaG9sZGVyPSdUeXBlIHRvIGZpbHRlcic+Iik7CiAgICB9OwoKICAgIHZhciBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b24gPSBmdW5jdGlvbiAodGFibGVfaWQsIGNvbnRhaW5lcikgewogICAgICAgICQoJy55YWRjZi1maWx0ZXItd3JhcHBlciwgLmNvbHVtbi1maWx0ZXInKS5oaWRlKCk7CiAgICAgICAgJCgnLmNvbHVtbi1maWx0ZXInKS5jbGljayhmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgJCgnLmNvbHVtbi1maWx0ZXInKS5vbigna2V5dXAnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIC8vIFBlcmZvcm0gc2VhcmNoCiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuZGF0YSgnaW5kZXgnKTsKICAgICAgICAgICAgJCh0YWJsZV9pZCkuRGF0YVRhYmxlKCkuY29sdW1uKGluZGV4KS5zZWFyY2goJCh0aGlzKS52YWwoKSkuZHJhdygpOwogICAgICAgIH0pOwogICAgICAgIHZhciBmaWx0ZXJUb2dnbGUgPSAiPGkgY2xhc3M9J3RhYmxlLWZpbHRlci10b2dnbGUgZ2x5cGhpY29uIGdseXBoaWNvbi1maWx0ZXInIGRhdGEtdGFibGU9JyIgKyB0YWJsZV9pZCArCiAgICAgICAgICAgICInIG9uY2xpY2s9J3NpZ25hbC5saXN0X3V0aWxzLmhhbmRsZV9maWx0ZXJfdG9nZ2xlJyBkYXRhLXNob3ctZmlsdGVyPSd0cnVlJz48L2k+IjsKICAgICAgICB2YXIgdG9nZ2xlX2J1dHRvbiA9ICQucGFyc2VIVE1MKGZpbHRlclRvZ2dsZSk7CiAgICAgICAgaWYgKCEoXy5pc1VuZGVmaW5lZChjb250YWluZXIpICYmIF8uaXNOdWxsKGNvbnRhaW5lcikpKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQodG9nZ2xlX2J1dHRvbik7CiAgICAgICAgfQoKICAgICAgICAkKGRvY3VtZW50KS5vbignZmlsdGVyLXRvZ2dsZS1pbml0JywgZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAkKCcudGFibGUtZmlsdGVyLXRvZ2dsZScpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBoaWRlX3Nob3dfZml0bGVyID0gZnVuY3Rpb24gKHRhYmxlSWQsIGhpZGVPclNob3cpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGlkZU9yU2hvdyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0YWJsZUlkICsgJ193cmFwcGVyIC55YWRjZi1maWx0ZXItd3JhcHBlciwuY29sdW1uLWZpbHRlcicpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRhYmxlSWQgKyAnX3dyYXBwZXIgLnlhZGNmLWZpbHRlci13cmFwcGVyLC5jb2x1bW4tZmlsdGVyJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgdmFyIHRhcmdldEZpbHRlclRvZ2dsZSA9ICQoZXZ0LnRhcmdldCk7CiAgICAgICAgICAgICAgICB2YXIgdGFibGVJZCA9IHRhcmdldEZpbHRlclRvZ2dsZS5kYXRhKCd0YWJsZScpOwogICAgICAgICAgICAgICAgdmFyIHNob3dGaWx0ZXIgPSB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvdy1maWx0ZXInKTsKICAgICAgICAgICAgICAgIGlmIChzaG93RmlsdGVyID09PSAndHJ1ZScpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvd0ZpbHRlcicsICdmYWxzZScpOwogICAgICAgICAgICAgICAgICAgIGhpZGVfc2hvd19maXRsZXIodGFibGVJZCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRGaWx0ZXJUb2dnbGUuZGF0YSgnc2hvd0ZpbHRlcicsICd0cnVlJyk7CiAgICAgICAgICAgICAgICAgICAgaGlkZV9zaG93X2ZpdGxlcih0YWJsZUlkLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgICQoZG9jdW1lbnQpLnRyaWdnZXIoJ2ZpbHRlci10b2dnbGUtaW5pdCcpOwogICAgICAgIHJldHVybiAkKHRvZ2dsZV9idXR0b24pOwogICAgfTsKCiAgICB2YXIgaGFuZGxlX2ZpbHRlcl90b2dnbGUgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgJCh0aGlzKS5hdHRyKCd0YXJnZXQtdGFibGUnKTsKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBmbGFnX2l0OiBmbGFnX2l0LAogICAgICAgIGZsYWdfaGFuZGxlcjogZmxhZ19oYW5kbGVyLAogICAgICAgIHByaW9yaXR5X2xpbms6IHByaW9yaXR5X2xpbmssCiAgICAgICAgY2hhbmdlX3ByaW9yaXR5OiBjaGFuZ2VfcHJpb3JpdHksCiAgICAgICAgZmluZF9maWVsZDogZmluZF9maWVsZCwKICAgICAgICBzZXRfdmFsdWU6IHNldF92YWx1ZSwKICAgICAgICBnZXRfZHVlX2luOiBnZXRfZHVlX2luLAogICAgICAgIGR1ZV9pbl9jb21wOiBkdWVfaW5fY29tcCwKICAgICAgICBhc3NpZ25lZF90b19jb21wOiBhc3NpZ25lZF90b19jb21wLAogICAgICAgIHRydW5jYXRlVGV4dEFuZFNob3dUb29sdGlwOiB0cnVuY2F0ZVRleHRBbmRTaG93VG9vbHRpcCwKICAgICAgICBhZGRfZmlsdGVyczogYWRkX2ZpbHRlcnMsCiAgICAgICAgaGFuZGxlX2ZpbHRlcl90b2dnbGU6IGhhbmRsZV9maWx0ZXJfdG9nZ2xlLAogICAgICAgIGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbjogYWRkX2ZpbHRlcl90b2dnbGVfYnV0dG9uCiAgICB9Cn0pKCk7CnZhciBzaG93VG9waWNXaWRnZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAkKCIjdG9waWMiKS5zZWxlY3QyKHsKICAgICAgICB0YWdzOiB0cnVlLAogICAgICAgIHBsYWNlaG9sZGVyOiAiU2VsZWN0IHRvcGljIiwKICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgY3JlYXRlVGFnOiBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgICAgICAgIHZhciB0ZXJtID0gJC50cmltKHBhcmFtcy50ZXJtKTsKICAgICAgICAgICAgaWYgKHRlcm0gIT0gIiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IHRlcm0sCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGVybQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgfSk7Cn07Ci8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2NvbW1vbi5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9saXN0X3V0aWxzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2hhbmRsZWJhcl9leHQuanMKLy89IHJlcXVpcmUgYXBwL3B2cy90b3BpYy9hdHRhY2hBbGVydFRvVG9waWMuanMKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307Cgp2YXIgdG9waWNEYXRhOwp2YXIgY29sdW1uU2VxOwp2YXIgaXNWaWV3SW5zdGFuY2UgPSAxOwp2YXIgc2lnbmFsQWxlcnRUeXBlID0gewogICAgU0lOR0xFX0NBU0VfQUxFUlQ6ICJTaW5nbGUgQ2FzZSBBbGVydCIsCiAgICBBR0dSRUdBVEVfQUxFUlQ6ICJBZ2dyZWdhdGUgQ2FzZSBBbGVydCIsCiAgICBFVkRBU19BTEVSVDogIkV2ZGFzIEFsZXJ0IiwKICAgIEFESE9DX0FMRVJUOiAiQWQtSG9jIEFsZXJ0IiwKICAgIExJVEVSQVRVUkVfU0VBUkNIX0FMRVJUOiAiTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQiCn0KCnNpZ25hbC5hbGVydFJldmlldyA9IChmdW5jdGlvbiAoKSB7CgogICAgdmFyIGlkcyA9IFtdOwogICAgdmFyIHJvd3MgPSBbXTsKCiAgICB2YXIgYXBwbHlCdXNpbmVzc1J1bGVzID0gZnVuY3Rpb24gKHJvdywgZGF0YSkgewogICAgICAgIC8vQXBwbHkgdGhlIGV1ZHJhIHJ1bGVzLgogICAgICAgIGlmIChkYXRhLmZvcm1hdCkgewogICAgICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShkYXRhLmZvcm1hdCk7CiAgICAgICAgICAgIHZhciB0ZXh0T2JqOwogICAgICAgICAgICAkLmVhY2gob2JqLnRleHQudGMsIGZ1bmN0aW9uIChpbmRleCwgZGF0YSkgewogICAgICAgICAgICAgICAgdGV4dE9iaiA9ICQocm93KS5maW5kKCcuJyArIGRhdGEpOwogICAgICAgICAgICAgICAgdGV4dE9iai5jc3MoJ2NvbG9yJywgb2JqLnRleHQuY29sb3IpOwogICAgICAgICAgICAgICAgaWYgKG9iai50ZXh0LmJvbGQpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygnZm9udC13ZWlnaHQnLCAnOTAwJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob2JqLnRleHQuaXRhbGljKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dE9iai5jc3MoJ2ZvbnQtc3R5bGUnLCAnaXRhbGljJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob2JqLnRleHQudW5kZXJsaW5lKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dE9iai5jc3MoJ3RleHQtZGVjb3JhdGlvbicsICd1bmRlcmxpbmUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQuZWFjaChvYmouY2VsbC50YywgZnVuY3Rpb24gKGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgICAgICAkKHJvdykuZmluZCgnLicgKyBkYXRhKS5wYXJlbnRzKCd0ZCcpLmNzcygnYmFja2dyb3VuZC1jb2xvcicsIG9iai5jZWxsLmNvbG9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgZW5hYmxlTWVudVRvb2x0aXBzID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoIi5ncmlkLW1lbnUtdG9vbHRpcCIpLm1vdXNlb3ZlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgICAgIHZhciB0b29sdGlwVGV4dCA9ICR0aGlzLmF0dHIoImRhdGEtdGl0bGUiKTsKICAgICAgICAgICAgJHRoaXMudG9vbHRpcCh7CiAgICAgICAgICAgICAgICB0aXRsZTogdG9vbHRpcFRleHQsCiAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICJib3R0b20iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkdGhpcy50b29sdGlwKCdzaG93Jyk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBkaXNhYmxlVG9vbHRpcHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgiLm1kaS1hbHBoYS1kLWJveCwgLm1kaS1maWx0ZXItb3V0bGluZSwgLm1kaS10cmVuZGluZy11cCwgLm1kaS1jb250ZW50LXNhdmUsIC5tZGktZXhwb3J0LCAubWRpLXNldHRpbmdzLCBtZGktcGx1cy1ib3gsIG1kaS1jaGFydC1iYXIiKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoIi50b29sdGlwIikuaGlkZSgpOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgc29ydEljb25IYW5kbGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0aEFycmF5ID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLmNvbHVtbnMoKS5oZWFkZXIoKTsKICAgICAgICBpZiAoaXNWaWV3SW5zdGFuY2UpIHsKICAgICAgICAgICAgdmFyIGNvbHVtbk5hbWU7CiAgICAgICAgICAgIHZhciBpbmRleE9mQ29sdW1uID0gMDsKICAgICAgICAgICAgY29sdW1uU2VxLmV2ZXJ5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZXEgPSBjb2x1bW5TZXFbaW5kZXhPZkNvbHVtbl0uc2VxOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IHNlcSkgewogICAgICAgICAgICAgICAgICAgIGNvbHVtbk5hbWUgPSBjb2x1bW5TZXFbaW5kZXhPZkNvbHVtbl0ubmFtZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbmRleE9mQ29sdW1uKys7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBjb2x1bW5JbmRleCA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5maW5kKCJ0aFtkYXRhLWZpZWxkPSIgKyBjb2x1bW5OYW1lICsgIl0iKS5hdHRyKCdkYXRhLWNvbHVtbi1pbmRleCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbHVtbkluZGV4ID0gaW5kZXg7CiAgICAgICAgfQogICAgICAgICQuZWFjaCh0aEFycmF5LCBmdW5jdGlvbiAoY3VycmVudEluZGV4LCBlbGVtZW50KSB7CiAgICAgICAgICAgIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19hc2MnKSkgewogICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nX2FzYycpOwogICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3NvcnRpbmdfZGVzYycpKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NvcnRpbmdfZGVzYycpOwogICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGN1cnJlbnRJbmRleCA9PSBjb2x1bW5JbmRleCAmJiAhZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ3NvcnRpbmdfZGlzYWJsZWQnKSkgewogICAgICAgICAgICAgICAgaWYgKGRpciA9PSAnYXNjJykgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc29ydGluZycpOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgic29ydGluZ19hc2MiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGlyID09ICdkZXNjJykgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc29ydGluZycpOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgic29ydGluZ19kZXNjIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgLyoqCiAgICAgKiBUaGUgcmVzZXQgbW9kYWwgc2NyZWVuIGZ1bmN0aW9uIHdoaWNoIHJlc2V0cyB0aGUgcGFzc3dvcmQgZGl2IGluIHRoZSB3b3JrZmxvdyBtb2RhbCBzY3JlZW4uCiAgICAgKiBUaGlzIGlzIGludGVybmFsIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBpbnRlcm5hbGx5IGluIHRoaXMgb2JqZWN0IHNjb3BlLgogICAgICovCiAgICB2YXIgcmVzZXRNb2RhbFNjcmVlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAvL0NsZWFuIHVwIHRoZSB0aGUgZGlzcG9zaXRpb25zIGZpZWxkcy4KICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNleHRyYS12YWx1ZS1zZWxlY3QnKS5odG1sKCI8b3B0aW9uPjwvb3B0aW9uPiIpOwogICAgICAgIC8vSGlkZSB0aGUgcGFzc3dvcmQKICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNwYXNzd29yZERpdicpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjaXNQYXNzd29yZEVuYWJsZWQnKS52YWwoMCk7CiAgICB9CgogICAgdmFyIHNob3dQYXNzd29yZEZpZWxkID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI3Bhc3N3b3JkRGl2JykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNpc1Bhc3N3b3JkRW5hYmxlZCcpLnZhbCgxKTsKICAgIH0KCiAgICB2YXIgY2hhbmdlV29ya2Zsb3dFZGl0U2NyZWVuID0gZnVuY3Rpb24gKGF2YWlsYWJsZVZhbHVlcywgdGFyZ2V0VmFsKSB7CgogICAgICAgIHZhciBhdmFpbGFibGVWYWxPYmogPSBfLmZpbmRXaGVyZShhdmFpbGFibGVWYWx1ZXMsIHt2YWx1ZTogdGFyZ2V0VmFsfSk7CgogICAgICAgIGlmICh0eXBlb2YgYXZhaWxhYmxlVmFsT2JqICE9ICd1bmRlZmluZWQnICYmIGF2YWlsYWJsZVZhbE9iaikgewogICAgICAgICAgICBpZiAoYXZhaWxhYmxlVmFsT2JqLmFwcHJvdmFsUmVxdWlyZWQpIHsKICAgICAgICAgICAgICAgIHNob3dQYXNzd29yZEZpZWxkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXNldE1vZGFsU2NyZWVuKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vQ2xlYW4gdXAgdGhlIHRoZSBkaXNwb3NpdGlvbnMgZmllbGRzCiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2V4dHJhLXZhbHVlLXNlbGVjdCcpLmh0bWwoJycpCgogICAgICAgICAgICAvL0ZpbGwgdXAgdGhlIGRpc3Bvc2l0aW9ucyBpbiB0aGUgY29tYm8KICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjZXh0cmEtdmFsdWUtc2VsZWN0JykuaHRtbChnZXREaXNwb3NpdGlvbk9wdGlvbnMoYXZhaWxhYmxlVmFsT2JqKSkKICAgICAgICB9CiAgICB9CgogICAgdmFyIGdldERpc3Bvc2l0aW9uT3B0aW9ucyA9IGZ1bmN0aW9uIChhdmFpbGFibGVWYWxPYmopIHsKICAgICAgICB2YXIgZGlzcG9zaXRpb25TdHIgPSAiPG9wdGlvbj48L29wdGlvbj4iOwogICAgICAgIF8uZWFjaChhdmFpbGFibGVWYWxPYmouZGlzcG9zaXRpb25zLCBmdW5jdGlvbiAoZGlzcG9zaXRpb24pIHsKICAgICAgICAgICAgZGlzcG9zaXRpb25TdHIgPSBkaXNwb3NpdGlvblN0ciArCiAgICAgICAgICAgICAgICAiPG9wdGlvbiB2YWx1ZT1cIiIgKyBkaXNwb3NpdGlvbi52YWx1ZSArICJcIj4iICsgZGlzcG9zaXRpb24uZGlzcGxheU5hbWUgKyAiPC9vcHRpb24+IgogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIGRpc3Bvc2l0aW9uU3RyCiAgICB9CgogICAgdmFyIGF1dGhlbnRpY2F0ZVVzZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHJldHVyblZhbCA9IGZhbHNlCiAgICAgICAgdmFyIHBhc3N3b3JkSnNvbiA9IHsKICAgICAgICAgICAgInBhc3N3b3JkIjogJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjcGFzc3dvcmRBdXRoZW50aWNhdGlvbicpLnZhbCgpCiAgICAgICAgfQoKICAgICAgICB2YXIgYXV0aFVybCA9ICcvc2lnbmFsL3VzZXIvYXV0aGVudGljYXRlJwoKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6IGF1dGhVcmwsCiAgICAgICAgICAgIGRhdGE6IHBhc3N3b3JkSnNvbiwKICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmF1dGhvcml6ZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSB0cnVlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm5WYWwgPSBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJldHVyblZhbAogICAgfQoKICAgIHZhciB0b2dnbGVFcnJvck5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICBpZiAoYWN0aW9uID09ICdoaWRlJykgewogICAgICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCAuZXJyb3JOb3RpZmljYXRpb24nKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJy5lcnJvck1lc3NhZ2UnKS5odG1sKCcnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCAuZXJyb3JOb3RpZmljYXRpb24nKS5yZW1vdmVDbGFzcygnaGlkZScpCiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnLmVycm9yTWVzc2FnZScpLmh0bWwoJyBBdXRoZW50aWNhdGlvbiBGYWlsZWQhJyk7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgb3BlbkNhc2VIaXN0b3J5TW9kYWwgPSBmdW5jdGlvbiAoKSB7CgogICAgICAgIC8vQmluZCB0aGUgY2xpY2sgZXZlbnQgb24gdGhlIGNhc2UgaGlzdG9yeSBpY29uLgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY2FzZS1oaXN0b3J5LWljb24nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICAgICAgaWYgKGlzQWJzdHJhY3RWaWV3T3JDYXNlVmlldyhzZWxlY3RlZFJvd0luZGV4KSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dJbmRleCA9IHNlbGVjdGVkUm93SW5kZXggLyAyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGlzU2lnbmFsID0gJCh0aGlzKS5kYXRhKCdzaWduYWwnKTsKCiAgICAgICAgICAgIHZhciByb3dPYmplY3QgPSB7fTsKICAgICAgICAgICAgaWYgKCFpc1NpZ25hbCkgewogICAgICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGUucm93cyhzZWxlY3RlZFJvd0luZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZVNpbmdsZVJldmlldy5yb3coJCh0aGlzKS5wYXJlbnRzKCd0cicpKS5kYXRhKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSByb3dPYmplY3QuY2FzZU51bWJlcjsKICAgICAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSByb3dPYmplY3QucHJvZHVjdEZhbWlseTsKICAgICAgICAgICAgdmFyIGNhc2VWZXJzaW9uID0gcm93T2JqZWN0LmNhc2VWZXJzaW9uOwogICAgICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3dPYmplY3QucHJvZHVjdE5hbWU7CiAgICAgICAgICAgIHZhciBwdCA9IHJvd09iamVjdC5wcmltYXJ5RXZlbnQ7CiAgICAgICAgICAgIHZhciBhbGVydENvbmZpZ0lkID0gcm93T2JqZWN0LmFsZXJ0Q29uZmlnSWQ7CgogICAgICAgICAgICB2YXIgY2FzZUhpc3RvcnlNb2RhbCA9ICQoJyNjYXNlSGlzdG9yeU1vZGFsJyk7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VOdW1iZXIiKS5odG1sKGNhc2VOdW1iZXIpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNwcm9kdWN0RmFtaWx5IikuaHRtbChwcm9kdWN0RmFtaWx5KTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjY2FzZVZlcnNpb24iKS52YWwoY2FzZVZlcnNpb24pOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNwcm9kdWN0TmFtZSIpLnZhbChwcm9kdWN0TmFtZSk7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2FsZXJ0Q29uZmlnSWQiKS52YWwoYWxlcnRDb25maWdJZCk7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3B0IikudmFsKHB0KTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5tb2RhbCgnc2hvdycpOwoKICAgICAgICAgICAgaWYodHlwZW9mIHNpbmdsZUNhc2VVcGRhdGVKdXN0aWZpY2F0aW9uVXJsICE9ICd1bmRlZmluZWQnKQogICAgICAgICAgICAgICAgdXBkYXRlSnVzdGlmaWNhdGlvblVybCA9IHNpbmdsZUNhc2VVcGRhdGVKdXN0aWZpY2F0aW9uVXJsOwoKICAgICAgICAgICAgc2lnbmFsLmNhc2VIaXN0b3J5VGFibGUuaW5pdF9jYXNlX2hpc3RvcnlfdGFibGUoY2FzZUhpc3RvcnlVcmwpOwogICAgICAgICAgICBzaWduYWwuY2FzZUhpc3RvcnlUYWJsZS5pbml0X2Nhc2VfaGlzdG9yeV90YWJsZV9zdXNwZWN0KGNhc2VIaXN0b3J5U3VzcGVjdFVybCk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuQWxlcnRDb21tZW50TW9kYWwgPSBmdW5jdGlvbiAoYWxlcnRUeXBlLCBhcHBsaWNhdGlvbk5hbWUpIHsKCiAgICAgICAgLy9Nb2RhbCBvYmplY3QKICAgICAgICB2YXIgY29tbWVudE1vZGFsID0gJCgnI2NvbW1lbnRNb2RhbCcpOwogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY29tbWVudC1pY29uJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHZhciBkYXRhSW5mbzsKICAgICAgICAgICAgdmFyIGlzQ2FzZURldGFpbDsKICAgICAgICAgICAgdmFyIGFwcFR5cGU7CiAgICAgICAgICAgIHZhciB2YWxpZGF0ZWRTaWduYWxJZDsKICAgICAgICAgICAgdmFyIGNvbW1lbnRBbGVydFR5cGUgPSAkKCR0aGlzKS5kYXRhKCduYW1lJyk7CiAgICAgICAgICAgIHZhciBpc1NpZ25hbCA9ICQoJHRoaXMpLmRhdGEoJ3NpZ25hbCcpOwoKICAgICAgICAgICAgaWYgKGNvbW1lbnRBbGVydFR5cGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgYWxlcnRUeXBlID0gY29tbWVudEFsZXJ0VHlwZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgY2FzZUpzb25BcnJheSA9IFtdOwogICAgICAgICAgICBkYXRhSW5mbyA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWluZm8nKTsKICAgICAgICAgICAgaXNDYXNlRGV0YWlsID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2RhdGEtY29tbWVudCcpOwoKICAgICAgICAgICAgYXBwVHlwZSA9ICQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoKTsKICAgICAgICAgICAgaWYgKGFwcFR5cGUgPT09ICcnKSB7CiAgICAgICAgICAgICAgICBhcHBUeXBlID0gY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIHZhbGlkYXRlZFNpZ25hbElkID0gY29tbWVudE1vZGFsLmZpbmQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dDb3VudDsKICAgICAgICAgICAgaWYgKCQoJyNkZXRhaWxlZC12aWV3LWNoZWNrYm94JykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93Q291bnQgPSAkKCd0YWJsZSNhbGVydHNEZXRhaWxzVGFibGUgLmNvcHktc2VsZWN0OmNoZWNrZWQnKS5sZW5ndGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0NvdW50ID0gJCgndGFibGUuRFRGQ19DbG9uZWQgLmNvcHktc2VsZWN0OmNoZWNrZWQnKS5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNlbGVjdGVkUm93Q291bnQgPiAxICYmICQoJHRoaXMpLmNsb3Nlc3QoJ3RyJykuZmluZCgiLmNvcHktc2VsZWN0IikucHJvcCgiY2hlY2tlZCIpKSB7CiAgICAgICAgICAgICAgICB2YXIgdGV4dFRvRGlzcGxheTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYXBwbGljYXRpb25OYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnU2luZ2xlIENhc2UgQWxlcnQnOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0VG9EaXNwbGF5ID0gJ0Nhc2UnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdBZ2dyZWdhdGUgQ2FzZSBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnUEVDJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnRVZEQVMgQWxlcnQnOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0VG9EaXNwbGF5ID0gJ1BFQyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFRvRGlzcGxheSA9ICdBcnRpY2xlJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkKGNvbW1lbnRNb2RhbCkuZmluZCgnZGl2LmJ1bGtPcHRpb25zU2VjdGlvbicpLnNob3coKTsKICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uIHNwYW4uYWxlcnRUeXBlVGV4dCcpLmh0bWwodGV4dFRvRGlzcGxheSk7CiAgICAgICAgICAgICAgICAkKGNvbW1lbnRNb2RhbCkuZmluZCgnZGl2LmJ1bGtPcHRpb25zU2VjdGlvbiBzcGFuLmNvdW50JykuaHRtbChzZWxlY3RlZFJvd0NvdW50KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uJykuaGlkZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uIGlucHV0W25hbWU9YnVsa09wdGlvbnNdJykudW5iaW5kKCkub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoJCh0aGlzKS52YWwoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2FsbFNlbGVjdGVkJzoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25BcnJheSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZVNpbmdsZUJ1bGtSb3dDb21tZW50UHJvY2VzcyhjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRBZGRDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uQXJyYXksICJidWxrIiwgYWxlcnRUeXBlLCB2YWxpZGF0ZWRTaWduYWxJZCwgaXNDYXNlRGV0YWlsKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY3VycmVudCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VKc29uQXJyYXkgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhdGVTaW5nbGVSb3dDb21tZW50UHJvY2VzcygkdGhpcywgY2FzZUpzb25BcnJheSwgY29tbWVudE1vZGFsLCBhbGVydFR5cGUsIGlzQ2FzZURldGFpbCwgaXNTaWduYWwpOwogICAgICAgICAgICAgICAgICAgICAgICBiaW5kQWRkQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbkFycmF5LCAicm93IiwgYWxlcnRUeXBlLCB2YWxpZGF0ZWRTaWduYWxJZCwgaXNDYXNlRGV0YWlsKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGRhdGFJbmZvID09PSAicm93IikgewogICAgICAgICAgICAgICAgaW5pdGlhdGVTaW5nbGVSb3dDb21tZW50UHJvY2VzcygkdGhpcywgY2FzZUpzb25BcnJheSwgY29tbWVudE1vZGFsLCBhbGVydFR5cGUsIGlzQ2FzZURldGFpbCwgaXNTaWduYWwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb21tZW50TW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgYmluZEFkZENvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgZGF0YUluZm8sIGFsZXJ0VHlwZSwgdmFsaWRhdGVkU2lnbmFsSWQsIGlzQ2FzZURldGFpbCwgJHRoaXMpCiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGJpbmRBZGRDb21tZW50cyA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwsIGNhc2VKc29uQXJyYXksIGRhdGFJbmZvLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwsIGN1cnJlbnRSb3cpIHsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmFkZC1jb21tZW50cyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGNhc2VKc29uOwogICAgICAgICAgICB2YXIgY2FzZUpzb25PYmo7CiAgICAgICAgICAgIHZhciBkYXRhOwogICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzOwogICAgICAgICAgICB2YXIgY2FzZUpzb25PYmpBcnJheSA9IFtdOwogICAgICAgICAgICBpZiAoZGF0YUluZm8gPT09ICJyb3ciKSB7CiAgICAgICAgICAgICAgICBjYXNlSnNvbiA9IGNhc2VKc29uQXJyYXlbMF07CgogICAgICAgICAgICAgICAgaWYgKGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYWxlcnRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAiY29tbWVudCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiaWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiB2YWxpZGF0ZWRTaWduYWxJZCwKICAgICAgICAgICAgICAgICAgICAgICAgInRvcGljSWQiOiAkKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjYXNlSnNvbi5leGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogY2FzZUpzb24uYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAiY29uZmlnSWQiOiBjYXNlSnNvbi5jb25maWdJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogY2FzZUpzb24ubGl0ZXJhdHVyZUFsZXJ0SWQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuY29tbWVudD09IiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L2RlbGV0ZUNvbW1lbnQiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3VwZGF0ZUNvbW1lbnQiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3NhdmVDb21tZW50IjsKCiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmogPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0TmFtZSI6IGNhc2VKc29uLnByb2R1Y3ROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAiZXZlbnROYW1lIjogY2FzZUpzb24uZXZlbnROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAicHQiOiBjYXNlSnNvbi5wdCwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbW1lbnRzIjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJjYXNlTnVtYmVyIjogY2FzZUpzb24uY2FzZU51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3RGYW1pbHkiOiBjYXNlSnNvbi5wcm9kdWN0RmFtaWx5LAogICAgICAgICAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiB2YWxpZGF0ZWRTaWduYWxJZCwKICAgICAgICAgICAgICAgICAgICAgICAgInRvcGljSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI3RvcGljSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJhc3NpZ25lZFRvIjogY2FzZUpzb24uYXNzaWduZWRUbywKICAgICAgICAgICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCI6IGNhc2VKc29uLmFkaG9jQWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjYXNlSnNvbi5leGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogY2FzZUpzb24ucHJvZHVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAicHRDb2RlIjogY2FzZUpzb24ucHRDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAiY29uZmlnSWQiOiBjYXNlSnNvbi5jb25maWdJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogY2FzZUpzb24ubGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcnRpY2xlSWQiOiBjYXNlSnNvbi5hcnRpY2xlSWQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2VKc29uT2JqQXJyYXkucHVzaChjYXNlSnNvbk9iaik7CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheTogSlNPTi5zdHJpbmdpZnkoY2FzZUpzb25PYmpBcnJheSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvc2F2ZUNvbW1lbnQiOwogICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93Q291bnQ7CiAgICAgICAgICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93Q291bnQgPSAkKCd0YWJsZSNhbGVydHNEZXRhaWxzVGFibGUgLmNvcHktc2VsZWN0OmNoZWNrZWQnKS5sZW5ndGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93Q291bnQgPSAkKCd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBzZWxlY3RlZFJvd0NvdW50OyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVkU2lnbmFsSWQgPSAkKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS5odG1sKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb24gPSBjYXNlSnNvbkFycmF5W2luZGV4XTsKCiAgICAgICAgICAgICAgICAgICAgLy9DYXNlIEpTT04uCiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmogPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0TmFtZSI6IGNhc2VKc29uLnByb2R1Y3ROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAiZXZlbnROYW1lIjogY2FzZUpzb24uZXZlbnROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAicHQiOiBjYXNlSnNvbi5wdCwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbW1lbnRzIjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJjYXNlTnVtYmVyIjogY2FzZUpzb24uY2FzZU51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3RGYW1pbHkiOiBjYXNlSnNvbi5wcm9kdWN0RmFtaWx5LAogICAgICAgICAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiB2YWxpZGF0ZWRTaWduYWxJZCwKICAgICAgICAgICAgICAgICAgICAgICAgInRvcGljSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI3RvcGljSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJhc3NpZ25lZFRvIjogY2FzZUpzb24uYXNzaWduZWRUbywKICAgICAgICAgICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCI6IGNhc2VKc29uLmFkaG9jQWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3RJZCI6IGNhc2VKc29uLnByb2R1Y3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgInB0Q29kZSI6IGNhc2VKc29uLnB0Q29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgImNvbmZpZ0lkIjogY2FzZUpzb24uY29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJsaXRlcmF0dXJlQWxlcnRJZCI6IGNhc2VKc29uLmxpdGVyYXR1cmVBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAiYXJ0aWNsZUlkIjogY2FzZUpzb24uYXJ0aWNsZUlkLAogICAgICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhc2VKc29uT2JqQXJyYXkucHVzaChjYXNlSnNvbk9iaikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheTogSlNPTi5zdHJpbmdpZnkoY2FzZUpzb25PYmpBcnJheSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9TYXZlIGNvbW1lbnQgY2FsbAogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCJpLmlzUHJvY2Vzc2luZyIpLnNob3coKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoImkuaXNQcm9jZXNzaW5nIikuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIC8vUG9wdWxhdGUgdGhlIGNvbW1lbnRzIGFnYWluIGlmIHNpbmdsZSBjb21tZW50IGlzIGFkZGVkLgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXNDYXNlRGV0YWlsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFJbmZvID09PSAicm93IikgewogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWxlcnRDb21tZW50cy5wb3B1bGF0ZV9jb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NvbW1lbnRib3gnKS52YWwoJycpLmJsdXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuY29tbWVudCAhPSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NvbW1lbnRJY29uKGN1cnJlbnRSb3cpIDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNvbW1lbnRJY29uKGN1cnJlbnRSb3cpIDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdtb2RhbC1vcGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb2RhbC1iYWNrZHJvcCcpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hlY2tib3hTZWxlY3RvcjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoJyNkZXRhaWxlZC12aWV3LWNoZWNrYm94JykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrYm94U2VsZWN0b3IgPSAndGFibGUjYWxlcnRzRGV0YWlsc1RhYmxlIC5jb3B5LXNlbGVjdDpjaGVja2VkJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrYm94U2VsZWN0b3IgPSAndGFibGUuRFRGQ19DbG9uZWQgLmNvcHktc2VsZWN0OmNoZWNrZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCgkKGNoZWNrYm94U2VsZWN0b3IpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Q29tbWVudEljb24odGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ3N1Y2Nlc3MnLCAndG9wIHJpZ2h0JywgIlN1Y2Nlc3MiLCAiQ29tbWVudHMgYWRkZWQgc3VjY2Vzc2Z1bGx5LiIsIHthdXRvSGlkZURlbGF5OiAxMDAwMH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzID0gZnVuY3Rpb24gKCR0aGlzLCBjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCkgewogICAgICAgIHZhciBhZGhvY0FsZXJ0SWQ7CiAgICAgICAgdmFyIGxpdGVyYXR1cmVBbGVydElkOwogICAgICAgIHZhciBhcnRpY2xlSWQ7CgogICAgICAgIHZhciByb3dPYmplY3QgPSB7fTsKICAgICAgICBpZiAoKGFsZXJ0VHlwZSA9PT0gJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdTaW5nbGUgQ2FzZSBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnRVZEQVMgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgJiYgIWlzU2lnbmFsKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0luZGV4ID0gJCgkdGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICBpZiAoaXNBYnN0cmFjdFZpZXdPckNhc2VWaWV3KHNlbGVjdGVkUm93SW5kZXgpKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAvIDIKICAgICAgICAgICAgfQogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZS5yb3coc2VsZWN0ZWRSb3dJbmRleCkuZGF0YSgpOwogICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnKSB7CiAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlQWdnUmV2aWV3LnJvdygkKCR0aGlzKS5wYXJlbnRzKCd0cicpKS5kYXRhKCk7CiAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09ICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCcpIHsKICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVMaXRlcmF0dXJlUmV2aWV3LnJvdygkKCR0aGlzKS5wYXJlbnRzKCd0cicpKS5kYXRhKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVTaW5nbGVSZXZpZXcucm93KCQoJHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICB9CgogICAgICAgIHZhciBjYXNlTnVtYmVyID0gcm93T2JqZWN0LmNhc2VOdW1iZXI7CiAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSByb3dPYmplY3QucHJvZHVjdEZhbWlseTsKICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSByb3dPYmplY3QuY2FzZVZlcnNpb247CiAgICAgICAgdmFyIHByb2R1Y3ROYW1lID0gcm93T2JqZWN0LnByb2R1Y3ROYW1lOwogICAgICAgIHZhciBldmVudE5hbWUgPSByb3dPYmplY3QucHJlZmVycmVkVGVybTsKICAgICAgICB2YXIgcHQgPSByb3dPYmplY3QucHQ7CiAgICAgICAgdmFyIGFzc2lnbmVkVG8gPSByb3dPYmplY3QuYXNzaWduZWRUby5pZDsKICAgICAgICB2YXIgYXNzaWduZWRUb1VzZXIgPSBudWxsOwogICAgICAgICBpZihyb3dPYmplY3QuYXNzaWduZWRUb1VzZXIgIT0gdW5kZWZpbmVkKQogICAgICAgICAgICAgYXNzaWduZWRUb1VzZXIgPSByb3dPYmplY3QuYXNzaWduZWRUb1VzZXIuaWQ7CiAgICAgICAgdmFyIHByb2R1Y3RJZCA9IHJvd09iamVjdC5wcm9kdWN0SWQ7CiAgICAgICAgdmFyIHB0Q29kZSA9IHJvd09iamVjdC5wdENvZGU7CiAgICAgICAgdmFyIGNvbmZpZ0lkID0gcm93T2JqZWN0LmFsZXJ0Q29uZmlnSWQ7CiAgICAgICAgdmFyIGV4ZWN1dGVkQ29uZmlnSWQgPSByb3dPYmplY3QuZXhlY0NvbmZpZ0lkOwoKICAgICAgICBpZiAoYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuQURIT0NfQUxFUlQpIHsKICAgICAgICAgICAgYWRob2NBbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuTElURVJBVFVSRV9TRUFSQ0hfQUxFUlQpIHsKICAgICAgICAgICAgbGl0ZXJhdHVyZUFsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIGFydGljbGVJZCA9IHJvd09iamVjdC5hcnRpY2xlSWQKICAgICAgICB9CiAgICAgICAgdmFyIGNhc2VKc29uID0gewogICAgICAgICAgICAiYWxlcnRUeXBlIjogYWxlcnRUeXBlLAogICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IHByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICJjYXNlTnVtYmVyIjogY2FzZU51bWJlciwKICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogcHJvZHVjdE5hbWUsCiAgICAgICAgICAgICJldmVudE5hbWUiOiBldmVudE5hbWUsCiAgICAgICAgICAgICJwdCI6IHB0LAogICAgICAgICAgICAicHRDb2RlIjogcHRDb2RlLAogICAgICAgICAgICAicHJvZHVjdElkIjogcHJvZHVjdElkLAogICAgICAgICAgICAiYXNzaWduZWRUbyI6IGFzc2lnbmVkVG8gPyBhc3NpZ25lZFRvIDogYXNzaWduZWRUb1VzZXIsCiAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogZXhlY3V0ZWRDb25maWdJZCwKICAgICAgICAgICAgImNvbmZpZ0lkIjogY29uZmlnSWQsCiAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiOiBhZGhvY0FsZXJ0SWQsCiAgICAgICAgICAgICJsaXRlcmF0dXJlQWxlcnRJZCI6IGxpdGVyYXR1cmVBbGVydElkLAogICAgICAgICAgICAiYXJ0aWNsZUlkIjogYXJ0aWNsZUlkCiAgICAgICAgfTsKCiAgICAgICAgY2FzZUpzb25BcnJheS5wdXNoKGNhc2VKc29uKTsKICAgICAgICB2YXIgY29tbWVudE1ldGFJbmZvID0gIiI7CgogICAgICAgIGlmIChjYXNlSnNvbi5hbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5BR0dSRUdBVEVfQUxFUlQgfHwgY2FzZUpzb24uYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuRVZEQVNfQUxFUlQpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiAoY2FzZUpzb24uZXZlbnROYW1lKSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIChjYXNlSnNvbi5wcm9kdWN0TmFtZSkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAiIgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gJzxzcGFuIGlkPSJwcm9kdWN0TmFtZSI+JyArIGNhc2VKc29uLnByb2R1Y3ROYW1lICsgJzwvc3Bhbj4gLSA8c3BhbiBpZD0iZXZlbnROYW1lIj4nICsgY2FzZUpzb24uZXZlbnROYW1lICsgJzwvc3Bhbj4nICsgJzxzcGFuIGNsYXNzPSJoaWRkZW4iIGlkPSJwcm9kdWN0SWQiPicgKyBjYXNlSnNvbi5wcm9kdWN0SWQgKyAnPC9zcGFuPicgKwogICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0iaGlkZGVuIiBpZD0icHRDb2RlIj4nICsgY2FzZUpzb24ucHRDb2RlICsgJzwvc3Bhbj4nCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodHlwZW9mIChjYXNlSnNvbi5jYXNlTnVtYmVyKSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIChjYXNlSnNvbi5wcm9kdWN0RmFtaWx5KSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICIiCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAnPHNwYW4gaWQ9ImNhc2VOdW1iZXIiPicgKyBjYXNlSnNvbi5jYXNlTnVtYmVyICsgJzwvc3Bhbj4gLSA8c3BhbiBpZD0icHJvZHVjdEZhbWlseSI+JyArIGNhc2VKc29uLnByb2R1Y3RGYW1pbHkgKyAnPC9zcGFuPicKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnQtbWV0YS1pbmZvIikuaHRtbChjb21tZW50TWV0YUluZm8pOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjYXNzaWduZWRUbyIpLmh0bWwoYXNzaWduZWRUbyk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb25maWdJZCIpLmh0bWwoY29uZmlnSWQpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjYXBwbGljYXRpb24iKS5odG1sKGNhc2VKc29uLmFsZXJ0VHlwZSk7CgogICAgICAgIC8vUG9wdWxhdGUgdGhlIGV4aXN0aW5nIGNvbW1lbnRzIGFuZCBiaW5kIGV2ZW50cyB0byB0aGVtIGluIGNhc2Ugb2Ygc2luZ2xlIGNvbW1lbnQuCiAgICAgICAgaWYgKHR5cGVvZiBpc0Nhc2VEZXRhaWwgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICQoJyNsb2FkaW5nQ29tbWVudHMnKS5odG1sKCcnKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNpZ25hbC5hbGVydENvbW1lbnRzLnBvcHVsYXRlX2NvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgIH0KICAgICAgICAkKCIjY29tbWVudE1vZGFsIikub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgnI2NvbW1lbnRib3gnKS52YWwoJycpOwogICAgICAgICAgICAkKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgnQWRkJyk7CiAgICAgICAgICAgICQoIi5jcmVhdGVkQnkiKS50ZXh0KCcnKTsKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgaW5pdGlhdGVTaW5nbGVCdWxrUm93Q29tbWVudFByb2Nlc3MgPSBmdW5jdGlvbiAoY2FzZUpzb25BcnJheSwgY29tbWVudE1vZGFsLCBhbGVydFR5cGUsIGlzQ2FzZURldGFpbCwgaXNTaWduYWwpIHsKICAgICAgICB2YXIgaW5kZXhTZXQgPSBuZXcgU2V0KCk7CiAgICAgICAgdmFyIGNoZWNrYm94U2VsZWN0b3I7CiAgICAgICAgaWYgKCQoJyNkZXRhaWxlZC12aWV3LWNoZWNrYm94JykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZSNhbGVydHNEZXRhaWxzVGFibGUgLmNvcHktc2VsZWN0OmNoZWNrZWQnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoZWNrYm94U2VsZWN0b3IgPSAndGFibGUuRFRGQ19DbG9uZWQgLmNvcHktc2VsZWN0OmNoZWNrZWQnOwogICAgICAgIH0KICAgICAgICAkLmVhY2goJChjaGVja2JveFNlbGVjdG9yKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICBpZiAoaXNBYnN0cmFjdFZpZXdPckNhc2VWaWV3KHNlbGVjdGVkUm93SW5kZXgpKQogICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dJbmRleCA9IHNlbGVjdGVkUm93SW5kZXggLyAyOwogICAgICAgICAgICBpbmRleFNldC5hZGQoKHNlbGVjdGVkUm93SW5kZXgpKTsKICAgICAgICB9KTsKICAgICAgICBpbmRleFNldC5mb3JFYWNoKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgICB2YXIgYWRob2NBbGVydElkOwogICAgICAgICAgICB2YXIgbGl0ZXJhdHVyZUFsZXJ0SWQ7CiAgICAgICAgICAgIHZhciBhcnRpY2xlSWQ7CiAgICAgICAgICAgIHZhciByb3dPYmplY3QgPSB7fTsKICAgICAgICAgICAgaWYgKChhbGVydFR5cGUgPT09ICdBZ2dyZWdhdGUgQ2FzZSBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnU2luZ2xlIENhc2UgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ0VWREFTIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCcpICYmICFpc1NpZ25hbCkgewogICAgICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGUucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFsZXJ0VHlwZSA9PT0gJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JykgewogICAgICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVBZ2dSZXZpZXcucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVTaW5nbGVSZXZpZXcucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHJvd09iamVjdC5jYXNlTnVtYmVyOwogICAgICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHJvd09iamVjdC5wcm9kdWN0RmFtaWx5OwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSByb3dPYmplY3QuY2FzZVZlcnNpb247CiAgICAgICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHJvd09iamVjdC5wcm9kdWN0TmFtZTsKICAgICAgICAgICAgdmFyIGV2ZW50TmFtZSA9IHJvd09iamVjdC5wcmVmZXJyZWRUZXJtOwogICAgICAgICAgICB2YXIgcHQgPSByb3dPYmplY3QucHQ7CiAgICAgICAgICAgIHZhciBhc3NpZ25lZFRvID0gcm93T2JqZWN0LmFzc2lnbmVkVG8uaWQ7CiAgICAgICAgICAgIHZhciBwcm9kdWN0SWQgPSByb3dPYmplY3QucHJvZHVjdElkOwogICAgICAgICAgICB2YXIgcHRDb2RlID0gcm93T2JqZWN0LnB0Q29kZTsKICAgICAgICAgICAgdmFyIGNvbmZpZ0lkID0gcm93T2JqZWN0LmFsZXJ0Q29uZmlnSWQ7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gcm93T2JqZWN0LmV4ZWNDb25maWdJZDsKCiAgICAgICAgICAgIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5BREhPQ19BTEVSVCkgewogICAgICAgICAgICAgICAgYWRob2NBbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICB9IGVsc2UgaWYgKGFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkxJVEVSQVRVUkVfU0VBUkNIX0FMRVJUKSB7CiAgICAgICAgICAgICAgICBsaXRlcmF0dXJlQWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgICAgIGFydGljbGVJZCA9IHJvd09iamVjdC5hcnRpY2xlSWQKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY2FzZUpzb24gPSB7CiAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYWxlcnRUeXBlLAogICAgICAgICAgICAgICAgInByb2R1Y3RGYW1pbHkiOiBwcm9kdWN0RmFtaWx5LAogICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogcHJvZHVjdE5hbWUsCiAgICAgICAgICAgICAgICAiZXZlbnROYW1lIjogZXZlbnROYW1lLAogICAgICAgICAgICAgICAgInB0IjogcHQsCiAgICAgICAgICAgICAgICAicHRDb2RlIjogcHRDb2RlLAogICAgICAgICAgICAgICAgInByb2R1Y3RJZCI6IHByb2R1Y3RJZCwKICAgICAgICAgICAgICAgICJhc3NpZ25lZFRvIjogYXNzaWduZWRUbywKICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogZXhlY3V0ZWRDb25maWdJZCwKICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNvbmZpZ0lkLAogICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCI6IGFkaG9jQWxlcnRJZCwKICAgICAgICAgICAgICAgICJsaXRlcmF0dXJlQWxlcnRJZCI6IGxpdGVyYXR1cmVBbGVydElkLAogICAgICAgICAgICAgICAgImFydGljbGVJZCI6IGFydGljbGVJZAogICAgICAgICAgICB9OwogICAgICAgICAgICBjYXNlSnNvbkFycmF5LnB1c2goY2FzZUpzb24pCiAgICAgICAgfSk7CgogICAgICAgIC8vU2V0IHZhbHVlcyB0byB0aGUgbW9kYWwgZWxlbWVudHMuCiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNsb2FkaW5nQ29tbWVudHMiKS5oaWRlKCk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50LW1ldGEtaW5mbyIpLmh0bWwoIiIpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5odG1sKCIiKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCcnKTsKICAgICAgICBpZiAoY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCkgIT0gJ1VwZGF0ZScpIHsKICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCJBZGQiKTsKICAgICAgICB9CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5vbigia2V5dXAiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS52YWwoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciByZXN0YXJ0UmV2aWV3ID0gZnVuY3Rpb24gKGNhc2VSZXZpZXdQcmV2aW91c1VybCkgewoKICAgICAgICAvL0V2ZW50IHdoZW4gcmV2aWV3IHJlc3RhcnQgaXMgY2xpY2tlZC4KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNhc2UtcmVzdGFydC1yZXZpZXcnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZU51bWJlciJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgZm9sbG93VXBOdW1iZXIgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iZm9sbG93VXBOdW1iZXIiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGNhc2VWZXJzaW9uID0gcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImNhc2VWZXJzaW9uIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBwcm9kdWN0RmFtaWx5ID0gcGFyZW50X3Jvdy5maW5kKCdpbnB1dFtkYXRhLWZpZWxkPSJwcm9kdWN0RmFtaWx5Il0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBmb2xsb3dVcE1vZGFsID0gJCgnI2ZvbGxvd1VwTW9kYWwnKTsKICAgICAgICAgICAgZm9sbG93VXBNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICBmb2xsb3dVcE1vZGFsLmZpbmQoIi5wcmV2aW91cy1mb2xsb3dVcCIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBnZXRQcmV2aW91c1N0YXRlID0gY2FzZVJldmlld1ByZXZpb3VzVXJsICsgIj9jYXNlTnVtYmVyPSIgKyBjYXNlTnVtYmVyICsKICAgICAgICAgICAgICAgICAgICAiJmNhc2VWZXJzaW9uPSIgKyBjYXNlVmVyc2lvbiArICImcHJvZHVjdEZhbWlseT0iICsgcHJvZHVjdEZhbWlseSArICImZm9sbG93VXBOdW1iZXI9IiArIGZvbGxvd1VwTnVtYmVyOwogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IGdldFByZXZpb3VzU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0id29ya2Zsb3dTdGF0ZSJdJykudGV4dChyZXN1bHQucHJldmlvdXNTdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJkaXNwb3NpdGlvbiJdJykudGV4dChyZXN1bHQucHJldmlvdXNEaXNwb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJpbmZvLXNpZ24iXScpLmFkZENsYXNzKCJoaWRkZW4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9sbG93VXBNb2RhbC5tb2RhbCgnZGVzdHJveScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuU2ltaWxhckNhc2VzTW9kYWwgPSBmdW5jdGlvbiAoY2FzZUluZm9VcmwpIHsKCiAgICAgICAgLy9FdmVudCB0cmlnZ2VyZWQgd2hlbiBzaW1pbGFyIGNhc2VzIGNvdW50IGlzIGNsaWNrZWQuCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zaW1pbGFyLWNhc2VzJywgZnVuY3Rpb24gKGV2ZW50KSB7CgogICAgICAgICAgICB2YXIgc2ltaWxhckNhc2VNb2RhbCA9ICQoJyNzaW1pbGFyQ2FzZU1vZGFsJyk7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCJ0ciIpOwoKICAgICAgICAgICAgLy9GZXRjaCB0aGUgdmFsdWVzIG9mIHRoZSBldmVudC4KICAgICAgICAgICAgdmFyIGV2ZW50VmFsID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2RhdGEtZXZlbnQtdmFsJyk7CiAgICAgICAgICAgIHZhciBldmVudFR5cGUgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1maWVsZCcpOwogICAgICAgICAgICB2YXIgZXhlY3V0ZWRDb25maWdJZCA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBwdCA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCJkYXRhLXB0Iik7CiAgICAgICAgICAgIHZhciBldmVudENvZGU7CiAgICAgICAgICAgIGlmIChldmVudFR5cGUpIHsKICAgICAgICAgICAgICAgIGV2ZW50Q29kZSA9IChldmVudFR5cGUuc3BsaXQoIl9jb2RlIilbMF0pOwogICAgICAgICAgICAgICAgZXZlbnRUeXBlID0gZXZlbnRUeXBlLnNwbGl0KCJfIilbMl07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjYXNlTnVtYmVyID0gcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImNhc2VOdW1iZXIiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGNhc2VWZXJzaW9uID0gcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImNhc2VWZXJzaW9uIl0nKS5hdHRyKCJkYXRhLWlkIik7CgogICAgICAgICAgICAvL1Nob3cgbW9kYWwgYW5kIHNldCBpdHMgdmFsdWVzLgogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2V2ZW50VHlwZSIpLmh0bWwoZXZlbnRUeXBlKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRWYWwiKS5odG1sKGV2ZW50VmFsKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjY2FzZU51bWJlckluZm8iKS52YWwoY2FzZU51bWJlcik7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2V4ZWN1dGVkQ29uZmlnSWQiKS52YWwoZXhlY3V0ZWRDb25maWdJZCk7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2Nhc2VDdXJyZW50VmVyc2lvbiIpLnZhbChjYXNlVmVyc2lvbik7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2V2ZW50Q29kZSIpLnZhbChldmVudENvZGUpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNldmVudENvZGVWYWwiKS52YWwoZXZlbnRWYWwpOwogICAgICAgICAgICAvL01ha2UgdGhlIG1vZGFsIHRhYmxlIGFzIGRhdGF0YWJsZQoKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzaWduYWwuc2ltaWxhckNhc2VUYWJsZS5pbml0X3NpbWlsYXJfY2FzZV90YWJsZShjYXNlSW5mb1VybCkKICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5BdHRhY2htZW50TW9kYWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zaG93LWF0dGFjaG1lbnQtaWNvbicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICB2YXIgJHRoaXMgPSB0aGlzOwogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHBhcmVudF9yb3cuZmluZCgnYVtkYXRhLWZpZWxkPSJhdHRhY2htZW50Il0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBjYXNlQ29udHJvbGxlciA9IHBhcmVudF9yb3cuZmluZCgnYVtkYXRhLWZpZWxkPSJhdHRhY2htZW50Il0nKS5hdHRyKCJkYXRhLWNvbnRyb2xsZXIiKTsKICAgICAgICAgICAgdmFyIHVybCA9ICIvc2lnbmFsLyIgKyBjYXNlQ29udHJvbGxlciArICIvdXBsb2FkIjsKICAgICAgICAgICAgdmFyIGdldEF0dGFjaG1lbnRVcmwgPSAiL3NpZ25hbC8iICsgY2FzZUNvbnRyb2xsZXIgKyAiL2ZldGNoQXR0YWNobWVudD9hbGVydElkPSIgKyBhbGVydElkOwogICAgICAgICAgICAkKCcjc2hvd0F0dGFjaG1lbnRNb2RhbCAjYXR0YWNobWVudEZvcm0gI2F0dGFjaG1lbnRGb3JtSWQnKS5hdHRyKCd2YWx1ZScsIGFsZXJ0SWQpOwogICAgICAgICAgICB2YXIgY2FzZUhpc3RvcnlNb2RhbCA9ICQoJyNzaG93QXR0YWNobWVudE1vZGFsJyk7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgJCgiI3Nob3dBdHRhY2htZW50TW9kYWwgZm9ybSNhdHRhY2htZW50Rm9ybSIpLnVuYmluZCgnc3VibWl0Jykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSh0aGlzKTsKICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZmluZCgnLmF0dGFjaG1lbnQtZmlsZScpLnZhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCgiLnVwbG9hZCIpLmF0dHIoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCgnLmF0dGFjaG1lbnQtZmlsZScpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93QXR0YWNobWVudEljb24ocGFyZW50X3Jvdyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2hvd0F0dGFjaG1lbnRNb2RhbCAjYXR0YWNobWVudC10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCIudXBsb2FkIikuYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzRGF0YTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50LXRhYmxlJykuRGF0YVRhYmxlKHsKICAgICAgICAgICAgICAgIGRlc3Ryb3k6IHRydWUsCiAgICAgICAgICAgICAgICBzZWFyY2hpbmc6IGZhbHNlLAogICAgICAgICAgICAgICAgc1BhZ2luYXRpb25UeXBlOiAiYm9vdHN0cmFwIiwKICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IGZhbHNlLAogICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHsKICAgICAgICAgICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6IGdldEF0dGFjaG1lbnRVcmwsCiAgICAgICAgICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZuRHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLnJlbW92ZS1hdHRhY2htZW50JykuY2xpY2soZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dGFjaG1lbnRSb3cgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0YWNobWVudElkID0gYXR0YWNobWVudFJvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9InJlbW92ZUF0dGFjaG1lbnQiXScpLmF0dHIoImRhdGEtYXR0YWNobWVudElkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZW1vdmVVcmwgPSAnL3NpZ25hbC8nICsgY2FzZUNvbnRyb2xsZXIgKyAnL2RlbGV0ZUF0dGFjaG1lbnQ/YXR0YWNobWVudElkPScgKyBhdHRhY2htZW50SWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHJlbW92ZVVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHthbGVydElkOiBhbGVydElkfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkKCcucmVtb3ZlLWF0dGFjaG1lbnQnKS5sZW5ndGggPT09MSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQXR0YWNobWVudEljb24oJHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50LXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnZXJyb3InLCAndG9wIHJpZ2h0JywgIkVycm9yIiwgIkFsbCBzZWxlY3RlZCBzYWZldHkgb2JzZXJ2YXRpb25zIG11c3QgYmUgaW4gc2FtZSBkaXNwb3NpdGlvbiBmb3IgcGVyZm9ybWluZyB0aGUgYnVsayB1cGRhdGUuIiwge2F1dG9IaWRlRGVsYXk6IDEwMDAwfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iL3NpZ25hbC9hdHRhY2htZW50YWJsZS9kb3dubG9hZD9pZD0nICsgcm93LmlkICsgJyI+JyArIGVzY2FwZUhUTUwocm93Lm5hbWUpICsgJzwvYT4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY2VsbC1icmVhaycsCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAidGltZVN0YW1wIgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIm1vZGlmaWVkQnkiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gdGFiaW5kZXg9IjAiIHRpdGxlPSJSZW1vdmUgQXR0YWNobWVudCIgIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXIiIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLXJlbW92ZSByZW1vdmUtYXR0YWNobWVudCIgZGF0YS1maWVsZD0icmVtb3ZlQXR0YWNobWVudCIgZGF0YS1hdHRhY2htZW50SWQ9JyArIHJvdy5pZCArICc+PC9zcGFuPicKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYkxlbmd0aENoYW5nZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICAgICAicmVuZGVyIjogJC5mbi5kYXRhVGFibGUucmVuZGVyLnRleHQoKQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzID0gZnVuY3Rpb24gKGZpbHRlcnNEYXRhLCBwcmVmaXgsIGlkKSB7CiAgICAgICAgLy9BZGQgZmlsdGVycyB0byB0aGUgZGF0YSB0YWJsZS4KICAgICAgICB2YXIgZGF0YVRhYmxlc19sZW5ndGggPSAkKCcuZGF0YVRhYmxlc19sZW5ndGgnKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5hZGRDbGFzcygnY29sLXNtLTEyJyk7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCkucmVtb3ZlQ2xhc3MoImNvbC14cy0yIik7CiAgICAgICAgYXBwbGljYXRpb25OYW1lID09IEFMRVJUX0NPTkZJR19UWVBFLkFESE9DX0FMRVJUID8gZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5hZGRDbGFzcygiY29sLXhzLTkiKSA6IGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgiOm5vdCgnLmRhdGFUYWJsZXNfd3JhcHBlcicpIikuYWRkQ2xhc3MoImNvbC14cy0xMCIpOwogICAgICAgIGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgiOm5vdCgnLmRhdGFUYWJsZXNfd3JhcHBlcicpIikubmV4dCgpLnJlbW92ZUNsYXNzKCJjb2wteHMtMTAiKTsKICAgICAgICBhcHBsaWNhdGlvbk5hbWUgPT0gQUxFUlRfQ09ORklHX1RZUEUuQURIT0NfQUxFUlQgPyBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoIjpub3QoJy5kYXRhVGFibGVzX3dyYXBwZXInKSIpLm5leHQoKS5hZGRDbGFzcygiY29sLXhzLTMiKSA6IGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgiOm5vdCgnLmRhdGFUYWJsZXNfd3JhcHBlcicpIikubmV4dCgpLmFkZENsYXNzKCJjb2wteHMtMiIpOwogICAgICAgIGRhdGFUYWJsZXNfbGVuZ3RoLmZpbmQoImxhYmVsIikuYWRkQ2xhc3MoJ2NvbC14cy0yJyk7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGguZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBkdEJ1dHRvbnMgPSAnPGRpdiBjbGFzcz0iZGF0YVRhYmxlLXRvcC1kaXNwb3NpdGlvbiBjb2wteHMtMTAiPic7CiAgICAgICAgICAgICQuZWFjaChmaWx0ZXJzRGF0YSwgZnVuY3Rpb24gKGluZGV4LCBvYmopIHsKICAgICAgICAgICAgICAgIGlmIChvYmouY2xvc2VkIHx8IG9iai5pc0Nsb3NlZCkgewogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGRpdiBjbGFzcz0iY2hlY2tib3ggY2hlY2tib3gtcHJpbWFyeSBjaGVja2JveC1pbmxpbmUgbS1sLTMgY2hlY2tib3gtcG9zLWFicyI+JzsKICAgICAgICAgICAgICAgICAgICBkdEJ1dHRvbnMgKz0gJzxpbnB1dCBpZD0iZmlsdGVyJyArIGluZGV4ICsgJyIgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJkeW5hbWljLWZpbHRlcnMiIG5hbWU9InJlbGF0ZWRSZXN1bHRzIiBkYXRhLWNsb3NlZD0iJyArIG9iai5pc0Nsb3NlZCArICciIHZhbHVlPSInICsgb2JqLnZhbHVlICsgJyIgLz4gPGxhYmVsIGNsYXNzPSJtLXItMzAiICBmb3I9ImZpbHRlcicgKyBpbmRleCArICciPicgKyBvYmoudmFsdWUgKyAnPC9sYWJlbD48L2Rpdj4nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGRpdiBjbGFzcz0iY2hlY2tib3ggY2hlY2tib3gtcHJpbWFyeSBjaGVja2JveC1pbmxpbmUgbS1sLTMgY2hlY2tib3gtcG9zLWFicyI+JzsKICAgICAgICAgICAgICAgICAgICBkdEJ1dHRvbnMgKz0gJzxpbnB1dCBpZD0iZmlsdGVyJyArIGluZGV4ICsgJyIgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJkeW5hbWljLWZpbHRlcnMiIG5hbWU9InJlbGF0ZWRSZXN1bHRzIiBkYXRhLWNsb3NlZD0iJyArIG9iai5pc0Nsb3NlZCArICciIGNoZWNrZWQ9ImNoZWNrZWQiIHZhbHVlPSInICsgb2JqLnZhbHVlICsgJyIgLz4gPGxhYmVsIGNsYXNzPSJtLXItMzAiIGZvcj0iZmlsdGVyJyArIGluZGV4ICsgJyI+JyArIG9iai52YWx1ZSArICc8L2xhYmVsPjwvZGl2PicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPC9kaXY+JzsKICAgICAgICAgICAgZHRCdXR0b25zID0gZHRCdXR0b25zICsgJzwvZGl2Pic7CiAgICAgICAgICAgIGlmICh0aGlzLmlkICE9PSAnYXJjaGl2ZWRBbGVydHNUYWJsZV9sZW5ndGgnICYmIHRoaXMuaWQgIT09ICdhY3Rpdml0aWVzVGFibGVfbGVuZ3RoJykKICAgICAgICAgICAgICAgICQodGhpcykuYXBwZW5kKGR0QnV0dG9ucyk7CiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZHluYW1pYy1maWx0ZXJzJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGFsZXJ0RGV0YWlsc1RhYmxlOwogICAgICAgICAgICAgICAgdmFyIGZyZXFTZWxlY3RlZCA9ICIiOwogICAgICAgICAgICAgICAgaWYgKCQoIiNmcmVxdWVuY3lOYW1lcyIpKSB7CiAgICAgICAgICAgICAgICAgICAgZnJlcVNlbGVjdGVkID0gJCgiI2ZyZXF1ZW5jeU5hbWVzIikudmFsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyQXJyYXkgPSBbXTsKICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJWYWx1ZXMgPSBbXTsKICAgICAgICAgICAgICAgICQoJy5keW5hbWljLWZpbHRlcnMnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclZhbHVlcy5wdXNoKCQodGhpcykudmFsKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmaWx0ZXJBcnJheS5wdXNoKCQodGhpcykuaXMoJzpjaGVja2VkJykpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHByZWZpeCArICJmaWx0ZXJzX3N0b3JlIiwgSlNPTi5zdHJpbmdpZnkoZmlsdGVyQXJyYXkpKTsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfdmFsdWUiLCBKU09OLnN0cmluZ2lmeShmaWx0ZXJWYWx1ZXMpKTsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0ocHJlZml4ICsgImlkIiwgaWQpOwogICAgICAgICAgICAgICAgdmFyIHVybDsKICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbk5hbWUgPT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0RGV0YWlsc1RhYmxlID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpOwogICAgICAgICAgICAgICAgICAgIHVybCA9IGxpc3RDb25maWdVcmwgKyAiP2ZpbHRlcnM9IiArIGZpbHRlclZhbHVlcy5qb2luKCIsIikKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnREZXRhaWxzVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gbGlzdENvbmZpZ1VybCArICImZnJlcXVlbmN5PSIgKyBmcmVxU2VsZWN0ZWQgKyAiJmlzRmlsdGVyUmVxdWVzdD10cnVlJmZpbHRlcnM9IiArIEpTT04uc3RyaW5naWZ5KGZpbHRlclZhbHVlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhbGVydERldGFpbHNUYWJsZS5hamF4LnVybCh1cmwpLmxvYWQoKQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICB9OwoKICAgIHZhciBpc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZSA9IGZ1bmN0aW9uIChwcmVmaXgpIHsKICAgICAgICB2YXIgYyA9IHNpZ25hbC51dGlscy5nZXRRdWVyeVN0cmluZygiY29uZmlnSWQiKTsKICAgICAgICByZXR1cm4gYyA/IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocHJlZml4ICsgImlkIikgPT0gYyA6IGZhbHNlCiAgICB9OwoKICAgIHZhciByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiKTsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKHByZWZpeCArICJmaWx0ZXJzX3ZhbHVlIik7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShwcmVmaXggKyAiaWQiKTsKICAgIH07CgogICAgdmFyIG9wZW5TYXZlVmlld01vZGFsID0gZnVuY3Rpb24gKGZpbHRlckluZGV4LCBhcHBsaWNhdGlvbk5hbWUsIHZpZXdJZCkgewogICAgICAgIHZhciBzeXN0ZW1EZWZhdWx0ID0gWyJTeXN0ZW0gVmlldyJdOwogICAgICAgIHZhciB2aWV3SW5mbzsKCiAgICAgICAgLy9zYXZpbmcgbmV3IHZpZXcKICAgICAgICAkKCIuc2F2ZVZpZXciKS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgJCgnLnNhdmVWaWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2aWV3SW5mbyA9IGdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwoKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19maWx0ZXJzJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLmZpbHRlck1hcCkpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2NvbHVtbkxpc3QnKS52YWwodmlld0luZm8ubm90VmlzaWJsZUNvbHVtbik7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWxlcnRUeXBlJykudmFsKGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfc29ydGluZycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hZHZhbmNlZF9maWx0ZXInKS52YWwodmlld0luZm8uYWR2YW5jZWRGaWx0ZXIpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICNjdXJyZW50X3ZpZXdfaWQnKS52YWwodmlld0lkKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuc2F2ZV9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsJykubW9kYWwoJ3Nob3cnKTsKICAgICAgICB9KQoKICAgICAgICAvL3VwZGF0aW5nIGV4aXN0aW5nIHZpZXcKICAgICAgICAkKCIudXBkYXRlVmlldyIpLnVuYmluZCgnY2xpY2snKTsKICAgICAgICAkKCcudXBkYXRlVmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmlld0luZm8gPSBnZW5lcmF0ZVZpZXdJbmZvKGZpbHRlckluZGV4KTsKICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSwgc3lzdGVtRGVmYXVsdCkgIT0gLTEpIHsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfZmlsdGVycycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5maWx0ZXJNYXApKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfY29sdW1uTGlzdCcpLnZhbCh2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWxlcnRUeXBlJykudmFsKGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X3NvcnRpbmcnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uc29ydGVkQ29sdW1uKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICNjdXJyZW50X3ZpZXdfaWQnKS52YWwodmlld0lkKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgLnNhdmVfYnV0dG9ucycpLnNob3coKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgT2JqZWN0KCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0WyduYW1lJ10gPSAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RbJ2ZpbHRlck1hcCddID0gSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RbJ2NvbHVtbkxpc3QnXSA9IHZpZXdJbmZvLm5vdFZpc2libGVDb2x1bW4udG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RbJ2FsZXJ0VHlwZSddID0gYXBwbGljYXRpb25OYW1lOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnaWQnXSA9ICQoJy52aWV3U2VsZWN0JykudmFsKCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0Wydzb3J0aW5nJ10gPSBKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnYWR2YW5jZWRGaWx0ZXInXSA9IHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyOwogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IHVwZGF0ZVZpZXdVcmwsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlcXVlc3QsCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZVVSTCA9ICQobG9jYXRpb24pLmF0dHIoImhyZWYiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigidmlld0lkIikgIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHBhZ2VVUkwuc2xpY2UoMCwgcGFnZVVSTC5pbmRleE9mKCJ2aWV3SWQiKSArIDcpICsgZGF0YS52aWV3SWQKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYWdlVVJMLmluZGV4T2YoIiMiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VVUkwgPSBwYWdlVVJMLnNsaWNlKDAsIHBhZ2VVUkwuaW5kZXhPZigiIyIpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcGFnZVVSTCArICImdmlld0lkPSIgKyBkYXRhLnZpZXdJZAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuZXJyb3JNZXNzYWdlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dFcnJvck5vdGlmaWNhdGlvbihkYXRhLmVycm9yTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vc2VsZWN0aW5nIGFub3RoZXIgdmlldwogICAgICAgICQoJy52aWV3U2VsZWN0JykudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy52aWV3U2VsZWN0Jykub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHBhZ2VVUkwgPSAkKGxvY2F0aW9uKS5hdHRyKCJocmVmIik7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFZpZXcgPSAkKCcudmlld1NlbGVjdCcpLnZhbCgpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdpc1ZpZXdDYWxsJywgJ3RydWUnKTsKICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigidmlld0lkIikgIT0gLTEpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcGFnZVVSTC5zbGljZSgwLCBwYWdlVVJMLmluZGV4T2YoInZpZXdJZCIpICsgNykgKyBzZWxlY3RlZFZpZXcKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChwYWdlVVJMLmluZGV4T2YoIiMiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgIHBhZ2VVUkwgPSBwYWdlVVJMLnNsaWNlKDAsIHBhZ2VVUkwuaW5kZXhPZigiIyIpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBwYWdlVVJMICsgIiZ2aWV3SWQ9IiArIHNlbGVjdGVkVmlldwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vZGVsZXRpbmcgb3IgZWRpdGluZyBzZWxlY3RlZCB2aWV3CiAgICAgICAgJCgnLmVkaXRWaWV3JykudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy5lZGl0VmlldycpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmlld0luZm8gPSBnZW5lcmF0ZVZpZXdJbmZvKGZpbHRlckluZGV4KTsKCiAgICAgICAgICAgIGlmICgkLmluQXJyYXkoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCksIHN5c3RlbURlZmF1bHQpID09IC0xKSB7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X25hbWUnKS52YWwoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2RlZmF1bHQnKS5wcm9wKCdjaGVja2VkJywgKCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5pbmRleE9mKCIoZGVmYXVsdCkiKSAhPSAtMSkpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19pZCcpLnZhbCgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS52YWwoKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2ZpbHRlcnMnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2NvbHVtbkxpc3QnKS52YWwodmlld0luZm8ubm90VmlzaWJsZUNvbHVtbik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X3NvcnRpbmcnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uc29ydGVkQ29sdW1uKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FsZXJ0VHlwZScpLnZhbChhcHBsaWNhdGlvbk5hbWUpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuZWRpdF9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCcjYWxlcnQtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgZ2VuZXJhdGVWaWV3SW5mbyA9IGZ1bmN0aW9uIChmaWx0ZXJJbmRleCkgewogICAgICAgIHZhciBvVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CgogICAgICAgIC8vZ2VuZXJhdGUgZmlsdGVyIHZhbHVlIG1hcAogICAgICAgIHZhciBmaWx0ZXJNYXAgPSBuZXcgT2JqZWN0KCk7CiAgICAgICAgJC5lYWNoKGZpbHRlckluZGV4LCBmdW5jdGlvbiAoaWR4LCBvYmopIHsKICAgICAgICAgICAgdmFyIGZpbHRlclZhbCA9IHlhZGNmLmV4R2V0Q29sdW1uRmlsdGVyVmFsKG9UYWJsZSwgb2JqKTsKICAgICAgICAgICAgaWYgKGZpbHRlclZhbCkgewogICAgICAgICAgICAgICAgZmlsdGVyTWFwW29ial0gPSBmaWx0ZXJWYWwKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvL2dlbmVyYXRlIGNvbHVtbnMgdmlzaWJsZSBsaXN0CiAgICAgICAgdmFyIG5vdFZpc2libGVDb2x1bW4gPSAkKCcjY29sdW1uSW5kZXgnKS52YWwoKTsKCiAgICAgICAgLy9nZW5lcmF0ZSBzb3J0aW5nIGNvbHVtbiBpbmZvCiAgICAgICAgdmFyIHNvcnRlZENvbHVtbiA9IG5ldyBPYmplY3QoKTsKICAgICAgICBpZiAoJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmRhdGFUYWJsZSgpLmZuU2V0dGluZ3MoKS5hYVNvcnRpbmdbMF0pIHsKICAgICAgICAgICAgdmFyIHNvcnRlZENvbCA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5kYXRhVGFibGUoKS5mblNldHRpbmdzKCkuYWFTb3J0aW5nWzBdWzBdOwogICAgICAgICAgICB2YXIgY29sdW1uTmFtZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5maW5kKCJ0aCIpLmVxKHNvcnRlZENvbCkuYXR0cigiZGF0YS1maWVsZCIpOwogICAgICAgICAgICB2YXIgaW5kZXggPSAwOwogICAgICAgICAgICBjb2x1bW5TZXEuZXZlcnkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlcU5hbWUgPSBjb2x1bW5TZXFbaW5kZXhdLm5hbWU7CiAgICAgICAgICAgICAgICBpZiAoY29sdW1uTmFtZSA9PSBzZXFOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgc29ydGVkQ29sID0gY29sdW1uU2VxW2luZGV4XS5zZXE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5kZXgrKzsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIHNvcnRlZERpciA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5kYXRhVGFibGUoKS5mblNldHRpbmdzKCkuYWFTb3J0aW5nWzBdWzFdOwogICAgICAgICAgICBzb3J0ZWRDb2x1bW5bc29ydGVkQ29sXSA9IHNvcnRlZERpcjsKICAgICAgICB9CgogICAgICAgIC8vZ2VuZXJhdGUgYWR2YW5jZWQgZmlsdGVyIGluZm8KICAgICAgICB2YXIgYWR2YW5jZWRGaXRlcklkID0gJCgnLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93bicpLnZhbCgpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdmaWx0ZXJNYXAnOiBmaWx0ZXJNYXAsCiAgICAgICAgICAgICdub3RWaXNpYmxlQ29sdW1uJzogbm90VmlzaWJsZUNvbHVtbiwKICAgICAgICAgICAgJ3NvcnRlZENvbHVtbic6IHNvcnRlZENvbHVtbiwKICAgICAgICAgICAgJ2FkdmFuY2VkRmlsdGVyJzogYWR2YW5jZWRGaXRlcklkCiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgY3JlYXRlU29ydGluZ01hcCA9IGZ1bmN0aW9uIChpbmZvS2V5LCB2aWV3TmFtZSkgewogICAgICAgIHZhciBzb3J0aW5nTWFwID0gW107CiAgICAgICAgdmFyIHNvcnRpbmcgPSB7fTsKICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsKSB7CiAgICAgICAgICAgIHNvcnRpbmcgPSAkLnBhcnNlSlNPTihzZXNzaW9uU3RvcmVkVmFsKTsKICAgICAgICB9IGVsc2UgaWYgKCQoIiNzb3J0ZWRDb2x1bW4iKS52YWwoKSAhPSAiIiAmJiAkKCIjc29ydGVkQ29sdW1uIikudmFsKCkgIT0gInt9IiAmJiBjYWxsaW5nU2NyZWVuID09ICdyZXZpZXcnKSB7CiAgICAgICAgICAgIHNvcnRpbmcgPSAkLnBhcnNlSlNPTigkKCcjc29ydGVkQ29sdW1uJykudmFsKCkpOwogICAgICAgIH0KICAgICAgICAkLmVhY2goc29ydGluZywgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgc29ydGluZ01hcC5wdXNoKFtwYXJzZUludChrZXkpLCB2YWx1ZV0pCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHNvcnRpbmdNYXAKICAgIH07CgogICAgdmFyIGNyZWF0ZUZpbHRlck1hcCA9IGZ1bmN0aW9uIChpbmZvS2V5LCB2aWV3TmFtZSkgewogICAgICAgIHZhciBmaWx0ZXJzVmFsdWUgPSBbXTsKICAgICAgICB2YXIgZmlsdGVyTWFwID0ge307CiAgICAgICAgdmFyIHNlc3Npb25TdG9yZWRWYWw7CiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0odmlld05hbWUpID09ICQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpKSB7CiAgICAgICAgICAgIHNlc3Npb25TdG9yZWRWYWwgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGluZm9LZXkpOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvblN0b3JlZFZhbCAmJiBzZXNzaW9uU3RvcmVkVmFsICE9IHt9KSB7CiAgICAgICAgICAgIGZpbHRlck1hcCA9ICQucGFyc2VKU09OKHNlc3Npb25TdG9yZWRWYWwpOwogICAgICAgIH0gZWxzZSBpZiAoJCgnI2ZpbHRlck1hcCcpLnZhbCgpICE9ICIiICYmICQoJyNmaWx0ZXJNYXAnKS52YWwoKSAhPSAie30iKSB7CiAgICAgICAgICAgIGZpbHRlck1hcCA9ICQucGFyc2VKU09OKCQoJyNmaWx0ZXJNYXAnKS52YWwoKSk7CiAgICAgICAgfQogICAgICAgICQuZWFjaChmaWx0ZXJNYXAsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHZhciBmaWx0ZXJBcnIgPSBbcGFyc2VJbnQoa2V5KSwgdmFsdWVdOwogICAgICAgICAgICBmaWx0ZXJzVmFsdWUucHVzaChmaWx0ZXJBcnIpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZpbHRlcnNWYWx1ZQogICAgfTsKCiAgICB2YXIgY3JlYXRlTGlzdE9mSW5kZXggPSBmdW5jdGlvbiAoaW5mb0tleSwgaXNFdmRhcywgdmlld05hbWUpIHsKICAgICAgICB2YXIgbG9pID0gW107CiAgICAgICAgdmFyIGNvbHVtbkluZGV4ID0gW10KICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChjYWxsaW5nU2NyZWVuID09ICdyZXZpZXcnKSB7CiAgICAgICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsKSB7CiAgICAgICAgICAgICAgICBjb2x1bW5JbmRleCA9IHNlc3Npb25TdG9yZWRWYWwuc3BsaXQoJywnKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29sdW1uSW5kZXggPSAkKCcjY29sdW1uSW5kZXgnKS52YWwoKS5zcGxpdCgnLCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZWFjaChjb2x1bW5JbmRleCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGlzRXZkYXMpIHsKICAgICAgICAgICAgICAgICAgICBsb2kucHVzaChwYXJzZUludCh0aGlzKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbG9pLnB1c2gocGFyc2VJbnQodGhpcykgKyAxKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxvaQogICAgfTsKCiAgICB2YXIgc2V0U29ydE9yZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoIiNhbGVydHNEZXRhaWxzVGFibGVSb3ciKS5vbignbW91c2Vkb3duJywgJ3RoJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpbmRleCA9ICQodGhpcykuYXR0cigiZGF0YS1jb2x1bW4taW5kZXgiKTsKICAgICAgICAgICAgZGlyID0gJ2FzYyc7CiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdzb3J0aW5nX2FzYycpKSB7CiAgICAgICAgICAgICAgICBkaXIgPSAnZGVzYycKICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdzb3J0aW5nX2Rlc2MnKSkgewogICAgICAgICAgICAgICAgZGlyID0gJ2FzYycKICAgICAgICAgICAgfQogICAgICAgICAgICBpc1ZpZXdJbnN0YW5jZSA9IDA7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuQWxlcnRUYWdNb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmVkaXRBbGVydFRhZ3MnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0gdGFibGUucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgdmFyIGV4ZWNDb25maWdJZCA9IHBhcmVudF9yb3cuZmluZCgnLmV4ZWNDb25maWdJZCcpLmF0dHIoInZhbHVlIik7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IGZldGNoVGFnc1VybCwKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhbGVydFRhZ01vZGFsT2JqID0gJCgnI2FsZXJ0VGFnTW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS5zZWxlY3QyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICJBZGQgQ2F0ZWdvcmllcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQudGFnTGlzdAoKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykudmFsKHJlc3VsdC5hbGVydFRhZ0xpc3QpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgiLmFkZFRhZ3MiKS51bmJpbmQoKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHNhdmVUYWdVcmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdzOiBKU09OLnN0cmluZ2lmeShhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRJZDogYWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGVjQ29uZmlnSWQ6IGV4ZWNDb25maWdJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuYWpheC5yZWxvYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBvcGVuU2luZ2xlQWxlcnRUYWdNb2RhbCA9IGZ1bmN0aW9uICh0YWJsZU9iaiwgdGFnc09iaikgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZWRpdEFsZXJ0VGFncycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgaW5kZXggPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICAgICAgaWYgKGlzQWJzdHJhY3RWaWV3T3JDYXNlVmlldyhpbmRleCkpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggLyAyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHRhYmxlT2JqLnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIHZhciBleGVjQ29uZmlnSWQgPSBwYXJlbnRfcm93LmZpbmQoJy5leGVjQ29uZmlnSWQnKS5hdHRyKCJ2YWx1ZSIpOwogICAgICAgICAgICB2YXIgYWxlcnRUYWdNb2RhbE9iaiA9ICQoJyNhbGVydFRhZ01vZGFsJyk7CiAgICAgICAgICAgIHZhciAkc2luZ2xlQ2FzZUFsZXJ0VGFncyA9IGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpOwogICAgICAgICAgICB2YXIgJGdsb2JhbFRhZ3MgPSBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNnbG9iYWxUYWdzJyk7CiAgICAgICAgICAgIGFwcGx5U2VsZWN0MkZvclRhZ3MoJHNpbmdsZUNhc2VBbGVydFRhZ3MsIGZldGNoVGFnc1VybCwgJ0Nhc2UgU2VyaWVzIENhdGVnb3JpZXMnLCB0cnVlKTsKICAgICAgICAgICAgYXBwbHlTZWxlY3QyRm9yVGFncygkZ2xvYmFsVGFncywgZmV0Y2hUYWdzVXJsLCAnR2xvYmFsIENhdGVnb3JpZXMnLCBmYWxzZSk7CiAgICAgICAgICAgICRzaW5nbGVDYXNlQWxlcnRUYWdzLmZpbmQoJ29wdGlvbicpLnJlbW92ZSgpCiAgICAgICAgICAgICRnbG9iYWxUYWdzLmZpbmQoJ29wdGlvbicpLnJlbW92ZSgpCiAgICAgICAgICAgICRzaW5nbGVDYXNlQWxlcnRUYWdzLnZhbChudWxsKS50cmlnZ2VyKCJjaGFuZ2UiKTsKICAgICAgICAgICAgJGdsb2JhbFRhZ3MudmFsKG51bGwpLnRyaWdnZXIoImNoYW5nZSIpOwogICAgICAgICAgICAkLmVhY2gocm93T2JqZWN0LmNhc2VTZXJpZXNUYWdzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0gbmV3IE9wdGlvbih2YWx1ZSwgdmFsdWUsIHRydWUsIHRydWUpOwogICAgICAgICAgICAgICAgJHNpbmdsZUNhc2VBbGVydFRhZ3MuYXBwZW5kKG9wdGlvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkLmVhY2gocm93T2JqZWN0Lmdsb2JhbFRhZ3MsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKHZhbHVlLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAkZ2xvYmFsVGFncy5hcHBlbmQob3B0aW9uKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNnbG9iYWxUYWdzJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgIHZhciBlbmFibGVDYXNlU2VyaWVzVGFncyA9IHJvd09iamVjdC5pc0Nhc2VTZXJpZXNHZW5lcmF0ZWQ7CiAgICAgICAgICAgIGlmICghZW5hYmxlQ2FzZVNlcmllc1RhZ3MpIHsKICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLmF0dHIoJ2Rpc2FibGVkJywgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmoubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCIuYWRkVGFncyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBzYXZlVGFnVXJsLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdzOiBKU09OLnN0cmluZ2lmeShhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbFRhZ3M6IEpTT04uc3RyaW5naWZ5KGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI2dsb2JhbFRhZ3MnKS52YWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRDYXNlU2VyaWVzVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5kZWxldGVkQ2FzZVNlcmllc1RhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkR2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5kZWxldGVkR2xvYmFsVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkQ2FzZVNlcmllc1RhZ3M6IEpTT04uc3RyaW5naWZ5KHRhZ3NPYmouYWRkZWRDYXNlU2VyaWVzVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZGVkR2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5hZGRlZEdsb2JhbFRhZ3MpLAogICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICBleGVjQ29uZmlnSWQ6IGV4ZWNDb25maWdJZAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocGF5bG9hZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5bG9hZC5zdGF0dXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlT2JqLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ3N1Y2Nlc3MnLCAndG9wIHJpZ2h0JywgIlN1Y2Nlc3MiLCBwYXlsb2FkLm1lc3NhZ2UsIHthdXRvSGlkZURlbGF5OiAyMDAwfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ2Vycm9yJywgJ3RvcCByaWdodCcsICJFcnJvciIsIHBheWxvYWQubWVzc2FnZSwge2F1dG9IaWRlRGVsYXk6IDIwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2luZ2xlLWNhc2UtYWxlcnQtc3Bpbm5lcicpLmFkZENsYXNzKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICQoJyNzaW5nbGUtY2FzZS1hbGVydC1zcGlubmVyJykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIHBvcHVsYXRlQWR2YW5jZWRGaWx0ZXJTZWxlY3QgPSBmdW5jdGlvbiAoYWxlcnRUeXBlKSB7CgogICAgICAgICQoIi5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24iKS5zZWxlY3QyKHsKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICQuaTE4bi5fKCdzZWxlY3RPbmUnKSwKICAgICAgICAgICAgYWxsb3dDbGVhcjogdHJ1ZSwKICAgICAgICAgICAgYWpheDogewogICAgICAgICAgICAgICAgdXJsOiBmZXRjaEFkdkZpbHRlclVybCwKICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsCiAgICAgICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgIHF1aWV0TWlsbGlzOiA1MCwKICAgICAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydFR5cGU6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGVybTogcGFyYW1zLnRlcm0gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhcmFtcy5wYWdlIHx8IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heDogcGFyYW1zLm1heCB8fCAzMAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcHJvY2Vzc1Jlc3VsdHM6IGZ1bmN0aW9uIChkYXRhLCBwYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbXMucGFnZSA9IHBhcmFtcy5wYWdlIHx8IDE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogJC5tYXAoZGF0YS5saXN0LCBmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGZpbHRlci5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmaWx0ZXIuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vcmU6IChwYXJhbXMucGFnZSAqIDMwKSA8IGRhdGEudG90YWxDb3VudAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvL3NlbGVjdCBhZHZhbmNlZCBmaWx0ZXIgYmFzZWQgb24gY3VycmVudCB2aWV3CiAgICAgICAgaWYgKCQoJyNhZHZhbmNlZEZpbHRlclZpZXcnKS52YWwoKSkgewogICAgICAgICAgICB2YXIgYWR2YW5jZWRGaWx0ZXJWaWV3ID0gJC5wYXJzZUpTT04oJCgnI2FkdmFuY2VkRmlsdGVyVmlldycpLnZhbCgpKTsKICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oYWR2YW5jZWRGaWx0ZXJWaWV3Lm5hbWUsIGFkdmFuY2VkRmlsdGVyVmlldy5pZCwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICQoIi5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24iKS5hcHBlbmQob3B0aW9uKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICB9CgogICAgICAgICQoJyNhZGRBZHZhbmNlZEZpbHRlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2lnbmFsLmFkdmFuY2VkRmlsdGVyLmluaXRpYWxpemVBZHZhbmNlZEZpbHRlcnMoJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwnKSk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNzZWxlY3RPcGVyYXRvcicpLmVtcHR5KCkuYXBwZW5kKCc8b3B0aW9uIHNlbGVjdGVkPSJzZWxlY3RlZCIgdmFsdWU9IiI+U2VsZWN0IE9wZXJhdG9yPC9vcHRpb24+Jyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNuYW1lJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2Rlc2NyaXB0aW9uJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3F1ZXJ5SlNPTicpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNhbGVydFR5cGUnKS52YWwoJycpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjYnVpbGRlckFsbCcpLmZpbmQoJy5leHByZXNzaW9uJykucmVtb3ZlKCk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsIC5kZWxldGVBZHZGaWx0ZXInKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZmlsdGVyc1dpdGhvdXRTYXZpbmcnKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpLm1vZGFsKCdzaG93Jyk7CgogICAgICAgIH0pOwoKICAgICAgICAkKCcjZWRpdEFkdmFuY2VkRmlsdGVyJykudW5iaW5kKCkub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgYWR2YW5jZWRGaWx0ZXJJZCA9ICQoJy5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24nKS52YWwoKTsKICAgICAgICAgICAgaWYgKGFkdmFuY2VkRmlsdGVySWQpIHsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdXJsOiBmZXRjaEFkdmFuY2VkRmlsdGVySW5mb1VybCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7J2FkdmFuY2VkRmlsdGVyLmlkJzogYWR2YW5jZWRGaWx0ZXJJZH0sCiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiR0VUIiwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNzZWxlY3RPcGVyYXRvcicpLmVtcHR5KCkuYXBwZW5kKCc8b3B0aW9uIHNlbGVjdGVkPSJzZWxlY3RlZCIgdmFsdWU9IiI+U2VsZWN0IE9wZXJhdG9yPC9vcHRpb24+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNuYW1lJykudmFsKHJlc3VsdC5uYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2Rlc2NyaXB0aW9uJykudmFsKHJlc3VsdC5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNxdWVyeUpTT04nKS52YWwocmVzdWx0LkpTT05RdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNhbGVydFR5cGUnKS52YWwoYWxlcnRUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2ZpbHRlcklkJykudmFsKGFkdmFuY2VkRmlsdGVySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZmlsdGVyc1dpdGhvdXRTYXZpbmcnKS5hZGRDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAuZGVsZXRlQWR2RmlsdGVyJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgLm1vZGFsLXRpdGxlJykuaHRtbCgiRWRpdCBGaWx0ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFkdmFuY2VkRmlsdGVyLmluaXRpYWxpemVBZHZhbmNlZEZpbHRlcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgICQoIi5hZHZhbmNlZC1maWx0ZXItZHJvcGRvd24iKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdGFibGUuYWpheC5yZWxvYWQoKQogICAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIG9wZW5BbGVydENvbW1lbnRNb2RhbDogb3BlbkFsZXJ0Q29tbWVudE1vZGFsLAogICAgICAgIG9wZW5DYXNlSGlzdG9yeU1vZGFsOiBvcGVuQ2FzZUhpc3RvcnlNb2RhbCwKICAgICAgICByZXN0YXJ0UmV2aWV3OiByZXN0YXJ0UmV2aWV3LAogICAgICAgIG9wZW5TaW1pbGFyQ2FzZXNNb2RhbDogb3BlblNpbWlsYXJDYXNlc01vZGFsLAogICAgICAgIGFwcGx5QnVzaW5lc3NSdWxlczogYXBwbHlCdXNpbmVzc1J1bGVzLAogICAgICAgIHNob3dBdHRhY2htZW50TW9kYWw6IG9wZW5BdHRhY2htZW50TW9kYWwsCiAgICAgICAgYmluZEdyaWREeW5hbWljRmlsdGVyczogYmluZEdyaWREeW5hbWljRmlsdGVycywKICAgICAgICBlbmFibGVNZW51VG9vbHRpcHM6IGVuYWJsZU1lbnVUb29sdGlwcywKICAgICAgICBkaXNhYmxlVG9vbHRpcHM6IGRpc2FibGVUb29sdGlwcywKICAgICAgICBzb3J0SWNvbkhhbmRsZXI6IHNvcnRJY29uSGFuZGxlciwKICAgICAgICBpc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZTogaXNBbGVydFBlcnNpc3RlZEluU2Vzc2lvblN0b3JhZ2UsCiAgICAgICAgcmVtb3ZlRmlsdGVyc0Zyb21TZXNzaW9uU3RvcmFnZTogcmVtb3ZlRmlsdGVyc0Zyb21TZXNzaW9uU3RvcmFnZSwKICAgICAgICBvcGVuU2F2ZVZpZXdNb2RhbDogb3BlblNhdmVWaWV3TW9kYWwsCiAgICAgICAgY3JlYXRlU29ydGluZ01hcDogY3JlYXRlU29ydGluZ01hcCwKICAgICAgICBjcmVhdGVGaWx0ZXJNYXA6IGNyZWF0ZUZpbHRlck1hcCwKICAgICAgICBjcmVhdGVMaXN0T2ZJbmRleDogY3JlYXRlTGlzdE9mSW5kZXgsCiAgICAgICAgb3BlbkFsZXJ0VGFnTW9kYWw6IG9wZW5BbGVydFRhZ01vZGFsLAogICAgICAgIHNldFNvcnRPcmRlcjogc2V0U29ydE9yZGVyLAogICAgICAgIG9wZW5TaW5nbGVBbGVydFRhZ01vZGFsOiBvcGVuU2luZ2xlQWxlcnRUYWdNb2RhbCwKICAgICAgICBnZW5lcmF0ZVZpZXdJbmZvOiBnZW5lcmF0ZVZpZXdJbmZvLAogICAgICAgIHBvcHVsYXRlQWR2YW5jZWRGaWx0ZXJTZWxlY3Q6IHBvcHVsYXRlQWR2YW5jZWRGaWx0ZXJTZWxlY3QKICAgIH0KCn0pKCk7CgpmdW5jdGlvbiBzaG93RXJyb3JNZXNzYWdlSW5Nb2RhbCgkbW9kYWwsIHRleHQpIHsKICAgIGNsZWFyX2Vycm9ycygpOwogICAgaWYgKHRleHQpIHsKICAgICAgICB0ZXh0ID0gdGV4dDsKICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dCA9ICdQbGVhc2UgZmlsbCAgdGhlIHJlcXVpcmVkIEZpZWxkcyc7CiAgICB9CiAgICB2YXIgYWxlcnRIdG1sID0gZ2V0RXJyb3JNZXNzYWdlSHRtbCh0ZXh0KTsKICAgICRtb2RhbC5maW5kKCcubW9kYWwtYm9keScpLnByZXBlbmQoYWxlcnRIdG1sKTsKfQoKZnVuY3Rpb24gZ2V0RXJyb3JNZXNzYWdlSHRtbChtc2cpIHsKICAgIHZhciBhbGVydEh0bWwgPSAnPGRpdiBjbGFzcz0iYWxlcnQgYWxlcnQtZGFuZ2VyIGFsZXJ0LWRpc21pc3NpYmxlIiByb2xlPSJhbGVydCI+ICcgKwogICAgICAgICc8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImNsb3NlIiBkYXRhLWRpc21pc3M9ImFsZXJ0Ij4gJyArCiAgICAgICAgJzxzcGFuIGFyaWEtaGlkZGVuPSJ0cnVlIj4mdGltZXM7PC9zcGFuPiAnICsKICAgICAgICAnPHNwYW4gY2xhc3M9InNyLW9ubHkiPjxnOm1lc3NhZ2UgY29kZT0iZGVmYXVsdC5idXR0b24uY2xvc2UubGFiZWwiIC8+PC9zcGFuPiAnICsKICAgICAgICAnPC9idXR0b24+ICcgKyBtc2c7CiAgICAnPC9kaXY+JzsKICAgIHJldHVybiBhbGVydEh0bWw7Cn0KCnZhciBjbGVhcl9lcnJvcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAkKCcubW9kYWwgLm1vZGFsLWJvZHkgLmFsZXJ0JykucmVtb3ZlKCk7Cn07CgpmdW5jdGlvbiBzZWFyY2gobmFtZUtleSwgbXlBcnJheSkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBteUFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKG15QXJyYXlbaV0ubmFtZSA9PT0gbmFtZUtleSkgewogICAgICAgICAgICByZXR1cm4gbXlBcnJheVtpXTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIHBvcHVsYXRlVG9waWNEZXRhaWwoJG1vZGFsLCB0b3BpY09iaikgewogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS52YWwodG9waWNPYmouc3RhcnREYXRlKTsKICAgICRtb2RhbC5maW5kKCcjZW5kRGF0ZScpLnZhbCh0b3BpY09iai5lbmREYXRlKTsKICAgICRtb2RhbC5maW5kKCcucHJvZHVjdC1zcGFuJykudGV4dChnZXRQcm9kdWN0TmFtZUxpc3QoSlNPTi5wYXJzZSh0b3BpY09iai5wcm9kdWN0cykpKTsKICAgICRtb2RhbC5maW5kKCcjc3RhcnREYXRlJykuYXR0cigiZGlzYWJsZWQiLCAiIik7CiAgICAkbW9kYWwuZmluZCgnI2VuZERhdGUnKS5hdHRyKCJkaXNhYmxlZCIsICIiKTsKICAgIGlmICh0b3BpY09iai5wcm9kdWN0cykgewogICAgICAgICRtb2RhbC5maW5kKCcjcHJvZHVjdCcpLmF0dHIoImRpc2FibGVkIiwgIiIpOwogICAgfQp9CgpmdW5jdGlvbiBkZXBvcHVsYXRlVG9waWNEZXRhaWwoJG1vZGFsKSB7CiAgICB2YXIgcHJvZHVjdEpzb24gPSAkbW9kYWwuZmluZCgnLnByb2R1Y3QtanNvbi1jb250YWluZXInKS52YWwoKTsKICAgICRtb2RhbC5maW5kKCcjc3RhcnREYXRlJykudmFsKCIiKTsKICAgICRtb2RhbC5maW5kKCcjZW5kRGF0ZScpLnZhbCgiIik7CiAgICAkbW9kYWwuZmluZCgnI3Byb2R1Y3QnKS52YWwoIiIpOwogICAgJG1vZGFsLmZpbmQoJy5wcm9kdWN0LXNwYW4nKS50ZXh0KGdldFByb2R1Y3ROYW1lTGlzdChKU09OLnBhcnNlKHByb2R1Y3RKc29uKSkpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKICAgICRtb2RhbC5maW5kKCcjcHJvZHVjdCcpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlUHJvZHVjdEpzb24ocHJvZHVjdElkLCBwcm9kdWN0TmFtZSwgbGV2ZWwpIHsKICAgIHZhciB0b3BpY1Byb2R1Y3RWYWx1ZXMgPSB7IjEiOiBbXSwgIjIiOiBbXSwgIjMiOiBbXSwgIjQiOiBbXSwgIjUiOiBbXX07CiAgICB0b3BpY1Byb2R1Y3RWYWx1ZXNbbGV2ZWxdLnB1c2goe25hbWU6IHByb2R1Y3ROYW1lLCBpZDogcHJvZHVjdElkfSk7CiAgICByZXR1cm4gdG9waWNQcm9kdWN0VmFsdWVzOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0TmFtZUxpc3Qob2JqKSB7CiAgICB2YXIgcHJvZHVjdEFycmF5ID0gW107CiAgICB2YXIgb2JqQXJyYXkgPSBvYmpbJzMnXTsKICAgICQuZWFjaChvYmpBcnJheSwgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkgewogICAgICAgIHByb2R1Y3RBcnJheS5wdXNoKHZhbHVlLm5hbWUpOwogICAgfSk7CiAgICByZXR1cm4gcHJvZHVjdEFycmF5LmpvaW4oJywnKTsKfQoKZnVuY3Rpb24gZ2V0UHJvZHVjdEpzb24oYXBwbGljYXRpb25OYW1lLCByb3cpIHsKICAgIHZhciBwcm9kdWN0SnNvbjsKICAgIGlmIChhcHBsaWNhdGlvbk5hbWUgPT0gIkFkLUhvYyBBbGVydCIpIHsKICAgICAgICBpZiAocm93LmZpbmQoJy5yb3ctcHJvZHVjdC1qc29uLWNvbnRhaW5lcicpLnZhbCgpKQogICAgICAgICAgICBwcm9kdWN0SnNvbiA9IEpTT04ucGFyc2Uocm93LmZpbmQoJy5yb3ctcHJvZHVjdC1qc29uLWNvbnRhaW5lcicpLnZhbCgpKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHByb2R1Y3ROYW1lID0gcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0icHJvZHVjdE5hbWUiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICB2YXIgcHJvZHVjdElkID0gcm93LmZpbmQoJy5yb3ctcHJvZHVjdC1pZCcpLnZhbCgpOwogICAgICAgIHZhciBsZXZlbCA9IHJvdy5maW5kKCcucm93LWxldmVsLWlkJykudmFsKCk7CiAgICAgICAgaWYgKCFsZXZlbCkgewogICAgICAgICAgICBsZXZlbCA9IDM7CiAgICAgICAgfQogICAgICAgIHByb2R1Y3RKc29uID0gZ2VuZXJhdGVQcm9kdWN0SnNvbihwcm9kdWN0SWQsIHByb2R1Y3ROYW1lLCBsZXZlbCk7CiAgICB9CiAgICByZXR1cm4gcHJvZHVjdEpzb247Cn0KCmZ1bmN0aW9uIGFwcGx5U2VsZWN0MkZvclRhZ3MoJHNlbGVjdG9yLCB1cmwsIHBsYWNlSG9sZGVyVGV4dCwgaXNDYXNlU2VyaWVzVGFnKSB7CiAgICAkc2VsZWN0b3Iuc2VsZWN0Mih7CiAgICAgICAgbWluaW11bUlucHV0TGVuZ3RoOiAwLAogICAgICAgIG11bHRpcGxlOiB0cnVlLAogICAgICAgIHRhZ3M6IHRydWUsCiAgICAgICAgcGxhY2Vob2xkZXI6IHBsYWNlSG9sZGVyVGV4dCwKICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgY3JlYXRlVGFnOiBmdW5jdGlvbiAodGFnKSB7CgogICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgb3B0aW9uIGlzIGFscmVhZHkgdGhlcmUKICAgICAgICAgICAgZm91bmQgPSBmYWxzZTsKICAgICAgICAgICAgJHNlbGVjdG9yLmZpbmQoIm9wdGlvbiIpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCQudHJpbSh0YWcudGVybSkudG9VcHBlckNhc2UoKSA9PT0gJC50cmltKCQodGhpcykudGV4dCgpKS50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJldlRhZyA9ICQodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIGlmIGl0J3Mgbm90IHRoZXJlLCB0aGVuIHNob3cgdGhlIHN1Z2dlc3Rpb24KICAgICAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpZDogJC50cmltKHRhZy50ZXJtKSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAkLnRyaW0odGFnLnRlcm0pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpZDogJC50cmltKHByZXZUYWcudGV4dCgpKSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiAkLnRyaW0ocHJldlRhZy50ZXh0KCkpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhamF4OiB7CiAgICAgICAgICAgIHF1aWV0TWlsbGlzOiAyNTAsCiAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHRlcm06IHBhcmFtcy50ZXJtLAogICAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhcmFtcy5wYWdlIHx8IDEsCiAgICAgICAgICAgICAgICAgICAgbWF4OiAzMCwKICAgICAgICAgICAgICAgICAgICBsYW5nOiB1c2VyTG9jYWxlLAogICAgICAgICAgICAgICAgICAgIGlzQ2FzZVNlcmllc1RhZzogaXNDYXNlU2VyaWVzVGFnCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LAogICAgICAgICAgICBwcm9jZXNzUmVzdWx0czogZnVuY3Rpb24gKGRhdGEsIHBhcmFtcykgewogICAgICAgICAgICAgICAgcGFyYW1zLnBhZ2UgPSBwYXJhbXMucGFnZSB8fCAxOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiBkYXRhLmxpc3QsCiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICBtb3JlOiAocGFyYW1zLnBhZ2UgKiAzMCkgPCBkYXRhLnRvdGFsQ291bnQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KCmZ1bmN0aW9uIHNob3dDb21tZW50SWNvbihjdXJyZW50Um93KSB7CiAgICB2YXIgJGJ0bkdyb3VwID0gJChjdXJyZW50Um93KS5jbG9zZXN0KCd0cicpLmZpbmQoJ3RkLmRyb3BEb3duIC5idG4tZ3JvdXAnKTsKICAgIGlmICgkKCRidG5Hcm91cCkuZmluZCgnLmNvbW1lbnQnKS5sZW5ndGggPT09IDApIHsKICAgICAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLmFmdGVyKCc8aSBjbGFzcz0ibWRpIG1kaS1jaGF0IGJsdWUtMiBmb250LTEzIHBvcy1hYiBjb21tZW50IiB0aXRsZT0iJyArICQuaTE4bi5fKCdjb21tZW50QXZhaWxhYmxlJykgKyAnIj48L2k+Jyk7CiAgICB9Cn0KCmZ1bmN0aW9uIHJlbW92ZUNvbW1lbnRJY29uKGN1cnJlbnRSb3cpIHsKICAgIHZhciAkYnRuR3JvdXAgPSAkKGN1cnJlbnRSb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgJCgkYnRuR3JvdXApLmZpbmQoJy5kcm9wZG93bi10b2dnbGUnKS5uZXh0KCdpJykucmVtb3ZlKCk7Cn0KCmZ1bmN0aW9uIHJlbW92ZUF0dGFjaG1lbnRJY29uKGN1cnJlbnRSb3cpIHsKICAgIHZhciAkYnRuR3JvdXAgPSAkKGN1cnJlbnRSb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuZHJvcGRvd24tdG9nZ2xlJykubmV4dCgnaScpLnJlbW92ZSgpOwogICAgfSBlbHNlIHsKICAgICAgICAkKCRidG5Hcm91cCkuZmluZCgnLmNvbW1lbnQnKS5uZXh0KCdpJykucmVtb3ZlKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHNob3dBdHRhY2htZW50SWNvbih0clJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQodHJSb3cpLmZpbmQoJ3RkLmRyb3BEb3duIC5idG4tZ3JvdXAnKTsKICAgIGlmICgkKCRidG5Hcm91cCkuZmluZCgnLmF0dGFjaCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGlmICgkKCRidG5Hcm91cCkuZmluZCgnLmNvbW1lbnQnKS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgJCgkYnRuR3JvdXApLmZpbmQoJy5kcm9wZG93bi10b2dnbGUnKS5hZnRlcignIDxpIGNsYXNzPSJtZGkgbWRpLWF0dGFjaG1lbnQgYmx1ZS0xIGZvbnQtMTMgcG9zLWFiIGF0dGFjaCIgdGl0bGU9IicgKyAkLmkxOG4uXygnYXR0YWNobWVudEF2YWlsYWJsZScpICsgJyI+PC9pPiAnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkKCRidG5Hcm91cCkuZmluZCgnLmNvbW1lbnQnKS5hZnRlcignIDxpIGNsYXNzPSJtZGkgbWRpLWF0dGFjaG1lbnQgYmx1ZS0xIGZvbnQtMTMgcG9zLWFiIGF0dGFjaCIgdGl0bGU9IicgKyAkLmkxOG4uXygnYXR0YWNobWVudEF2YWlsYWJsZScpICsgJyI+PC9pPiAnKTsKICAgICAgICB9CiAgICB9Cn0KCnZhciBpc1NhZmV0eUxlYWRBbGxvd2VkID0gZnVuY3Rpb24gKGxpc3RQcm9kdWN0SWRzLCBzZWxlY3RlZFByb2R1Y3RJZCkgewogICAgcmV0dXJuIGxpc3RQcm9kdWN0SWRzLmluZGV4T2Yoc2VsZWN0ZWRQcm9kdWN0SWQpICE9PSAtMQp9OwoKdmFyIHNldENvbHVtblNlcSA9IGZ1bmN0aW9uIChtYXBTZXEpIHsKICAgIGNvbHVtblNlcSA9IG1hcFNlcQp9Cgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9OwoKc2lnbmFsLmV2ZGFzQ2FzZURyaWxsRG93biA9IChmdW5jdGlvbiAoKSB7CgogICAgdmFyIGluaXRfY2FzZV9kcmlsbF9kb3duX3RhYmxlID0gZnVuY3Rpb24gKHVybCwgY2FzZURldGFpbFVybCkgewoKICAgICAgICB2YXIgdGFibGUgPSAkKCcjZXZkYXMtY2FzZS1kcmlsbC1kb3duLXRhYmxlJykuRGF0YVRhYmxlKHsKICAgICAgICAgICAgbGFuZ3VhZ2U6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiA1MCwKICAgICAgICAgICAgImFMZW5ndGhNZW51IjogW1s1MCwgMTAwLCAyMDAsIDEwMDAsIC0xXSwgWzUwLCAxMDAsIDIwMCwgMTAwMCwgIkFsbCJdXSwKICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQoIi5tb3JlLW9wdGlvbiIpLndlYnVpUG9wb3Zlcih7CiAgICAgICAgICAgICAgICAgICAgaHRtbDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyOiAnaG92ZXInLAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQodGhpcykuYXR0cignbW9yZS1kYXRhJykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiY2FzZU51bSIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9IicgKyAoY2FzZURldGFpbFVybCArICI/IiArIHNpZ25hbC51dGlscy5jb21wb3NlUGFyYW1zKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlTnVtYmVyOiByb3cuY2FzZU51bSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiByb3cudmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiByb3cuYWxlcnRJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpICsgJyI+JyArICI8c3BhbiBkYXRhLWZpZWxkID0nY2FzZU51bScgZGF0YS1pZD0nIiArIHJvdy5jYXNlTnVtICsgIic+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocm93LmNhc2VOdW0pICsgIjwvc3Bhbj48L2E+IgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTE1MCIKCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICdjYXNlSWRlbnRpZmllcicsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY29tcGFueUZsYWcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9IicgKyAoY2FzZURldGFpbFVybCArICc/JyArIHNpZ25hbC51dGlscy5jb21wb3NlUGFyYW1zKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3dpZDogcm93LmNhc2VJZGVudGlmaWVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiByb3cuYWxlcnRJZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSArICciPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8c3BhbiBkYXRhLWZpZWxkID0nY2FzZU51bScgZGF0YS1pZD0nIiArIHJvdy5jYXNlTnVtICsgIic+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJvdy5jYXNlSWRlbnRpZmllcikgKyAiPC9zcGFuPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L2E+IgogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5jYXNlSWRlbnRpZmllcgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMjUwIgoKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImhjcCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImFnZUdyb3VwIiwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTAwIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZ2VuZGVyIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGF0ZUZpcnN0UmVjZWlwdCIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTEwMCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogInByaW1hcnlTb3VyY2VDb3VudHJ5RGVzYyIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTEwMCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gKHJvdy5zdXNwTGlzdCkgPyByb3cuc3VzcExpc3Q6Jyc7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb3JlT3B0aW9uID0gdGV4dC5sZW5ndGggPiA0MCA/ICc8YSBjbGFzcz0icHVsbC1yaWdodCIgdHlwZT0ibGluayI+PGkgY2xhc3M9ImZhIGZhLWVsbGlwc2lzLWggbW9yZS1vcHRpb24iICBtb3JlLWRhdGE9IicgKyB0ZXh0ICsgJyI+IDwvaT4gPC9hPicgOiAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iIj48c3Bhbj4nICsgdGV4dC5zdWJzdHJpbmcoMCwgNDApICsgJzwvc3Bhbj4nICsgbW9yZU9wdGlvbiArICc8L3NwYW4+JzsKCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTUwIGNvbC1tYXgtMjAwIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSAocm93LmNvbmNMaXN0KSA/IHJvdy5jb25jTGlzdDonJzsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vcmVPcHRpb24gPSB0ZXh0Lmxlbmd0aCA+IDQwID8gJzxhIGNsYXNzPSJwdWxsLXJpZ2h0IiB0eXBlPSJsaW5rIj48aSBjbGFzcz0iZmEgZmEtZWxsaXBzaXMtaCBtb3JlLW9wdGlvbiIgIG1vcmUtZGF0YT0iJyArIHRleHQgKyAnIj4gPC9pPiA8L2E+JyA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSIiPjxzcGFuPicgKyB0ZXh0LnN1YnN0cmluZygwLCA0MCkgKyAnPC9zcGFuPicgKyBtb3JlT3B0aW9uICsgJzwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiY29sLW1pbi0xNTAgY29sLW1heC0yMDAiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJyZWFjdExpc3QiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9IHJvdy5yZWFjdExpc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gZGF0YS5zcGxpdCgiLCIpLmpvaW4oJywgJykKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSAiLSIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW9yZU9wdGlvbiA9IHRleHQubGVuZ3RoID4gNDAgPyAnPGEgY2xhc3M9InB1bGwtcmlnaHQiIHR5cGU9ImxpbmsiPjxpIGNsYXNzPSJmYSBmYS1lbGxpcHNpcy1oIG1vcmUtb3B0aW9uIiAgbW9yZS1kYXRhPSInICsgdGV4dCArICciPiA8L2k+IDwvYT4nIDogIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9IiI+PHNwYW4+JyArIHRleHQuc3Vic3RyaW5nKDAsIDQwKSArICc8L3NwYW4+JyArIG1vcmVPcHRpb24gKyAnPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTUwIGNvbC1tYXgtMjAwIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiaWNzciIsCiAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9IicgKyByb3cuaWNzciArICciPjxpIGNsYXNzPSJmYSBmYS1leHRlcm5hbC1saW5rIj48L2k+PC9hPicKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHNjcm9sbFg6dHJ1ZSwKICAgICAgICAgICAgc2Nyb2xsWToiY2FsYygxMDB2aCAtIDI0N3B4KSIsCiAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgIH1dCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRhYmxlCiAgICB9OwoKICAgIHZhciBiaW5kX2V2ZGFzX2RyaWxsX2Rvd25fdGFibGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5ldmRhcy1jYXNlLWRyaWxsLWRvd24tbGluaycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBzcmNFbGUgPSAkKHRoaXMpOwogICAgICAgICAgICAkKCcjZXZkYXMtY2FzZS1kcmlsbC1kb3duLW1vZGFsJykuYXR0cignZGF0YS11cmwnLCBzcmNFbGUuYXR0cignaHJlZicpKTsKICAgICAgICAgICAgJCgnI2V2ZGFzLWNhc2UtZHJpbGwtZG93bi1tb2RhbCcpLm1vZGFsKHt9KTsKICAgICAgICB9KTsKCiAgICAgICAgJCgnI2V2ZGFzLWNhc2UtZHJpbGwtZG93bi1tb2RhbCcpLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGRyaWxsX2Rvd25fdGFibGUgPSBzaWduYWwudXRpbHMucmVuZGVyKCdldmRhc19jYXNlX2RyaWxsX2Rvd25fdGFibGUnLCB7fSk7CiAgICAgICAgICAgICQoJyNldmRhcy1kcmlsbC1kb3duLXRhYmxlLWNvbnRhaW5lcicpLmh0bWwoZHJpbGxfZG93bl90YWJsZSk7CiAgICAgICAgICAgIHZhciB1cmwgPSAkKCcjZXZkYXMtY2FzZS1kcmlsbC1kb3duLW1vZGFsJykuYXR0cignZGF0YS11cmwnKTsKICAgICAgICAgICAgaW5pdF9jYXNlX2RyaWxsX2Rvd25fdGFibGUodXJsLCBldmRhc0Nhc2VEZXRhaWxVcmwpCiAgICAgICAgfSkKCiAgICAgICAgJCgnI2V2ZGFzLWNhc2UtZHJpbGwtZG93bi1tb2RhbCcpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoJyNldmRhcy1kcmlsbC1kb3duLXRhYmxlLWNvbnRhaW5lcicpLnJlbW92ZSgnZXZkYXMtY2FzZS1kcmlsbC1kb3duLXRhYmxlJyk7CiAgICAgICAgICAgIHZhciBkcmlsbF9kb3duX3RhYmxlID0gc2lnbmFsLnV0aWxzLnJlbmRlcignZXZkYXNfY2FzZV9kcmlsbF9kb3duX3RhYmxlJywge30pOwogICAgICAgICAgICAkKCcjZXZkYXMtZHJpbGwtZG93bi10YWJsZS1jb250YWluZXInKS5odG1sKGRyaWxsX2Rvd25fdGFibGUpOwogICAgICAgIH0pCgoKICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBiaW5kX2V2ZGFzX2RyaWxsX2Rvd25fdGFibGU6IGJpbmRfZXZkYXNfZHJpbGxfZG93bl90YWJsZQogICAgfQp9KSgpOwoKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewogICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5oaXN0b3J5LWp1c3RpZmljYXRpb24gLmVkaXRJY29uJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICB1cGRhdGVKdXN0aWZpY2F0aW9uKGUpOwogICAgfSk7CgogICAgdmFyIHVwZGF0ZUp1c3RpZmljYXRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHZhciAkY3VycmVudEp1c3RpZmljYXRpb25QYXJlbnQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0ZCcpOwogICAgICAgIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcygnZWRpdEljb24nKSkgewogICAgICAgICAgICAkY3VycmVudEp1c3RpZmljYXRpb25QYXJlbnQuZmluZCgnLmVkaXRlZEp1c3RpZmljYXRpb24nKS52YWwoJChlLnRhcmdldCkuY2xvc2VzdCgnLmhpc3RvcnktanVzdGlmaWNhdGlvbicpLmZpbmQoJ3NwYW4nKS5odG1sKCkpOwogICAgICAgIH0KICAgICAgICAkY3VycmVudEp1c3RpZmljYXRpb25QYXJlbnQuZmluZCgnLmVkaXQtanVzdGlmaWNhdGlvbi1ib3gnKS5zaG93KCk7CgogICAgICAgICRjdXJyZW50SnVzdGlmaWNhdGlvblBhcmVudC5maW5kKCIuaGlzdG9yeS1qdXN0aWZpY2F0aW9uICNjb25maXJtSGlzdG9yeUp1c3RpZmljYXRpb24iKS51bmJpbmQoKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNoYW5nZUp1c3RpZmljYXRpb24oJGN1cnJlbnRKdXN0aWZpY2F0aW9uUGFyZW50LmZpbmQoJy5lZGl0ZWRKdXN0aWZpY2F0aW9uJykudmFsKCksICRjdXJyZW50SnVzdGlmaWNhdGlvblBhcmVudCk7CiAgICAgICAgfSk7CgogICAgICAgICRjdXJyZW50SnVzdGlmaWNhdGlvblBhcmVudC5maW5kKCcuaGlzdG9yeS1qdXN0aWZpY2F0aW9uICNjYW5jZWxIaXN0b3J5SnVzdGlmaWNhdGlvbicpLnVuYmluZCgpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY2xlYXJBbmRIaWRlSnVzdGlmaWNhdGlvbkVkaXRCb3goJGN1cnJlbnRKdXN0aWZpY2F0aW9uUGFyZW50KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGNoYW5nZUp1c3RpZmljYXRpb24gPSBmdW5jdGlvbiAobmV3SnVzdGlmaWNhdGlvbiwgJGN1cnJlbnRKdXN0aWZpY2F0aW9uKSB7CiAgICAgICAgdmFyIGluZGV4ID0gJGN1cnJlbnRKdXN0aWZpY2F0aW9uLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKTsKICAgICAgICB2YXIgdGFibGVJZCA9ICRjdXJyZW50SnVzdGlmaWNhdGlvbi5jbG9zZXN0KCd0YWJsZScpLnByb3AoJ2lkJyk7CiAgICAgICAgdmFyIHRhYmxlID0gJCgiIyIgKyB0YWJsZUlkKS5EYXRhVGFibGUoKTsKICAgICAgICB2YXIgaGlzdG9yeU9iaiA9IHRhYmxlLnJvd3MoaW5kZXgpLmRhdGEoKVswXTsKICAgICAgICBpZiAobmV3SnVzdGlmaWNhdGlvbiAmJiBuZXdKdXN0aWZpY2F0aW9uLnRyaW0oKSAhPT0gaGlzdG9yeU9iai5qdXN0aWZpY2F0aW9uLnRyaW0oKSkgewogICAgICAgICAgICB2YXIgJGN1cnJlbnRKdXN0aWZpY2F0aW9uUGFyZW50ID0gJGN1cnJlbnRKdXN0aWZpY2F0aW9uLmNsb3Nlc3QoJ3RkJyk7CiAgICAgICAgICAgIHZhciBodG1sID0gJGN1cnJlbnRKdXN0aWZpY2F0aW9uUGFyZW50Lmh0bWwoKTsKICAgICAgICAgICAgdmFyIGRhdGEgPSB7aWQ6IGhpc3RvcnlPYmouaWQsIG5ld0p1c3RpZmljYXRpb246IG5ld0p1c3RpZmljYXRpb24udHJpbSgpfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogdXBkYXRlSnVzdGlmaWNhdGlvblVybCwKICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgICAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICRjdXJyZW50SnVzdGlmaWNhdGlvblBhcmVudC5odG1sKCI8aSBpZD0nanVzdGlmaWNhdGlvbkNoYW5nZVByb2Nlc3NpbmcnIGNsYXNzPSdtZGkgbWRpLXNwaW4gbWRpLWxvYWRpbmcnPjwvaT4iKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlPYmouanVzdGlmaWNhdGlvbiA9IG5ld0p1c3RpZmljYXRpb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeU9iai5qdXN0aWZpY2F0aW9uID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRhYmxlLnJvdyhpbmRleCkuZGF0YShoaXN0b3J5T2JqKS5pbnZhbGlkYXRlKCk7IC8vIHRvIHVwZGF0ZSB0aGUgY2VsbCBkYXRhIGluIHRoZSB0YWJsZSBhcnJheQogICAgICAgICAgICAgICAgICAgIGNsZWFyQW5kSGlkZUp1c3RpZmljYXRpb25FZGl0Qm94KCRjdXJyZW50SnVzdGlmaWNhdGlvblBhcmVudCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ2Vycm9yJywgJ3RvcCByaWdodCcsICJFcnJvciIsICJTb3JyeSB3ZSBjb3VsZCBub3QgcHJvY2VlZCB3aXRoIHRoZSByZXF1ZXN0LiBLaW5kbHkgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4iLCB7YXV0b0hpZGVEZWxheTogMTAwMDB9KTsKICAgICAgICAgICAgICAgICAgICB0YWJsZS5yb3coaW5kZXgpLmRhdGEoaGlzdG9yeU9iaikuaW52YWxpZGF0ZSgpOyAvLyB0byB1cGRhdGUgdGhlIGNlbGwgZGF0YSBpbiB0aGUgdGFibGUgYXJyYXkKICAgICAgICAgICAgICAgICAgICBjbGVhckFuZEhpZGVKdXN0aWZpY2F0aW9uRWRpdEJveCgkY3VycmVudEp1c3RpZmljYXRpb25QYXJlbnQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgY2xlYXJBbmRIaWRlSnVzdGlmaWNhdGlvbkVkaXRCb3ggPSBmdW5jdGlvbiAoJGN1cnJlbnRKdXN0aWZpY2F0aW9uUGFyZW50KSB7CiAgICAgICAgJGN1cnJlbnRKdXN0aWZpY2F0aW9uUGFyZW50LmZpbmQoIi5oaXN0b3J5LWp1c3RpZmljYXRpb24gLmVkaXQtanVzdGlmaWNhdGlvbi1ib3giKS5oaWRlKCk7CiAgICAgICAgJGN1cnJlbnRKdXN0aWZpY2F0aW9uUGFyZW50LmZpbmQoJy5oaXN0b3J5LWp1c3RpZmljYXRpb24gLmVkaXRlZEp1c3RpZmljYXRpb24nKS52YWwoJycpOwogICAgfTsKfSk7CgovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9jb21tb24uanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jYXNlRHJpbGxEb3duL2Nhc2VEcmlsbERvd24KLy89IHJlcXVpcmUgYXBwL3B2cy9hbGVydENvbW1lbnRzL2FsZXJ0Q29tbWVudHMKLy89IHJlcXVpcmUgYXBwL3B2cy9wcm9kdWN0RXZlbnRIaXN0b3J5L3Byb2R1Y3RFdmVudEhpc3RvcnlUYWJsZQovLz0gcmVxdWlyZSBhcHAvcHZzL2FsZXJ0Q29tbWVudHMvYWxlcnRDb21tZW50cwovLz0gcmVxdWlyZSBhcHAvcHZzL2NvbW1vbi9yeF9hbGVydF91dGlscwovLz0gcmVxdWlyZSBhcHAvcHZzL2FsZXJ0c19yZXZpZXcvYWxlcnRfcmV2aWV3Ci8vPSByZXF1aXJlIGFwcC9wdnMvY2FzZURyaWxsRG93bi9ldmRhc0Nhc2VEcmlsbERvd24uanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jYXNlSGlzdG9yeS9jYXNlSGlzdG9yeUp1c3RpZmljYXRpb24uanMKCnZhciB0YWJsZUFnZ1JldmlldzsKdmFyIHRhYmxlU2luZ2xlUmV2aWV3Owp2YXIgZnVsbENhc2VMaXN0OwoKJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgewoKICAgIHZhciBjaGVja2VkSWRMaXN0ID0gW107CiAgICB2YXIgY2hlY2tlZFJvd0xpc3QgPSBbXTsKICAgIHNpZ25hbC5ldmRhc0Nhc2VEcmlsbERvd24uYmluZF9ldmRhc19kcmlsbF9kb3duX3RhYmxlKGV2ZGFzQ2FzZURldGFpbFVybCk7CiAgICBzaWduYWwuYWxlcnRSZXZpZXcub3BlbkFsZXJ0Q29tbWVudE1vZGFsKCJBZ2dyZWdhdGUgQ2FzZSBBbGVydCIsICJBZ2dyZWdhdGUgQ2FzZSBBbGVydCIsICJBZ2dyZWdhdGUgQ2FzZSBBbGVydCIsIGNoZWNrZWRJZExpc3QsIGNoZWNrZWRSb3dMaXN0KTsKCiAgICB0YWJsZUFnZ1JldmlldyA9ICQoJyNyeFRhYmxlQWdncmVnYXRlUmV2aWV3JykuRGF0YVRhYmxlKHsKICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICB9LAogICAgICAgICJhamF4IjogewogICAgICAgICAgICAidXJsIjogVkFMSURBVEVELmFjYUxpc3RVcmwgKyAiP2lkPSIgKyAkKCIjc2lnbmFsSWQiKS52YWwoKSwKICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgIH0sCiAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHNpZ25hbC5jYXNlRHJpbGxEb3duLmJpbmRfZHJpbGxfZG93bl90YWJsZShjYXNlRGV0YWlsVXJsKTsKCiAgICAgICAgICAgICQoJy5wcm9kdWN0LWV2ZW50LWhpc3RvcnktaWNvbicpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0icHJvZHVjdE5hbWUiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgICAgIHZhciBldmVudE5hbWUgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iZXZlbnROYW1lIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgICAgICB2YXIgY29uZmlnSWQgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY29uZmlnSWQiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gcGFyZW50X3Jvdy5maW5kKCdpbnB1dFtpZD0iZXhlY0NvbmZpZ0lkIl0nKS52YWwoKTsKICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0RXZlbnRIaXN0b3J5TW9kYWwgPSAkKCcjcHJvZHVjdEV2ZW50SGlzdG9yeU1vZGFsJyk7CiAgICAgICAgICAgICAgICBwcm9kdWN0RXZlbnRIaXN0b3J5TW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgICAgIHByb2R1Y3RFdmVudEhpc3RvcnlNb2RhbC5maW5kKCIjcHJvZHVjdE5hbWUiKS5odG1sKHByb2R1Y3ROYW1lKTsKICAgICAgICAgICAgICAgIHByb2R1Y3RFdmVudEhpc3RvcnlNb2RhbC5maW5kKCIjZXZlbnROYW1lIikuaHRtbChldmVudE5hbWUpOwogICAgICAgICAgICAgICAgcHJvZHVjdEV2ZW50SGlzdG9yeU1vZGFsLmZpbmQoIiNjb25maWdJZCIpLmh0bWwoY29uZmlnSWQpOwoKICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBhZ2dVcGRhdGVKdXN0aWZpY2F0aW9uVXJsICE9ICd1bmRlZmluZWQnKQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZUp1c3RpZmljYXRpb25VcmwgPSBhZ2dVcGRhdGVKdXN0aWZpY2F0aW9uVXJsOwoKICAgICAgICAgICAgICAgIHNpZ25hbC5wcm9kdWN0RXZlbnRIaXN0b3J5VGFibGUuaW5pdF9jdXJyZW50X2FsZXJ0X2hpc3RvcnlfdGFibGUocHJvZHVjdEV2ZW50SGlzdG9yeVVybCwgcHJvZHVjdE5hbWUsIGV2ZW50TmFtZSwgY29uZmlnSWQsIGV4ZWN1dGVkQ29uZmlnSWQpOwogICAgICAgICAgICAgICAgc2lnbmFsLnByb2R1Y3RFdmVudEhpc3RvcnlUYWJsZS5pbml0X290aGVyX2FsZXJ0c19oaXN0b3J5X3RhYmxlKHByb2R1Y3RFdmVudEhpc3RvcnlVcmwsIHByb2R1Y3ROYW1lLCBldmVudE5hbWUsIGNvbmZpZ0lkKTsKCiAgICAgICAgICAgICAgICAvL1Byb2R1Y3QgRXZlbnQgSGlzdG9yeSBNb2RhbAogICAgICAgICAgICAgICAgJCgiLmV4cG9ydENhc2VIaXN0b3J5IikuY2xpY2soZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdEV2ZW50SGlzdG9yeU1vZGFsID0gJCgnI3Byb2R1Y3RFdmVudEhpc3RvcnlNb2RhbCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHByb2R1Y3RFdmVudEhpc3RvcnlNb2RhbC5maW5kKCIjcHJvZHVjdE5hbWUiKS5odG1sKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50TmFtZSA9IHByb2R1Y3RFdmVudEhpc3RvcnlNb2RhbC5maW5kKCIjZXZlbnROYW1lIikuaHRtbCgpOwogICAgICAgICAgICAgICAgICAgIHZhciBjb25maWdJZCA9IHByb2R1Y3RFdmVudEhpc3RvcnlNb2RhbC5maW5kKCIjY29uZmlnSWQiKS50ZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkQ2FzZSA9IGUuY3VycmVudFRhcmdldC5ocmVmICsgIiZwcm9kdWN0TmFtZT0iICsgcHJvZHVjdE5hbWUgKyAiJmV2ZW50TmFtZT0iICsgZXZlbnROYW1lICsgIiZjb25maWdJZD0iICsgY29uZmlnSWQ7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBzZWxlY3RlZENhc2U7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJCgnLmFnZy13b3JrZmxvdycpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0icmVtb3ZlU2lnbmFsIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgICAgICB2YXIgYXBwVHlwZSA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJ3b3JrZmxvd1N0YXRlIl0nKS5hdHRyKCJkYXRhLWFwcHR5cGUiKTsKICAgICAgICAgICAgICAgIGZpbmRTaWduYWxzKGFwcFR5cGUsIHByb2R1Y3ROYW1lLCBwYXJlbnRfcm93KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvL0p1c3QgbmVlZCB0byBzaG93IHRoZSBwcmV2aW91cyBjb21tZW50cwogICAgICAgICAgICB2YXIgY29tbWVudE1vZGFsID0gJCgiI2NvbW1lbnRNb2RhbCIpOwogICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmFkZC1jb21tZW50cyIpLmhpZGUoKTsKCiAgICAgICAgICAgICQoIi5kb3dubG9hZE1lbW9SZXBvcnQiKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHNob3dQb3B1cCgkKGV2ZW50LnRhcmdldCkucGFyZW50KCkuZGF0YSgnaWQnKSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9LAogICAgICAgICJiQXV0b1dpZHRoIjogZmFsc2UsCiAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgeyJtRGF0YSI6ICJhbGVydE5hbWUiLCBjbGFzc05hbWU6J2NvbC1taW4tMTUwJ30sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcm9kdWN0TmFtZSIsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTE1MCcsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gIjxpbnB1dCB0eXBlPSdoaWRkZW4nIHZhbHVlPSciICsgcm93LnByb2R1Y3RJZCArICInIGNsYXNzPSdyb3ctcHJvZHVjdC1pZCcvPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAiPGlucHV0IHR5cGU9J2hpZGRlbicgdmFsdWU9JyIgKyByb3cubGV2ZWwgKyAiJyBjbGFzcz0ncm93LWxldmVsLWlkJy8+IjsKICAgICAgICAgICAgICAgICAgICBpZiAocm93LmlzU3BlY2lhbFBFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAiPHNwYW4gc3R5bGU9J2NvbG9yOnJlZCcgIGRhdGEtZmllbGQgPSdwcm9kdWN0TmFtZScgZGF0YS1pZD0nIiArIHJvdy5wcm9kdWN0TmFtZSArICInPiIgKyByb3cucHJvZHVjdE5hbWUgKyAiPC9zcGFuPiIKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gIjxzcGFuIGRhdGEtZmllbGQgPSdwcm9kdWN0TmFtZScgZGF0YS1pZD0nIiArIHJvdy5wcm9kdWN0TmFtZSArICInPiIgKyByb3cucHJvZHVjdE5hbWUgKyAiPC9zcGFuPiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHsibURhdGEiOiAic29jIiwgY2xhc3NOYW1lOiAnY29sLW1pbi00MCd9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicHJlZmVycmVkVGVybSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGRhdGEtZmllbGQgPSdldmVudE5hbWUnIGRhdGEtaWQ9JyIgKyByb3cucHJlZmVycmVkVGVybSArICInPiIgKyAocm93LnByZWZlcnJlZFRlcm0pICsgIjwvc3Bhbj4iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMuc3RhY2tlZCgKICAgICAgICAgICAgICAgICAgICAgICAgZHJpbGxfZG93bl9vcHRpb25zKHJvdy5uZXdTcG9uQ291bnQsICdORVcnLCAnU1BPTlRfRkxBRycsJ05FV19TUE9OJywgcm93LHRydWUsMCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRyaWxsX2Rvd25fb3B0aW9ucyhyb3cuY3VtU3BvbkNvdW50LCAnQ1VNTScsICdTUE9OVF9GTEFHJywnQ1VNTV9TUE9OJywgcm93LGZhbHNlLDApKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tNTAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICIiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25hbC51dGlscy5zdGFja2VkKAogICAgICAgICAgICAgICAgICAgICAgICBkcmlsbF9kb3duX29wdGlvbnMocm93Lm5ld1NlcmlvdXNDb3VudCwgJ05FVycsICdTRVJJT1VTX0ZMQUcnLCdORVdfU0VSJyxyb3csdHJ1ZSwzKSwKICAgICAgICAgICAgICAgICAgICAgICAgZHJpbGxfZG93bl9vcHRpb25zKHJvdy5jdW1TZXJpb3VzQ291bnQsICdDVU1NJywgJ1NFUklPVVNfRkxBRycsJ0NVTU1fU0VSJywgcm93LGZhbHNlLDMpKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tNTAnCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicHJyVmFsdWUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5wcnJWYWx1ZSAhPSAnLScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSB0YWJpbmRleD0iMCI+JyArIHJvdy5wcnJWYWx1ZSArICc8L2E+JwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93LnByclZhbHVlCiAgICAgICAgICAgICAgICB9LCBjbGFzc05hbWU6ICdjb2wtbWluLTUwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicm9yVmFsdWUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSB0YWJpbmRleD0iMCI+JyArIHJvdy5yb3JWYWx1ZSArICc8L2E+JwogICAgICAgICAgICAgICAgfSwgY2xhc3NOYW1lOiAnY29sLW1pbi01MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImViZ20iLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSB0YWJpbmRleD0iMCIgdGl0bGU9IiI+JyArIGRhdGEgKyAnPC9hPicKICAgICAgICAgICAgICAgIH0sIGNsYXNzTmFtZTogJ2NvbC1taW4tNTAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICIiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25hbC51dGlscy5zdGFja2VkKAogICAgICAgICAgICAgICAgICAgICAgICAnPGEgdGFiaW5kZXg9IjAiPicgKyByb3cuZWIwNSArICc8L2E+JywKICAgICAgICAgICAgICAgICAgICAgICAgJzxhIHRhYmluZGV4PSIwIj4nICsgcm93LmViOTUgKyAnPC9hPicpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY29sLW1pbi01MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInRyZW5kIiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tNTAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy50cmVuZCA9PSAiUG9zaXRpdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPHNwYW4gc3R5bGUgPSAnY29sb3I6cmVkJz4iICsgJC5pMThuLl8oJ3RyZW5kVHlwZS5wb3NpdGl2ZScpICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocm93LnRyZW5kID09ICJOZWdhdGl2ZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBzdHlsZSA9ICdjb2xvcjpncmVlbic+IiArICQuaTE4bi5fKCd0cmVuZFR5cGUubmVnYXRpdmUnKSArICI8L3NwYW4+IjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3Bhbj48L3NwYW4+IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImRhdGFTb3VyY2UiLAogICAgICAgICAgICAgICAgY2NsYXNzTmFtZTogJ2NvbC1taW4tNTAnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8c3BhbiBkYXRhLWZpZWxkID0nZGF0YVNvdXJjZScgZGF0YS1pZD0nIiArIHJvdy5kYXRhU291cmNlICsgIic+IiArIHJvdy5kYXRhU291cmNlICsgIjwvc3Bhbj4iCgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7Im1EYXRhIjogImRpc3Bvc2l0aW9uIn0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICIiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyIiBjbGFzcz0icHJvZHVjdC1ldmVudC1oaXN0b3J5LWljb24gZ2x5cGhpY29uIGdseXBoaWNvbi1saXN0LWFsdCI+PC9zcGFuPic7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY29sLW1pbi01MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogIiIsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTI1JywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuZGF0YVNvdXJjZSA9PSAiRVZEQVMiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gc3R5bGU9ImN1cnNvcjogcG9pbnRlcjtmb250LXNpemU6IDEyNSU7IiBkYXRhLWluZm89InJvdyIgZGF0YS1zaWduYWw9dHJ1ZSBkYXRhLW5hbWUgPSJFVkRBUyBBbGVydCIgY2xhc3M9InRleHQtbGVmdCBjb3VudC1pbmZvLWNvbW1lbnQgY29tbWVudC1pY29uIGNvbW1lbnQtaWNvbiBnbHlwaGljb24gZ2x5cGhpY29uLWNvbW1lbnQiPjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Zm9udC1zaXplOiAxMjUlOyIgZGF0YS1pbmZvPSJyb3ciIGRhdGEtc2lnbmFsPXRydWUgZGF0YS1uYW1lID0iQWdncmVnYXRlIENhc2UgQWxlcnQiIGNsYXNzPSJ0ZXh0LWxlZnQgY291bnQtaW5mby1jb21tZW50IGNvbW1lbnQtaWNvbiBjb21tZW50LWljb24gZ2x5cGhpY29uIGdseXBoaWNvbi1jb21tZW50Ij48L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICIiLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY29sLW1pbi0yNScsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXBwVHlwZSA9IChyb3cuZGF0YVNvdXJjZSA9PT0gJ0VWREFTJykgPyAiRVZEQVMgQWxlcnQiIDogIkFnZ3JlZ2F0ZSBDYXNlIEFsZXJ0IjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Zm9udC1zaXplOiAxMjUlOyIgZGF0YS1maWVsZD0icmVtb3ZlU2lnbmFsIiBkYXRhLWlkPSInICsgcm93LmlkICsgJyIgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tbGluayI+PC9zcGFuPicgKwogICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gc3R5bGU9ImRpc3BsYXk6IG5vbmU7IiBkYXRhLWZpZWxkID0ibWFzdGVyUHJlZlRlcm1BbGwiIGRhdGEtaWQ9IicgKyByb3cubWFzdGVyUHJlZlRlcm1BbGwgKyAnIj48L3NwYW4+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBzdHlsZT0iZGlzcGxheTogbm9uZTsiIGRhdGEtZmllbGQgPSJjb25maWdJZCIgZGF0YS1pZD0iJyArIHJvdy5hbGVydENvbmZpZ0lkICsgJyI+PC9zcGFuPicgKwogICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gc3R5bGU9ImRpc3BsYXk6IG5vbmU7IiBjbGFzcz0iYWxlcnQtY2hlY2stYm94IiBkYXRhLWlkPSInICsgcm93LmlkICsgJyI+PC9zcGFuPiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIHN0eWxlPSJkaXNwbGF5OiBub25lOyIgZGF0YS1maWVsZD0iYXNzaWduZWRUbyIgZGF0YS1jdXJyZW50LXVzZXItaWQ9IicgKyByb3cuYXNzaWduZWRUbyArICciPjwvc3Bhbj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz0iZXhlY0NvbmZpZ0lkIiBpZD0iZXhlY0NvbmZpZ0lkIiB0eXBlPSJoaWRkZW4iIHZhbHVlPSInICsgcm93LmV4ZWNDb25maWdJZCArICciIC8+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgc2Nyb2xsWDp0cnVlLAogICAgICAgIHNjcm9sbFk6JzIyMHB4JywKICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgInRhcmdldHMiOiAnX2FsbCcsCiAgICAgICAgICAgICAgICAicmVuZGVyIjogJC5mbi5kYXRhVGFibGUucmVuZGVyLnRleHQoKQogICAgICAgICAgICB9XQogICAgfSk7CgogICAgdGFibGVTaW5nbGVSZXZpZXcgPSAkKCcjcnhUYWJsZVNpbmdsZVJldmlldycpLkRhdGFUYWJsZSh7CiAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgfSwKICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKHNldHRpbmdzKSB7CgogICAgICAgICAgICAkKCcuc2NhLXdvcmtmbG93JykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJyZW1vdmVTaWduYWwiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgICAgIGZpbmRTaWduYWxzKCJTaW5nbGUgQ2FzZSBBbGVydCIsIHByb2R1Y3ROYW1lLCBwYXJlbnRfcm93KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZihzZXR0aW5ncy5qc29uICYmIHNldHRpbmdzLmpzb24ubGVuZ3RoPjApIHsKICAgICAgICAgICAgICAgIGZ1bGxDYXNlTGlzdCA9IFtdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZXR0aW5ncy5qc29uLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZnVsbENhc2VMaXN0LnB1c2goe2Nhc2VOdW1iZXI6IHNldHRpbmdzLmpzb25baV0uY2FzZU51bWJlciwgY2FzZVZlcnNpb246IHNldHRpbmdzLmpzb25baV0uY2FzZVZlcnNpb24sIGFsZXJ0SWQ6IHNldHRpbmdzLmpzb25baV0uaWR9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vVGhlIGNhc2UgaGlzdG9yeSBtb2RhbC4KICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3Lm9wZW5DYXNlSGlzdG9yeU1vZGFsKCk7CiAgICAgICAgICAgICQoIi5leHBvcnRDYXNlSGlzdG9yeSIpLmNsaWNrKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICB2YXIgY2FzZUhpc3RvcnlNb2RhbCA9ICQoJyNjYXNlSGlzdG9yeU1vZGFsJyk7CiAgICAgICAgICAgICAgICB2YXIgY2FzZVZhbCA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VOdW1iZXIiKS5odG1sKCk7CiAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3Byb2R1Y3RGYW1pbHkiKS5odG1sKCk7CiAgICAgICAgICAgICAgICB2YXIgYWxlcnRDb25maWdJZCA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2FsZXJ0Q29uZmlnSWQiKS52YWwoKTsKICAgICAgICAgICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI2Nhc2VWZXJzaW9uIikudmFsKCk7CiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRDYXNlID0gZS5jdXJyZW50VGFyZ2V0LmhyZWYgKyAiJmNhc2VOdW1iZXI9IiArIGNhc2VWYWwgKyAiJnByb2R1Y3RGYW1pbHk9IiArIHByb2R1Y3RGYW1pbHkgKyAiJmFsZXJ0Q29uZmlnSWQ9IiArIGFsZXJ0Q29uZmlnSWQgKyAiJmNhc2VWZXJzaW9uPSIgKyBjYXNlVmVyc2lvbiA7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHNlbGVjdGVkQ2FzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9KTsKCiAgICAgICAgfSwKICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgInVybCI6IFZBTElEQVRFRC5zY2FMaXN0VXJsICsgIj9pZD0iICsgJCgiI3NpZ25hbElkIikudmFsKCksCiAgICAgICAgICAgICJkYXRhU3JjIjogIiIKICAgICAgICB9LAogICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydE5hbWUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4+JyArIGVzY2FwZUhUTUwoZGF0YSkgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInByaW9yaXR5IiwKICAgICAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsicHJpb3JpdHkiXSwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImZvbnQtMjQiIHRpdGxlPSInICsgcm93LnByaW9yaXR5LnZhbHVlICsgJyI+PGkgY2xhc3M9IicgKyByb3cucHJpb3JpdHkuaWNvbkNsYXNzICArJyI+PC9pPjwvYT4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdC1jZW50ZXInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlTnVtYmVyIiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tMTUwJywKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJjYXNlRGV0YWlsVXJsIiBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiID4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBkYXRhLWZpZWxkID0icHJvZHVjdEZhbWlseSIgZGF0YS1pZD0iJyArIHJvdy5wcm9kdWN0RmFtaWx5ICsgJyIgdHlwZT0iaGlkZGVuIiB2YWx1ZT0iJyArIHJvdy5wcm9kdWN0RmFtaWx5ICsgJyIgLz4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBkYXRhLWZpZWxkID0icHJpbWFyeUV2ZW50IiBkYXRhLWlkPSInICsgcm93LnByaW1hcnlFdmVudCArICciIHR5cGU9ImhpZGRlbiIgdmFsdWU9IicgKyByb3cucHJpbWFyeUV2ZW50ICsgJyIgLz4nICsKICAgICAgICAgICAgICAgICAgICAgICAgIjxzcGFuIGRhdGEtZmllbGQgPSdjYXNlTnVtYmVyJyBkYXRhLWlkPSciICsgcm93LmNhc2VOdW1iZXIgKyAiJz4iICsKICAgICAgICAgICAgICAgICAgICAgICAgKHJvdy5jYXNlTnVtYmVyKSArICI8L3NwYW4+PHNwYW4gZGF0YS1maWVsZCA9J2Nhc2VWZXJzaW9uJyBkYXRhLWlkPSciICsgcm93LmNhc2VWZXJzaW9uICsgIic+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICI8L3NwYW4+KDxzcGFuIGRhdGEtZmllbGQgPSdmb2xsb3dVcE51bWJlcicgZGF0YS1pZD0nIiArIHJvdy5mb2xsb3dVcE51bWJlciArICInPiIgKwogICAgICAgICAgICAgICAgICAgICAgICAoKHJvdy5mb2xsb3dVcE51bWJlciA8IDEpID8gMCA6IHJvdy5mb2xsb3dVcE51bWJlcikgKyAiPC9zcGFuPikiICsgJzwvYT4nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcm9kdWN0TmFtZSIsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTE1MCcsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGRhdGEtZmllbGQgPSdwcm9kdWN0TmFtZScgZGF0YS1pZD0nIiArIHJvdy5wcm9kdWN0TmFtZSArICInPiIgKyAocm93LnByb2R1Y3ROYW1lKSArICI8L3NwYW4+IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyJtRGF0YSI6ICJtYXN0ZXJQcmVmVGVybUFsbCJ9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0ic3RhY2tlZC1jZWxsLWNlbnRlci10b3AiPicgKyBjYWxjdWxhdGVTZXJpb3VzbmVzcyhyb3cuYXNzZXNzU2VyaW91c25lc3MpICsgIi8iICsgY2FsY3VsYXRlTGlzdGVkbmVzcyhyb3cubGlzdGVkbmVzcykgKyAnPC9kaXY+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgeyJtRGF0YSI6ICJkaXNwb3NpdGlvbiJ9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiIiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tMjUnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyIiBkYXRhLXNpZ25hbD10cnVlIGNsYXNzPSJjYXNlLWhpc3RvcnktaWNvbiBnbHlwaGljb24gZ2x5cGhpY29uLWxpc3QtYWx0Ij4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz0iYWxlcnRDb25maWdJZCIgaWQ9ImFsZXJ0Q29uZmlnSWQiIHR5cGU9ImhpZGRlbiIgdmFsdWU9IicgKyByb3cuYWxlcnRDb25maWdJZCArICciIC8+JysKICAgICAgICAgICAgICAgICAgICAnPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiIiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tMjUnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyO2ZvbnQtc2l6ZTogMTI1JTsiIGRhdGEtaW5mbz0icm93IiBkYXRhLXNpZ25hbD10cnVlIGRhdGEtbmFtZSA9IlNpbmdsZSBDYXNlIEFsZXJ0IiBjbGFzcz0idGV4dC1sZWZ0IGNvdW50LWluZm8tY29tbWVudCBjb21tZW50LWljb24gY29tbWVudC1pY29uIGdseXBoaWNvbiBnbHlwaGljb24tY29tbWVudCI+PC9zcGFuPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICIiLAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY29sLW1pbi0yNScsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Zm9udC1zaXplOiAxMjUlOyIgZGF0YS1maWVsZD0icmVtb3ZlU2lnbmFsIiBkYXRhLWlkPSInICsgcm93LmlkICsgJyIgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tbGluayI+PC9zcGFuPicgKwogICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gc3R5bGU9ImRpc3BsYXk6IG5vbmU7IiBkYXRhLWZpZWxkID0ibWFzdGVyUHJlZlRlcm1BbGwiIGRhdGEtaWQ9IicgKyByb3cubWFzdGVyUHJlZlRlcm1BbGwgKyAnIj48L3NwYW4+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBzdHlsZT0iZGlzcGxheTogbm9uZTsiIGNsYXNzPSJhbGVydC1jaGVjay1ib3giIGRhdGEtaWQ9IicgKyByb3cuaWQgKyAnIj48L3NwYW4+ICcgKwogICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gc3R5bGU9ImRpc3BsYXk6IG5vbmU7IiBkYXRhLWZpZWxkPSJhc3NpZ25lZFRvIiBkYXRhLWN1cnJlbnQtdXNlci1pZD0iJyArIHJvdy5hc3NpZ25lZFRvLmlkICsgJyI+PC9zcGFuPicgKwogICAgICAgICAgICAgICAgICAgICAgICAnPGlucHV0IGNsYXNzPSJleGVjQ29uZmlnSWQiIGlkPSJleGVjQ29uZmlnSWQiIHR5cGU9ImhpZGRlbiIgdmFsdWU9IicgKyByb3cuZXhlY0NvbmZpZ0lkICsgJyIgLz4nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBzY3JvbGxYOnRydWUsCiAgICAgICAgc2Nyb2xsWTonMjIwcHgnLAogICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgIH1dCiAgICB9KTsKCiAgICAkKCcjcnhUYWJsZUFkSG9jUmV2aWV3JykuRGF0YVRhYmxlKCB7CiAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgfSwKICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgInVybCI6IFZBTElEQVRFRC5hZEhvY0xpc3RVcmwgKyAiP2lkPSIgKyAkKCIjc2lnbmFsSWQiKS52YWwoKSwKICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgIH0sCiAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgnLmFkaG9jLXdvcmtmbG93JykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJyZW1vdmVTaWduYWwiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgICAgIGZpbmRTaWduYWxzKCJBZC1Ib2MgQWxlcnQiLCBwcm9kdWN0TmFtZSwgcGFyZW50X3Jvdyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgeyJtRGF0YSI6ICJuYW1lIn0sCiAgICAgICAgICAgIHsibURhdGEiOiAicHJvZHVjdFNlbGVjdGlvbiJ9LAogICAgICAgICAgICB7Im1EYXRhIjogImV2ZW50U2VsZWN0aW9uIn0sCiAgICAgICAgICAgIHsibURhdGEiOiAiZGV0ZWN0ZWRCeSJ9LAogICAgICAgICAgICB7Im1EYXRhIjogImluaXREYXRhU3JjIn0sCiAgICAgICAgICAgIHsibURhdGEiOiAiZGlzcG9zaXRpb24ifSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogIiIsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdkdC1jZW50ZXInLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyO2ZvbnQtc2l6ZTogMTI1JTsiIGRhdGEtZmllbGQ9InJlbW92ZVNpZ25hbCIgZGF0YS1pZD0iJyArIHJvdy5pZCArICciIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLWxpbmsiPjwvc3Bhbj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIHN0eWxlPSJkaXNwbGF5OiBub25lOyIgZGF0YS1maWVsZCA9Im1hc3RlclByZWZUZXJtQWxsIiBkYXRhLWlkPSInICsgcm93Lm1hc3RlclByZWZUZXJtQWxsICsgJyI+PC9zcGFuPicgKwogICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gc3R5bGU9ImRpc3BsYXk6IG5vbmU7IiBjbGFzcz0iYWxlcnQtY2hlY2stYm94IiBkYXRhLWlkPSInICsgcm93LmlkICsgJyI+PC9zcGFuPiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxzcGFuIHN0eWxlPSJkaXNwbGF5OiBub25lOyIgZGF0YS1maWVsZD0iYXNzaWduZWRUbyIgZGF0YS1jdXJyZW50LXVzZXItaWQ9IicgKyByb3cuYXNzaWduZWRUby5pZCArICciPjwvc3Bhbj4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz0iZXhlY0NvbmZpZ0lkIiBpZD0iZXhlY0NvbmZpZ0lkIiB0eXBlPSJoaWRkZW4iIHZhbHVlPSInICsgcm93LmV4ZWNDb25maWdJZCArICciIC8+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgc2Nyb2xsWDogdHJ1ZSwKICAgICAgICBzY3JvbGxZOicyMjBweCcsCiAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgIH0pOwoKICAgIHRhYmxlTGl0ZXJhdHVyZVJldmlldyA9ICQoJyNyeFRhYmxlTGl0ZXJhdHVyZVJldmlldycpLkRhdGFUYWJsZSh7CiAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAidXJsIjogIi4uL2Fzc2V0cy9pMThuL2RhdGFUYWJsZXNfIiArIHVzZXJMb2NhbGUgKyAiLmpzb24iCiAgICAgICAgfSwKICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvL1RoZXJlIGlzIG5vIHdvcmtmbG93LCBhbHNvIGNvbW1lbnQgbW9kYWwgaXMgY2hhbmdlZAogICAgICAgICAgICAvLyBUT0RPOiBBZGQgbmV3IGNvbW1lbnQgbW9kYWwgY29kZSBoZXJlCiAgICAgICAgICAgICQoIi5tb3JlLW9wdGlvbiIpLndlYnVpUG9wb3Zlcih7CiAgICAgICAgICAgICAgICBodG1sOiB0cnVlLAogICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2hvdmVyJywKICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKS5hdHRyKCdtb3JlLWRhdGEnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2Nyb2xsT2ZmKCk7CiAgICAgICAgfSwKICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgInVybCI6IFZBTElEQVRFRC5saXRlcmF0dXJlQWxlcnRMaXN0VXJsICsgIj9pZD0iICsgJCgiI3NpZ25hbElkIikudmFsKCksCiAgICAgICAgICAgICJkYXRhU3JjIjogIiIKICAgICAgICB9LAogICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydE5hbWUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4+JyArIGVzY2FwZUhUTUwoZGF0YSkgKyAnPC9zcGFuPicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInByaW9yaXR5IiwKICAgICAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsicHJpb3JpdHkiXSwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImZvbnQtMjQiIHRpdGxlPSInICsgcm93LnByaW9yaXR5LnZhbHVlICsgJyI+PGkgY2xhc3M9IicgKyByb3cucHJpb3JpdHkuaWNvbkNsYXNzICArJyI+PC9pPjwvYT4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aXRsZSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHN0ckxlbmd0aCA9IHJvdy50aXRsZS5zcGxpdCgiICIpLmpvaW4oIiIpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB2YXIgbW9yZU9wdGlvbiA9IHN0ckxlbmd0aCA+IDQ1ID8gJzxhIGNsYXNzPSJwdWxsLXJpZ2h0IiB0eXBlPSJsaW5rIj48aSBjbGFzcz0iZmEgZmEtZWxsaXBzaXMtaCBtb3JlLW9wdGlvbiIgIG1vcmUtZGF0YT0iJyArIHJvdy50aXRsZSArICciPiA8L2k+IDwvYT4nIDogIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3Bhbj4nICsgIGdlbmVyYXRlQXJ0aWNsZUxpbmsocm93LmFydGljbGVJZCwgcm93LnRpdGxlLnN1YnN0cmluZygwLCA0NSkpICsgbW9yZU9wdGlvbiArICc8L3NwYW4+JzsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTI1MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImF1dGhvcnMiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyTGVuZ3RoID0gcm93LmF1dGhvcnMuc3BsaXQoIiAiKS5qb2luKCIiKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb3JlT3B0aW9uID0gc3RyTGVuZ3RoID4gNDUgPyAnPGEgY2xhc3M9InB1bGwtcmlnaHQiIHR5cGU9ImxpbmsiPjxpIGNsYXNzPSJmYSBmYS1lbGxpcHNpcy1oIG1vcmUtb3B0aW9uIiAgbW9yZS1kYXRhPSInICsgcm93LmF1dGhvcnMgKyAnIj4gPC9pPiA8L2E+JyA6ICIiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuPicgKyByb3cuYXV0aG9ycy5zdWJzdHJpbmcoMCwgNDUpICsgbW9yZU9wdGlvbiArICc8L3NwYW4+JzsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTI1MCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInB1YmxpY2F0aW9uRGF0ZSIsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdjb2wtbWluLTEwMCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImRpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiIiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbC1taW4tMjUgY29sLW1heC0yNScsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxzcGFuIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Zm9udC1zaXplOiAxMjUlOyIgZGF0YS1pbmZvPSJyb3ciIGRhdGEtc2lnbmFsPXRydWUgZGF0YS1uYW1lID0iTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQiIGNsYXNzPSJ0ZXh0LWxlZnQgY291bnQtaW5mby1jb21tZW50IGNvbW1lbnQtaWNvbiBjb21tZW50LWljb24gZ2x5cGhpY29uIGdseXBoaWNvbi1jb21tZW50Ij48L3NwYW4+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgc2Nyb2xsWDogdHJ1ZSwKICAgICAgICBzY3JvbGxZOicyMjBweCcKICAgIH0pOwoKICAgIHZhciBmaW5kU2lnbmFscyA9IGZ1bmN0aW9uIChhbGVydFR5cGUsIGFsZXJ0SWQsIHJvdykgewogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogImZldGNoU2lnbmFsc0xpc3Q/YWxlcnRJZD0iICsgYWxlcnRJZCArICImYWxlcnRUeXBlPSIgKyBhbGVydFR5cGUsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc2lnbmFsc0Jvb2xlYW4pIHsKICAgICAgICAgICAgICAgICAgICAkKCcjc2lnbmFsLWRpc3NvY2lhdGUtbW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICAgICAgICAgICQoJyNzaWduYWwtZGlzc29jaWF0ZS1tb2RhbCAjY2hhbmdlLWJ0JykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByb3cuZmluZCgnLmNoYW5nZS13b3JrZmxvdy1zdGF0ZScpLnRyaWdnZXIoJ2NsaWNrJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaWduYWwtZGlzc29jaWF0ZS1tb2RhbCcpLm1vZGFsKCdoaWRlJykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkKCcjc2lnbmFsLWRpc3NvY2lhdGUtbW9kYWwgI2NhbmNlbC1idCcpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3NpZ25hbC1kaXNzb2NpYXRlLW1vZGFsJykubW9kYWwoJ2hpZGUnKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJvdy5maW5kKCcuY2hhbmdlLXdvcmtmbG93LXN0YXRlJykudHJpZ2dlcignY2xpY2snKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGV4Y2VwdGlvbikKICAgICAgICAgICAgfQoKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGRyaWxsX2Rvd25fb3B0aW9ucyA9IGZ1bmN0aW9uICh2YWx1ZSx0eXBlLHR5cGVGbGFnLGNsYXNzTmFtZSxyb3csaXNTdGFydERhdGUsZmxhZ192YXIpIHsKICAgICAgaWYocm93LmRhdGFTb3VyY2UgPT0gJ0VWREFTJyl7CiAgICAgICAgICByZXR1cm4gZXZkYXNEcmlsbERvd25PcHRpb25zKHZhbHVlLCByb3cucHJvZHVjdE5hbWUsIHJvdy5wcmVmZXJyZWRUZXJtLCByb3cuZXhlY0NvbmZpZ0lkLCBmbGFnX3Zhcixpc1N0YXJ0RGF0ZSxyb3cuaWQsJycsY2xhc3NOYW1lKTsKICAgICAgfWVsc2UgewogICAgICAgICAgcmV0dXJuIGNudF9kcmlsbF9kb3duKHZhbHVlLHR5cGUsdHlwZUZsYWcscm93LmV4ZWNDb25maWdJZCwgcm93LmlkLCByb3cucHJvZHVjdElkLCByb3cucHRDb2RlLGNsYXNzTmFtZSwgcm93LmRhdGFTb3VyY2UpOwogICAgICB9CiAgICB9OwoKICAgIHZhciBjbnRfZHJpbGxfZG93biA9IGZ1bmN0aW9uICh2YWx1ZSwgdHlwZSwgdHlwZUZsYWcsIGV4ZWN1dGVkQ29uZmlnSWQsIGFsZXJ0SWQsIHByb2R1Y3RJZCwgcHRDb2RlLCBjbGFzc05hbWUpIHsKICAgICAgICB2YXIgbGlzdENvbmZpZ1VybCA9ICIvc2lnbmFsL2FnZ3JlZ2F0ZUNhc2VBbGVydC9jYXNlRHJpbGxEb3duP2lkPSIgKyBhbGVydElkICsgJyZ0eXBlRmxhZz0nICsgdHlwZUZsYWcgKyAnJnR5cGU9JyArCiAgICAgICAgICAgIHR5cGUgKyAiJmV4ZWN1dGVkQ29uZmlnSWQ9IiArIGV4ZWN1dGVkQ29uZmlnSWQgKyAiJnByb2R1Y3RJZD0iICsgcHJvZHVjdElkICsgIiZwdENvZGU9IiArIHB0Q29kZQogICAgICAgIHZhciBzaW5nbGVDYXNlRGV0YWlsc1VybCA9ICcvc2lnbmFsL3NpbmdsZUNhc2VBbGVydC9jYXNlU2VyaWVzRGV0YWlscz9hZ2dFeGVjdXRpb25JZD0nICsgZXhlY3V0ZWRDb25maWdJZCArICcmYWdnQWxlcnRJZD0nICsgYWxlcnRJZCArICcmYWdnQ291bnRUeXBlPScgKyBjbGFzc05hbWUgKyAnJnByb2R1Y3RJZD0nICsgcHJvZHVjdElkICsgJyZwdENvZGU9JyArIHB0Q29kZSArICcmdHlwZT0nICsgdHlwZSArICImdHlwZUZsYWc9IiArIHR5cGVGbGFnOwogICAgICAgIHZhciBzZXJpZXNEYXRhID0gImlkOiIgKyBhbGVydElkICsgIix0eXBlRmxhZzoiICsgdHlwZUZsYWcgKyAiLHR5cGU6IiArIHR5cGUgKyAiLGV4ZWN1dGVkQ29uZmlnSWQ6IiArCiAgICAgICAgICAgIGV4ZWN1dGVkQ29uZmlnSWQgKyAiLHByb2R1Y3RJZDoiICsgcHJvZHVjdElkICsgIixwdENvZGU6IiArIHB0Q29kZTsKCiAgICAgICAgaWYgKHR5cGVvZiBwdnJJbnRlZ3JhdGUgIT0gInVuZGVmaW5lZCIgJiYgSlNPTi5wYXJzZShwdnJJbnRlZ3JhdGUpKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25CdXR0b24gPSAnPGRpdiBzdHlsZT0iZGlzcGxheTogYmxvY2siIGNsYXNzPSJidG4tZ3JvdXAgZHJvcGRvd24iPiBcCiAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImRyb3Bkb3duLXRvZ2dsZSAnICsgY2xhc3NOYW1lICsgJyIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIiBocmVmPSIjIj4nICsgdmFsdWUgKyAnPC9hPiBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUgZHJvcGRvd24tbWVudS1yaWdodCIgcm9sZT0ibWVudSIgc3R5bGU9Im1pbi13aWR0aDogODBweCAhaW1wb3J0YW50OyBmb250LXNpemU6IDEycHg7Ij4gXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSByb2xlPSJwcmVzZW50YXRpb24iPjxhIGhyZWY9JyArIHNpbmdsZUNhc2VEZXRhaWxzVXJsICsgJyB0YXJnZXQ9Il9ibGFuayIgZGF0YS11cmw9JyArIGxpc3RDb25maWdVcmwgKyAnIGNsYXNzPSIiPicgKyAnQ2FzZSBTZXJpZXMnICsgJzwvYT48L2xpPiBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgY2xhc3M9ImdlbmVyYXRlLWNhc2Utc2VyaWVzIiBkYXRhLXVybD0iJyArIHNlcmllc0RhdGEgKyAnIiAnICsKICAgICAgICAgICAgICAgICdyb2xlPSJtZW51aXRlbSIgaHJlZj0iIyIgPicgKyAnU2F2ZSBDYXNlIFNlcmllcycgKyAnPC9hPjwvbGk+XAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+IFwKICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JzsKICAgICAgICAgICAgcmV0dXJuIGFjdGlvbkJ1dHRvbjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IiMiIGRhdGEtdXJsPScgKyBsaXN0Q29uZmlnVXJsICsgJyBjbGFzcz0iY2FzZS1kcmlsbC1kb3duLWxpbmsgJyArIGNsYXNzTmFtZSArICciPicgKyB2YWx1ZSArICc8L2E+JwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGV2ZGFzRHJpbGxEb3duT3B0aW9ucyA9IGZ1bmN0aW9uICh2YWx1ZSwgc3Vic3RhbmNlLCBwdCwgaWQsIGZsYWdfdmFyLCBpc1N0YXJ0RGF0ZSwgYWxlcnRJZCwgdXJsLCBjbGFzc05hbWUpIHsKICAgICAgICB2YXIgYWN0aW9uQnV0dG9uOwogICAgICAgIHZhciBjYXNlRHJpbGxEb3duVXJsID0gZW5jb2RlVVJJKGZldGNoRHJpbGxEb3duRGF0YVVybCArICI/c3Vic3RhbmNlPSIgKyBzdWJzdGFuY2UgKyAiJmlkPSIgKyBpZCArICImcHQ9IiArIHB0ICsgIiZmbGFnVmFyPSIgKyBmbGFnX3ZhciArICImaXNTdGFydERhdGU9IiArIGlzU3RhcnREYXRlICsgIiZhbGVydElkPSIgKyBhbGVydElkKTsKICAgICAgICBpZiAodXJsICYmIHVybCAhPSAnJykgewogICAgICAgICAgICBhY3Rpb25CdXR0b24gPSAnPGRpdiBzdHlsZT0iZGlzcGxheTogYmxvY2siIGNsYXNzPSJidG4tZ3JvdXAgZHJvcGRvd24iPicgKwogICAgICAgICAgICAgICAgJzxhIGNsYXNzPSJkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biIgaHJlZj0iIyI+PHNwYW4gY2xhc3M9IicgKyBjbGFzc05hbWUgKyAnIj4nICsgdmFsdWUgKyAnPC9zcGFuPjwvYT4nICsKICAgICAgICAgICAgICAgICc8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUgZHJvcGRvd24tbWVudS1yaWdodCIgcm9sZT0ibWVudSIgc3R5bGU9Im1pbi13aWR0aDogODBweCAhaW1wb3J0YW50OyBmb250LXNpemU6IDEycHg7Ij4nICsKICAgICAgICAgICAgICAgICc8bGkgcm9sZT0icHJlc2VudGF0aW9uIj48YSBocmVmPSInICsgY2FzZURyaWxsRG93blVybCArICciIGNsYXNzPSJldmRhcy1jYXNlLWRyaWxsLWRvd24tbGluayI+Q2FzZSBMaXN0PC9hPjwvbGk+JyArCiAgICAgICAgICAgICAgICAnPGxpIHJvbGU9InByZXNlbnRhdGlvbiI+PGEgaHJlZj0iJyArIHVybCArICciIHRhcmdldD0iX2JsYW5rIj5FdmRhcyBMaW5rPC9hPjwvbGk+JyArCiAgICAgICAgICAgICAgICAnPC91bD4nICsKICAgICAgICAgICAgICAgICc8L2Rpdj4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiA9ICc8YSBocmVmPSInICsgY2FzZURyaWxsRG93blVybCArICciIGNsYXNzPSJldmRhcy1jYXNlLWRyaWxsLWRvd24tbGluayI+PHNwYW4gY2xhc3M9IicgKyBjbGFzc05hbWUgKyAnIj4nICsgdmFsdWUgKyAnPC9zcGFuPjwvYT4nCiAgICAgICAgfQogICAgICAgIHJldHVybiBhY3Rpb25CdXR0b24KICAgIH07CgogICAgdmFyIGNhbGN1bGF0ZVNlcmlvdXNuZXNzID0gZnVuY3Rpb24gKHNlclZhbCkgewogICAgICAgIHZhciBjYWxjdWxhdGVkU2VyaW91c25lc3MgPSAiIjsKICAgICAgICBzd2l0Y2ggKHNlclZhbCkgewogICAgICAgICAgICBjYXNlICJTZXJpb3VzIjoKICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRTZXJpb3VzbmVzcyA9ICJZIjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJOb24tU2VyaW91cyI6CiAgICAgICAgICAgICAgICBjYWxjdWxhdGVkU2VyaW91c25lc3MgPSAiTiI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiVW5rbm93biI6CiAgICAgICAgICAgICAgICBjYWxjdWxhdGVkU2VyaW91c25lc3MgPSAiVSI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRTZXJpb3VzbmVzcyA9ICItIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZWRTZXJpb3VzbmVzczsKICAgIH07CgoKICAgIHZhciBjYWxjdWxhdGVMaXN0ZWRuZXNzID0gZnVuY3Rpb24gKGxpc3RWYWwpIHsKICAgICAgICB2YXIgY2FsY3VsYXRlZExpc3RlZG5lc3MgPSAiIjsKICAgICAgICBzd2l0Y2ggKGxpc3RWYWwpIHsKICAgICAgICAgICAgY2FzZSAiTGlzdGVkIjoKICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRMaXN0ZWRuZXNzID0gIk4iOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIlVubGlzdGVkIjoKICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRMaXN0ZWRuZXNzID0gIlkiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIlVua25vd24iOgogICAgICAgICAgICAgICAgY2FsY3VsYXRlZExpc3RlZG5lc3MgPSAiVSI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRMaXN0ZWRuZXNzID0gIi0iOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FsY3VsYXRlZExpc3RlZG5lc3M7CiAgICB9OwoKICAgIHZhciBnZW5lcmF0ZUFydGljbGVMaW5rID0gZnVuY3Rpb24gKGFydGljbGVJZCwgdGl0bGUpIHsKICAgICAgICByZXR1cm4gJzxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInICsgcHViTWVkVXJsICsgYXJ0aWNsZUlkICsgJyI+JyArIHRpdGxlICsgJzwvYT4nOwogICAgfTsKICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICIuZ2VuZXJhdGUtY2FzZS1zZXJpZXMiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG1ldGFJbmZvID0gJCh0aGlzKS5hdHRyKCJkYXRhLXVybCIpOwogICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgdmFyIGV4ZWNDb25maWdJZCA9IHBhcmVudF9yb3cuZmluZCgiI2V4ZWNDb25maWdJZCIpLnZhbCgpOwogICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJwcm9kdWN0TmFtZSJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgIHZhciBldmVudE5hbWUgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iZXZlbnROYW1lIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgdmFyIGNhc2VTZXJpZXNNb2RhbCA9ICQoIiNjYXNlLXNlcmllcy1tb2RhbCIpOwogICAgICAgIGNhc2VTZXJpZXNNb2RhbC5tb2RhbCgic2hvdyIpOwogICAgICAgIGNhc2VTZXJpZXNNb2RhbC5maW5kKCIjY2FzZS1zZXJpZXMtbmFtZSIpLnZhbChwcm9kdWN0TmFtZSArICJfIiArIGV2ZW50TmFtZSArICJfIiArIGV4ZWNDb25maWdJZCk7CiAgICAgICAgY2FzZVNlcmllc01vZGFsLmZpbmQoIi5zYXZlLWNhc2Utc2VyaWVzIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VyaWVzTmFtZSA9IGNhc2VTZXJpZXNNb2RhbC5maW5kKCIjY2FzZS1zZXJpZXMtbmFtZSIpLnZhbCgpOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiBnZW5lcmF0ZUNhc2VTZXJpZXNVcmwgKyAiP21ldGFJbmZvPSIgKyBtZXRhSW5mbyArICImc2VyaWVzTmFtZT0iICsgc2VyaWVzTmFtZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlU2VyaWVzTW9kYWwubW9kYWwoImhpZGUiKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIGNhc2VTZXJpZXNNb2RhbC5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0pCiAgICB9KTsKCiAgICAkKGRvY3VtZW50KS5vbigiY2xpY2siLCIuY2FzZURldGFpbFVybCIsZnVuY3Rpb24oKXsKICAgICAgICB2YXIgc2NhQWxlcnRJZCA9IHRhYmxlU2luZ2xlUmV2aWV3LnJvdygkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuaW5kZXgoKSkuZGF0YSgpLmlkOwogICAgICAgIHZhciBjYXNlVmVyc2lvbiA9ICQodGhpcykuZmluZCgic3BhbltkYXRhLWZpZWxkPWNhc2VWZXJzaW9uXSIpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICB2YXIgY2FzZU51bWJlciA9ICQodGhpcykuZmluZCgic3BhbltkYXRhLWZpZWxkPWNhc2VOdW1iZXJdIikuYXR0cigiZGF0YS1pZCIpOwogICAgICAgIHNpZ25hbC51dGlscy5wb3N0VXJsKGNhc2VEZXRhaWxVcmwsIHsKICAgICAgICAgICAgY2FzZU51bWJlcjogY2FzZU51bWJlciwKICAgICAgICAgICAgdmVyc2lvbjogY2FzZVZlcnNpb24sCiAgICAgICAgICAgIGZvbGxvd1VwTnVtYmVyOiBudWxsLAogICAgICAgICAgICBhbGVydElkOiBzY2FBbGVydElkLAogICAgICAgICAgICBpc0ZhZXJzOiAkKCIjaXNGYWVycyIpLnZhbCgpLAogICAgICAgICAgICBmdWxsQ2FzZUxpc3Q6IEpTT04uc3RyaW5naWZ5KGZ1bGxDYXNlTGlzdCkKICAgICAgICB9LCB0cnVlKTsKICAgIH0pOwoKfSk7CgoKCgoKCgoKCg==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="9190328" offset="0" length="4096" />
        <PacketInfo time="9190343" offset="4096" length="16384" />
        <PacketInfo time="9190343" offset="20480" length="8146" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>