$(document).ready(function(){function e(a){a.on("shown.bs.modal",function(){$("textarea").trigger("keyup");a.find(".textAreaValue").val()?a.find(".updateTextarea").html($.i18n._("labelUpdate")):a.find(".updateTextarea").html($.i18n._("labelAdd"))})}function d(a){var b=$("#textarea-ext1");$("#textarea-ext1 .updateTextarea").unbind().click(function(c){c.preventDefault();$("#"+a).val(b.find("textarea").val());b.modal("hide")})}disableOptions(disabledValues);$("#detected-date-picker").datepicker({date:$("#detectedDate").val()?
$("#detectedDate").val():null,allowPastDates:!0,momentConfig:{culture:userLocale,tz:userTimeZone,format:DEFAULT_DATE_DISPLAY_FORMAT},restricted:[{from:TOMORROW,to:Infinity}]});$("#aggStartDatePicker").datepicker({date:$("#aggStartDate").val()?$("#aggStartDate").val():null,allowPastDates:!0,momentConfig:{culture:userLocale,tz:userTimeZone,format:DEFAULT_DATE_DISPLAY_FORMAT}});$("#aggEndDatePicker").datepicker({date:$("#aggEndDate").val()?$("#aggEndDate").val():null,allowPastDates:!0,momentConfig:{culture:userLocale,
tz:userTimeZone,format:DEFAULT_DATE_DISPLAY_FORMAT}});$("#lastDecisionDatePicker").datepicker({date:$("#lastDecisionDate").val()?new Date($("#lastDecisionDate").val()):null,allowPastDates:!0});$("#haDateClosedDatePicker").datepicker({date:$("#haDateClosed").val()?$("#haDateClosed").val():null,allowPastDates:!0,momentConfig:{culture:userLocale,tz:userTimeZone,format:DEFAULT_DATE_DISPLAY_FORMAT}});$("#haDateClosedDatePi").datepicker({date:$("#haDateClosed").val()?new Date($("#haDateClosed").val()):
null,allowPastDates:!0});$("#haSignalStatus").select2();$("#evaluationMethods").select2();var b=null;if($("#signalActionTaken").val()){for(var b=$("#signalActionTaken").val().toString().replace("[","").replace("]","").split(","),c=0;c<b.length;c++)b[c]=b[c].trim();$("#actionTaken").select2().val(b).trigger("change")}else $("#actionTaken").select2();if($("#signalEvaluationMethod").val()){b=$("#signalEvaluationMethod").val().toString().replace("[","").replace("]","").split(",");for(c=0;c<b.length;c++)b[c]=
b[c].trim();$("#evaluationMethod").select2().val(b).trigger("change")}else $("#evaluationMethod").select2();$(".signalStrategy").change(function(){var a=$(this).val();""!=a?($.ajax({url:searchStrategyProducts+"?id="+a,success:function(a){$("#productNames").val(a.productNames)}}),a=$(".signalStrategy  option:selected").text(),$("#signalName").val(a+"_signal")):($("#signalName").val(""),$("#productNames").val(""))});$("#includeInAggregateReportChk").click(function(){$(this).is(":checked")?$("#includeInAggregateReport").attr("value",
!0):$("#includeInAggregateReport").attr("value",!1)});if($("#signalSource").val()){b=$("#signalSource").val().toString().replace("[","").replace("]","").split("##");for(c=0;c<b.length;c++)b[c]=b[c].trim();$("#initialDataSource").select2().val(b).trigger("change")}else $("#initialDataSource").select2();if($("#topicCategoryList").val()){b=$("#topicCategoryList").val().toString().replace("[","").replace("]","").split(",");for(c=0;c<b.length;c++)b[c]=b[c].trim();$("#signalTypeList").select2().val(b).trigger("change")}else $("#signalTypeList").select2();
$("#linkedSignal").select2().data("select2").$dropdown.addClass("cell-break");$("#signalOutcome").select2();$(".textarea-ext .openTextArea").unbind().click(function(a){a.preventDefault();a=$("#textarea-ext1");e(a);var b=$(this).prev("textarea");a.find(".textAreaValue").val(b.val());a.find(".modal-title").text(b.prev("label").text().trim().replace("*",""));a.modal("show");d(b.prop("id"))});$(document).on("click","#linkedSignalInfo",function(){var a=$("#linkedSignalInfo");$(".viewLinkedSignal").html("");
if($("#linkedSignal").val()&&0<$("#linkedSignal").val().length){var b="";$("#linkedSignal option:selected").each(function(){var a=$(this);b+='<li><a href="'+linkedSignalDetailUrl+"?id="+a.val()+'" target="_blank">'+a.text()+"</a></li>"});$(".viewLinkedSignal").append(b);a.show()}else $(".viewLinkedSignal").html(""),a.hide()});$(document).on("change","#linkedSignal",function(){var a=$("#linkedSignalInfo");$(this).val()&&0<$(this).val().length?a.show():a.hide()});$(document).on("submit","#signalEditForm",
function(a){$("option").prop("disabled",!1);a.preventDefault();a=$(this).serialize();$.ajax({type:"POST",url:updateSignalUrl,data:a,dataType:"json",success:f});disableOptions(disabledValues)});var f=function(a){if(a.status)$(".alert-success").find(".success-message").text(a.data),$(".alert-danger").hasClass("hide")||$(".alert-danger").addClass("hide"),$(".alert-success").removeClass("hide"),setTimeout(function(){addHideClass($(".alert-success"))},5E3),$("#productSelectionAssessment").val($("#productSelection").val()),
$("#eventSelectionAssessment").val($("#eventSelection").val()),$("#showProductSelectionAssessment").html($("#showProductSelection").html()),$("#showEventSelectionAssessment").html($("#showEventSelection").html()),assessmentDictionaryModal.loadValuesToDictionary();else{var b=$(".alert-danger"),c="<ul>";"object"==typeof a.data?$.each(a.data,function(a,b){c+="<li>"+b+"</li>"}):c+="<li>"+a.data+"</li>";c+="</ul>";b.find(".error-message").html(c);$(".alert-success").hasClass("hide")||$(".alert-success").addClass("hide");
b.removeClass("hide")}$("html, body").animate({scrollTop:0},"slow");disableOptions(disabledValues)};$(document).on("click",".errorButton",function(a){a.preventDefault();$(".alert-danger").addClass("hide")});$(document).on("click",".successButton",function(a){a.preventDefault();$(".alert-success").addClass("hide")});$("#eventModalAssessment").on("shown.bs.modal",function(){$("#eventSmqSelectAssessment").on("change",function(){null!==$(this).val()?($("#eventModalAssessment").find("input[type=text]").attr("disabled",
!0).val(""),eventValues={1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[]}):$("#eventModalAssessment").find("input[type=text]").attr("disabled",!1)})});$("#eventModal").on("shown.bs.modal",function(){$("#eventSmqSelect").on("change",function(){null!==$(this).val()?($("#eventModal").find("input[type=text]").attr("disabled",!0).val(""),eventValues={1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[]}):$("#eventModal").find("input[type=text]").attr("disabled",!1)})});$("#assessmentToPdf, #assessmentToXlsx, #assessmentToDocx").each(function(){$(this).on("click",
function(a){a.preventDefault();a=$(this).attr("href");a=(/outputFormat=(.+?)(&|$)/.exec(a)||[,null])[1];a=jQuery("<form>",{action:$(this).attr("href"),target:"_top"}).append(jQuery("<input>",{name:"dateRange",value:$("#dateRange").val(),type:"hidden"})).append(jQuery("<input>",{name:"productSelection",value:$("#productSelectionAssessment").val(),type:"hidden"})).append(jQuery("<input>",{name:"eventSelection",value:$("#eventSelectionAssessment").val(),type:"hidden"})).append(jQuery("<input>",{name:"validatedSignal.id",
value:$("#signalId").val(),type:"hidden"})).append(jQuery("<input>",{name:"outputFormat",value:a,type:"hidden"})).append(jQuery("<input>",{name:"reportType",value:"peber",type:"hidden"}));$("#hiddenform").append(a);a.submit()})})});
var addHideClass=function(e){e.addClass("hide")},disableOptions=function(e){var d=[];$.map(e,function(b,c){if(""!=b)for(d=b.toString().replace("[","").replace("]","").split(","),b=0;b<d.length;b++)"signalStatus"==c?$("select[name=signalStatus]").find('option[value="'+d[b].trim()+'"]').prop("disabled",!0):$("#"+c).find('option[value="'+d[b].trim()+'"]').prop("disabled",!0)})};