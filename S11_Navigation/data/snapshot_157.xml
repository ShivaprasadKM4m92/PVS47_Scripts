<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="157">
  <HTTPTask id="805" hostname="10.100.22.24:8181" path="/signal/assets/app/pvs/literatureSearch/literature_details-92c0d2e9673d62ab4a216f31e583fbf4.js" url="http://10.100.22.24:8181/signal/assets/app/pvs/literatureSearch/literature_details-92c0d2e9673d62ab4a216f31e583fbf4.js" ip="10.100.22.24" port="8181" connectionId="29" origin="Primary" frame="1" startDateTime="2020-05-22T19:37:43.490+05:30" startTime="119578062" endTime="119578796">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTAuMTAwLjIyLjI0OjgxODE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzgxLjAuNDA0NC4xMzggU2FmYXJpLzUzNy4zNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC9saXRlcmF0dXJlQWxlcnQvZGV0YWlscw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZW4tVVMsZW47cT0wLjk=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>U0VTU0lPTj00OGMyNjliZC01NTcyLTRhN2UtYmFiOS0wZmNmY2NiZDM0NjU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9zaWduYWwvYXNzZXRzL2FwcC9wdnMvbGl0ZXJhdHVyZVNlYXJjaC9saXRlcmF0dXJlX2RldGFpbHMtOTJjMGQyZTk2NzNkNjJhYjRhMjE2ZjMxZTU4M2ZiZjQuanMgSFRUUC8xLjENCkhvc3Q6IDEwLjEwMC4yMi4yNDo4MTgxDQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODEuMC40MDQ0LjEzOCBTYWZhcmkvNTM3LjM2DQpBY2NlcHQ6ICovKg0KUmVmZXJlcjogaHR0cDovLzEwLjEwMC4yMi4yNDo4MTgxL3NpZ25hbC9saXRlcmF0dXJlQWxlcnQvZGV0YWlscw0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlDQpBY2NlcHQtTGFuZ3VhZ2U6IGVuLVVTLGVuO3E9MC45DQpDb29raWU6IFNFU1NJT049NDhjMjY5YmQtNTU3Mi00YTdlLWJhYjktMGZjZmNjYmQzNDY1DQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="SESSION" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NDhjMjY5YmQtNTU3Mi00YTdlLWJhYjktMGZjZmNjYmQzNDY1</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>32940</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Last-Modified" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyMSBNYXkgMjAyMCAwODoxNzozMCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ImFwcC9wdnMvbGl0ZXJhdHVyZVNlYXJjaC9saXRlcmF0dXJlX2RldGFpbHMtOTJjMGQyZTk2NzNkNjJhYjRhMjE2ZjMxZTU4M2ZiZjQuanMi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGljLCBtYXgtYWdlPTMxNTM2MDAw</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MzI5NDA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAyMiBNYXkgMjAyMCAxNDowMzoyNCBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIA0KTGFzdC1Nb2RpZmllZDogVGh1LCAyMSBNYXkgMjAyMCAwODoxNzozMCBHTVQNCkVUYWc6ICJhcHAvcHZzL2xpdGVyYXR1cmVTZWFyY2gvbGl0ZXJhdHVyZV9kZXRhaWxzLTkyYzBkMmU5NjczZDYyYWI0YTIxNmYzMWU1ODNmYmY0LmpzIg0KVmFyeTogQWNjZXB0LUVuY29kaW5nDQpDYWNoZS1Db250cm9sOiBwdWJsaWMsIG1heC1hZ2U9MzE1MzYwMDANCkNvbnRlbnQtRW5jb2Rpbmc6IGd6aXANCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdDtjaGFyc2V0PVVURi04DQpDb250ZW50LUxlbmd0aDogMzI5NDANCkRhdGU6IEZyaSwgMjIgTWF5IDIwMjAgMTQ6MDM6MjQgR01UDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCi8vIGEgY29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIHBhcnNpbmcgc3RyaW5nIG5hbWVzcGFjZXMgYW5kCi8vIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGluZyBuZXN0ZWQgbmFtZXNwYWNlcwpmdW5jdGlvbiBleHRlbmQoIG5zLCBuc19zdHJpbmcgKSB7CiAgICB2YXIgcGFydHMgPSBuc19zdHJpbmcuc3BsaXQoJy4nKSwKICAgICAgICBwYXJlbnQgPSBucywKICAgICAgICBwbCwgaTsKICAgIGlmIChwYXJ0c1swXSA9PSAic2lnbmFsIikgewogICAgICAgIHBhcnRzID0gcGFydHMuc2xpY2UoMSk7CiAgICB9CiAgICBwbCA9IHBhcnRzLmxlbmd0aDsKICAgIGZvciAoaSA9IDA7IGkgPCBwbDsgaSsrKSB7CiAgICAgICAgLy9jcmVhdGUgYSBwcm9wZXJ0eSBpZiBpdCBkb2VzbnQgZXhpc3QKICAgICAgICBpZiAodHlwZW9mIHBhcmVudFtwYXJ0c1tpXV0gPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcGFyZW50W3BhcnRzW2ldXSA9IHt9OwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbcGFydHNbaV1dOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKfQoKLy9Qcm90b3R5cGUgbWV0aG9kcwpEYXRlLnByb3RvdHlwZS5hZGREYXlzID0gZnVuY3Rpb24oZGF5cykgewogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7CiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBkYXlzKTsKICAgIHJldHVybiBkYXRlOwp9OwoKQXJyYXkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKGYpe2YgIT0gdmFsdWV9KTsKfTsKClNDQV9XT1JLRkxPV19TVEFUVVNfRU5VTSA9IHsgTkVXOiAnTmV3JywKICAgIEFTU09DSUFURV9SRVZJRVdFRDogJ0Fzc29jaWF0ZVJldmlld2VkJywKICAgIFBIWVNJQ0lBTl9SRVZJRVdFRDogJ1BoeXNpY2lhblJldmlld2VkJywKICAgIFJFUVVJUkVEX0VWQUxVQVRJT046ICdSZXF1aXJlZEV2YWx1YXRpb24nLAogICAgQ09OVElOVUVEX01PTklUT1JJTkc6ICdDb250aW51ZWRNb25pdG9yaW5nJwp9OwoKU0NBX0RJU1BPU0lUSU9OX0VOVU0gPSB7CiAgICBWQUxJREFURURfU0lHTkFMIDogJ1ZhbGlkYXRlZFNpZ25hbCcsCiAgICBWQUxJREFURURfTk9OX0NPTkZJUk1FRF9TSUdOQUwgOiAnVmFsaWRhdGVkTm9uQ29uZmlybWVkU2lnbmFsJywKICAgIFZBTElEQVRFRF9VTkRFUl9JTlZFU1RJR0FUSU9OIDogJ1ZhbGlkYXRlZFVuZGVySW52ZXN0aWdhdGlvbicsCiAgICBDT01NVU5JQ0FURURfU0lHTkFMIDogJ0NvbW11bmljYXRlZFNpZ25hbCcsCiAgICBOT05fVkFMSUQ6ICdOb25WYWxpZCcKfTsKClNDQV9QUklPUklUWV9FTlVNID0gewogICAgSElHSDogIkhpZ2giLAogICAgTUVESVVNOiAiTWVkaXVtIiwKICAgIExPVzogIkxPVyIKfTsKCkRBVEVfRk1UX1RaID0gIllZWVktTU0tREQiOwoKc2lnbmFsLnV0aWxzID0gKGZ1bmN0aW9uKCkgewoKICAgIHZhciBzdGFja2VkID0gZnVuY3Rpb24odG9wVmFsdWUsIGJvdHRvbVZhbHVlKSB7CiAgICAgICAgdmFyIHRvcENvbXAgPSAiIjsKICAgICAgICB2YXIgYm90dG9tQ29tcCA9ICIiOwoKICAgICAgICBpZihfLmlzRnVuY3Rpb24odG9wVmFsdWUpKSB7CiAgICAgICAgICAgIHRvcENvbXAgPSB0b3BWYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdG9wQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLXRvcCI+JyArIHRvcFZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIGlmIChfLmlzRnVuY3Rpb24oYm90dG9tVmFsdWUpKSB7CiAgICAgICAgICAgIGJvdHRvbUNvbXAgPSBib3R0b21WYWx1ZSgpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYm90dG9tQ29tcCA9ICc8ZGl2IGNsYXNzPSJzdGFja2VkLWNlbGwtY2VudGVyLWJvdHRvbSI+JyArIGJvdHRvbVZhbHVlICsgJzwvZGl2PicKICAgICAgICB9CgogICAgICAgIHJldHVybiB0b3BDb21wICsgYm90dG9tQ29tcAogICAgfTsKCiAgICAvLyBBbmQgdGhpcyBpcyB0aGUgZGVmaW5pdGlvbiBvZiB0aGUgY3VzdG9tIGZ1bmN0aW9uIOKAiwogICAgdmFyIHJlbmRlciA9IGZ1bmN0aW9uKHRtcGxfbmFtZSwgdG1wbF9kYXRhKSB7CgogICAgICAgIGlmICggIXJlbmRlci50bXBsX2NhY2hlICkgewoKCgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZSA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAoIXJlbmRlci50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgdmFyIHRtcGxfZGlyID0gJy9zaWduYWwvYXNzZXRzL2FwcC9wdnMvaGJzLXRlbXBsYXRlcyc7CiAgICAgICAgICAgIHZhciB0bXBsX3VybCA9IHRtcGxfZGlyICsgJy8nICsgdG1wbF9uYW1lICsgJy5oYnMnOwoKICAgICAgICAgICAgdmFyIHRtcGxfc3RyaW5nID0gIiI7CiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHRtcGxfdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0bXBsX3N0cmluZyA9IGRhdGEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gSGFuZGxlYmFycy5jb21waWxlKHRtcGxfc3RyaW5nKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZW5kZXIudG1wbF9jYWNoZVt0bXBsX25hbWVdKHRtcGxfZGF0YSkKICAgIH07CgogICAgdmFyIGhic19wYXJ0aWFsID0gZnVuY3Rpb24odG1wbF9uYW1lKSB7CiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlKSB7CiAgICAgICAgICAgIGhic19wYXJ0aWFsLnRtcGxfY2FjaGUgPSB7fQogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0pIHsKICAgICAgICAgICAgIHZhciB0bXBsX2RpciA9ICcvc2lnbmFsL2Fzc2V0cy9hcHAvcHZzL2hicy10ZW1wbGF0ZXMnOwogICAgICAgICAgICB2YXIgdG1wbF91cmwgPSB0bXBsX2RpciArICcvJyArIHRtcGxfbmFtZSArICcuaGJzJzsKCiAgICAgICAgICAgIHZhciB0bXBsX3N0cmluZyA9ICIiOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiB0bXBsX3VybCwKICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdG1wbF9zdHJpbmcgPSBkYXRhCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaGJzX3BhcnRpYWwudG1wbF9jYWNoZVt0bXBsX25hbWVdID0gdG1wbF9zdHJpbmcKICAgICAgICB9CgogICAgICAgIHJldHVybiBoYnNfcGFydGlhbC50bXBsX2NhY2hlW3RtcGxfbmFtZV0KICAgIH07CgogICAgdmFyIGNvbXBvc2VVcmwgPSBmdW5jdGlvbihjb250cm9sbGVyLCBhY3Rpb24sIHBhcmFtcykgewogICAgICAgIHZhciB1cmwgPSAiL3NpZ25hbC8iICsgY29udHJvbGxlciArICIvIiArIGFjdGlvbiArIChfLmlzTnVsbChwYXJhbXMpID8gJycgOiAnPycgKyBjb21wb3NlUGFyYW1zKHBhcmFtcykpOwoKICAgICAgICByZXR1cm4gdXJsCiAgICB9OwoKICAgIC8vVE9ETyA6IE5lZWQgdG8gY2hhbmdlIHRoaXMgdG8gaGFuZGxlYmFyIGZvcm0sIFdpbGwgYmUgZG9uZSBsYXRlcgogICAgdmFyIHBvc3RVcmwgPSBmdW5jdGlvbiAocGF0aCwgcGFyYW1zLCBuZXdXaW5kb3cpIHsKCiAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKICAgICAgICBmb3JtLm1ldGhvZCA9ICJwb3N0IjsKICAgICAgICBmb3JtLmFjdGlvbiA9IHBhdGg7CiAgICAgICAgZm9ybS5lbmN0eXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgaWYgKG5ld1dpbmRvdykgZm9ybS50YXJnZXQgPSAiX2JsYW5rIjsKCiAgICAgICAgdmFyIHRva2VuID0gJCgibWV0YVtuYW1lPSdfY3NyZiddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHZhciBwYXJhbWV0ZXIgPSAkKCJtZXRhW25hbWU9J19jc3JmX3BhcmFtZXRlciddIikuYXR0cigiY29udGVudCIpOwogICAgICAgIHBhcmFtc1twYXJhbWV0ZXJdID0gdG9rZW47CiAgICAgICAgZm9yIChsZXQga2V5IGluIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLnR5cGUgPSAnaGlkZGVuJzsKICAgICAgICAgICAgICAgIGhpZGRlbkZpZWxkLm5hbWUgPSBrZXk7CiAgICAgICAgICAgICAgICBoaWRkZW5GaWVsZC52YWx1ZSA9IHBhcmFtc1trZXldOwogICAgICAgICAgICAgICAgZm9ybS5hcHBlbmRDaGlsZChoaWRkZW5GaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmb3JtKTsKICAgICAgICBmb3JtLnN1Ym1pdCgpOwogICAgfQoKICAgIHZhciBjb21wb3NlUGFyYW1zID0gZnVuY3Rpb24obykgewogICAgICAgIHJldHVybiBfLm1hcChfLnBhaXJzKG8pLCBmdW5jdGlvbihwKXtyZXR1cm4gcC5qb2luKCc9Jyl9ICkuam9pbignJicpCiAgICB9OwoKICAgIHZhciBjYXBpdGFsSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgJiYgc1swXS50b1VwcGVyQ2FzZSgpICsgcy5zbGljZSgxKTsKICAgIH07CgogICAgdmFyIGJyZWFrSXQgPSBmdW5jdGlvbihzKSB7CiAgICAgICAgcmV0dXJuIHMgPyBzLnNwbGl0KC8oPz1bQS1aXSkvKS5qb2luKCcgJykgOiBzCiAgICB9OwoKICAgIHZhciBlbmFibGVfbG9hZF9idXR0b24gPSBmdW5jdGlvbihlbGUsIGVuYWJsZWQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgIHZhciB0YXJnZXRFbGUgPSBlbGUuZmluZCgnLmdseXBoaWNvbicpOwogICAgICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgICAgICAgJCh0YXJnZXRFbGUpLmFkZENsYXNzKCdyZWZyZXNoLWFuaW1hdGUnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQodGFyZ2V0RWxlKS5yZW1vdmVDbGFzcygncmVmcmVzaC1hbmltYXRlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgdmFyIHNldEluTG9jYWxTdG9yYWdlID0gZnVuY3Rpb24ocHJvcCwgZGF0YSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHByb3AsIGRhdGEpOwogICAgfTsKCiAgICB2YXIgZ2V0RnJvbUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uKHByb3ApIHsKICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocHJvcCk7CiAgICB9OwoKICAgIHZhciBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbihwcm9wLCBkYXRhKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJvcCwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOwogICAgfTsKCiAgICB2YXIgZ2V0SlNPTkZyb21Mb2NhbFN0b3JhZ2UgPSBmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHByb3ApKTsKICAgIH07CgogICAgdmFyIGxvY2FsU3RvcmFnZVV0aWwgPSB7CiAgICAgICAgc2V0UHJvcCA6IHNldEluTG9jYWxTdG9yYWdlLAogICAgICAgIGdldFByb3AgOiBnZXRGcm9tTG9jYWxTdG9yYWdlLAogICAgICAgIHNldEpTT04gOiBzZXRKU09OSW5Mb2NhbFN0b3JhZ2UsCiAgICAgICAgZ2V0SlNPTiA6IGdldEpTT05Gcm9tTG9jYWxTdG9yYWdlCiAgICB9OwoKICAgIHZhciBnZXRRdWVyeVN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBrZXkgPSBmYWxzZSwgcmVzID0ge30sIGl0bSA9IG51bGw7CiAgICAgICAgLy8gZ2V0IHRoZSBxdWVyeSBzdHJpbmcgd2l0aG91dCB0aGUgPwogICAgICAgIHZhciBxcyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgLy8gY2hlY2sgZm9yIHRoZSBrZXkgYXMgYW4gYXJndW1lbnQKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIGtleSA9IGFyZ3VtZW50c1swXTsKICAgICAgICAvLyBtYWtlIGEgcmVnZXggcGF0dGVybiB0byBncmFiIGtleS92YWx1ZQogICAgICAgIHZhciBwYXR0ZXJuID0gLyhbXiY9XSspPShbXiZdKikvZzsKICAgICAgICAvLyBsb29wIHRoZSBpdGVtcyBpbiB0aGUgcXVlcnkgc3RyaW5nLCBlaXRoZXIKICAgICAgICAvLyBmaW5kIGEgbWF0Y2ggdG8gdGhlIGFyZ3VtZW50LCBvciBidWlsZCBhbiBvYmplY3QKICAgICAgICAvLyB3aXRoIGtleS92YWx1ZSBwYWlycwogICAgICAgIHdoaWxlIChpdG0gPSBwYXR0ZXJuLmV4ZWMocXMpKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09IGZhbHNlICYmIGRlY29kZVVSSUNvbXBvbmVudChpdG1bMV0pID09PSBrZXkpCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICByZXNbZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGl0bVsyXSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ga2V5ID09PSBmYWxzZSA/IHJlcyA6IG51bGw7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgcmVuZGVyIDogcmVuZGVyLAogICAgICAgIHN0YWNrZWQ6IHN0YWNrZWQsCiAgICAgICAgY29tcG9zZVVybDogY29tcG9zZVVybCwKICAgICAgICBwb3N0VXJsOiBwb3N0VXJsLAogICAgICAgIGNvbXBvc2VQYXJhbXM6IGNvbXBvc2VQYXJhbXMsCiAgICAgICAgY2FwaXRhbEl0OiBjYXBpdGFsSXQsCiAgICAgICAgYnJlYWtJdDogYnJlYWtJdCwKICAgICAgICBoYnNfcGFydGlhbDogaGJzX3BhcnRpYWwsCiAgICAgICAgZW5hYmxlX2xvYWRfYnV0dG9uOiBlbmFibGVfbG9hZF9idXR0b24sCiAgICAgICAgbG9jYWxTdG9yYWdlVXRpbDogbG9jYWxTdG9yYWdlVXRpbCwKICAgICAgICBnZXRRdWVyeVN0cmluZzogZ2V0UXVlcnlTdHJpbmcKICAgIH0KfSkoKTsKCgoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fQoKc2lnbmFsLmNhc2VEcmlsbERvd24gPSAoZnVuY3Rpb24oKSB7CgogICAgdmFyIGluaXRfY2FzZV9kcmlsbF9kb3duX3RhYmxlID0gZnVuY3Rpb24odXJsLCBjYXNlRGV0YWlsVXJsKSB7CgogICAgICAgIHZhciB0YWJsZSA9ICQoJyNjYXNlLWRyaWxsLWRvd24tdGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICBsYW5ndWFnZTogewogICAgICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiB1cmwsCiAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAiYkxlbmd0aENoYW5nZSI6IHRydWUsCiAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwLAogICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzUwLCAxMDAsIDIwMCwgMTAwMCwgLTFdLCBbNTAsIDEwMCwgMjAwLCAxMDAwLCAiQWxsIl1dLAogICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlTnVtIiwKICAgICAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJysgKGNhc2VEZXRhaWxVcmwgKyAnPycgKyBzaWduYWwudXRpbHMuY29tcG9zZVBhcmFtcyh7Y2FzZU51bWJlcjogcm93LmNhc2VOdW0sIHZlcnNpb246IHJvdy5jYXNlVmVyc2lvbn0pKSsnIj4nKyI8c3BhbiBkYXRhLWZpZWxkID0nY2FzZU51bScgZGF0YS1pZD0nIiArIHJvdy5jYXNlTnVtICsgIic+IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocm93LmNhc2VOdW0pICsgIjwvc3Bhbj48c3BhbiBkYXRhLWZpZWxkID0nY2FzZVZlcnNpb24nIGRhdGEtaWQ9JyIgKyByb3cuY2FzZVZlcnNpb24gKyAiJz4iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8L3NwYW4+PC9hPiIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAncHJvZHVjdE5hbWUnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJnZW5lcmljTmFtZSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogJ3B0JwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAic29jIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibGlzdGVkbmVzcyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIm91dGNvbWUiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJzZXJpb3VzbmVzcyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRldGVybWluZWRDYXVzYWxpdHkiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJyZXBvcnRlZENhdXNhbGl0eSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgIH1dCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB0YWJsZTsKICAgIH07CgoKICAgIHZhciBiaW5kX2RyaWxsX2Rvd25fdGFibGUgPSBmdW5jdGlvbihjYXNlRGV0YWlsVXJsKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jYXNlLWRyaWxsLWRvd24tbGluaycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgLy9QcmVkZW50IGRlZmF1bHQgd2lsbCBtYWtlIHN1cmUgdGhhdCBkZWZhdWx0IGV2ZW50IGRvZXMgbm90IGhhcHBlbi4KICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCkKCiAgICAgICAgICAgIHZhciBzcmNFbGUgPSAkKGV2dC50YXJnZXQpCiAgICAgICAgICAgICQoJyNjYXNlLWRyaWxsLWRvd24tbW9kYWwnKS5hdHRyKCdkYXRhLXVybCcsIHNyY0VsZS5hdHRyKCdkYXRhLXVybCcpKQogICAgICAgICAgICAkKCcjY2FzZS1kcmlsbC1kb3duLW1vZGFsJykubW9kYWwoe30pCiAgICAgICAgfSkKCiAgICAgICAgJCgnI2Nhc2UtZHJpbGwtZG93bi1tb2RhbCcpLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkKCcjZHJpbGwtZG93bi10YWJsZS1jb250YWluZXInKS5yZW1vdmUoJyNjYXNlLWRyaWxsLWRvd24tdGFibGUnKQogICAgICAgICAgICB2YXIgZHJpbGxfZG93bl90YWJsZSA9IHNpZ25hbC51dGlscy5yZW5kZXIoJ2Nhc2VfZHJpbGxfZG93bl90YWJsZScsIHt9KQogICAgICAgICAgICAkKCcjZHJpbGwtZG93bi10YWJsZS1jb250YWluZXInKS5odG1sKGRyaWxsX2Rvd25fdGFibGUpCiAgICAgICAgICAgIHZhciB1cmwgPSAkKCcjY2FzZS1kcmlsbC1kb3duLW1vZGFsJykuYXR0cignZGF0YS11cmwnKQogICAgICAgICAgICB2YXIgY2FzZV9kcmlsbF9kb3duX3RhYmxlID0gaW5pdF9jYXNlX2RyaWxsX2Rvd25fdGFibGUodXJsLCBjYXNlRGV0YWlsVXJsKQogICAgICAgIH0pCiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBpbml0X2Nhc2VfZHJpbGxfZG93bl90YWJsZTogaW5pdF9jYXNlX2RyaWxsX2Rvd25fdGFibGUsCiAgICAgICAgYmluZF9kcmlsbF9kb3duX3RhYmxlIDogIGJpbmRfZHJpbGxfZG93bl90YWJsZQogICAgfQp9KSgpCgp2YXIgc2lnbmFsID0gc2lnbmFsIHx8IHt9CgpzaWduYWwuYWxlcnRDb21tZW50cyA9IChmdW5jdGlvbiAoKSB7CgogICAgdmFyIGxpc3RDb21tZW50cyA9IGZ1bmN0aW9uIChjYXNlSnNvbikgewoKICAgICAgICAvL01vZGFsIG9iamVjdAogICAgICAgIHZhciBjb21tZW50TW9kYWwgPSAkKCcjY29tbWVudE1vZGFsJyk7CgogICAgICAgIC8vUG9wdWxhdGUgdGhlIGV4aXN0aW5nIGNvbW1lbnRzIGFuZCBiaW5kIGV2ZW50cyB0byB0aGVtLgogICAgICAgIHBvcHVsYXRlQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CgogICAgICAgIC8vU2V0IHZhbHVlcyB0byB0aGUgbW9kYWwgZWxlbWVudHMuCiAgICAgICAgdmFyIGNvbW1lbnRNZXRhSW5mbyA9ICIiCiAgICAgICAgaWYgKGNhc2VKc29uLmFsZXJ0VHlwZSA9PSAiQWdncmVnYXRlIENhc2UgQWxlcnQiKSB7CiAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0icHJvZHVjdE5hbWUiPicgKyBjYXNlSnNvbi5wcm9kdWN0TmFtZSArICc8L3NwYW4+IC0gPHNwYW4gaWQ9ImV2ZW50TmFtZSI+JyArIGNhc2VKc29uLmV2ZW50TmFtZSArICc8L3NwYW4+JwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0iY2FzZU51bWJlciI+JyArIGNhc2VKc29uLmNhc2VOdW1iZXIgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJwcm9kdWN0RmFtaWx5Ij4nICsgY2FzZUpzb24ucHJvZHVjdEZhbWlseSArICc8L3NwYW4+JwogICAgICAgIH0KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnQtbWV0YS1pbmZvIikuaHRtbChjb21tZW50TWV0YUluZm8pOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjYXBwbGljYXRpb24iKS5odG1sKGNhc2VKc29uLmFsZXJ0VHlwZSk7CiAgICAgICAgY29tbWVudE1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgYmluZFNhdmVDb21tZW50KGNvbW1lbnRNb2RhbCk7CiAgICB9OwoKICAgIHZhciBwb3B1bGF0ZUNvbW1lbnRzID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24sIG9uU2lnbmFsU2NyZWVuKSB7CiAgICAgICAgdmFyIHVwZGF0ZWRDb21tZW50cyA9ICQoIiNjb21tZW50Ym94IikudmFsKCk7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC9hbGVydENvbW1lbnQvbGlzdENvbW1lbnRzIiwKICAgICAgICAgICAgZGF0YTogY2FzZUpzb24sCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI25vLWNvbW1lbnRzIikuYWRkQ2xhc3MoImhpZGUiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykuaHRtbCgiVXBkYXRlIik7CiAgICAgICAgICAgICAgICAgICAgaWYodXBkYXRlZENvbW1lbnRzLmxlbmd0aCA+PSByZXN1bHQuY29tbWVudHMubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKHVwZGF0ZWRDb21tZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbChyZXN1bHQuY29tbWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbChyZXN1bHQuaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgiTGFzdCBNb2RpZmllZCBieSAiICsgcmVzdWx0Lm1vZGlmaWVkQnkgKyAiIG9uICIgKyByZXN1bHQuZGF0ZVVwZGF0ZWQpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKCiAgICAgICAgICAgICAgICB9ZWxzZSBpZih0eXBlb2YgaXNDb21tZW50QWRkZWQgIT0gJ3VuZGVmaW5lZCcgJiYgaXNDb21tZW50QWRkZWQgJiYgb25TaWduYWxTY3JlZW4pewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNuby1jb21tZW50cyIpLnJlbW92ZUNsYXNzKCJoaWRlIik7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5wcm9wKCJkaXNhYmxlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CgogICAgICAgICAgICAgICAgfWVsc2UgaWYodHlwZW9mIGlzQ29tbWVudEFkZGVkICE9ICd1bmRlZmluZWQnICYmIGlzQ29tbWVudEFkZGVkKXsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoJy5hZGQtY29tbWVudHMnKS5odG1sKCJBZGQiKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoJycpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjbm8tY29tbWVudHMiKS5yZW1vdmVDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5hZGRDbGFzcygiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuY3JlYXRlZEJ5IikudGV4dCgnJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRJZCIpLnZhbCgnJyk7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5jcmVhdGVkQnkiKS50ZXh0KCcnKTsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnI2NvbW1lbnRib3gnKS5vbigia2V5dXAiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKT09IiIgJiYgY29tbWVudE1vZGFsLmZpbmQoJyNjb21tZW50Ym94JykudmFsKCk9PSIiKQogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIGxvYWQgcHJldmlvdXMgY29tbWVudHMuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRTYXZlQ29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwpIHsKCiAgICAgICAgLy9BZGQgY2xpY2sgZXZlbnQgdG8gdGhlIGFkZCBjb21tZW50IGJ1dHRvbi4KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmFkZC1jb21tZW50cyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqQXJyYXkgPSBbXTsKICAgICAgICAgICAgdmFyIGFwcFR5cGUgPSAkKCIjYXBwbGljYXRpb24iKS5odG1sKCk7CiAgICAgICAgICAgIHZhciB2YWxpZGF0ZWRTaWduYWxJZCA9ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgdmFyIHRvcGljSWQgPSAkKCIjdG9waWNJZCIpLmh0bWwoKTsKCiAgICAgICAgICAgIGlmIChhcHBUeXBlID09ICcnKSB7CiAgICAgICAgICAgICAgICBhcHBUeXBlID0gY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIHZhbGlkYXRlZFNpZ25hbElkID0gY29tbWVudE1vZGFsLmZpbmQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIHRvcGljSWQgPSBjb21tZW50TW9kYWwuZmluZCgiI3RvcGljSWQiKS5odG1sKCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNhc2VKc29uT2JqOwogICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICB2YXIgZGF0YTsKICAgICAgICAgICAgLy9DYXNlIEpTT04uCiAgICAgICAgICAgIGNhc2VKc29uT2JqID0gewogICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFwcFR5cGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBjb21tZW50TW9kYWwuZmluZCgiI3Byb2R1Y3ROYW1lIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV2ZW50TmFtZSI6IGNvbW1lbnRNb2RhbC5maW5kKCIjZXZlbnROYW1lIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImNvbW1lbnRzIjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiB2YWxpZGF0ZWRTaWduYWxJZCwKICAgICAgICAgICAgICAgICJhc3NpZ25lZFRvIjogY29tbWVudE1vZGFsLmZpbmQoIiNhc3NpZ25lZFRvIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2V4ZWN1dGVkQ29uZmlnSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiY29uZmlnSWQiIDogY29tbWVudE1vZGFsLmZpbmQoIiNjb25maWdJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICJ0b3BpY0lkIjogY29tbWVudE1vZGFsLmZpbmQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgInByb2R1Y3RGYW1pbHkiOiBjb21tZW50TW9kYWwuZmluZCgiI3Byb2RGYW1pbHkiKS5odG1sKCksCiAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY2FzZU5vIikuaHRtbCgpLAogICAgICAgICAgICAgICAgInByb2R1Y3RJZCI6IHBhcnNlSW50KGNvbW1lbnRNb2RhbC5maW5kKCIjcHJvZHVjdElkIikuaHRtbCgpKSwKICAgICAgICAgICAgICAgICJwdENvZGUiOiBwYXJzZUludChjb21tZW50TW9kYWwuZmluZCgiI3B0Q29kZSIpLmh0bWwoKSkKCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhc2VKc29uT2JqQXJyYXkucHVzaChjYXNlSnNvbk9iaik7CiAgICAgICAgICAgIGlmKGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCkpewogICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3VwZGF0ZUNvbW1lbnQiOwogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAiYWxlcnRUeXBlIjogYXBwVHlwZSwKICAgICAgICAgICAgICAgICAgICAiY29tbWVudCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudGJveCIpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgICJpZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjb21tZW50TW9kYWwuZmluZCgiI2V4ZWN1dGVkQ29uZmlnSWQiKS5odG1sKCksCiAgICAgICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogdmFsaWRhdGVkU2lnbmFsSWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgdXJsID0gIi9zaWduYWwvYWxlcnRDb21tZW50L3NhdmVDb21tZW50IjsKICAgICAgICAgICAgICAgIGRhdGEgPSB7ImNhc2VKc29uT2JqQXJyYXkiOiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KX0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2lzVXBkYXRlZCIpLnZhbCgidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25PYmpBcnJheVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjb21tZW50Ym94JykudmFsKCcnKS5ibHVyKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kRWRpdENvbW1lbnQgPSBmdW5jdGlvbiAoY29tbWVudE1vZGFsKSB7CgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcuZWRpdC1jb21tZW50JykuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi51cGRhdGUtY29tbWVudCIpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudC1hcmVhIikuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7CiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoImhpZGRlbiIpCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBiaW5kRGVsZXRlQ29tbWVudCA9IGZ1bmN0aW9uIChjb21tZW50TW9kYWwsIGNhc2VKc29uKSB7CgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcuZGVsZXRlLWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpZCA9IHsKICAgICAgICAgICAgICAgICJpZCI6ICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnRJZCIpLnZhbCgpLAogICAgICAgICAgICAgICAgInZhbGlkYXRlZFNpZ25hbElkIjogJCgiI3ZhbGlkYXRlZFNpZ25hbElkIikudGV4dCgpLAogICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCIgOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogIi9zaWduYWwvYWxlcnRDb21tZW50L2RlbGV0ZUNvbW1lbnQiLAogICAgICAgICAgICAgICAgZGF0YTogaWQsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRVcGRhdGVDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pIHsKCgogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIucHJldmlvdXMtY29tbWVudHMiKS5maW5kKCcudXBkYXRlLWNvbW1lbnQnKS5jbGljayhmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5nbHlwaGljb24tcGVuY2lsIikucmVtb3ZlQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICAgICB2YXIgY29tbWVudERhdGEgPSB7CiAgICAgICAgICAgICAgICAiY29tbWVudCI6ICQodGhpcykucGFyZW50KCkuZmluZCgiLmNvbW1lbnQtYXJlYSIpLnZhbCgpLAogICAgICAgICAgICAgICAgImlkIjogJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAidmFsaWRhdGVkU2lnbmFsSWQiOiAkKCIjdmFsaWRhdGVkU2lnbmFsSWQiKS50ZXh0KCksCiAgICAgICAgICAgICAgICAidG9waWNJZCI6ICQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBjYXNlSnNvbi5leGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgImFkaG9jQWxlcnRJZCIgOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC91cGRhdGVDb21tZW50IiwKICAgICAgICAgICAgICAgIGRhdGE6IGNvbW1lbnREYXRhLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewoKICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIGxpc3RfY29tbWVudHM6IGxpc3RDb21tZW50cywKICAgICAgICBwb3B1bGF0ZV9jb21tZW50czogcG9wdWxhdGVDb21tZW50cywKICAgICAgICBzYXZlX2NvbW1lbnQ6IGJpbmRTYXZlQ29tbWVudAogICAgfQp9KSgpOwoKCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2kxOG4nLAogICAgZnVuY3Rpb24oc3RyKXsKICAgICAgICByZXR1cm4gKCAodHlwZW9mIGkxOG4pICE9PSAndW5kZWZpbmVkJyA/IHN0ciA6IHN0cikKICAgIH0KKTsKCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3NlbGVjdCcsIGZ1bmN0aW9uKG5hbWUsIHNlbGVjdGVkVmFsdWUsIG9wdGlvbnMsIGRpc3BfZmllbGQsIHZhbHVlX2ZpZWxkKSB7CiAgICB2YXIgb3V0ID0gIjxzZWxlY3QgY2xhc3M9J2Zvcm0tY29udHJvbCBzZWxlY3RCb3gnIGlkPVwnIiArIG5hbWUgKyAiXCcgbmFtZT0iICsgbmFtZSArICI+XG4iOwogICAgXy5lYWNoKG9wdGlvbnMsIGZ1bmN0aW9uKHYpIHsKICAgICAgICBvdXQgKz0gIjxvcHRpb24gdmFsdWU9JyIgKyB2W3ZhbHVlX2ZpZWxkXSArICInIiArCiAgICAgICAgICAgICh2W3ZhbHVlX2ZpZWxkXSA9PSBzZWxlY3RlZFZhbHVlW3ZhbHVlX2ZpZWxkXSA/ICIgc2VsZWN0ZWQgIiA6ICIiKSArICIgPiIgKwogICAgICAgICAgICBlc2NhcGVIVE1MKHZbZGlzcF9maWVsZF0pICsgIjwvb3B0aW9uPlxuIgogICAgfSk7CiAgICBvdXQgKz0gIjwvc2VsZWN0PiI7CgogICAgcmV0dXJuIG5ldyBIYW5kbGViYXJzLlNhZmVTdHJpbmcob3V0KQp9KTsKCkhhbmRsZWJhcnMucmVnaXN0ZXJQYXJ0aWFsKCdkYXRlX3BpY2tlcl90ZW1wbGF0ZScsIHNpZ25hbC51dGlscy5oYnNfcGFydGlhbCgnZGF0ZV9waWNrZXJfdGVtcGxhdGUnKSk7CgovL0hhbmRsZWJhciBoZWxwZXIgdG8gaW1pdGF0ZSB0aGUgaWYgY29uZGl0aW9ucwpIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpZl9lcScsIGZ1bmN0aW9uKGEsIGIsIG9wdHMpIHsKICAgIGlmIChhID09IGIpIHsKICAgICAgICByZXR1cm4gb3B0cy5mbih0aGlzKTsKICAgIH0KfSk7CgovL0hhbmRsZWJhciBoZWxwZXIgdG8gaW1pdGF0ZSB0aGUgaWYuLmVsc2UgY29uZGl0aW9ucwpIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdpZl9lbHNlX2VxJywgZnVuY3Rpb24oYSwgYiwgb3B0cykgewogICAgaWYgKGEgPT0gYikgewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gb3B0cy5pbnZlcnNlKHRoaXMpOwogICAgfQp9KTsKCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX3RhZ19leGlzdCcsIGZ1bmN0aW9uKGtleSwgdmFsdWUsdGFncywgb3B0cykgewogICAgaWYodmFsdWUudGFnVGV4dCA9PSB0YWdzW2tleS0xXS50YWdUZXh0ICYmIHZhbHVlLnN1YlRhZ1RleHQhPW51bGwgJiYgdmFsdWUuc3ViVGFnVGV4dCAhPSB0YWdzW2tleS0xXS5zdWJUYWdUZXh0KXsKICAgICAgICByZXR1cm4gb3B0cy5mbih0aGlzKTsKICAgIH0gZWxzZXsKICAgICAgICByZXR1cm4gb3B0cy5pbnZlcnNlKHRoaXMpOwogICAgfQp9KTsKCkhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2lmX2Vsc2VfbmVxJywgZnVuY3Rpb24oYSwgYiwgb3B0cykgewogICAgaWYgKGEgIT0gYikgewogICAgICAgIHJldHVybiBvcHRzLmZuKHRoaXMpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gb3B0cy5pbnZlcnNlKHRoaXMpOwogICAgfQp9KTsKCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2hhbmRsZWJhcl9leHQuanMKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CgpzaWduYWwuYWxlcnRzX3V0aWxzID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIHByaW9yaXRpZXM7CiAgICB2YXIgd29ya2Zsb3dTdGF0ZXM7CgogICAgdmFyIGdldF9wcmlvcml0aWVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC93b3JrZmxvdy9wcmlvcml0aWVzIiwKICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgICAgICAgIHByaW9yaXRpZXMgPSByZXN1bHQKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gcHJpb3JpdGllcwogICAgfTsKCiAgICB2YXIgZ2V0X3dvcmtmbG93U3RhdGVzID0gZnVuY3Rpb24oaW5pdERhdGEpIHsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL3dvcmtmbG93L3dvcmtmbG93U3RhdGUiLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIGRhdGE6IGluaXREYXRhLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgICAgICAgIHdvcmtmbG93U3RhdGVzID0gcmVzdWx0CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHdvcmtmbG93U3RhdGVzCiAgICB9OwoKICAgIHZhciBwcmlvcml0aWVzX3NlbGVjdGlvbnMgPSBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICB2YXIgbmV3X3NlbGVjdCA9ICc8ZGl2PjxzZWxlY3QgY2xhc3M9ImZvcm0tY29udHJvbCBhZGQtY3Vyc29yIiAnICsKICAgICAgICAgICAgJ3N0eWxlPSJoZWlnaHQ6IDMwcHg7IiBvbmNoYW5nZT0idXBkYXRlUHJpb3JpdHkodGhpcy52YWx1ZSwnICsgcm93LmlkICsgJykiPic7CiAgICAgICAgdmFyIHByaW9yaXR5ID0gcm93LnByaW9yaXR5OwoKICAgICAgICB2YXIgdGhlX3NlbGVjdCA9IF8ucmVkdWNlKHByaW9yaXRpZXMsIGZ1bmN0aW9uKG0sIHApewogICAgICAgICAgICBpZiAocC52YWx1ZSA9PSBwcmlvcml0eSkKICAgICAgICAgICAgICAgIHJldHVybiBtICsgJzxvcHRpb24gdmFsdWU9IicgKyBwLnZhbHVlICsgJyIgc2VsZWN0ZWQ+ICcgKyBwLmRpc3BsYXlOYW1lICsgJzwvb3B0aW9uPic7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHJldHVybiBtICsgJzxvcHRpb24gdmFsdWU9IicgKyBwLnZhbHVlICsgJyI+JyArIHAuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JwogICAgICAgIH0sIG5ld19zZWxlY3QpOwogICAgICAgIHRoZV9zZWxlY3QgPSB0aGVfc2VsZWN0ICsgJzwvc2VsZWN0PjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIHRoZV9zZWxlY3Q7CiAgICB9OwoKICAgIHZhciB3b3JrZmxvd19zZWxlY3Rpb25zID0gZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgdmFyIG5ld19zZWxlY3QgPSAnPGRpdj48c2VsZWN0IGNsYXNzPSJmb3JtLWNvbnRyb2wgYWRkLWN1cnNvciIgc3R5bGU9ImhlaWdodDogMzBweDsiIG9uY2hhbmdlPSJ1cGRhdGVTdGF0dXModGhpcy52YWx1ZSwnICsgcm93LmlkICsgJykiPic7CiAgICAgICAgdmFyIHdvcmtmbG93U3RhdGUgPSByb3cud29ya2Zsb3dTdGF0ZTsKCiAgICAgICAgdmFyIHRoZV9zZWxlY3QgPSBfLnJlZHVjZSh3b3JrZmxvd1N0YXRlcywgZnVuY3Rpb24obSwgd3MpewogICAgICAgICAgICBpZiAod3MudmFsdWUgPT0gd29ya2Zsb3dTdGF0ZSkKICAgICAgICAgICAgICAgIHJldHVybiBtICsgJzxvcHRpb24gdmFsdWU9IicgKyB3cy52YWx1ZSArICciIHNlbGVjdGVkPiAnICsgd3MuZGlzcGxheU5hbWUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIG0gKyAnPG9wdGlvbiB2YWx1ZT0iJyArIHdzLnZhbHVlICsgJyI+JyArIHdzLmRpc3BsYXlOYW1lICsgJzwvb3B0aW9uPicKICAgICAgICB9LCBuZXdfc2VsZWN0KTsKICAgICAgICB0aGVfc2VsZWN0ID0gdGhlX3NlbGVjdCArICc8L3NlbGVjdD48L2Rpdj4nOwogICAgICAgIHJldHVybiB0aGVfc2VsZWN0OwogICAgfTsKCiAgICB2YXIgY29tcG9zZV9lZGl0X3N0YXRlX2xpbmsgPSBmdW5jdGlvbih2YWx1ZSwgcm93SWQsIGZpbGVkTmFtZSkgewogICAgICAgIHJldHVybiAiPHNwYW4+IiArIHZhbHVlICsgIjwvc3Bhbj4iICsgIjxhIGhyZWY9JyMnIGNsYXNzPSdlZGl0LXN0YXRlJyA+IiArCiAgICAgICAgICAgICI8aSBjbGFzcz0nZmEgZmEtc2hhcmUtYWx0IHB1bGwtcmlnaHQnIGRhdGEtZmllbGQ9JyIgICsgZmlsZWROYW1lICsKICAgICAgICAgICAgIicgZGF0YS1pZD0nIiArIHJvd0lkICsgIicvPjwvYT4iCiAgICB9OwoKICAgIHZhciBzdGF0ZV9jaGFuZ2VkID0gZnVuY3Rpb24oZXh0cmFfdmFsdWVzKSB7CiAgICAgICAgJCgiI3ZhbHVlU2VsZWN0IikuY2hhbmdlKGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgICB2YXIgYXZhaWxhYmxlX2V4dHJhX3ZhbHVlcyA9IGV4dHJhX3ZhbHVlc1skKHZhbHVlU2VsZWN0KS52YWwoKV0KICAgICAgICB9KQogICAgfTsKCiAgICAvL1RPRE8gdGhpcyBpcyBhIHRlbXAgc29sdXRpb24gZm9yIHRoZSBKU09OIGZvcm1hdC4gSXQgc2hvdWxkIGNvbWUgZnJvbSBzZXJ2ZXIgc2lkZQogICAgLy9GdW5jdGlvbiB0aGF0IGNvbnZlcnRzIHRoZSBqc29uIGlubmVyaHRtbCB0byB0aGUgY3N2IHZhbHVlcy4KICAgIC8vSXQgY29udmVydHMgdGhlIHByb3BlcnRpZXMgd2hpY2ggYXJlIG5vdCBpZC4KICAgIHZhciBzaG93X2pzb25fYXNfY3N2ID0gZnVuY3Rpb24gKGVsZW1lbnRDbGFzcykgewogICAgICAgICQoIi4iICsgZWxlbWVudENsYXNzKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmIChpc05hTigkKHRoaXMpLmh0bWwoKSkpIHsKICAgICAgICAgICAgICAgICAgdmFyIG1vZGlmaWVkVmFsID0gIiI7CiAgICAgICAgICAgICAgICAgIHZhciBqc29uVmFsID0gSlNPTi5wYXJzZSgkKHRoaXMpLmh0bWwoKSk7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIG9iaiBpbiBqc29uVmFsKSB7CiAgICAgICAgICAgICAgICAgICAgIGlmIChqc29uVmFsLmhhc093blByb3BlcnR5KG9iaikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBqc29uVmFsW29ial0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb25WYWxbb2JqXS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvcCAhPSAnaWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGlmaWVkVmFsID0gbW9kaWZpZWRWYWwgKyBqc29uVmFsW29ial1bcHJvcF0gKyAiLCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICQodGhpcykuaHRtbChtb2RpZmllZFZhbC5zbGljZSgwLCAtMSkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIC8vRG8gbm90aGluZwogICAgICAgICAgICAgIC8vY29uc29sZS5sb2coZXJyKQogICAgICAgICAgIH0KICAgICAgICAgICAkKHRoaXMpLmh0bWwoKQogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBpbml0X21hdGNoZWRfYWxlcnRzX3RhYmxlID0gZnVuY3Rpb24odGFibGVFbGUsIHVybCkgewogICAgICAgIHZhciB0YWJsZSA9IHRhYmxlRWxlLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiL3NpZ25hbC9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWpheDogewogICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICBkYXRhU3JjOiAnJywKICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbih4aHIsc3RhdHVzLGVycm9yKXt9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhb0NvbHVtbnM6WwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG1EYXRhOiAnbmFtZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICdwcm9kdWN0U2VsZWN0aW9uJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ3RvcGljJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBtRGF0YTogJ2RldGVjdGVkRGF0ZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbURhdGE6ICdkaXNwb3NpdGlvbicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgZG9tOiAnJwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGFibGUKICAgIH07CgogICAgdmFyIGdldFNpZ25hbE5hbWVMaXN0ID0gZnVuY3Rpb24oc2lnbmFsc0FuZFRvcGljcykgewogICAgICAgIHZhciBzaWduYWxBbmRUb3BpY3MgPSAnJzsKICAgICAgICAkLmVhY2goc2lnbmFsc0FuZFRvcGljcywgZnVuY3Rpb24oaSwgb2JqKXsKICAgICAgICAgICAgdmFyIHVybCA9IHNpZ25hbERldGFpbFVybCArICc/aWQ9JyArIG9ialsnc2lnbmFsSWQnXTsKICAgICAgICAgICAgc2lnbmFsQW5kVG9waWNzID0gc2lnbmFsQW5kVG9waWNzICsgJzxzcGFuIGNsYXNzPSJjbGljayI+PGEgaHJlZj0iJyArIHVybCArICciPicgKyBvYmpbJ25hbWUnXSArICc8L2E+PC9zcGFuPiZuYnNwOycKICAgICAgICAgICAgc2lnbmFsQW5kVG9waWNzID0gc2lnbmFsQW5kVG9waWNzICsgIiwiCiAgICAgICAgfSk7CiAgICAgICAgaWYoc2lnbmFsQW5kVG9waWNzLmxlbmd0aCA+IDEpCiAgICAgICAgICAgIHJldHVybiAnPGRpdj4nICsgc2lnbmFsQW5kVG9waWNzLnN1YnN0cmluZygwLCBzaWduYWxBbmRUb3BpY3MubGVuZ3RoIC0gMSkgKyAnPC9kaXY+JzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAnLSc7CiAgICB9OwoKICAgIC8vIEZvciBzaGFyZWQgd2l0aCBtb2RhbAogICAgdmFyIGluaXRpYWxpemVTaGFyZVdpdGhTZWxlY3QyID0gZnVuY3Rpb24oKXsKICAgICAgICAkKCcjc2hhcmVXaXRoJykuc2VsZWN0MigpLm9uKCJjaGFuZ2UiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAkKCcjc2hhcmVXaXRoJykucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2hhcy1lcnJvcicpOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgaW5pdGlhbGl6ZVNoYXJlV2l0aFZhbHVlcyA9IGZ1bmN0aW9uKCl7CiAgICAgICAgJCgnI3NoYXJlZFdpdGhNb2RhbCcpLm9uKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgZXhlY3V0ZWRDb25maWdJZCA9IGUucmVsYXRlZFRhcmdldC5pZDsKICAgICAgICAgICAgJCgnI2V4ZWN1dGVkQ29uZmlnSWQnKS52YWwoZXhlY3V0ZWRDb25maWdJZCk7CiAgICAgICAgICAgICQoJyNzaGFyZWRXaXRoJykucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2hhcy1lcnJvcicpOwoKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLAogICAgICAgICAgICAgICAgdXJsOiBnZXRTaGFyZWRXaXRoICsgJz9pZD0nICsgZXhlY3V0ZWRDb25maWdJZCwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHZhciB1c2VycyA9ICcnOwogICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXN1bHQudXNlcnMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB1c2VycyArPSB0aGlzLm5hbWUgKyAnPGJyIC8+JwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICQoJyNzaGFyZWRXaXRoVXNlckxpc3QnKS5odG1sKHVzZXJzKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXBzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJlc3VsdC5ncm91cHMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBncm91cHMgKz0gIHRoaXMubmFtZSArICcgPGJyIC8+JwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICQoJyNzaGFyZWRXaXRoR3JvdXBMaXN0JykuaHRtbChncm91cHMpOwoKICAgICAgICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0LmFsbCwgZnVuY3Rpb24oaSwgZGF0YSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKGRhdGEubmFtZSwgZGF0YS5pZCwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaGFyZWRXaXRoJykuYXBwZW5kKG9wdGlvbikudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2hhcmVkV2l0aE1vZGFsU2hvdyA9IHRydWU7CgogICAgICAgIH0pLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHNoYXJlZFdpdGhNb2RhbFNob3cgPSBmYWxzZTsKICAgICAgICAgICAgJCgnI3NoYXJlZFdpdGgnKS52YWwobnVsbCkudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgICQoJyNzaGFyZWRXaXRoJykuZmluZCgnb3B0aW9uJykucmVtb3ZlKCk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBnZXRUYWdzRWxlbWVudCA9IGZ1bmN0aW9uKHRhZ3MpIHsKICAgICAgICB2YXIgdGFnc0VsZW1lbnQgPSAnPGRpdiBjbGFzcz0idGFnLWNvbnRhaW5lciBibG9jay1lbGxpcHNpcyI+PGRpdiBjbGFzcz0idGFnLWxlbmd0aCI+JzsKICAgICAgICB2YXIgZ2xvYmFsVGFnc0FycmF5ID0gW107CiAgICAgICAgdmFyIGFsZXJ0VGFnc3JyYXkgPSBbXTsKICAgICAgICB2YXIgcHJpdmF0ZVRhZ3NBcnJheSA9IFtdOwogICAgICAgICQuZWFjaCh0YWdzLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBpZiAodmFsdWUucHJpdmF0ZVVzZXIgPT0gJyhQKScpIHsKICAgICAgICAgICAgICAgIHByaXZhdGVUYWdzQXJyYXkucHVzaCh2YWx1ZSkKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS50YWdUeXBlID09ICcoQSknKSB7CiAgICAgICAgICAgICAgICBhbGVydFRhZ3NycmF5LnB1c2godmFsdWUpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBnbG9iYWxUYWdzQXJyYXkucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFnc0VsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzJywgewogICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICB0YWdzOnRhZ3MsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHZhciB2aWV3QWxsRWxlbWVudHMgPSBmZXRjaFZpZXdBbGxUYWdzKGdsb2JhbFRhZ3NBcnJheSAsIGFsZXJ0VGFnc3JyYXkgLCBwcml2YXRlVGFnc0FycmF5KTsKCiAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iQWRkL0VkaXQgQ2F0ZWdvcmllcyIgY2xhc3M9ImVkaXRBbGVydFRhZ3MgYnRuLWVkaXQtdGFnIG1pZCI+PGkgY2xhc3M9Im1kaSBtZGktcGVuY2lsLWJveCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICB0YWdzRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInK3ZpZXdBbGxFbGVtZW50cysnIj48aSBjbGFzcz0ibWRpIG1kaS1kb3RzLWhvcml6b250YWwgZm9udC0yMCBibHVlLTEiPiA8L2k+PC9hPic7CiAgICAgICAgdGFnc0VsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgcmV0dXJuIHRhZ3NFbGVtZW50CiAgICB9OwoKICAgIHZhciBmZXRjaFZpZXdBbGxUYWdzID0gZnVuY3Rpb24oZ2xvYmFsVGFnc0FycmF5ICwgYWxlcnRUYWdzQXJyYXkgLCBwcml2YXRlVGFnc0FycmF5KSB7CiAgICAgICAgdmFyIHJldHVybkVsZW1lbnQgPSAiIjsKICAgICAgICBpZiAoZ2xvYmFsVGFnc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCA9ICI8cCBjbGFzcz0ncGJyJyBzdHlsZT0nbWFyZ2luLXRvcDo3cHgnPjxiPkdsb2JhbCBDYXRlZ29yeTwvYj48aHIgY2xhc3M9J3RhZ2Vocic+IjsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHNfdmlld19hbGwnLCB7dGFnczogZ2xvYmFsVGFnc0FycmF5fSkgKyAiPC9wPiIgIDsKICAgICAgICB9CiAgICAgICAgaWYgKGFsZXJ0VGFnc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSAiPHAgY2xhc3M9J3Bicicgc3R5bGU9J21hcmdpbi10b3A6N3B4Jz48Yj5BbGVydCBTcGVjaWZpYyBDYXRlZ29yeTwvYj48aHIgY2xhc3M9J3RhZ2Vocic+IjsKICAgICAgICAgICAgcmV0dXJuRWxlbWVudCArPSBzaWduYWwudXRpbHMucmVuZGVyKCd0YWdzX2RldGFpbHNfdmlld19hbGwnLCB7CiAgICAgICAgICAgICAgICB0YWdzOiBhbGVydFRhZ3NBcnJheSwKICAgICAgICAgICAgfSkgICsgIjwvcD4iIDsKICAgICAgICB9CiAgICAgICAgaWYgKHByaXZhdGVUYWdzQXJyYXkubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXR1cm5FbGVtZW50ICs9ICI8cCBjbGFzcz0ncGJyJyBzdHlsZT0nbWFyZ2luLXRvcDo3cHgnPjxiPlByaXZhdGUgQ2F0ZWdvcnk8L2I+PGhyIGNsYXNzPSd0YWdlaHInPiI7CiAgICAgICAgICAgIHJldHVybkVsZW1lbnQgKz0gc2lnbmFsLnV0aWxzLnJlbmRlcigndGFnc19kZXRhaWxzX3ZpZXdfYWxsJywge3RhZ3M6IHByaXZhdGVUYWdzQXJyYXl9KSAgKyAiPC9wPiIgOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0dXJuRWxlbWVudAogICAgfTsKICAgIHJldHVybiB7CiAgICAgICAgZ2V0X3ByaW9yaXRpZXM6IGdldF9wcmlvcml0aWVzLAogICAgICAgIHByaW9yaXRpZXNfc2VsZWN0aW9uczogcHJpb3JpdGllc19zZWxlY3Rpb25zLAogICAgICAgIGdldF93b3JrZmxvd1N0YXRlczogZ2V0X3dvcmtmbG93U3RhdGVzLAogICAgICAgIHdvcmtmbG93X3NlbGVjdGlvbnM6IHdvcmtmbG93X3NlbGVjdGlvbnMsCiAgICAgICAgY29tcG9zZV9lZGl0X3N0YXRlX2xpbms6IGNvbXBvc2VfZWRpdF9zdGF0ZV9saW5rLAogICAgICAgIHN0YXRlX2NoYW5nZTogc3RhdGVfY2hhbmdlZCwKICAgICAgICBzaG93X2pzb25fYXNfY3N2OiBzaG93X2pzb25fYXNfY3N2LAogICAgICAgIGluaXRfbWF0Y2hlZF9hbGVydHNfdGFibGU6IGluaXRfbWF0Y2hlZF9hbGVydHNfdGFibGUsCiAgICAgICAgZ2V0U2lnbmFsTmFtZUxpc3Q6IGdldFNpZ25hbE5hbWVMaXN0LAogICAgICAgIGluaXRpYWxpemVTaGFyZVdpdGhTZWxlY3QyIDogaW5pdGlhbGl6ZVNoYXJlV2l0aFNlbGVjdDIsCiAgICAgICAgaW5pdGlhbGl6ZVNoYXJlV2l0aFZhbHVlczppbml0aWFsaXplU2hhcmVXaXRoVmFsdWVzLAogICAgICAgIGdldF90YWdzX2VsZW1lbnQgOiBnZXRUYWdzRWxlbWVudAogICAgfQp9KSgpOwoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCnNpZ25hbC5saXN0X3V0aWxzID0gKGZ1bmN0aW9uICgpIHsKICAgIHZhciBmbGFnX2l0ID0gZnVuY3Rpb24gKGZsYWcsIGlkKSB7CiAgICAgICAgdmFyIHRoZUh0bWwgPSAnPGkgY2xhc3M9ImZhIGZhLWZsYWctbyB0ZXh0LW11dGVkIHJ4LWxpc3QtZmxhZyIgZGF0YS1pZD0iJyArIGlkICsgJyI+PC9pPicKICAgICAgICBpZiAoZmxhZykgewogICAgICAgICAgICB0aGVIdG1sID0gJzxpIGNsYXNzPSJmYSBmYS1mbGFnIHRleHQtcHJpbWFyeSByeC1saXN0LWZsYWciIGRhdGEtaWQ9IicgKyBpZCArICciPjwvaT4nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGVIdG1sCiAgICB9OwoKICAgIHZhciBmbGFnX2hhbmRsZXIgPSBmdW5jdGlvbiAoY29udHJvbGxlciwgYWN0aW9uKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5yeC1saXN0LWZsYWcnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgZWxlID0gZS50YXJnZXQ7CiAgICAgICAgICAgIHZhciBpZCA9ICQoZWxlKS5hdHRyKCdkYXRhLWlkJyk7CgogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgdXJsOiAiL3NpZ25hbC8iICsgY29udHJvbGxlciArICIvIiArIGFjdGlvbiArICI/aWQ9IiArIGlkLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZmxhZ2dlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkucmVtb3ZlQ2xhc3MoJ2ZhLWZsYWctbycpLnJlbW92ZUNsYXNzKCd0ZXh0LW11dGVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlKS5hZGRDbGFzcygnZmEtZmxhZycpLmFkZENsYXNzKCd0ZXh0LXByaW1hcnknKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKGVsZSkuYWRkQ2xhc3MoJ2ZhLWZsYWctbycpLmFkZENsYXNzKCd0ZXh0LW11dGVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoZWxlKS5yZW1vdmVDbGFzcygnZmEtZmxhZycpLnJlbW92ZUNsYXNzKCd0ZXh0LXByaW1hcnknKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgcHJpb3JpdHlfbGluayA9IGZ1bmN0aW9uIChwcmlvcml0eSwgaWQpIHsKICAgICAgICB2YXIgaWNvbl91cmwgPSBjb21wb3NlX3ByaW9yaXR5X2ljb24ocHJpb3JpdHkpOwogICAgICAgIHJldHVybiAnPGEgaHJlZj0iIyIgY2xhc3M9ImNoYW5nZS1wcmlvcml0eSI+PGltZyBkYXRhLWZpZWxkPSJwcmlvcml0eSIgZGF0YS1pbmZvPSJyb3ciIGRhdGEtaWQ9IicgKwogICAgICAgICAgICBpZCArICciIGRhdGEtdmFsdWU9IicgKyBwcmlvcml0eSArICciIHNyYz0iJyArIGljb25fdXJsICsgJyIvPjwvYT4nCiAgICB9OwoKICAgIHZhciBjb21wb3NlX3ByaW9yaXR5X2ljb24gPSBmdW5jdGlvbiAocHJpb3JpdHkpIHsKICAgICAgICB2YXIgaWNvbl91cmwgPSAiL3NpZ25hbC9hc3NldHMvaWNvbnMvZGVmYXVsdF9wcmlvcml0eS5wbmciOwoKICAgICAgICBpZiAoXy5jb250YWlucyhbJ2hpZ2gnLCAnbG93JywgJ21lZGl1bSddLCBwcmlvcml0eS50b0xvd2VyQ2FzZSgpKSkgewogICAgICAgICAgICBpY29uX3VybCA9ICIvc2lnbmFsL2Fzc2V0cy9pY29ucy8iICsgcHJpb3JpdHkudG9Mb3dlckNhc2UoKSArICJfcHJpb3JpdHkucG5nIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGljb25fdXJsOwogICAgfTsKCiAgICB2YXIgY2hhbmdlX3ByaW9yaXR5ID0gZnVuY3Rpb24gKHByaW9yaXR5RWxlLCBwcmlvcml0eSkgewogICAgICAgIHZhciBpY29uX3VybCA9IGNvbXBvc2VfcHJpb3JpdHlfaWNvbihwcmlvcml0eSk7CiAgICAgICAgJChwcmlvcml0eUVsZSkuYXR0cigic3JjIiwgaWNvbl91cmwpOwogICAgICAgICQocHJpb3JpdHlFbGUpLmF0dHIoImRhdGEtdmFsdWUiLCBwcmlvcml0eSk7CiAgICB9OwoKICAgIHZhciBjaGFuZ2VfcHJpb3JpdHlUZXN0ID0gZnVuY3Rpb24gKHByaW9yaXR5RWxlLCBwcmlvcml0eSkgewogICAgICAgICQocHJpb3JpdHlFbGUpLmF0dHIoImRhdGEtdmFsdWUiLCBwcmlvcml0eSk7CiAgICB9OwoKICAgIGNoYW5nZV9wcmlvcml0eVRlc3QKCiAgICB2YXIgZmluZF9maWVsZCA9IGZ1bmN0aW9uICh0YWJsZV9yb3dfZWxlLCBhdHRyX25hbWUpIHsKICAgICAgICByZXR1cm4gJCh0YWJsZV9yb3dfZWxlKS5maW5kKCJbZGF0YS1hdHRyaWJ1dGUtbmFtZT0nIiArIGF0dHJfbmFtZSArICInXSIpCiAgICB9OwoKICAgIHZhciBzZXRfdmFsdWUgPSBmdW5jdGlvbiAodGFibGVfcm93X2VsZSwgYXR0cl9uYW1lLCBpZCwgZGF0YV9mdW4sIGFwcF9uYW1lKSB7CiAgICAgICAgdmFyIGVsZSA9IGZpbmRfZmllbGQodGFibGVfcm93X2VsZSwgYXR0cl9uYW1lKTsKICAgICAgICBlbGUuaHRtbChkYXRhX2Z1bihpZCwgYXBwX25hbWUpKTsKICAgIH07CgogICAgdmFyIGdldF9kdWVfaW4gPSBmdW5jdGlvbiAoaWQsIGFwcF9uYW1lKSB7CiAgICAgICAgdmFyIGR1ZUluID0gMDsKICAgICAgICAkLmFqYXgoewogICAgICAgICAgICB1cmw6ICIvc2lnbmFsL2FsZXJ0L2R1ZUluP2FsZXJ0SWQ9IiArIGlkICsgIiZhcHBOYW1lPSIgKyBhcHBfbmFtZSwKICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgZHVlSW4gPSBkYXRhLnJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBkdWVJbgogICAgfTsKCiAgICB2YXIgZHVlX2luX2NvbXAgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gIjxkaXYgZGF0YS1hdHRyaWJ1dGUtbmFtZT0nZHVlSW4nIHN0eWxlID0gJ2NvbG9yOnJlZCc+IiArIHZhbHVlICsgIjwvZGl2PiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICI8ZGl2IGRhdGEtYXR0cmlidXRlLW5hbWU9J2R1ZUluJz4iICsgdmFsdWUgKyAiPC9kaXY+IjsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBhc3NpZ25lZF90b19jb21wID0gZnVuY3Rpb24gKGlkLCBhc3NpZ25lZFRvKSB7CiAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBjbGFzcz0iYXNzaWduZWRUb0NvbnRhaW5lciI+PHNlbGVjdCBjbGFzcz0iYXNzaWduZWRUb1NlbGVjdCBmb3JtLWNvbnRyb2wgc2VsZWN0MiI+PC9zZWxlY3Q+PGkgY2xhc3M9Im1kaSBtZGktc3BpbiBtZGktbG9hZGluZyBhc3NpZ25Ub1Byb2Nlc3NpbmciIHN0eWxlPSJkaXNwbGF5OiBub25lIj48L2k+PC9kaXY+JzsKICAgICAgICByZXR1cm4gaHRtbAogICAgfTsKCiAgICB2YXIgdHJ1bmNhdGVUZXh0QW5kU2hvd1Rvb2x0aXAgPSBmdW5jdGlvbiAoY3V0b2ZmLCB3b3JkYnJlYWssIGVzY2FwZUh0bWwpIHsKICAgICAgICB2YXIgZXNjID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICAgICAgfTsKCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgLy8gT3JkZXIsIHNlYXJjaCBhbmQgdHlwZSBnZXQgdGhlIG9yaWdpbmFsIGRhdGEKICAgICAgICAgICAgaWYgKHR5cGUgIT09ICdkaXNwbGF5JykgewogICAgICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlb2YgZCAhPT0gJ251bWJlcicgJiYgdHlwZW9mIGQgIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZCA9IGQudG9TdHJpbmcoKTsgLy8gY2FzdCBudW1iZXJzCgogICAgICAgICAgICBpZiAoZC5sZW5ndGggPD0gY3V0b2ZmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZXNjKGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc2hvcnRlbmVkID0gZC5zdWJzdHIoMCwgY3V0b2ZmIC0gMSk7CgogICAgICAgICAgICAvLyBGaW5kIHRoZSBsYXN0IHdoaXRlIHNwYWNlIGNoYXJhY3RlciBpbiB0aGUgc3RyaW5nCiAgICAgICAgICAgIGlmICh3b3JkYnJlYWspIHsKICAgICAgICAgICAgICAgIHNob3J0ZW5lZCA9IHNob3J0ZW5lZC5yZXBsYWNlKC9ccyhbXlxzXSopJC8sICcnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gUHJvdGVjdCBhZ2FpbnN0IHVuY29udHJvbGxlZCBIVE1MIGlucHV0CiAgICAgICAgICAgIGlmIChlc2NhcGVIdG1sKSB7CiAgICAgICAgICAgICAgICBzaG9ydGVuZWQgPSBlc2Moc2hvcnRlbmVkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0iZWxsaXBzaXMiIHRpdGxlPSInICsgZXNjKGQpICsgJyI+JyArIHNob3J0ZW5lZCArICcmIzgyMzA7PC9zcGFuPic7CiAgICAgICAgfTsKICAgIH07CgogICAgdmFyIGFkZF9maWx0ZXJzID0gZnVuY3Rpb24gKHRhYmxlLCBmaWx0ZXJzLCBmaWx0ZXJfdG9nZ2xlX2J0X2NvbnRhaW5lcikgewoKICAgICAgICB2YXIgeWFkY2ZfZmlsdGVycyA9IF8uZmlsdGVyKGZpbHRlcnMsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgIGlmIChmWzFdICE9ICdjdXN0b21pemVkJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGN1c3RfZmlsdGVycyA9IF8uZGlmZmVyZW5jZShmaWx0ZXJzLCB5YWRjZl9maWx0ZXJzKTsKCiAgICAgICAgeWFkY2YuaW5pdCh0YWJsZSwgXy5tYXAoeWFkY2ZfZmlsdGVycywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKGl0ZW1bMl0gPT0gdHJ1ZSkKICAgICAgICAgICAgICAgIHJldHVybiB7Y29sdW1uX251bWJlcjogaXRlbVswXSwgZmlsdGVyX3R5cGU6IGl0ZW1bMV0sIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogJ3gnfTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIHtjb2x1bW5fbnVtYmVyOiBpdGVtWzBdLCBmaWx0ZXJfdHlwZTogaXRlbVsxXSwgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZX07CiAgICAgICAgfSkpOwoKICAgICAgICBpZiAoZmlsdGVyX3RvZ2dsZV9idF9jb250YWluZXIpIHsKICAgICAgICAgICAgYWRkX2ZpbHRlcl90b2dnbGVfYnV0dG9uKCdpZHh4eHh4eCcsIGZpbHRlcl90b2dnbGVfYnRfY29udGFpbmVyKTsKICAgICAgICB9CgogICAgICAgIGlmIChjdXN0X2ZpbHRlcnMpIHsKICAgICAgICAgICAgXy5lYWNoKGN1c3RfZmlsdGVycywgZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgICAgICQodGFibGUuY29sdW1uKGZbMF0pLmhlYWRlcigpKS5hcHBlbmQoY3JlYXRlX3N0YWNrZWRfZmlsdGVyKGZbMF0pKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgY3JlYXRlX3N0YWNrZWRfZmlsdGVyID0gZnVuY3Rpb24gKGlkeCkgewogICAgICAgIHJldHVybiAkKCI8aW5wdXQgdHlwZT0ndGV4dCcgZGF0YS1pbmRleD0nIiArIGlkeCArICInIGNsYXNzPSdjb2x1bW4tZmlsdGVyJyBwbGFjZWhvbGRlcj0nVHlwZSB0byBmaWx0ZXInPiIgKwogICAgICAgICAgICAiPGlucHV0IHR5cGU9J3RleHQnIGRhdGEtaW5kZXg9JyIgKyBpZHggKyAiJyBjbGFzcz0nY29sdW1uLWZpbHRlcicgcGxhY2Vob2xkZXI9J1R5cGUgdG8gZmlsdGVyJz4iKTsKICAgIH07CgogICAgdmFyIGFkZF9maWx0ZXJfdG9nZ2xlX2J1dHRvbiA9IGZ1bmN0aW9uICh0YWJsZV9pZCwgY29udGFpbmVyKSB7CiAgICAgICAgJCgnLnlhZGNmLWZpbHRlci13cmFwcGVyLCAuY29sdW1uLWZpbHRlcicpLmhpZGUoKTsKICAgICAgICAkKCcuY29sdW1uLWZpbHRlcicpLmNsaWNrKGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9KTsKICAgICAgICAkKCcuY29sdW1uLWZpbHRlcicpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgLy8gUGVyZm9ybSBzZWFyY2gKICAgICAgICAgICAgdmFyIGluZGV4ID0gJCh0aGlzKS5kYXRhKCdpbmRleCcpOwogICAgICAgICAgICAkKHRhYmxlX2lkKS5EYXRhVGFibGUoKS5jb2x1bW4oaW5kZXgpLnNlYXJjaCgkKHRoaXMpLnZhbCgpKS5kcmF3KCk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGZpbHRlclRvZ2dsZSA9ICI8aSBjbGFzcz0ndGFibGUtZmlsdGVyLXRvZ2dsZSBnbHlwaGljb24gZ2x5cGhpY29uLWZpbHRlcicgZGF0YS10YWJsZT0nIiArIHRhYmxlX2lkICsKICAgICAgICAgICAgIicgb25jbGljaz0nc2lnbmFsLmxpc3RfdXRpbHMuaGFuZGxlX2ZpbHRlcl90b2dnbGUnIGRhdGEtc2hvdy1maWx0ZXI9J3RydWUnPjwvaT4iOwogICAgICAgIHZhciB0b2dnbGVfYnV0dG9uID0gJC5wYXJzZUhUTUwoZmlsdGVyVG9nZ2xlKTsKICAgICAgICBpZiAoIShfLmlzVW5kZWZpbmVkKGNvbnRhaW5lcikgJiYgXy5pc051bGwoY29udGFpbmVyKSkpIHsKICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZCh0b2dnbGVfYnV0dG9uKTsKICAgICAgICB9CgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdmaWx0ZXItdG9nZ2xlLWluaXQnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICQoJy50YWJsZS1maWx0ZXItdG9nZ2xlJykuY2xpY2soZnVuY3Rpb24gKGV2dCkgewogICAgICAgICAgICAgICAgdmFyIGhpZGVfc2hvd19maXRsZXIgPSBmdW5jdGlvbiAodGFibGVJZCwgaGlkZU9yU2hvdykgewogICAgICAgICAgICAgICAgICAgIGlmIChoaWRlT3JTaG93ID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRhYmxlSWQgKyAnX3dyYXBwZXIgLnlhZGNmLWZpbHRlci13cmFwcGVyLC5jb2x1bW4tZmlsdGVyJykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGFibGVJZCArICdfd3JhcHBlciAueWFkY2YtZmlsdGVyLXdyYXBwZXIsLmNvbHVtbi1maWx0ZXInKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0RmlsdGVyVG9nZ2xlID0gJChldnQudGFyZ2V0KTsKICAgICAgICAgICAgICAgIHZhciB0YWJsZUlkID0gdGFyZ2V0RmlsdGVyVG9nZ2xlLmRhdGEoJ3RhYmxlJyk7CiAgICAgICAgICAgICAgICB2YXIgc2hvd0ZpbHRlciA9IHRhcmdldEZpbHRlclRvZ2dsZS5kYXRhKCdzaG93LWZpbHRlcicpOwogICAgICAgICAgICAgICAgaWYgKHNob3dGaWx0ZXIgPT09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgIHRhcmdldEZpbHRlclRvZ2dsZS5kYXRhKCdzaG93RmlsdGVyJywgJ2ZhbHNlJyk7CiAgICAgICAgICAgICAgICAgICAgaGlkZV9zaG93X2ZpdGxlcih0YWJsZUlkLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRhcmdldEZpbHRlclRvZ2dsZS5kYXRhKCdzaG93RmlsdGVyJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgICAgICBoaWRlX3Nob3dfZml0bGVyKHRhYmxlSWQsIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgJChkb2N1bWVudCkudHJpZ2dlcignZmlsdGVyLXRvZ2dsZS1pbml0Jyk7CiAgICAgICAgcmV0dXJuICQodG9nZ2xlX2J1dHRvbik7CiAgICB9OwoKICAgIHZhciBoYW5kbGVfZmlsdGVyX3RvZ2dsZSA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAkKHRoaXMpLmF0dHIoJ3RhcmdldC10YWJsZScpOwogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIGZsYWdfaXQ6IGZsYWdfaXQsCiAgICAgICAgZmxhZ19oYW5kbGVyOiBmbGFnX2hhbmRsZXIsCiAgICAgICAgcHJpb3JpdHlfbGluazogcHJpb3JpdHlfbGluaywKICAgICAgICBjaGFuZ2VfcHJpb3JpdHk6IGNoYW5nZV9wcmlvcml0eSwKICAgICAgICBmaW5kX2ZpZWxkOiBmaW5kX2ZpZWxkLAogICAgICAgIHNldF92YWx1ZTogc2V0X3ZhbHVlLAogICAgICAgIGdldF9kdWVfaW46IGdldF9kdWVfaW4sCiAgICAgICAgZHVlX2luX2NvbXA6IGR1ZV9pbl9jb21wLAogICAgICAgIGFzc2lnbmVkX3RvX2NvbXA6IGFzc2lnbmVkX3RvX2NvbXAsCiAgICAgICAgdHJ1bmNhdGVUZXh0QW5kU2hvd1Rvb2x0aXA6IHRydW5jYXRlVGV4dEFuZFNob3dUb29sdGlwLAogICAgICAgIGFkZF9maWx0ZXJzOiBhZGRfZmlsdGVycywKICAgICAgICBoYW5kbGVfZmlsdGVyX3RvZ2dsZTogaGFuZGxlX2ZpbHRlcl90b2dnbGUsCiAgICAgICAgYWRkX2ZpbHRlcl90b2dnbGVfYnV0dG9uOiBhZGRfZmlsdGVyX3RvZ2dsZV9idXR0b24KICAgIH0KfSkoKTsKdmFyIHNob3dUb3BpY1dpZGdldCA9IGZ1bmN0aW9uICgpIHsKICAgICQoIiN0b3BpYyIpLnNlbGVjdDIoewogICAgICAgIHRhZ3M6IHRydWUsCiAgICAgICAgcGxhY2Vob2xkZXI6ICJTZWxlY3QgdG9waWMiLAogICAgICAgIGFsbG93Q2xlYXI6IHRydWUsCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBjcmVhdGVUYWc6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgdmFyIHRlcm0gPSAkLnRyaW0ocGFyYW1zLnRlcm0pOwogICAgICAgICAgICBpZiAodGVybSAhPSAiIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBpZDogdGVybSwKICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0ZXJtCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICB9KTsKfTsKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfY29tbW9uLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2xpc3RfdXRpbHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfaGFuZGxlYmFyX2V4dC5qcwovLz0gcmVxdWlyZSBhcHAvcHZzL3RvcGljL2F0dGFjaEFsZXJ0VG9Ub3BpYy5qcwoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKCnZhciB0b3BpY0RhdGE7CnZhciBjb2x1bW5TZXE7CnZhciBpc1ZpZXdJbnN0YW5jZSA9IDE7CnZhciBzaWduYWxBbGVydFR5cGUgPSB7CiAgICBTSU5HTEVfQ0FTRV9BTEVSVDogIlNpbmdsZSBDYXNlIEFsZXJ0IiwKICAgIEFHR1JFR0FURV9BTEVSVDogIkFnZ3JlZ2F0ZSBDYXNlIEFsZXJ0IiwKICAgIEVWREFTX0FMRVJUOiAiRXZkYXMgQWxlcnQiLAogICAgQURIT0NfQUxFUlQ6ICJBZC1Ib2MgQWxlcnQiLAogICAgTElURVJBVFVSRV9TRUFSQ0hfQUxFUlQ6ICJMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCIKfQoKc2lnbmFsLmFsZXJ0UmV2aWV3ID0gKGZ1bmN0aW9uICgpIHsKCiAgICB2YXIgaWRzID0gW107CiAgICB2YXIgcm93cyA9IFtdOwoKICAgIHZhciBhcHBseUJ1c2luZXNzUnVsZXMgPSBmdW5jdGlvbiAocm93LCBkYXRhKSB7CiAgICAgICAgLy9BcHBseSB0aGUgZXVkcmEgcnVsZXMuCiAgICAgICAgaWYgKGRhdGEuZm9ybWF0KSB7CiAgICAgICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKGRhdGEuZm9ybWF0KTsKICAgICAgICAgICAgdmFyIHRleHRPYmo7CiAgICAgICAgICAgICQuZWFjaChvYmoudGV4dC50YywgZnVuY3Rpb24gKGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgICAgICB0ZXh0T2JqID0gJChyb3cpLmZpbmQoJy4nICsgZGF0YSk7CiAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygnY29sb3InLCBvYmoudGV4dC5jb2xvcik7CiAgICAgICAgICAgICAgICBpZiAob2JqLnRleHQuYm9sZCkgewogICAgICAgICAgICAgICAgICAgIHRleHRPYmouY3NzKCdmb250LXdlaWdodCcsICc5MDAnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvYmoudGV4dC5pdGFsaWMpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygnZm9udC1zdHlsZScsICdpdGFsaWMnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvYmoudGV4dC51bmRlcmxpbmUpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0T2JqLmNzcygndGV4dC1kZWNvcmF0aW9uJywgJ3VuZGVybGluZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJC5lYWNoKG9iai5jZWxsLnRjLCBmdW5jdGlvbiAoaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgICAgICQocm93KS5maW5kKCcuJyArIGRhdGEpLnBhcmVudHMoJ3RkJykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgb2JqLmNlbGwuY29sb3IpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBlbmFibGVNZW51VG9vbHRpcHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgiLmdyaWQtbWVudS10b29sdGlwIikubW91c2VvdmVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIHRvb2x0aXBUZXh0ID0gJHRoaXMuYXR0cigiZGF0YS10aXRsZSIpOwogICAgICAgICAgICAkdGhpcy50b29sdGlwKHsKICAgICAgICAgICAgICAgIHRpdGxlOiB0b29sdGlwVGV4dCwKICAgICAgICAgICAgICAgIHBsYWNlbWVudDogImJvdHRvbSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICR0aGlzLnRvb2x0aXAoJ3Nob3cnKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGRpc2FibGVUb29sdGlwcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKCIubWRpLWFscGhhLWQtYm94LCAubWRpLWZpbHRlci1vdXRsaW5lLCAubWRpLXRyZW5kaW5nLXVwLCAubWRpLWNvbnRlbnQtc2F2ZSwgLm1kaS1leHBvcnQsIC5tZGktc2V0dGluZ3MsIG1kaS1wbHVzLWJveCwgbWRpLWNoYXJ0LWJhciIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgiLnRvb2x0aXAiKS5oaWRlKCk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHZhciBzb3J0SWNvbkhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHRoQXJyYXkgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCkuY29sdW1ucygpLmhlYWRlcigpOwogICAgICAgIGlmIChpc1ZpZXdJbnN0YW5jZSkgewogICAgICAgICAgICB2YXIgY29sdW1uTmFtZTsKICAgICAgICAgICAgdmFyIGluZGV4T2ZDb2x1bW4gPSAwOwogICAgICAgICAgICBjb2x1bW5TZXEuZXZlcnkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlcSA9IGNvbHVtblNlcVtpbmRleE9mQ29sdW1uXS5zZXE7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gc2VxKSB7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uTmFtZSA9IGNvbHVtblNlcVtpbmRleE9mQ29sdW1uXS5uYW1lOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGluZGV4T2ZDb2x1bW4rKzsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGNvbHVtbkluZGV4ID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmZpbmQoInRoW2RhdGEtZmllbGQ9IiArIGNvbHVtbk5hbWUgKyAiXSIpLmF0dHIoJ2RhdGEtY29sdW1uLWluZGV4Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29sdW1uSW5kZXggPSBpbmRleDsKICAgICAgICB9CiAgICAgICAgJC5lYWNoKHRoQXJyYXksIGZ1bmN0aW9uIChjdXJyZW50SW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzb3J0aW5nX2FzYycpKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NvcnRpbmdfYXNjJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoInNvcnRpbmciKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19kZXNjJykpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc29ydGluZ19kZXNjJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoInNvcnRpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY3VycmVudEluZGV4ID09IGNvbHVtbkluZGV4ICYmICFlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnc29ydGluZ19kaXNhYmxlZCcpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGlyID09ICdhc2MnKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nX2FzYyIpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaXIgPT0gJ2Rlc2MnKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdzb3J0aW5nJyk7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCJzb3J0aW5nX2Rlc2MiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICAvKioKICAgICAqIFRoZSByZXNldCBtb2RhbCBzY3JlZW4gZnVuY3Rpb24gd2hpY2ggcmVzZXRzIHRoZSBwYXNzd29yZCBkaXYgaW4gdGhlIHdvcmtmbG93IG1vZGFsIHNjcmVlbi4KICAgICAqIFRoaXMgaXMgaW50ZXJuYWwgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGludGVybmFsbHkgaW4gdGhpcyBvYmplY3Qgc2NvcGUuCiAgICAgKi8KICAgIHZhciByZXNldE1vZGFsU2NyZWVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8vQ2xlYW4gdXAgdGhlIHRoZSBkaXNwb3NpdGlvbnMgZmllbGRzLgogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2V4dHJhLXZhbHVlLXNlbGVjdCcpLmh0bWwoIjxvcHRpb24+PC9vcHRpb24+Iik7CiAgICAgICAgLy9IaWRlIHRoZSBwYXNzd29yZAogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI3Bhc3N3b3JkRGl2JykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNpc1Bhc3N3b3JkRW5hYmxlZCcpLnZhbCgwKTsKICAgIH0KCiAgICB2YXIgc2hvd1Bhc3N3b3JkRmllbGQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjcGFzc3dvcmREaXYnKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnI2lzUGFzc3dvcmRFbmFibGVkJykudmFsKDEpOwogICAgfQoKICAgIHZhciBjaGFuZ2VXb3JrZmxvd0VkaXRTY3JlZW4gPSBmdW5jdGlvbiAoYXZhaWxhYmxlVmFsdWVzLCB0YXJnZXRWYWwpIHsKCiAgICAgICAgdmFyIGF2YWlsYWJsZVZhbE9iaiA9IF8uZmluZFdoZXJlKGF2YWlsYWJsZVZhbHVlcywge3ZhbHVlOiB0YXJnZXRWYWx9KTsKCiAgICAgICAgaWYgKHR5cGVvZiBhdmFpbGFibGVWYWxPYmogIT0gJ3VuZGVmaW5lZCcgJiYgYXZhaWxhYmxlVmFsT2JqKSB7CiAgICAgICAgICAgIGlmIChhdmFpbGFibGVWYWxPYmouYXBwcm92YWxSZXF1aXJlZCkgewogICAgICAgICAgICAgICAgc2hvd1Bhc3N3b3JkRmllbGQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc2V0TW9kYWxTY3JlZW4oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9DbGVhbiB1cCB0aGUgdGhlIGRpc3Bvc2l0aW9ucyBmaWVsZHMKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcjZXh0cmEtdmFsdWUtc2VsZWN0JykuaHRtbCgnJykKCiAgICAgICAgICAgIC8vRmlsbCB1cCB0aGUgZGlzcG9zaXRpb25zIGluIHRoZSBjb21ibwogICAgICAgICAgICAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNleHRyYS12YWx1ZS1zZWxlY3QnKS5odG1sKGdldERpc3Bvc2l0aW9uT3B0aW9ucyhhdmFpbGFibGVWYWxPYmopKQogICAgICAgIH0KICAgIH0KCiAgICB2YXIgZ2V0RGlzcG9zaXRpb25PcHRpb25zID0gZnVuY3Rpb24gKGF2YWlsYWJsZVZhbE9iaikgewogICAgICAgIHZhciBkaXNwb3NpdGlvblN0ciA9ICI8b3B0aW9uPjwvb3B0aW9uPiI7CiAgICAgICAgXy5lYWNoKGF2YWlsYWJsZVZhbE9iai5kaXNwb3NpdGlvbnMsIGZ1bmN0aW9uIChkaXNwb3NpdGlvbikgewogICAgICAgICAgICBkaXNwb3NpdGlvblN0ciA9IGRpc3Bvc2l0aW9uU3RyICsKICAgICAgICAgICAgICAgICI8b3B0aW9uIHZhbHVlPVwiIiArIGRpc3Bvc2l0aW9uLnZhbHVlICsgIlwiPiIgKyBkaXNwb3NpdGlvbi5kaXNwbGF5TmFtZSArICI8L29wdGlvbj4iCiAgICAgICAgfSkKICAgICAgICByZXR1cm4gZGlzcG9zaXRpb25TdHIKICAgIH0KCiAgICB2YXIgYXV0aGVudGljYXRlVXNlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmV0dXJuVmFsID0gZmFsc2UKICAgICAgICB2YXIgcGFzc3dvcmRKc29uID0gewogICAgICAgICAgICAicGFzc3dvcmQiOiAkKCcjZWRpdC1zdGF0ZS1tb2RhbCcpLmZpbmQoJyNwYXNzd29yZEF1dGhlbnRpY2F0aW9uJykudmFsKCkKICAgICAgICB9CgogICAgICAgIHZhciBhdXRoVXJsID0gJy9zaWduYWwvdXNlci9hdXRoZW50aWNhdGUnCgogICAgICAgICQuYWpheCh7CiAgICAgICAgICAgIHVybDogYXV0aFVybCwKICAgICAgICAgICAgZGF0YTogcGFzc3dvcmRKc29uLAogICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuYXV0aG9yaXplZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IHRydWUKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsID0gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVyblZhbCA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmV0dXJuVmFsCiAgICB9CgogICAgdmFyIHRvZ2dsZUVycm9yTm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIGlmIChhY3Rpb24gPT0gJ2hpZGUnKSB7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsIC5lcnJvck5vdGlmaWNhdGlvbicpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsJykuZmluZCgnLmVycm9yTWVzc2FnZScpLmh0bWwoJycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJyNlZGl0LXN0YXRlLW1vZGFsIC5lcnJvck5vdGlmaWNhdGlvbicpLnJlbW92ZUNsYXNzKCdoaWRlJykKICAgICAgICAgICAgJCgnI2VkaXQtc3RhdGUtbW9kYWwnKS5maW5kKCcuZXJyb3JNZXNzYWdlJykuaHRtbCgnIEF1dGhlbnRpY2F0aW9uIEZhaWxlZCEnKTsKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBvcGVuQ2FzZUhpc3RvcnlNb2RhbCA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgLy9CaW5kIHRoZSBjbGljayBldmVudCBvbiB0aGUgY2FzZSBoaXN0b3J5IGljb24uCiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jYXNlLWhpc3RvcnktaWNvbicsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dJbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICBpZiAoaXNBYnN0cmFjdFZpZXdPckNhc2VWaWV3KHNlbGVjdGVkUm93SW5kZXgpKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAvIDIKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaXNTaWduYWwgPSAkKHRoaXMpLmRhdGEoJ3NpZ25hbCcpOwoKICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgICAgICBpZiAoIWlzU2lnbmFsKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZS5yb3dzKHNlbGVjdGVkUm93SW5kZXgpLmRhdGEoKVswXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlU2luZ2xlUmV2aWV3LnJvdygkKHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHJvd09iamVjdC5jYXNlTnVtYmVyOwogICAgICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHJvd09iamVjdC5wcm9kdWN0RmFtaWx5OwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSByb3dPYmplY3QuY2FzZVZlcnNpb247CiAgICAgICAgICAgIHZhciBwcm9kdWN0TmFtZSA9IHJvd09iamVjdC5wcm9kdWN0TmFtZTsKICAgICAgICAgICAgdmFyIHB0ID0gcm93T2JqZWN0LnByaW1hcnlFdmVudDsKICAgICAgICAgICAgdmFyIGFsZXJ0Q29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKCiAgICAgICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI2Nhc2VIaXN0b3J5TW9kYWwnKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjY2FzZU51bWJlciIpLmh0bWwoY2FzZU51bWJlcik7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3Byb2R1Y3RGYW1pbHkiKS5odG1sKHByb2R1Y3RGYW1pbHkpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLmZpbmQoIiNjYXNlVmVyc2lvbiIpLnZhbChjYXNlVmVyc2lvbik7CiAgICAgICAgICAgIGNhc2VIaXN0b3J5TW9kYWwuZmluZCgiI3Byb2R1Y3ROYW1lIikudmFsKHByb2R1Y3ROYW1lKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjYWxlcnRDb25maWdJZCIpLnZhbChhbGVydENvbmZpZ0lkKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5maW5kKCIjcHQiKS52YWwocHQpOwogICAgICAgICAgICBjYXNlSGlzdG9yeU1vZGFsLm1vZGFsKCdzaG93Jyk7CgogICAgICAgICAgICBpZih0eXBlb2Ygc2luZ2xlQ2FzZVVwZGF0ZUp1c3RpZmljYXRpb25VcmwgIT0gJ3VuZGVmaW5lZCcpCiAgICAgICAgICAgICAgICB1cGRhdGVKdXN0aWZpY2F0aW9uVXJsID0gc2luZ2xlQ2FzZVVwZGF0ZUp1c3RpZmljYXRpb25Vcmw7CgogICAgICAgICAgICBzaWduYWwuY2FzZUhpc3RvcnlUYWJsZS5pbml0X2Nhc2VfaGlzdG9yeV90YWJsZShjYXNlSGlzdG9yeVVybCk7CiAgICAgICAgICAgIHNpZ25hbC5jYXNlSGlzdG9yeVRhYmxlLmluaXRfY2FzZV9oaXN0b3J5X3RhYmxlX3N1c3BlY3QoY2FzZUhpc3RvcnlTdXNwZWN0VXJsKTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5BbGVydENvbW1lbnRNb2RhbCA9IGZ1bmN0aW9uIChhbGVydFR5cGUsIGFwcGxpY2F0aW9uTmFtZSkgewoKICAgICAgICAvL01vZGFsIG9iamVjdAogICAgICAgIHZhciBjb21tZW50TW9kYWwgPSAkKCcjY29tbWVudE1vZGFsJyk7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jb21tZW50LWljb24nLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgdmFyICR0aGlzID0gdGhpczsKICAgICAgICAgICAgdmFyIGRhdGFJbmZvOwogICAgICAgICAgICB2YXIgaXNDYXNlRGV0YWlsOwogICAgICAgICAgICB2YXIgYXBwVHlwZTsKICAgICAgICAgICAgdmFyIHZhbGlkYXRlZFNpZ25hbElkOwogICAgICAgICAgICB2YXIgY29tbWVudEFsZXJ0VHlwZSA9ICQoJHRoaXMpLmRhdGEoJ25hbWUnKTsKICAgICAgICAgICAgdmFyIGlzU2lnbmFsID0gJCgkdGhpcykuZGF0YSgnc2lnbmFsJyk7CgogICAgICAgICAgICBpZiAoY29tbWVudEFsZXJ0VHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBhbGVydFR5cGUgPSBjb21tZW50QWxlcnRUeXBlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbkFycmF5ID0gW107CiAgICAgICAgICAgIGRhdGFJbmZvID0gJChldmVudC50YXJnZXQpLmF0dHIoJ2RhdGEtaW5mbycpOwogICAgICAgICAgICBpc0Nhc2VEZXRhaWwgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1jb21tZW50Jyk7CgogICAgICAgICAgICBhcHBUeXBlID0gJCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICBpZiAoYXBwVHlwZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgIGFwcFR5cGUgPSBjb21tZW50TW9kYWwuZmluZCgiI2FwcGxpY2F0aW9uIikuaHRtbCgpOwogICAgICAgICAgICAgICAgdmFsaWRhdGVkU2lnbmFsSWQgPSBjb21tZW50TW9kYWwuZmluZCgiI3ZhbGlkYXRlZFNpZ25hbElkIikuaHRtbCgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0NvdW50OwogICAgICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93Q291bnQgPSAkKCd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VsZWN0ZWRSb3dDb3VudCA+IDEgJiYgJCgkdGhpcykuY2xvc2VzdCgndHInKS5maW5kKCIuY29weS1zZWxlY3QiKS5wcm9wKCJjaGVja2VkIikpIHsKICAgICAgICAgICAgICAgIHZhciB0ZXh0VG9EaXNwbGF5OwogICAgICAgICAgICAgICAgc3dpdGNoIChhcHBsaWNhdGlvbk5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdTaW5nbGUgQ2FzZSBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnQ2FzZSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFRvRGlzcGxheSA9ICdQRUMnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdFVkRBUyBBbGVydCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRUb0Rpc3BsYXkgPSAnUEVDJzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnOgogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0VG9EaXNwbGF5ID0gJ0FydGljbGUnOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uJykuc2hvdygpOwogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24gc3Bhbi5hbGVydFR5cGVUZXh0JykuaHRtbCh0ZXh0VG9EaXNwbGF5KTsKICAgICAgICAgICAgICAgICQoY29tbWVudE1vZGFsKS5maW5kKCdkaXYuYnVsa09wdGlvbnNTZWN0aW9uIHNwYW4uY291bnQnKS5odG1sKHNlbGVjdGVkUm93Q291bnQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJChjb21tZW50TW9kYWwpLmZpbmQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24nKS5oaWRlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICQoJ2Rpdi5idWxrT3B0aW9uc1NlY3Rpb24gaW5wdXRbbmFtZT1idWxrT3B0aW9uc10nKS51bmJpbmQoKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc3dpdGNoICgkKHRoaXMpLnZhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYWxsU2VsZWN0ZWQnOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbkFycmF5ID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYXRlU2luZ2xlQnVsa1Jvd0NvbW1lbnRQcm9jZXNzKGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmluZEFkZENvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgImJ1bGsiLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdjdXJyZW50JzoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25BcnJheSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzLCBjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRBZGRDb21tZW50cyhjb21tZW50TW9kYWwsIGNhc2VKc29uQXJyYXksICJyb3ciLCBhbGVydFR5cGUsIHZhbGlkYXRlZFNpZ25hbElkLCBpc0Nhc2VEZXRhaWwpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZGF0YUluZm8gPT09ICJyb3ciKSB7CiAgICAgICAgICAgICAgICBpbml0aWF0ZVNpbmdsZVJvd0NvbW1lbnRQcm9jZXNzKCR0aGlzLCBjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICBiaW5kQWRkQ29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbkFycmF5LCBkYXRhSW5mbywgYWxlcnRUeXBlLCB2YWxpZGF0ZWRTaWduYWxJZCwgaXNDYXNlRGV0YWlsLCAkdGhpcykKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgYmluZEFkZENvbW1lbnRzID0gZnVuY3Rpb24gKGNvbW1lbnRNb2RhbCwgY2FzZUpzb25BcnJheSwgZGF0YUluZm8sIGFsZXJ0VHlwZSwgdmFsaWRhdGVkU2lnbmFsSWQsIGlzQ2FzZURldGFpbCwgY3VycmVudFJvdykgewogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIuYWRkLWNvbW1lbnRzIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY2FzZUpzb247CiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iajsKICAgICAgICAgICAgdmFyIGRhdGE7CiAgICAgICAgICAgIHZhciB1cmw7CiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjYXNlSnNvbk9iakFycmF5ID0gW107CiAgICAgICAgICAgIGlmIChkYXRhSW5mbyA9PT0gInJvdyIpIHsKICAgICAgICAgICAgICAgIGNhc2VKc29uID0gY2FzZUpzb25BcnJheVswXTsKCiAgICAgICAgICAgICAgICBpZiAoY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50SWQiKS52YWwoKSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb21tZW50IjogY29tbWVudE1vZGFsLmZpbmQoIiNjb21tZW50Ym94IikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJpZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6ICQoIiN0b3BpY0lkIikuaHRtbCgpLAogICAgICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhZGhvY0FsZXJ0SWQiOiBjYXNlSnNvbi5hZGhvY0FsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNhc2VKc29uLmNvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBjYXNlSnNvbi5saXRlcmF0dXJlQWxlcnRJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5jb21tZW50PT0iIikgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvZGVsZXRlQ29tbWVudCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvdXBkYXRlQ29tbWVudCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB1cmwgPSAiL3NpZ25hbC9hbGVydENvbW1lbnQvc2F2ZUNvbW1lbnQiOwoKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogY2FzZUpzb24ucHJvZHVjdE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBjYXNlSnNvbi5ldmVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdCI6IGNhc2VKc29uLnB0LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tbWVudHMiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlSnNvbi5jYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IGNhc2VKc29uLnByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBjYXNlSnNvbi5hc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogY2FzZUpzb24uYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAiZXhlY3V0ZWRDb25maWdJZCI6IGNhc2VKc29uLmV4ZWN1dGVkQ29uZmlnSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwcm9kdWN0SWQiOiBjYXNlSnNvbi5wcm9kdWN0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdENvZGUiOiBjYXNlSnNvbi5wdENvZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJjb25maWdJZCI6IGNhc2VKc29uLmNvbmZpZ0lkLAogICAgICAgICAgICAgICAgICAgICAgICAibGl0ZXJhdHVyZUFsZXJ0SWQiOiBjYXNlSnNvbi5saXRlcmF0dXJlQWxlcnRJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImFydGljbGVJZCI6IGNhc2VKc29uLmFydGljbGVJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheS5wdXNoKGNhc2VKc29uT2JqKTsKICAgICAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5OiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVybCA9ICIvc2lnbmFsL2FsZXJ0Q29tbWVudC9zYXZlQ29tbWVudCI7CiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWRSb3dDb3VudDsKICAgICAgICAgICAgICAgIGlmICgkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLmlzKCc6Y2hlY2tlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dDb3VudCA9ICQoJ3RhYmxlLkRURkNfQ2xvbmVkIC5jb3B5LXNlbGVjdDpjaGVja2VkJykubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHNlbGVjdGVkUm93Q291bnQ7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZWRTaWduYWxJZCA9ICQoIiN2YWxpZGF0ZWRTaWduYWxJZCIpLmh0bWwoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbiA9IGNhc2VKc29uQXJyYXlbaW5kZXhdOwoKICAgICAgICAgICAgICAgICAgICAvL0Nhc2UgSlNPTi4KICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iaiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgImFsZXJ0VHlwZSI6IGFsZXJ0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgInByb2R1Y3ROYW1lIjogY2FzZUpzb24ucHJvZHVjdE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBjYXNlSnNvbi5ldmVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJwdCI6IGNhc2VKc29uLnB0LAogICAgICAgICAgICAgICAgICAgICAgICAiY29tbWVudHMiOiBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnRib3giKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlSnNvbi5jYXNlTnVtYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IGNhc2VKc29uLnByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2YWxpZGF0ZWRTaWduYWxJZCI6IHZhbGlkYXRlZFNpZ25hbElkLAogICAgICAgICAgICAgICAgICAgICAgICAidG9waWNJZCI6IGNvbW1lbnRNb2RhbC5maW5kKCIjdG9waWNJZCIpLmh0bWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBjYXNlSnNvbi5hc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogY2FzZUpzb24uYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogY2FzZUpzb24ucHJvZHVjdElkLAogICAgICAgICAgICAgICAgICAgICAgICAicHRDb2RlIjogY2FzZUpzb24ucHRDb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAiY29uZmlnSWQiOiBjYXNlSnNvbi5jb25maWdJZCwKICAgICAgICAgICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogY2FzZUpzb24ubGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJhcnRpY2xlSWQiOiBjYXNlSnNvbi5hcnRpY2xlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICJleGVjdXRlZENvbmZpZ0lkIjogY2FzZUpzb24uZXhlY3V0ZWRDb25maWdJZAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FzZUpzb25PYmpBcnJheS5wdXNoKGNhc2VKc29uT2JqKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBjYXNlSnNvbk9iakFycmF5OiBKU09OLnN0cmluZ2lmeShjYXNlSnNvbk9iakFycmF5KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL1NhdmUgY29tbWVudCBjYWxsCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoImkuaXNQcm9jZXNzaW5nIikuc2hvdygpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiaS5pc1Byb2Nlc3NpbmciKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgLy9Qb3B1bGF0ZSB0aGUgY29tbWVudHMgYWdhaW4gaWYgc2luZ2xlIGNvbW1lbnQgaXMgYWRkZWQuCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpc0Nhc2VEZXRhaWwgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUluZm8gPT09ICJyb3ciKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hbGVydENvbW1lbnRzLnBvcHVsYXRlX2NvbW1lbnRzKGNvbW1lbnRNb2RhbCwgY2FzZUpzb24pOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY29tbWVudGJveCcpLnZhbCgnJykuYmx1cigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5jb21tZW50ICE9ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Q29tbWVudEljb24oY3VycmVudFJvdykgOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQ29tbWVudEljb24oY3VycmVudFJvdykgOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5tb2RhbCgiaGlkZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vZGFsLWJhY2tkcm9wJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGVja2JveFNlbGVjdG9yOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZSNhbGVydHNEZXRhaWxzVGFibGUgLmNvcHktc2VsZWN0OmNoZWNrZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCQoY2hlY2tib3hTZWxlY3RvciksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDb21tZW50SWNvbih0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnc3VjY2VzcycsICd0b3AgcmlnaHQnLCAiU3VjY2VzcyIsICJDb21tZW50cyBhZGRlZCBzdWNjZXNzZnVsbHkuIiwge2F1dG9IaWRlRGVsYXk6IDEwMDAwfSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgIH07CgogICAgdmFyIGluaXRpYXRlU2luZ2xlUm93Q29tbWVudFByb2Nlc3MgPSBmdW5jdGlvbiAoJHRoaXMsIGNhc2VKc29uQXJyYXksIGNvbW1lbnRNb2RhbCwgYWxlcnRUeXBlLCBpc0Nhc2VEZXRhaWwsIGlzU2lnbmFsKSB7CiAgICAgICAgdmFyIGFkaG9jQWxlcnRJZDsKICAgICAgICB2YXIgbGl0ZXJhdHVyZUFsZXJ0SWQ7CiAgICAgICAgdmFyIGFydGljbGVJZDsKCiAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgIGlmICgoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ1NpbmdsZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdFVkRBUyBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSAmJiAhaXNTaWduYWwpIHsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkUm93SW5kZXggPSAkKCR0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIGlmIChpc0Fic3RyYWN0Vmlld09yQ2FzZVZpZXcoc2VsZWN0ZWRSb3dJbmRleCkpIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93SW5kZXggPSBzZWxlY3RlZFJvd0luZGV4IC8gMgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJvd09iamVjdCA9IHRhYmxlLnJvdyhzZWxlY3RlZFJvd0luZGV4KS5kYXRhKCk7CiAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09ICdBZ2dyZWdhdGUgQ2FzZSBBbGVydCcpIHsKICAgICAgICAgICAgcm93T2JqZWN0ID0gdGFibGVBZ2dSZXZpZXcucm93KCQoJHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICB9IGVsc2UgaWYgKGFsZXJ0VHlwZSA9PT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgewogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZUxpdGVyYXR1cmVSZXZpZXcucm93KCQoJHRoaXMpLnBhcmVudHMoJ3RyJykpLmRhdGEoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZVNpbmdsZVJldmlldy5yb3coJCgkdGhpcykucGFyZW50cygndHInKSkuZGF0YSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSByb3dPYmplY3QuY2FzZU51bWJlcjsKICAgICAgICB2YXIgcHJvZHVjdEZhbWlseSA9IHJvd09iamVjdC5wcm9kdWN0RmFtaWx5OwogICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHJvd09iamVjdC5jYXNlVmVyc2lvbjsKICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3dPYmplY3QucHJvZHVjdE5hbWU7CiAgICAgICAgdmFyIGV2ZW50TmFtZSA9IHJvd09iamVjdC5wcmVmZXJyZWRUZXJtOwogICAgICAgIHZhciBwdCA9IHJvd09iamVjdC5wdDsKICAgICAgICB2YXIgYXNzaWduZWRUbyA9IHJvd09iamVjdC5hc3NpZ25lZFRvLmlkOwogICAgICAgIHZhciBhc3NpZ25lZFRvVXNlciA9IG51bGw7CiAgICAgICAgIGlmKHJvd09iamVjdC5hc3NpZ25lZFRvVXNlciAhPSB1bmRlZmluZWQpCiAgICAgICAgICAgICBhc3NpZ25lZFRvVXNlciA9IHJvd09iamVjdC5hc3NpZ25lZFRvVXNlci5pZDsKICAgICAgICB2YXIgcHJvZHVjdElkID0gcm93T2JqZWN0LnByb2R1Y3RJZDsKICAgICAgICB2YXIgcHRDb2RlID0gcm93T2JqZWN0LnB0Q29kZTsKICAgICAgICB2YXIgY29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKICAgICAgICB2YXIgZXhlY3V0ZWRDb25maWdJZCA9IHJvd09iamVjdC5leGVjQ29uZmlnSWQ7CgogICAgICAgIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5BREhPQ19BTEVSVCkgewogICAgICAgICAgICBhZGhvY0FsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgfSBlbHNlIGlmIChhbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5MSVRFUkFUVVJFX1NFQVJDSF9BTEVSVCkgewogICAgICAgICAgICBsaXRlcmF0dXJlQWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgYXJ0aWNsZUlkID0gcm93T2JqZWN0LmFydGljbGVJZAogICAgICAgIH0KICAgICAgICB2YXIgY2FzZUpzb24gPSB7CiAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICJwcm9kdWN0RmFtaWx5IjogcHJvZHVjdEZhbWlseSwKICAgICAgICAgICAgImNhc2VOdW1iZXIiOiBjYXNlTnVtYmVyLAogICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBwcm9kdWN0TmFtZSwKICAgICAgICAgICAgImV2ZW50TmFtZSI6IGV2ZW50TmFtZSwKICAgICAgICAgICAgInB0IjogcHQsCiAgICAgICAgICAgICJwdENvZGUiOiBwdENvZGUsCiAgICAgICAgICAgICJwcm9kdWN0SWQiOiBwcm9kdWN0SWQsCiAgICAgICAgICAgICJhc3NpZ25lZFRvIjogYXNzaWduZWRUbyA/IGFzc2lnbmVkVG8gOiBhc3NpZ25lZFRvVXNlciwKICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAiY29uZmlnSWQiOiBjb25maWdJZCwKICAgICAgICAgICAgImFkaG9jQWxlcnRJZCI6IGFkaG9jQWxlcnRJZCwKICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogbGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICJhcnRpY2xlSWQiOiBhcnRpY2xlSWQKICAgICAgICB9OwoKICAgICAgICBjYXNlSnNvbkFycmF5LnB1c2goY2FzZUpzb24pOwogICAgICAgIHZhciBjb21tZW50TWV0YUluZm8gPSAiIjsKCiAgICAgICAgaWYgKGNhc2VKc29uLmFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkFHR1JFR0FURV9BTEVSVCB8fCBjYXNlSnNvbi5hbGVydFR5cGUgPT09IHNpZ25hbEFsZXJ0VHlwZS5FVkRBU19BTEVSVCkgewogICAgICAgICAgICBpZiAodHlwZW9mIChjYXNlSnNvbi5ldmVudE5hbWUpID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgKGNhc2VKc29uLnByb2R1Y3ROYW1lKSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICIiCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb21tZW50TWV0YUluZm8gPSAnPHNwYW4gaWQ9InByb2R1Y3ROYW1lIj4nICsgY2FzZUpzb24ucHJvZHVjdE5hbWUgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJldmVudE5hbWUiPicgKyBjYXNlSnNvbi5ldmVudE5hbWUgKyAnPC9zcGFuPicgKyAnPHNwYW4gY2xhc3M9ImhpZGRlbiIgaWQ9InByb2R1Y3RJZCI+JyArIGNhc2VKc29uLnByb2R1Y3RJZCArICc8L3NwYW4+JyArCiAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPSJoaWRkZW4iIGlkPSJwdENvZGUiPicgKyBjYXNlSnNvbi5wdENvZGUgKyAnPC9zcGFuPicKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgKGNhc2VKc29uLmNhc2VOdW1iZXIpID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgKGNhc2VKc29uLnByb2R1Y3RGYW1pbHkpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgY29tbWVudE1ldGFJbmZvID0gIiIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNZXRhSW5mbyA9ICc8c3BhbiBpZD0iY2FzZU51bWJlciI+JyArIGNhc2VKc29uLmNhc2VOdW1iZXIgKyAnPC9zcGFuPiAtIDxzcGFuIGlkPSJwcm9kdWN0RmFtaWx5Ij4nICsgY2FzZUpzb24ucHJvZHVjdEZhbWlseSArICc8L3NwYW4+JwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudC1tZXRhLWluZm8iKS5odG1sKGNvbW1lbnRNZXRhSW5mbyk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNhc3NpZ25lZFRvIikuaHRtbChhc3NpZ25lZFRvKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbmZpZ0lkIikuaHRtbChjb25maWdJZCk7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIiNhcHBsaWNhdGlvbiIpLmh0bWwoY2FzZUpzb24uYWxlcnRUeXBlKTsKCiAgICAgICAgLy9Qb3B1bGF0ZSB0aGUgZXhpc3RpbmcgY29tbWVudHMgYW5kIGJpbmQgZXZlbnRzIHRvIHRoZW0gaW4gY2FzZSBvZiBzaW5nbGUgY29tbWVudC4KICAgICAgICBpZiAodHlwZW9mIGlzQ2FzZURldGFpbCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgJCgnI2xvYWRpbmdDb21tZW50cycpLmh0bWwoJycpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2lnbmFsLmFsZXJ0Q29tbWVudHMucG9wdWxhdGVfY29tbWVudHMoY29tbWVudE1vZGFsLCBjYXNlSnNvbik7CiAgICAgICAgfQogICAgICAgICQoIiNjb21tZW50TW9kYWwiKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKCcjY29tbWVudGJveCcpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJy5hZGQtY29tbWVudHMnKS5odG1sKCdBZGQnKTsKICAgICAgICAgICAgJCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBpbml0aWF0ZVNpbmdsZUJ1bGtSb3dDb21tZW50UHJvY2VzcyA9IGZ1bmN0aW9uIChjYXNlSnNvbkFycmF5LCBjb21tZW50TW9kYWwsIGFsZXJ0VHlwZSwgaXNDYXNlRGV0YWlsLCBpc1NpZ25hbCkgewogICAgICAgIHZhciBpbmRleFNldCA9IG5ldyBTZXQoKTsKICAgICAgICB2YXIgY2hlY2tib3hTZWxlY3RvcjsKICAgICAgICBpZiAoJCgnI2RldGFpbGVkLXZpZXctY2hlY2tib3gnKS5pcygnOmNoZWNrZWQnKSkgewogICAgICAgICAgICBjaGVja2JveFNlbGVjdG9yID0gJ3RhYmxlI2FsZXJ0c0RldGFpbHNUYWJsZSAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hlY2tib3hTZWxlY3RvciA9ICd0YWJsZS5EVEZDX0Nsb25lZCAuY29weS1zZWxlY3Q6Y2hlY2tlZCc7CiAgICAgICAgfQogICAgICAgICQuZWFjaCgkKGNoZWNrYm94U2VsZWN0b3IpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFJvd0luZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIGlmIChpc0Fic3RyYWN0Vmlld09yQ2FzZVZpZXcoc2VsZWN0ZWRSb3dJbmRleCkpCiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd0luZGV4ID0gc2VsZWN0ZWRSb3dJbmRleCAvIDI7CiAgICAgICAgICAgIGluZGV4U2V0LmFkZCgoc2VsZWN0ZWRSb3dJbmRleCkpOwogICAgICAgIH0pOwogICAgICAgIGluZGV4U2V0LmZvckVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgIHZhciBhZGhvY0FsZXJ0SWQ7CiAgICAgICAgICAgIHZhciBsaXRlcmF0dXJlQWxlcnRJZDsKICAgICAgICAgICAgdmFyIGFydGljbGVJZDsKICAgICAgICAgICAgdmFyIHJvd09iamVjdCA9IHt9OwogICAgICAgICAgICBpZiAoKGFsZXJ0VHlwZSA9PT0gJ0FnZ3JlZ2F0ZSBDYXNlIEFsZXJ0JyB8fCBhbGVydFR5cGUgPT09ICdTaW5nbGUgQ2FzZSBBbGVydCcgfHwgYWxlcnRUeXBlID09PSAnRVZEQVMgQWxlcnQnIHx8IGFsZXJ0VHlwZSA9PT0gJ0xpdGVyYXR1cmUgU2VhcmNoIEFsZXJ0JykgJiYgIWlzU2lnbmFsKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZS5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnKSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZUFnZ1Jldmlldy5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3dPYmplY3QgPSB0YWJsZVNpbmdsZVJldmlldy5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBjYXNlTnVtYmVyID0gcm93T2JqZWN0LmNhc2VOdW1iZXI7CiAgICAgICAgICAgIHZhciBwcm9kdWN0RmFtaWx5ID0gcm93T2JqZWN0LnByb2R1Y3RGYW1pbHk7CiAgICAgICAgICAgIHZhciBjYXNlVmVyc2lvbiA9IHJvd09iamVjdC5jYXNlVmVyc2lvbjsKICAgICAgICAgICAgdmFyIHByb2R1Y3ROYW1lID0gcm93T2JqZWN0LnByb2R1Y3ROYW1lOwogICAgICAgICAgICB2YXIgZXZlbnROYW1lID0gcm93T2JqZWN0LnByZWZlcnJlZFRlcm07CiAgICAgICAgICAgIHZhciBwdCA9IHJvd09iamVjdC5wdDsKICAgICAgICAgICAgdmFyIGFzc2lnbmVkVG8gPSByb3dPYmplY3QuYXNzaWduZWRUby5pZDsKICAgICAgICAgICAgdmFyIHByb2R1Y3RJZCA9IHJvd09iamVjdC5wcm9kdWN0SWQ7CiAgICAgICAgICAgIHZhciBwdENvZGUgPSByb3dPYmplY3QucHRDb2RlOwogICAgICAgICAgICB2YXIgY29uZmlnSWQgPSByb3dPYmplY3QuYWxlcnRDb25maWdJZDsKICAgICAgICAgICAgdmFyIGV4ZWN1dGVkQ29uZmlnSWQgPSByb3dPYmplY3QuZXhlY0NvbmZpZ0lkOwoKICAgICAgICAgICAgaWYgKGFsZXJ0VHlwZSA9PT0gc2lnbmFsQWxlcnRUeXBlLkFESE9DX0FMRVJUKSB7CiAgICAgICAgICAgICAgICBhZGhvY0FsZXJ0SWQgPSByb3dPYmplY3QuaWQ7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxlcnRUeXBlID09PSBzaWduYWxBbGVydFR5cGUuTElURVJBVFVSRV9TRUFSQ0hfQUxFUlQpIHsKICAgICAgICAgICAgICAgIGxpdGVyYXR1cmVBbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICAgICAgYXJ0aWNsZUlkID0gcm93T2JqZWN0LmFydGljbGVJZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjYXNlSnNvbiA9IHsKICAgICAgICAgICAgICAgICJhbGVydFR5cGUiOiBhbGVydFR5cGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdEZhbWlseSI6IHByb2R1Y3RGYW1pbHksCiAgICAgICAgICAgICAgICAiY2FzZU51bWJlciI6IGNhc2VOdW1iZXIsCiAgICAgICAgICAgICAgICAicHJvZHVjdE5hbWUiOiBwcm9kdWN0TmFtZSwKICAgICAgICAgICAgICAgICJldmVudE5hbWUiOiBldmVudE5hbWUsCiAgICAgICAgICAgICAgICAicHQiOiBwdCwKICAgICAgICAgICAgICAgICJwdENvZGUiOiBwdENvZGUsCiAgICAgICAgICAgICAgICAicHJvZHVjdElkIjogcHJvZHVjdElkLAogICAgICAgICAgICAgICAgImFzc2lnbmVkVG8iOiBhc3NpZ25lZFRvLAogICAgICAgICAgICAgICAgImV4ZWN1dGVkQ29uZmlnSWQiOiBleGVjdXRlZENvbmZpZ0lkLAogICAgICAgICAgICAgICAgImNvbmZpZ0lkIjogY29uZmlnSWQsCiAgICAgICAgICAgICAgICAiYWRob2NBbGVydElkIjogYWRob2NBbGVydElkLAogICAgICAgICAgICAgICAgImxpdGVyYXR1cmVBbGVydElkIjogbGl0ZXJhdHVyZUFsZXJ0SWQsCiAgICAgICAgICAgICAgICAiYXJ0aWNsZUlkIjogYXJ0aWNsZUlkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNhc2VKc29uQXJyYXkucHVzaChjYXNlSnNvbikKICAgICAgICB9KTsKCiAgICAgICAgLy9TZXQgdmFsdWVzIHRvIHRoZSBtb2RhbCBlbGVtZW50cy4KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2xvYWRpbmdDb21tZW50cyIpLmhpZGUoKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiI2NvbW1lbnQtbWV0YS1pbmZvIikuaHRtbCgiIik7CiAgICAgICAgY29tbWVudE1vZGFsLmZpbmQoIi5wcmV2aW91cy1jb21tZW50cyIpLmh0bWwoIiIpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCIjY29tbWVudElkIikudmFsKCcnKTsKICAgICAgICBjb21tZW50TW9kYWwuZmluZCgiLmNyZWF0ZWRCeSIpLnRleHQoJycpOwogICAgICAgIGlmIChjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoKSAhPSAnVXBkYXRlJykgewogICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLmh0bWwoIkFkZCIpOwogICAgICAgIH0KICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLm9uKCJrZXl1cCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKGNvbW1lbnRNb2RhbC5maW5kKCcjY29tbWVudGJveCcpLnZhbCgpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbW1lbnRNb2RhbC5maW5kKCcuYWRkLWNvbW1lbnRzJykucHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb21tZW50TW9kYWwuZmluZCgnLmFkZC1jb21tZW50cycpLnByb3AoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIHJlc3RhcnRSZXZpZXcgPSBmdW5jdGlvbiAoY2FzZVJldmlld1ByZXZpb3VzVXJsKSB7CgogICAgICAgIC8vRXZlbnQgd2hlbiByZXZpZXcgcmVzdGFydCBpcyBjbGlja2VkLgogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuY2FzZS1yZXN0YXJ0LXJldmlldycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB2YXIgcGFyZW50X3JvdyA9ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCd0cicpOwogICAgICAgICAgICB2YXIgY2FzZU51bWJlciA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJjYXNlTnVtYmVyIl0nKS5hdHRyKCJkYXRhLWlkIik7CiAgICAgICAgICAgIHZhciBmb2xsb3dVcE51bWJlciA9IHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJmb2xsb3dVcE51bWJlciJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZVZlcnNpb24iXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIHByb2R1Y3RGYW1pbHkgPSBwYXJlbnRfcm93LmZpbmQoJ2lucHV0W2RhdGEtZmllbGQ9InByb2R1Y3RGYW1pbHkiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGZvbGxvd1VwTW9kYWwgPSAkKCcjZm9sbG93VXBNb2RhbCcpOwogICAgICAgICAgICBmb2xsb3dVcE1vZGFsLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIGZvbGxvd1VwTW9kYWwuZmluZCgiLnByZXZpb3VzLWZvbGxvd1VwIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGdldFByZXZpb3VzU3RhdGUgPSBjYXNlUmV2aWV3UHJldmlvdXNVcmwgKyAiP2Nhc2VOdW1iZXI9IiArIGNhc2VOdW1iZXIgKwogICAgICAgICAgICAgICAgICAgICImY2FzZVZlcnNpb249IiArIGNhc2VWZXJzaW9uICsgIiZwcm9kdWN0RmFtaWx5PSIgKyBwcm9kdWN0RmFtaWx5ICsgIiZmb2xsb3dVcE51bWJlcj0iICsgZm9sbG93VXBOdW1iZXI7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogZ2V0UHJldmlvdXNTdGF0ZSwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9yb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJ3b3JrZmxvd1N0YXRlIl0nKS50ZXh0KHJlc3VsdC5wcmV2aW91c1N0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImRpc3Bvc2l0aW9uIl0nKS50ZXh0KHJlc3VsdC5wcmV2aW91c0Rpc3Bvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X3Jvdy5maW5kKCdzcGFuW2RhdGEtZmllbGQ9ImluZm8tc2lnbiJdJykuYWRkQ2xhc3MoImhpZGRlbiIpOwogICAgICAgICAgICAgICAgICAgICAgICBmb2xsb3dVcE1vZGFsLm1vZGFsKCdkZXN0cm95Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5TaW1pbGFyQ2FzZXNNb2RhbCA9IGZ1bmN0aW9uIChjYXNlSW5mb1VybCkgewoKICAgICAgICAvL0V2ZW50IHRyaWdnZXJlZCB3aGVuIHNpbWlsYXIgY2FzZXMgY291bnQgaXMgY2xpY2tlZC4KICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNpbWlsYXItY2FzZXMnLCBmdW5jdGlvbiAoZXZlbnQpIHsKCiAgICAgICAgICAgIHZhciBzaW1pbGFyQ2FzZU1vZGFsID0gJCgnI3NpbWlsYXJDYXNlTW9kYWwnKTsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoInRyIik7CgogICAgICAgICAgICAvL0ZldGNoIHRoZSB2YWx1ZXMgb2YgdGhlIGV2ZW50LgogICAgICAgICAgICB2YXIgZXZlbnRWYWwgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignZGF0YS1ldmVudC12YWwnKTsKICAgICAgICAgICAgdmFyIGV2ZW50VHlwZSA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWZpZWxkJyk7CiAgICAgICAgICAgIHZhciBleGVjdXRlZENvbmZpZ0lkID0gJChldmVudC50YXJnZXQpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIHB0ID0gJChldmVudC50YXJnZXQpLmF0dHIoImRhdGEtcHQiKTsKICAgICAgICAgICAgdmFyIGV2ZW50Q29kZTsKICAgICAgICAgICAgaWYgKGV2ZW50VHlwZSkgewogICAgICAgICAgICAgICAgZXZlbnRDb2RlID0gKGV2ZW50VHlwZS5zcGxpdCgiX2NvZGUiKVswXSk7CiAgICAgICAgICAgICAgICBldmVudFR5cGUgPSBldmVudFR5cGUuc3BsaXQoIl8iKVsyXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNhc2VOdW1iZXIgPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZU51bWJlciJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgICAgICB2YXIgY2FzZVZlcnNpb24gPSBwYXJlbnRfcm93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0iY2FzZVZlcnNpb24iXScpLmF0dHIoImRhdGEtaWQiKTsKCiAgICAgICAgICAgIC8vU2hvdyBtb2RhbCBhbmQgc2V0IGl0cyB2YWx1ZXMuCiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRUeXBlIikuaHRtbChldmVudFR5cGUpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNldmVudFZhbCIpLmh0bWwoZXZlbnRWYWwpOwogICAgICAgICAgICBzaW1pbGFyQ2FzZU1vZGFsLmZpbmQoIiNjYXNlTnVtYmVySW5mbyIpLnZhbChjYXNlTnVtYmVyKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXhlY3V0ZWRDb25maWdJZCIpLnZhbChleGVjdXRlZENvbmZpZ0lkKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjY2FzZUN1cnJlbnRWZXJzaW9uIikudmFsKGNhc2VWZXJzaW9uKTsKICAgICAgICAgICAgc2ltaWxhckNhc2VNb2RhbC5maW5kKCIjZXZlbnRDb2RlIikudmFsKGV2ZW50Q29kZSk7CiAgICAgICAgICAgIHNpbWlsYXJDYXNlTW9kYWwuZmluZCgiI2V2ZW50Q29kZVZhbCIpLnZhbChldmVudFZhbCk7CiAgICAgICAgICAgIC8vTWFrZSB0aGUgbW9kYWwgdGFibGUgYXMgZGF0YXRhYmxlCgogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNpZ25hbC5zaW1pbGFyQ2FzZVRhYmxlLmluaXRfc2ltaWxhcl9jYXNlX3RhYmxlKGNhc2VJbmZvVXJsKQogICAgICAgICAgICB9LCAxMDApOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgb3BlbkF0dGFjaG1lbnRNb2RhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnNob3ctYXR0YWNobWVudC1pY29uJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciAkdGhpcyA9IHRoaXM7CiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBhbGVydElkID0gcGFyZW50X3Jvdy5maW5kKCdhW2RhdGEtZmllbGQ9ImF0dGFjaG1lbnQiXScpLmF0dHIoImRhdGEtaWQiKTsKICAgICAgICAgICAgdmFyIGNhc2VDb250cm9sbGVyID0gcGFyZW50X3Jvdy5maW5kKCdhW2RhdGEtZmllbGQ9ImF0dGFjaG1lbnQiXScpLmF0dHIoImRhdGEtY29udHJvbGxlciIpOwogICAgICAgICAgICB2YXIgdXJsID0gIi9zaWduYWwvIiArIGNhc2VDb250cm9sbGVyICsgIi91cGxvYWQiOwogICAgICAgICAgICB2YXIgZ2V0QXR0YWNobWVudFVybCA9ICIvc2lnbmFsLyIgKyBjYXNlQ29udHJvbGxlciArICIvZmV0Y2hBdHRhY2htZW50P2FsZXJ0SWQ9IiArIGFsZXJ0SWQ7CiAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50Rm9ybSAjYXR0YWNobWVudEZvcm1JZCcpLmF0dHIoJ3ZhbHVlJywgYWxlcnRJZCk7CiAgICAgICAgICAgIHZhciBjYXNlSGlzdG9yeU1vZGFsID0gJCgnI3Nob3dBdHRhY2htZW50TW9kYWwnKTsKICAgICAgICAgICAgY2FzZUhpc3RvcnlNb2RhbC5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICAkKCIjc2hvd0F0dGFjaG1lbnRNb2RhbCBmb3JtI2F0dGFjaG1lbnRGb3JtIikudW5iaW5kKCdzdWJtaXQnKS5vbignc3VibWl0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKHRoaXMpOwogICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy5maW5kKCcuYXR0YWNobWVudC1maWxlJykudmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCIudXBsb2FkIikuYXR0cigiZGlzYWJsZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmb3JtRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCcuYXR0YWNobWVudC1maWxlJykudmFsKCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBdHRhY2htZW50SWNvbihwYXJlbnRfcm93KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaG93QXR0YWNobWVudE1vZGFsICNhdHRhY2htZW50LXRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIi51cGxvYWQiKS5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJCgnI3Nob3dBdHRhY2htZW50TW9kYWwgI2F0dGFjaG1lbnQtdGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICAgICAgZGVzdHJveTogdHJ1ZSwKICAgICAgICAgICAgICAgIHNlYXJjaGluZzogZmFsc2UsCiAgICAgICAgICAgICAgICBzUGFnaW5hdGlvblR5cGU6ICJib290c3RyYXAiLAogICAgICAgICAgICAgICAgcmVzcG9uc2l2ZTogZmFsc2UsCiAgICAgICAgICAgICAgICBsYW5ndWFnZTogewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICAgICAidXJsIjogZ2V0QXR0YWNobWVudFVybCwKICAgICAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAkKCcucmVtb3ZlLWF0dGFjaG1lbnQnKS5jbGljayhmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXR0YWNobWVudFJvdyA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2htZW50SWQgPSBhdHRhY2htZW50Um93LmZpbmQoJ3NwYW5bZGF0YS1maWVsZD0icmVtb3ZlQXR0YWNobWVudCJdJykuYXR0cigiZGF0YS1hdHRhY2htZW50SWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlbW92ZVVybCA9ICcvc2lnbmFsLycgKyBjYXNlQ29udHJvbGxlciArICcvZGVsZXRlQXR0YWNobWVudD9hdHRhY2htZW50SWQ9JyArIGF0dGFjaG1lbnRJZDsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJQT1NUIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogcmVtb3ZlVXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge2FsZXJ0SWQ6IGFsZXJ0SWR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoJy5yZW1vdmUtYXR0YWNobWVudCcpLmxlbmd0aCA9PT0xICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVBdHRhY2htZW50SWNvbigkdGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Nob3dBdHRhY2htZW50TW9kYWwgI2F0dGFjaG1lbnQtdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5Ob3RpZmljYXRpb24ubm90aWZ5KCdlcnJvcicsICd0b3AgcmlnaHQnLCAiRXJyb3IiLCAiQWxsIHNlbGVjdGVkIHNhZmV0eSBvYnNlcnZhdGlvbnMgbXVzdCBiZSBpbiBzYW1lIGRpc3Bvc2l0aW9uIGZvciBwZXJmb3JtaW5nIHRoZSBidWxrIHVwZGF0ZS4iLCB7YXV0b0hpZGVEZWxheTogMTAwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSIvc2lnbmFsL2F0dGFjaG1lbnRhYmxlL2Rvd25sb2FkP2lkPScgKyByb3cuaWQgKyAnIj4nICsgZXNjYXBlSFRNTChyb3cubmFtZSkgKyAnPC9hPicKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjZWxsLWJyZWFrJywKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aW1lU3RhbXAiCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAibW9kaWZpZWRCeSIKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiB0YWJpbmRleD0iMCIgdGl0bGU9IlJlbW92ZSBBdHRhY2htZW50IiAgc3R5bGU9ImN1cnNvcjogcG9pbnRlciIgY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlIHJlbW92ZS1hdHRhY2htZW50IiBkYXRhLWZpZWxkPSJyZW1vdmVBdHRhY2htZW50IiBkYXRhLWF0dGFjaG1lbnRJZD0nICsgcm93LmlkICsgJz48L3NwYW4+JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogZmFsc2UsCiAgICAgICAgICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgICAgICJyZW5kZXIiOiAkLmZuLmRhdGFUYWJsZS5yZW5kZXIudGV4dCgpCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIGJpbmRHcmlkRHluYW1pY0ZpbHRlcnMgPSBmdW5jdGlvbiAoZmlsdGVyc0RhdGEsIHByZWZpeCwgaWQpIHsKICAgICAgICAvL0FkZCBmaWx0ZXJzIHRvIHRoZSBkYXRhIHRhYmxlLgogICAgICAgIHZhciBkYXRhVGFibGVzX2xlbmd0aCA9ICQoJy5kYXRhVGFibGVzX2xlbmd0aCcpOwogICAgICAgIGRhdGFUYWJsZXNfbGVuZ3RoLmFkZENsYXNzKCdjb2wtc20tMTInKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoKS5yZW1vdmVDbGFzcygiY29sLXhzLTIiKTsKICAgICAgICBhcHBsaWNhdGlvbk5hbWUgPT0gQUxFUlRfQ09ORklHX1RZUEUuQURIT0NfQUxFUlQgPyBkYXRhVGFibGVzX2xlbmd0aC5wYXJlbnQoIjpub3QoJy5kYXRhVGFibGVzX3dyYXBwZXInKSIpLmFkZENsYXNzKCJjb2wteHMtOSIpIDogZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5hZGRDbGFzcygiY29sLXhzLTEwIik7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5uZXh0KCkucmVtb3ZlQ2xhc3MoImNvbC14cy0xMCIpOwogICAgICAgIGFwcGxpY2F0aW9uTmFtZSA9PSBBTEVSVF9DT05GSUdfVFlQRS5BREhPQ19BTEVSVCA/IGRhdGFUYWJsZXNfbGVuZ3RoLnBhcmVudCgiOm5vdCgnLmRhdGFUYWJsZXNfd3JhcHBlcicpIikubmV4dCgpLmFkZENsYXNzKCJjb2wteHMtMyIpIDogZGF0YVRhYmxlc19sZW5ndGgucGFyZW50KCI6bm90KCcuZGF0YVRhYmxlc193cmFwcGVyJykiKS5uZXh0KCkuYWRkQ2xhc3MoImNvbC14cy0yIik7CiAgICAgICAgZGF0YVRhYmxlc19sZW5ndGguZmluZCgibGFiZWwiKS5hZGRDbGFzcygnY29sLXhzLTInKTsKICAgICAgICBkYXRhVGFibGVzX2xlbmd0aC5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGR0QnV0dG9ucyA9ICc8ZGl2IGNsYXNzPSJkYXRhVGFibGUtdG9wLWRpc3Bvc2l0aW9uIGNvbC14cy0xMCI+JzsKICAgICAgICAgICAgJC5lYWNoKGZpbHRlcnNEYXRhLCBmdW5jdGlvbiAoaW5kZXgsIG9iaikgewogICAgICAgICAgICAgICAgaWYgKG9iai5jbG9zZWQgfHwgb2JqLmlzQ2xvc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8ZGl2IGNsYXNzPSJjaGVja2JveCBjaGVja2JveC1wcmltYXJ5IGNoZWNrYm94LWlubGluZSBtLWwtMyBjaGVja2JveC1wb3MtYWJzIj4nOwogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGlucHV0IGlkPSJmaWx0ZXInICsgaW5kZXggKyAnIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImR5bmFtaWMtZmlsdGVycyIgbmFtZT0icmVsYXRlZFJlc3VsdHMiIGRhdGEtY2xvc2VkPSInICsgb2JqLmlzQ2xvc2VkICsgJyIgdmFsdWU9IicgKyBvYmoudmFsdWUgKyAnIiAvPiA8bGFiZWwgY2xhc3M9Im0tci0zMCIgIGZvcj0iZmlsdGVyJyArIGluZGV4ICsgJyI+JyArIG9iai52YWx1ZSArICc8L2xhYmVsPjwvZGl2PicKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8ZGl2IGNsYXNzPSJjaGVja2JveCBjaGVja2JveC1wcmltYXJ5IGNoZWNrYm94LWlubGluZSBtLWwtMyBjaGVja2JveC1wb3MtYWJzIj4nOwogICAgICAgICAgICAgICAgICAgIGR0QnV0dG9ucyArPSAnPGlucHV0IGlkPSJmaWx0ZXInICsgaW5kZXggKyAnIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImR5bmFtaWMtZmlsdGVycyIgbmFtZT0icmVsYXRlZFJlc3VsdHMiIGRhdGEtY2xvc2VkPSInICsgb2JqLmlzQ2xvc2VkICsgJyIgY2hlY2tlZD0iY2hlY2tlZCIgdmFsdWU9IicgKyBvYmoudmFsdWUgKyAnIiAvPiA8bGFiZWwgY2xhc3M9Im0tci0zMCIgZm9yPSJmaWx0ZXInICsgaW5kZXggKyAnIj4nICsgb2JqLnZhbHVlICsgJzwvbGFiZWw+PC9kaXY+JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZHRCdXR0b25zICs9ICc8L2Rpdj4nOwogICAgICAgICAgICBkdEJ1dHRvbnMgPSBkdEJ1dHRvbnMgKyAnPC9kaXY+JzsKICAgICAgICAgICAgaWYgKHRoaXMuaWQgIT09ICdhcmNoaXZlZEFsZXJ0c1RhYmxlX2xlbmd0aCcgJiYgdGhpcy5pZCAhPT0gJ2FjdGl2aXRpZXNUYWJsZV9sZW5ndGgnKQogICAgICAgICAgICAgICAgJCh0aGlzKS5hcHBlbmQoZHRCdXR0b25zKTsKICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5keW5hbWljLWZpbHRlcnMnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYWxlcnREZXRhaWxzVGFibGU7CiAgICAgICAgICAgICAgICB2YXIgZnJlcVNlbGVjdGVkID0gIiI7CiAgICAgICAgICAgICAgICBpZiAoJCgiI2ZyZXF1ZW5jeU5hbWVzIikpIHsKICAgICAgICAgICAgICAgICAgICBmcmVxU2VsZWN0ZWQgPSAkKCIjZnJlcXVlbmN5TmFtZXMiKS52YWwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJBcnJheSA9IFtdOwogICAgICAgICAgICAgICAgdmFyIGZpbHRlclZhbHVlcyA9IFtdOwogICAgICAgICAgICAgICAgJCgnLmR5bmFtaWMtZmlsdGVycycpLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCQodGhpcykuaXMoJzpjaGVja2VkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVzLnB1c2goJCh0aGlzKS52YWwoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZpbHRlckFycmF5LnB1c2goJCh0aGlzKS5pcygnOmNoZWNrZWQnKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0ocHJlZml4ICsgImZpbHRlcnNfc3RvcmUiLCBKU09OLnN0cmluZ2lmeShmaWx0ZXJBcnJheSkpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyAiZmlsdGVyc192YWx1ZSIsIEpTT04uc3RyaW5naWZ5KGZpbHRlclZhbHVlcykpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyAiaWQiLCBpZCk7CiAgICAgICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICAgICAgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PSAnTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQnKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnREZXRhaWxzVGFibGUgPSAkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgdXJsID0gbGlzdENvbmZpZ1VybCArICI/ZmlsdGVycz0iICsgZmlsdGVyVmFsdWVzLmpvaW4oIiwiKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhbGVydERldGFpbHNUYWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKTsKICAgICAgICAgICAgICAgICAgICB1cmwgPSBsaXN0Q29uZmlnVXJsICsgIiZmcmVxdWVuY3k9IiArIGZyZXFTZWxlY3RlZCArICImaXNGaWx0ZXJSZXF1ZXN0PXRydWUmZmlsdGVycz0iICsgSlNPTi5zdHJpbmdpZnkoZmlsdGVyVmFsdWVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFsZXJ0RGV0YWlsc1RhYmxlLmFqYXgudXJsKHVybCkubG9hZCgpCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgIH07CgogICAgdmFyIGlzQWxlcnRQZXJzaXN0ZWRJblNlc3Npb25TdG9yYWdlID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHZhciBjID0gc2lnbmFsLnV0aWxzLmdldFF1ZXJ5U3RyaW5nKCJjb25maWdJZCIpOwogICAgICAgIHJldHVybiBjID8gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShwcmVmaXggKyAiaWQiKSA9PSBjIDogZmFsc2UKICAgIH07CgogICAgdmFyIHJlbW92ZUZpbHRlcnNGcm9tU2Vzc2lvblN0b3JhZ2UgPSBmdW5jdGlvbiAocHJlZml4KSB7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShwcmVmaXggKyAiZmlsdGVyc19zdG9yZSIpOwogICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0ocHJlZml4ICsgImZpbHRlcnNfdmFsdWUiKTsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKHByZWZpeCArICJpZCIpOwogICAgfTsKCiAgICB2YXIgb3BlblNhdmVWaWV3TW9kYWwgPSBmdW5jdGlvbiAoZmlsdGVySW5kZXgsIGFwcGxpY2F0aW9uTmFtZSwgdmlld0lkKSB7CiAgICAgICAgdmFyIHN5c3RlbURlZmF1bHQgPSBbIlN5c3RlbSBWaWV3Il07CiAgICAgICAgdmFyIHZpZXdJbmZvOwoKICAgICAgICAvL3NhdmluZyBuZXcgdmlldwogICAgICAgICQoIi5zYXZlVmlldyIpLnVuYmluZCgnY2xpY2snKTsKICAgICAgICAkKCcuc2F2ZVZpZXcnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZpZXdJbmZvID0gZ2VuZXJhdGVWaWV3SW5mbyhmaWx0ZXJJbmRleCk7CgogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2ZpbHRlcnMnKS52YWwoSlNPTi5zdHJpbmdpZnkodmlld0luZm8uZmlsdGVyTWFwKSk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfY29sdW1uTGlzdCcpLnZhbCh2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hbGVydFR5cGUnKS52YWwoYXBwbGljYXRpb25OYW1lKTsKICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19zb3J0aW5nJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLnNvcnRlZENvbHVtbikpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2FkdmFuY2VkX2ZpbHRlcicpLnZhbCh2aWV3SW5mby5hZHZhbmNlZEZpbHRlcik7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI2N1cnJlbnRfdmlld19pZCcpLnZhbCh2aWV3SWQpOwogICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsIC5zYXZlX2J1dHRvbnMnKS5zaG93KCk7CiAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwnKS5tb2RhbCgnc2hvdycpOwogICAgICAgIH0pCgogICAgICAgIC8vdXBkYXRpbmcgZXhpc3RpbmcgdmlldwogICAgICAgICQoIi51cGRhdGVWaWV3IikudW5iaW5kKCdjbGljaycpOwogICAgICAgICQoJy51cGRhdGVWaWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2aWV3SW5mbyA9IGdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwogICAgICAgICAgICBpZiAoJC5pbkFycmF5KCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpLCBzeXN0ZW1EZWZhdWx0KSAhPSAtMSkgewogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19maWx0ZXJzJykudmFsKEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLmZpbHRlck1hcCkpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19jb2x1bW5MaXN0JykudmFsKHZpZXdJbmZvLm5vdFZpc2libGVDb2x1bW4pOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAjdmlld19hbGVydFR5cGUnKS52YWwoYXBwbGljYXRpb25OYW1lKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfc29ydGluZycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWR2YW5jZWRfZmlsdGVyJykudmFsKHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI2N1cnJlbnRfdmlld19pZCcpLnZhbCh2aWV3SWQpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCAuc2F2ZV9idXR0b25zJykuc2hvdygpOwogICAgICAgICAgICAgICAgJCgnI3NhdmUtdmlldy1tb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IG5ldyBPYmplY3QoKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RbJ25hbWUnXSA9ICQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnRleHQoKS5yZXBsYWNlKCIoZGVmYXVsdCkiLCAiIikudHJpbSgpOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnZmlsdGVyTWFwJ10gPSBKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5maWx0ZXJNYXApOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnY29sdW1uTGlzdCddID0gdmlld0luZm8ubm90VmlzaWJsZUNvbHVtbi50b1N0cmluZygpOwogICAgICAgICAgICAgICAgcmVxdWVzdFsnYWxlcnRUeXBlJ10gPSBhcHBsaWNhdGlvbk5hbWU7CiAgICAgICAgICAgICAgICByZXF1ZXN0WydpZCddID0gJCgnLnZpZXdTZWxlY3QnKS52YWwoKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RbJ3NvcnRpbmcnXSA9IEpTT04uc3RyaW5naWZ5KHZpZXdJbmZvLnNvcnRlZENvbHVtbik7CiAgICAgICAgICAgICAgICByZXF1ZXN0WydhZHZhbmNlZEZpbHRlciddID0gdmlld0luZm8uYWR2YW5jZWRGaWx0ZXI7CiAgICAgICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgICAgICAgIHVybDogdXBkYXRlVmlld1VybCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiUE9TVCIsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVxdWVzdCwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYWdlVVJMID0gJChsb2NhdGlvbikuYXR0cigiaHJlZiIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFnZVVSTC5pbmRleE9mKCJ2aWV3SWQiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcGFnZVVSTC5zbGljZSgwLCBwYWdlVVJMLmluZGV4T2YoInZpZXdJZCIpICsgNykgKyBkYXRhLnZpZXdJZAogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigiIyIpICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVVSTCA9IHBhZ2VVUkwuc2xpY2UoMCwgcGFnZVVSTC5pbmRleE9mKCIjIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBwYWdlVVJMICsgIiZ2aWV3SWQ9IiArIGRhdGEudmlld0lkCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5lcnJvck1lc3NhZ2UpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yTm90aWZpY2F0aW9uKGRhdGEuZXJyb3JNZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy9zZWxlY3RpbmcgYW5vdGhlciB2aWV3CiAgICAgICAgJCgnLnZpZXdTZWxlY3QnKS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgJCgnLnZpZXdTZWxlY3QnKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgcGFnZVVSTCA9ICQobG9jYXRpb24pLmF0dHIoImhyZWYiKTsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkVmlldyA9ICQoJy52aWV3U2VsZWN0JykudmFsKCk7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2lzVmlld0NhbGwnLCAndHJ1ZScpOwogICAgICAgICAgICBpZiAocGFnZVVSTC5pbmRleE9mKCJ2aWV3SWQiKSAhPSAtMSkgewogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBwYWdlVVJMLnNsaWNlKDAsIHBhZ2VVUkwuaW5kZXhPZigidmlld0lkIikgKyA3KSArIHNlbGVjdGVkVmlldwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHBhZ2VVUkwuaW5kZXhPZigiIyIpICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcGFnZVVSTCA9IHBhZ2VVUkwuc2xpY2UoMCwgcGFnZVVSTC5pbmRleE9mKCIjIikpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHBhZ2VVUkwgKyAiJnZpZXdJZD0iICsgc2VsZWN0ZWRWaWV3CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy9kZWxldGluZyBvciBlZGl0aW5nIHNlbGVjdGVkIHZpZXcKICAgICAgICAkKCcuZWRpdFZpZXcnKS51bmJpbmQoJ2NsaWNrJyk7CiAgICAgICAgJCgnLmVkaXRWaWV3Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2aWV3SW5mbyA9IGdlbmVyYXRlVmlld0luZm8oZmlsdGVySW5kZXgpOwoKICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSwgc3lzdGVtRGVmYXVsdCkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfbmFtZScpLnZhbCgkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfZGVmYXVsdCcpLnByb3AoJ2NoZWNrZWQnLCAoJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLmluZGV4T2YoIihkZWZhdWx0KSIpICE9IC0xKSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsICN2aWV3X2lkJykudmFsKCQoJy52aWV3U2VsZWN0IDpzZWxlY3RlZCcpLnZhbCgpKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfZmlsdGVycycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5maWx0ZXJNYXApKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfY29sdW1uTGlzdCcpLnZhbCh2aWV3SW5mby5ub3RWaXNpYmxlQ29sdW1uKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfc29ydGluZycpLnZhbChKU09OLnN0cmluZ2lmeSh2aWV3SW5mby5zb3J0ZWRDb2x1bW4pKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWR2YW5jZWRfZmlsdGVyJykudmFsKHZpZXdJbmZvLmFkdmFuY2VkRmlsdGVyKTsKICAgICAgICAgICAgICAgICQoJyNzYXZlLXZpZXctbW9kYWwgI3ZpZXdfYWxlcnRUeXBlJykudmFsKGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsIC5lZGl0X2J1dHRvbnMnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAkKCcjc2F2ZS12aWV3LW1vZGFsJykubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoJyNhbGVydC12aWV3LW1vZGFsJykubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9OwoKICAgIHZhciBnZW5lcmF0ZVZpZXdJbmZvID0gZnVuY3Rpb24gKGZpbHRlckluZGV4KSB7CiAgICAgICAgdmFyIG9UYWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKTsKCiAgICAgICAgLy9nZW5lcmF0ZSBmaWx0ZXIgdmFsdWUgbWFwCiAgICAgICAgdmFyIGZpbHRlck1hcCA9IG5ldyBPYmplY3QoKTsKICAgICAgICAkLmVhY2goZmlsdGVySW5kZXgsIGZ1bmN0aW9uIChpZHgsIG9iaikgewogICAgICAgICAgICB2YXIgZmlsdGVyVmFsID0geWFkY2YuZXhHZXRDb2x1bW5GaWx0ZXJWYWwob1RhYmxlLCBvYmopOwogICAgICAgICAgICBpZiAoZmlsdGVyVmFsKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJNYXBbb2JqXSA9IGZpbHRlclZhbAogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vZ2VuZXJhdGUgY29sdW1ucyB2aXNpYmxlIGxpc3QKICAgICAgICB2YXIgbm90VmlzaWJsZUNvbHVtbiA9ICQoJyNjb2x1bW5JbmRleCcpLnZhbCgpOwoKICAgICAgICAvL2dlbmVyYXRlIHNvcnRpbmcgY29sdW1uIGluZm8KICAgICAgICB2YXIgc29ydGVkQ29sdW1uID0gbmV3IE9iamVjdCgpOwogICAgICAgIGlmICgkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuZGF0YVRhYmxlKCkuZm5TZXR0aW5ncygpLmFhU29ydGluZ1swXSkgewogICAgICAgICAgICB2YXIgc29ydGVkQ29sID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmRhdGFUYWJsZSgpLmZuU2V0dGluZ3MoKS5hYVNvcnRpbmdbMF1bMF07CiAgICAgICAgICAgIHZhciBjb2x1bW5OYW1lID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmZpbmQoInRoIikuZXEoc29ydGVkQ29sKS5hdHRyKCJkYXRhLWZpZWxkIik7CiAgICAgICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgICAgIGNvbHVtblNlcS5ldmVyeShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VxTmFtZSA9IGNvbHVtblNlcVtpbmRleF0ubmFtZTsKICAgICAgICAgICAgICAgIGlmIChjb2x1bW5OYW1lID09IHNlcU5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBzb3J0ZWRDb2wgPSBjb2x1bW5TZXFbaW5kZXhdLnNlcTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbmRleCsrOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgc29ydGVkRGlyID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLmRhdGFUYWJsZSgpLmZuU2V0dGluZ3MoKS5hYVNvcnRpbmdbMF1bMV07CiAgICAgICAgICAgIHNvcnRlZENvbHVtbltzb3J0ZWRDb2xdID0gc29ydGVkRGlyOwogICAgICAgIH0KCiAgICAgICAgLy9nZW5lcmF0ZSBhZHZhbmNlZCBmaWx0ZXIgaW5mbwogICAgICAgIHZhciBhZHZhbmNlZEZpdGVySWQgPSAkKCcuYWR2YW5jZWQtZmlsdGVyLWRyb3Bkb3duJykudmFsKCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ2ZpbHRlck1hcCc6IGZpbHRlck1hcCwKICAgICAgICAgICAgJ25vdFZpc2libGVDb2x1bW4nOiBub3RWaXNpYmxlQ29sdW1uLAogICAgICAgICAgICAnc29ydGVkQ29sdW1uJzogc29ydGVkQ29sdW1uLAogICAgICAgICAgICAnYWR2YW5jZWRGaWx0ZXInOiBhZHZhbmNlZEZpdGVySWQKICAgICAgICB9CiAgICB9OwoKICAgIHZhciBjcmVhdGVTb3J0aW5nTWFwID0gZnVuY3Rpb24gKGluZm9LZXksIHZpZXdOYW1lKSB7CiAgICAgICAgdmFyIHNvcnRpbmdNYXAgPSBbXTsKICAgICAgICB2YXIgc29ydGluZyA9IHt9OwogICAgICAgIHZhciBzZXNzaW9uU3RvcmVkVmFsOwogICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHZpZXdOYW1lKSA9PSAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSkgewogICAgICAgICAgICBzZXNzaW9uU3RvcmVkVmFsID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShpbmZvS2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb25TdG9yZWRWYWwpIHsKICAgICAgICAgICAgc29ydGluZyA9ICQucGFyc2VKU09OKHNlc3Npb25TdG9yZWRWYWwpOwogICAgICAgIH0gZWxzZSBpZiAoJCgiI3NvcnRlZENvbHVtbiIpLnZhbCgpICE9ICIiICYmICQoIiNzb3J0ZWRDb2x1bW4iKS52YWwoKSAhPSAie30iICYmIGNhbGxpbmdTY3JlZW4gPT0gJ3JldmlldycpIHsKICAgICAgICAgICAgc29ydGluZyA9ICQucGFyc2VKU09OKCQoJyNzb3J0ZWRDb2x1bW4nKS52YWwoKSk7CiAgICAgICAgfQogICAgICAgICQuZWFjaChzb3J0aW5nLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBzb3J0aW5nTWFwLnB1c2goW3BhcnNlSW50KGtleSksIHZhbHVlXSkKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc29ydGluZ01hcAogICAgfTsKCiAgICB2YXIgY3JlYXRlRmlsdGVyTWFwID0gZnVuY3Rpb24gKGluZm9LZXksIHZpZXdOYW1lKSB7CiAgICAgICAgdmFyIGZpbHRlcnNWYWx1ZSA9IFtdOwogICAgICAgIHZhciBmaWx0ZXJNYXAgPSB7fTsKICAgICAgICB2YXIgc2Vzc2lvblN0b3JlZFZhbDsKICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2aWV3TmFtZSkgPT0gJCgnLnZpZXdTZWxlY3QgOnNlbGVjdGVkJykudGV4dCgpLnJlcGxhY2UoIihkZWZhdWx0KSIsICIiKS50cmltKCkpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JlZFZhbCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaW5mb0tleSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZXNzaW9uU3RvcmVkVmFsICYmIHNlc3Npb25TdG9yZWRWYWwgIT0ge30pIHsKICAgICAgICAgICAgZmlsdGVyTWFwID0gJC5wYXJzZUpTT04oc2Vzc2lvblN0b3JlZFZhbCk7CiAgICAgICAgfSBlbHNlIGlmICgkKCcjZmlsdGVyTWFwJykudmFsKCkgIT0gIiIgJiYgJCgnI2ZpbHRlck1hcCcpLnZhbCgpICE9ICJ7fSIpIHsKICAgICAgICAgICAgZmlsdGVyTWFwID0gJC5wYXJzZUpTT04oJCgnI2ZpbHRlck1hcCcpLnZhbCgpKTsKICAgICAgICB9CiAgICAgICAgJC5lYWNoKGZpbHRlck1hcCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgdmFyIGZpbHRlckFyciA9IFtwYXJzZUludChrZXkpLCB2YWx1ZV07CiAgICAgICAgICAgIGZpbHRlcnNWYWx1ZS5wdXNoKGZpbHRlckFycikKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gZmlsdGVyc1ZhbHVlCiAgICB9OwoKICAgIHZhciBjcmVhdGVMaXN0T2ZJbmRleCA9IGZ1bmN0aW9uIChpbmZvS2V5LCBpc0V2ZGFzLCB2aWV3TmFtZSkgewogICAgICAgIHZhciBsb2kgPSBbXTsKICAgICAgICB2YXIgY29sdW1uSW5kZXggPSBbXQogICAgICAgIHZhciBzZXNzaW9uU3RvcmVkVmFsOwogICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHZpZXdOYW1lKSA9PSAkKCcudmlld1NlbGVjdCA6c2VsZWN0ZWQnKS50ZXh0KCkucmVwbGFjZSgiKGRlZmF1bHQpIiwgIiIpLnRyaW0oKSkgewogICAgICAgICAgICBzZXNzaW9uU3RvcmVkVmFsID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShpbmZvS2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKGNhbGxpbmdTY3JlZW4gPT0gJ3JldmlldycpIHsKICAgICAgICAgICAgaWYgKHNlc3Npb25TdG9yZWRWYWwpIHsKICAgICAgICAgICAgICAgIGNvbHVtbkluZGV4ID0gc2Vzc2lvblN0b3JlZFZhbC5zcGxpdCgnLCcpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2x1bW5JbmRleCA9ICQoJyNjb2x1bW5JbmRleCcpLnZhbCgpLnNwbGl0KCcsJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5lYWNoKGNvbHVtbkluZGV4LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNFdmRhcykgewogICAgICAgICAgICAgICAgICAgIGxvaS5wdXNoKHBhcnNlSW50KHRoaXMpKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2kucHVzaChwYXJzZUludCh0aGlzKSArIDEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbG9pCiAgICB9OwoKICAgIHZhciBzZXRTb3J0T3JkZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgiI2FsZXJ0c0RldGFpbHNUYWJsZVJvdyIpLm9uKCdtb3VzZWRvd24nLCAndGgnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGluZGV4ID0gJCh0aGlzKS5hdHRyKCJkYXRhLWNvbHVtbi1pbmRleCIpOwogICAgICAgICAgICBkaXIgPSAnYXNjJzsKICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ3NvcnRpbmdfYXNjJykpIHsKICAgICAgICAgICAgICAgIGRpciA9ICdkZXNjJwogICAgICAgICAgICB9IGVsc2UgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ3NvcnRpbmdfZGVzYycpKSB7CiAgICAgICAgICAgICAgICBkaXIgPSAnYXNjJwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlzVmlld0luc3RhbmNlID0gMDsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5BbGVydFRhZ01vZGFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZWRpdEFsZXJ0VGFncycsIGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgdmFyIHBhcmVudF9yb3cgPSAkKGV2ZW50LnRhcmdldCkuY2xvc2VzdCgndHInKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmluZGV4KCk7CiAgICAgICAgICAgIHZhciByb3dPYmplY3QgPSB0YWJsZS5yb3dzKGluZGV4KS5kYXRhKClbMF07CiAgICAgICAgICAgIHZhciBhbGVydElkID0gcm93T2JqZWN0LmlkOwogICAgICAgICAgICB2YXIgZXhlY0NvbmZpZ0lkID0gcGFyZW50X3Jvdy5maW5kKCcuZXhlY0NvbmZpZ0lkJykuYXR0cigidmFsdWUiKTsKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgIHVybDogZmV0Y2hUYWdzVXJsLAogICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIGFsZXJ0SWQ6IGFsZXJ0SWQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFsZXJ0VGFnTW9kYWxPYmogPSAkKCcjYWxlcnRUYWdNb2RhbCcpOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnNlbGVjdDIoewogICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogIkFkZCBDYXRlZ29yaWVzIiwKICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3M6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC50YWdMaXN0CgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmoubW9kYWwoJ3Nob3cnKTsKICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoJyNzaW5nbGVBbGVydFRhZ3MnKS52YWwocmVzdWx0LmFsZXJ0VGFnTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCIuYWRkVGFncyIpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogc2F2ZVRhZ1VybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ3M6IEpTT04uc3RyaW5naWZ5KGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnZhbCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydElkOiBhbGVydElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNDb25maWdJZDogZXhlY0NvbmZpZ0lkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH07CgogICAgdmFyIG9wZW5TaW5nbGVBbGVydFRhZ01vZGFsID0gZnVuY3Rpb24gKHRhYmxlT2JqLCB0YWdzT2JqKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5lZGl0QWxlcnRUYWdzJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICBpZiAoaXNBYnN0cmFjdFZpZXdPckNhc2VWaWV3KGluZGV4KSkgewogICAgICAgICAgICAgICAgaW5kZXggPSBpbmRleCAvIDIKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0gdGFibGVPYmoucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgdmFyIGV4ZWNDb25maWdJZCA9IHBhcmVudF9yb3cuZmluZCgnLmV4ZWNDb25maWdJZCcpLmF0dHIoInZhbHVlIik7CiAgICAgICAgICAgIHZhciBhbGVydFRhZ01vZGFsT2JqID0gJCgnI2FsZXJ0VGFnTW9kYWwnKTsKICAgICAgICAgICAgdmFyICRzaW5nbGVDYXNlQWxlcnRUYWdzID0gYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJyk7CiAgICAgICAgICAgIHZhciAkZ2xvYmFsVGFncyA9IGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI2dsb2JhbFRhZ3MnKTsKICAgICAgICAgICAgYXBwbHlTZWxlY3QyRm9yVGFncygkc2luZ2xlQ2FzZUFsZXJ0VGFncywgZmV0Y2hUYWdzVXJsLCAnQ2FzZSBTZXJpZXMgQ2F0ZWdvcmllcycsIHRydWUpOwogICAgICAgICAgICBhcHBseVNlbGVjdDJGb3JUYWdzKCRnbG9iYWxUYWdzLCBmZXRjaFRhZ3NVcmwsICdHbG9iYWwgQ2F0ZWdvcmllcycsIGZhbHNlKTsKICAgICAgICAgICAgJHNpbmdsZUNhc2VBbGVydFRhZ3MuZmluZCgnb3B0aW9uJykucmVtb3ZlKCkKICAgICAgICAgICAgJGdsb2JhbFRhZ3MuZmluZCgnb3B0aW9uJykucmVtb3ZlKCkKICAgICAgICAgICAgJHNpbmdsZUNhc2VBbGVydFRhZ3MudmFsKG51bGwpLnRyaWdnZXIoImNoYW5nZSIpOwogICAgICAgICAgICAkZ2xvYmFsVGFncy52YWwobnVsbCkudHJpZ2dlcigiY2hhbmdlIik7CiAgICAgICAgICAgICQuZWFjaChyb3dPYmplY3QuY2FzZVNlcmllc1RhZ3MsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBuZXcgT3B0aW9uKHZhbHVlLCB2YWx1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAkc2luZ2xlQ2FzZUFsZXJ0VGFncy5hcHBlbmQob3B0aW9uKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICQuZWFjaChyb3dPYmplY3QuZ2xvYmFsVGFncywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24odmFsdWUsIHZhbHVlLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICRnbG9iYWxUYWdzLmFwcGVuZChvcHRpb24pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgICAgIGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI2dsb2JhbFRhZ3MnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgICAgICAgICAgdmFyIGVuYWJsZUNhc2VTZXJpZXNUYWdzID0gcm93T2JqZWN0LmlzQ2FzZVNlcmllc0dlbmVyYXRlZDsKICAgICAgICAgICAgaWYgKCFlbmFibGVDYXNlU2VyaWVzVGFncykgewogICAgICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjc2luZ2xlQWxlcnRUYWdzJykuYXR0cignZGlzYWJsZWQnLCAnJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxlcnRUYWdNb2RhbE9iai5tb2RhbCgnc2hvdycpOwogICAgICAgICAgICBhbGVydFRhZ01vZGFsT2JqLmZpbmQoIi5hZGRUYWdzIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IHNhdmVUYWdVcmwsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICBhbGVydFRhZ3M6IEpTT04uc3RyaW5naWZ5KGFsZXJ0VGFnTW9kYWxPYmouZmluZCgnI3NpbmdsZUFsZXJ0VGFncycpLnZhbCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsVGFnczogSlNPTi5zdHJpbmdpZnkoYWxlcnRUYWdNb2RhbE9iai5maW5kKCcjZ2xvYmFsVGFncycpLnZhbCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlZENhc2VTZXJpZXNUYWdzOiBKU09OLnN0cmluZ2lmeSh0YWdzT2JqLmRlbGV0ZWRDYXNlU2VyaWVzVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRHbG9iYWxUYWdzOiBKU09OLnN0cmluZ2lmeSh0YWdzT2JqLmRlbGV0ZWRHbG9iYWxUYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWRDYXNlU2VyaWVzVGFnczogSlNPTi5zdHJpbmdpZnkodGFnc09iai5hZGRlZENhc2VTZXJpZXNUYWdzKSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWRHbG9iYWxUYWdzOiBKU09OLnN0cmluZ2lmeSh0YWdzT2JqLmFkZGVkR2xvYmFsVGFncyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0SWQ6IGFsZXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWNDb25maWdJZDogZXhlY0NvbmZpZ0lkCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChwYXlsb2FkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkLnN0YXR1cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVPYmouYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnc3VjY2VzcycsICd0b3AgcmlnaHQnLCAiU3VjY2VzcyIsIHBheWxvYWQubWVzc2FnZSwge2F1dG9IaWRlRGVsYXk6IDIwMDB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuTm90aWZpY2F0aW9uLm5vdGlmeSgnZXJyb3InLCAndG9wIHJpZ2h0JywgIkVycm9yIiwgcGF5bG9hZC5tZXNzYWdlLCB7YXV0b0hpZGVEZWxheTogMjAwMH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaW5nbGUtY2FzZS1hbGVydC1zcGlubmVyJykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJCgnI3NpbmdsZS1jYXNlLWFsZXJ0LXNwaW5uZXInKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdCA9IGZ1bmN0aW9uIChhbGVydFR5cGUpIHsKCiAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLnNlbGVjdDIoewogICAgICAgICAgICBwbGFjZWhvbGRlcjogJC5pMThuLl8oJ3NlbGVjdE9uZScpLAogICAgICAgICAgICBhbGxvd0NsZWFyOiB0cnVlLAogICAgICAgICAgICBhamF4OiB7CiAgICAgICAgICAgICAgICB1cmw6IGZldGNoQWR2RmlsdGVyVXJsLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJywKICAgICAgICAgICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgICAgICAgICAgcXVpZXRNaWxsaXM6IDUwLAogICAgICAgICAgICAgICAgZGF0YTogZnVuY3Rpb24gKHBhcmFtcykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0VHlwZTogYWxlcnRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXJtOiBwYXJhbXMudGVybSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFyYW1zLnBhZ2UgfHwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgbWF4OiBwYXJhbXMubWF4IHx8IDMwCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcm9jZXNzUmVzdWx0czogZnVuY3Rpb24gKGRhdGEsIHBhcmFtcykgewogICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wYWdlID0gcGFyYW1zLnBhZ2UgfHwgMTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiAkLm1hcChkYXRhLmxpc3QsIGZ1bmN0aW9uIChmaWx0ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogZmlsdGVyLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGZpbHRlci5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9yZTogKHBhcmFtcy5wYWdlICogMzApIDwgZGF0YS50b3RhbENvdW50CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vc2VsZWN0IGFkdmFuY2VkIGZpbHRlciBiYXNlZCBvbiBjdXJyZW50IHZpZXcKICAgICAgICBpZiAoJCgnI2FkdmFuY2VkRmlsdGVyVmlldycpLnZhbCgpKSB7CiAgICAgICAgICAgIHZhciBhZHZhbmNlZEZpbHRlclZpZXcgPSAkLnBhcnNlSlNPTigkKCcjYWR2YW5jZWRGaWx0ZXJWaWV3JykudmFsKCkpOwogICAgICAgICAgICB2YXIgb3B0aW9uID0gbmV3IE9wdGlvbihhZHZhbmNlZEZpbHRlclZpZXcubmFtZSwgYWR2YW5jZWRGaWx0ZXJWaWV3LmlkLCB0cnVlLCB0cnVlKTsKICAgICAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLmFwcGVuZChvcHRpb24pLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIH0KCiAgICAgICAgJCgnI2FkZEFkdmFuY2VkRmlsdGVyJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzaWduYWwuYWR2YW5jZWRGaWx0ZXIuaW5pdGlhbGl6ZUFkdmFuY2VkRmlsdGVycygkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3NlbGVjdE9wZXJhdG9yJykuZW1wdHkoKS5hcHBlbmQoJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iIj5TZWxlY3QgT3BlcmF0b3I8L29wdGlvbj4nKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI25hbWUnKS52YWwoJycpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjZGVzY3JpcHRpb24nKS52YWwoJycpOwogICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjcXVlcnlKU09OJykudmFsKCcnKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2FsZXJ0VHlwZScpLnZhbCgnJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsICNidWlsZGVyQWxsJykuZmluZCgnLmV4cHJlc3Npb24nKS5yZW1vdmUoKTsKICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgLmRlbGV0ZUFkdkZpbHRlcicpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsIC5maWx0ZXJzV2l0aG91dFNhdmluZycpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsJykubW9kYWwoJ3Nob3cnKTsKCiAgICAgICAgfSk7CgogICAgICAgICQoJyNlZGl0QWR2YW5jZWRGaWx0ZXInKS51bmJpbmQoKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBhZHZhbmNlZEZpbHRlcklkID0gJCgnLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93bicpLnZhbCgpOwogICAgICAgICAgICBpZiAoYWR2YW5jZWRGaWx0ZXJJZCkgewogICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICB1cmw6IGZldGNoQWR2YW5jZWRGaWx0ZXJJbmZvVXJsLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsnYWR2YW5jZWRGaWx0ZXIuaWQnOiBhZHZhbmNlZEZpbHRlcklkfSwKICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLAogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3NlbGVjdE9wZXJhdG9yJykuZW1wdHkoKS5hcHBlbmQoJzxvcHRpb24gc2VsZWN0ZWQ9InNlbGVjdGVkIiB2YWx1ZT0iIj5TZWxlY3QgT3BlcmF0b3I8L29wdGlvbj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI25hbWUnKS52YWwocmVzdWx0Lm5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjZGVzY3JpcHRpb24nKS52YWwocmVzdWx0LmRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI3F1ZXJ5SlNPTicpLnZhbChyZXN1bHQuSlNPTlF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFkdmFuY2VkRmlsdGVyTW9kYWwgI2FsZXJ0VHlwZScpLnZhbChhbGVydFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAjZmlsdGVySWQnKS52YWwoYWR2YW5jZWRGaWx0ZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsIC5maWx0ZXJzV2l0aG91dFNhdmluZycpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBZHZhbmNlZEZpbHRlck1vZGFsIC5kZWxldGVBZHZGaWx0ZXInKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCAubW9kYWwtdGl0bGUnKS5odG1sKCJFZGl0IEZpbHRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWR2YW5jZWRGaWx0ZXIuaW5pdGlhbGl6ZUFkdmFuY2VkRmlsdGVycygpOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjY3JlYXRlQWR2YW5jZWRGaWx0ZXJNb2RhbCcpLm1vZGFsKCdzaG93Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgJCgiLmFkdmFuY2VkLWZpbHRlci1kcm9wZG93biIpLm9uKCJjaGFuZ2UiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB0YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgICAgb3BlbkFsZXJ0Q29tbWVudE1vZGFsOiBvcGVuQWxlcnRDb21tZW50TW9kYWwsCiAgICAgICAgb3BlbkNhc2VIaXN0b3J5TW9kYWw6IG9wZW5DYXNlSGlzdG9yeU1vZGFsLAogICAgICAgIHJlc3RhcnRSZXZpZXc6IHJlc3RhcnRSZXZpZXcsCiAgICAgICAgb3BlblNpbWlsYXJDYXNlc01vZGFsOiBvcGVuU2ltaWxhckNhc2VzTW9kYWwsCiAgICAgICAgYXBwbHlCdXNpbmVzc1J1bGVzOiBhcHBseUJ1c2luZXNzUnVsZXMsCiAgICAgICAgc2hvd0F0dGFjaG1lbnRNb2RhbDogb3BlbkF0dGFjaG1lbnRNb2RhbCwKICAgICAgICBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzOiBiaW5kR3JpZER5bmFtaWNGaWx0ZXJzLAogICAgICAgIGVuYWJsZU1lbnVUb29sdGlwczogZW5hYmxlTWVudVRvb2x0aXBzLAogICAgICAgIGRpc2FibGVUb29sdGlwczogZGlzYWJsZVRvb2x0aXBzLAogICAgICAgIHNvcnRJY29uSGFuZGxlcjogc29ydEljb25IYW5kbGVyLAogICAgICAgIGlzQWxlcnRQZXJzaXN0ZWRJblNlc3Npb25TdG9yYWdlOiBpc0FsZXJ0UGVyc2lzdGVkSW5TZXNzaW9uU3RvcmFnZSwKICAgICAgICByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlOiByZW1vdmVGaWx0ZXJzRnJvbVNlc3Npb25TdG9yYWdlLAogICAgICAgIG9wZW5TYXZlVmlld01vZGFsOiBvcGVuU2F2ZVZpZXdNb2RhbCwKICAgICAgICBjcmVhdGVTb3J0aW5nTWFwOiBjcmVhdGVTb3J0aW5nTWFwLAogICAgICAgIGNyZWF0ZUZpbHRlck1hcDogY3JlYXRlRmlsdGVyTWFwLAogICAgICAgIGNyZWF0ZUxpc3RPZkluZGV4OiBjcmVhdGVMaXN0T2ZJbmRleCwKICAgICAgICBvcGVuQWxlcnRUYWdNb2RhbDogb3BlbkFsZXJ0VGFnTW9kYWwsCiAgICAgICAgc2V0U29ydE9yZGVyOiBzZXRTb3J0T3JkZXIsCiAgICAgICAgb3BlblNpbmdsZUFsZXJ0VGFnTW9kYWw6IG9wZW5TaW5nbGVBbGVydFRhZ01vZGFsLAogICAgICAgIGdlbmVyYXRlVmlld0luZm86IGdlbmVyYXRlVmlld0luZm8sCiAgICAgICAgcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdDogcG9wdWxhdGVBZHZhbmNlZEZpbHRlclNlbGVjdAogICAgfQoKfSkoKTsKCmZ1bmN0aW9uIHNob3dFcnJvck1lc3NhZ2VJbk1vZGFsKCRtb2RhbCwgdGV4dCkgewogICAgY2xlYXJfZXJyb3JzKCk7CiAgICBpZiAodGV4dCkgewogICAgICAgIHRleHQgPSB0ZXh0OwogICAgfSBlbHNlIHsKICAgICAgICB0ZXh0ID0gJ1BsZWFzZSBmaWxsICB0aGUgcmVxdWlyZWQgRmllbGRzJzsKICAgIH0KICAgIHZhciBhbGVydEh0bWwgPSBnZXRFcnJvck1lc3NhZ2VIdG1sKHRleHQpOwogICAgJG1vZGFsLmZpbmQoJy5tb2RhbC1ib2R5JykucHJlcGVuZChhbGVydEh0bWwpOwp9CgpmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2VIdG1sKG1zZykgewogICAgdmFyIGFsZXJ0SHRtbCA9ICc8ZGl2IGNsYXNzPSJhbGVydCBhbGVydC1kYW5nZXIgYWxlcnQtZGlzbWlzc2libGUiIHJvbGU9ImFsZXJ0Ij4gJyArCiAgICAgICAgJzxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0iYWxlcnQiPiAnICsKICAgICAgICAnPHNwYW4gYXJpYS1oaWRkZW49InRydWUiPiZ0aW1lczs8L3NwYW4+ICcgKwogICAgICAgICc8c3BhbiBjbGFzcz0ic3Itb25seSI+PGc6bWVzc2FnZSBjb2RlPSJkZWZhdWx0LmJ1dHRvbi5jbG9zZS5sYWJlbCIgLz48L3NwYW4+ICcgKwogICAgICAgICc8L2J1dHRvbj4gJyArIG1zZzsKICAgICc8L2Rpdj4nOwogICAgcmV0dXJuIGFsZXJ0SHRtbDsKfQoKdmFyIGNsZWFyX2Vycm9ycyA9IGZ1bmN0aW9uICgpIHsKICAgICQoJy5tb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKTsKfTsKCmZ1bmN0aW9uIHNlYXJjaChuYW1lS2V5LCBteUFycmF5KSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG15QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobXlBcnJheVtpXS5uYW1lID09PSBuYW1lS2V5KSB7CiAgICAgICAgICAgIHJldHVybiBteUFycmF5W2ldOwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwsIHRvcGljT2JqKSB7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnZhbCh0b3BpY09iai5zdGFydERhdGUpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKHRvcGljT2JqLmVuZERhdGUpOwogICAgJG1vZGFsLmZpbmQoJy5wcm9kdWN0LXNwYW4nKS50ZXh0KGdldFByb2R1Y3ROYW1lTGlzdChKU09OLnBhcnNlKHRvcGljT2JqLnByb2R1Y3RzKSkpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS5hdHRyKCJkaXNhYmxlZCIsICIiKTsKICAgICRtb2RhbC5maW5kKCcjZW5kRGF0ZScpLmF0dHIoImRpc2FibGVkIiwgIiIpOwogICAgaWYgKHRvcGljT2JqLnByb2R1Y3RzKSB7CiAgICAgICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykuYXR0cigiZGlzYWJsZWQiLCAiIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGRlcG9wdWxhdGVUb3BpY0RldGFpbCgkbW9kYWwpIHsKICAgIHZhciBwcm9kdWN0SnNvbiA9ICRtb2RhbC5maW5kKCcucHJvZHVjdC1qc29uLWNvbnRhaW5lcicpLnZhbCgpOwogICAgJG1vZGFsLmZpbmQoJyNzdGFydERhdGUnKS52YWwoIiIpOwogICAgJG1vZGFsLmZpbmQoJyNlbmREYXRlJykudmFsKCIiKTsKICAgICRtb2RhbC5maW5kKCcjcHJvZHVjdCcpLnZhbCgiIik7CiAgICAkbW9kYWwuZmluZCgnLnByb2R1Y3Qtc3BhbicpLnRleHQoZ2V0UHJvZHVjdE5hbWVMaXN0KEpTT04ucGFyc2UocHJvZHVjdEpzb24pKSk7CiAgICAkbW9kYWwuZmluZCgnI3N0YXJ0RGF0ZScpLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CiAgICAkbW9kYWwuZmluZCgnI2VuZERhdGUnKS5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwogICAgJG1vZGFsLmZpbmQoJyNwcm9kdWN0JykucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGVQcm9kdWN0SnNvbihwcm9kdWN0SWQsIHByb2R1Y3ROYW1lLCBsZXZlbCkgewogICAgdmFyIHRvcGljUHJvZHVjdFZhbHVlcyA9IHsiMSI6IFtdLCAiMiI6IFtdLCAiMyI6IFtdLCAiNCI6IFtdLCAiNSI6IFtdfTsKICAgIHRvcGljUHJvZHVjdFZhbHVlc1tsZXZlbF0ucHVzaCh7bmFtZTogcHJvZHVjdE5hbWUsIGlkOiBwcm9kdWN0SWR9KTsKICAgIHJldHVybiB0b3BpY1Byb2R1Y3RWYWx1ZXM7Cn0KCmZ1bmN0aW9uIGdldFByb2R1Y3ROYW1lTGlzdChvYmopIHsKICAgIHZhciBwcm9kdWN0QXJyYXkgPSBbXTsKICAgIHZhciBvYmpBcnJheSA9IG9ialsnMyddOwogICAgJC5lYWNoKG9iakFycmF5LCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgcHJvZHVjdEFycmF5LnB1c2godmFsdWUubmFtZSk7CiAgICB9KTsKICAgIHJldHVybiBwcm9kdWN0QXJyYXkuam9pbignLCcpOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0SnNvbihhcHBsaWNhdGlvbk5hbWUsIHJvdykgewogICAgdmFyIHByb2R1Y3RKc29uOwogICAgaWYgKGFwcGxpY2F0aW9uTmFtZSA9PSAiQWQtSG9jIEFsZXJ0IikgewogICAgICAgIGlmIChyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpCiAgICAgICAgICAgIHByb2R1Y3RKc29uID0gSlNPTi5wYXJzZShyb3cuZmluZCgnLnJvdy1wcm9kdWN0LWpzb24tY29udGFpbmVyJykudmFsKCkpOwogICAgfSBlbHNlIHsKICAgICAgICB2YXIgcHJvZHVjdE5hbWUgPSByb3cuZmluZCgnc3BhbltkYXRhLWZpZWxkPSJwcm9kdWN0TmFtZSJdJykuYXR0cigiZGF0YS1pZCIpOwogICAgICAgIHZhciBwcm9kdWN0SWQgPSByb3cuZmluZCgnLnJvdy1wcm9kdWN0LWlkJykudmFsKCk7CiAgICAgICAgdmFyIGxldmVsID0gcm93LmZpbmQoJy5yb3ctbGV2ZWwtaWQnKS52YWwoKTsKICAgICAgICBpZiAoIWxldmVsKSB7CiAgICAgICAgICAgIGxldmVsID0gMzsKICAgICAgICB9CiAgICAgICAgcHJvZHVjdEpzb24gPSBnZW5lcmF0ZVByb2R1Y3RKc29uKHByb2R1Y3RJZCwgcHJvZHVjdE5hbWUsIGxldmVsKTsKICAgIH0KICAgIHJldHVybiBwcm9kdWN0SnNvbjsKfQoKZnVuY3Rpb24gYXBwbHlTZWxlY3QyRm9yVGFncygkc2VsZWN0b3IsIHVybCwgcGxhY2VIb2xkZXJUZXh0LCBpc0Nhc2VTZXJpZXNUYWcpIHsKICAgICRzZWxlY3Rvci5zZWxlY3QyKHsKICAgICAgICBtaW5pbXVtSW5wdXRMZW5ndGg6IDAsCiAgICAgICAgbXVsdGlwbGU6IHRydWUsCiAgICAgICAgdGFnczogdHJ1ZSwKICAgICAgICBwbGFjZWhvbGRlcjogcGxhY2VIb2xkZXJUZXh0LAogICAgICAgIGFsbG93Q2xlYXI6IHRydWUsCiAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICBjcmVhdGVUYWc6IGZ1bmN0aW9uICh0YWcpIHsKCiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBvcHRpb24gaXMgYWxyZWFkeSB0aGVyZQogICAgICAgICAgICBmb3VuZCA9IGZhbHNlOwogICAgICAgICAgICAkc2VsZWN0b3IuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoJC50cmltKHRhZy50ZXJtKS50b1VwcGVyQ2FzZSgpID09PSAkLnRyaW0oJCh0aGlzKS50ZXh0KCkpLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICBwcmV2VGFnID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gaWYgaXQncyBub3QgdGhlcmUsIHRoZW4gc2hvdyB0aGUgc3VnZ2VzdGlvbgogICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0odGFnLnRlcm0pLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbSh0YWcudGVybSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlkOiAkLnRyaW0ocHJldlRhZy50ZXh0KCkpLAogICAgICAgICAgICAgICAgICAgIHRleHQ6ICQudHJpbShwcmV2VGFnLnRleHQoKSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGFqYXg6IHsKICAgICAgICAgICAgcXVpZXRNaWxsaXM6IDI1MCwKICAgICAgICAgICAgZGF0YVR5cGU6ICJqc29uIiwKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdGVybTogcGFyYW1zLnRlcm0sCiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFyYW1zLnBhZ2UgfHwgMSwKICAgICAgICAgICAgICAgICAgICBtYXg6IDMwLAogICAgICAgICAgICAgICAgICAgIGxhbmc6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgaXNDYXNlU2VyaWVzVGFnOiBpc0Nhc2VTZXJpZXNUYWcKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHByb2Nlc3NSZXN1bHRzOiBmdW5jdGlvbiAoZGF0YSwgcGFyYW1zKSB7CiAgICAgICAgICAgICAgICBwYXJhbXMucGFnZSA9IHBhcmFtcy5wYWdlIHx8IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IGRhdGEubGlzdCwKICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vcmU6IChwYXJhbXMucGFnZSAqIDMwKSA8IGRhdGEudG90YWxDb3VudAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gc2hvd0NvbW1lbnRJY29uKGN1cnJlbnRSb3cpIHsKICAgIHZhciAkYnRuR3JvdXAgPSAkKGN1cnJlbnRSb3cpLmNsb3Nlc3QoJ3RyJykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuZHJvcGRvd24tdG9nZ2xlJykuYWZ0ZXIoJzxpIGNsYXNzPSJtZGkgbWRpLWNoYXQgYmx1ZS0yIGZvbnQtMTMgcG9zLWFiIGNvbW1lbnQiIHRpdGxlPSInICsgJC5pMThuLl8oJ2NvbW1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nKTsKICAgIH0KfQoKZnVuY3Rpb24gcmVtb3ZlQ29tbWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLm5leHQoJ2knKS5yZW1vdmUoKTsKfQoKZnVuY3Rpb24gcmVtb3ZlQXR0YWNobWVudEljb24oY3VycmVudFJvdykgewogICAgdmFyICRidG5Hcm91cCA9ICQoY3VycmVudFJvdykuY2xvc2VzdCgndHInKS5maW5kKCd0ZC5kcm9wRG93biAuYnRuLWdyb3VwJyk7CiAgICBpZiAoJCgkYnRuR3JvdXApLmZpbmQoJy5jb21tZW50JykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgJCgkYnRuR3JvdXApLmZpbmQoJy5kcm9wZG93bi10b2dnbGUnKS5uZXh0KCdpJykucmVtb3ZlKCk7CiAgICB9IGVsc2UgewogICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLm5leHQoJ2knKS5yZW1vdmUoKTsKICAgIH0KfQoKZnVuY3Rpb24gc2hvd0F0dGFjaG1lbnRJY29uKHRyUm93KSB7CiAgICB2YXIgJGJ0bkdyb3VwID0gJCh0clJvdykuZmluZCgndGQuZHJvcERvd24gLmJ0bi1ncm91cCcpOwogICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuYXR0YWNoJykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgaWYgKCQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAkKCRidG5Hcm91cCkuZmluZCgnLmRyb3Bkb3duLXRvZ2dsZScpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoJGJ0bkdyb3VwKS5maW5kKCcuY29tbWVudCcpLmFmdGVyKCcgPGkgY2xhc3M9Im1kaSBtZGktYXR0YWNobWVudCBibHVlLTEgZm9udC0xMyBwb3MtYWIgYXR0YWNoIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhdHRhY2htZW50QXZhaWxhYmxlJykgKyAnIj48L2k+ICcpOwogICAgICAgIH0KICAgIH0KfQoKdmFyIGlzU2FmZXR5TGVhZEFsbG93ZWQgPSBmdW5jdGlvbiAobGlzdFByb2R1Y3RJZHMsIHNlbGVjdGVkUHJvZHVjdElkKSB7CiAgICByZXR1cm4gbGlzdFByb2R1Y3RJZHMuaW5kZXhPZihzZWxlY3RlZFByb2R1Y3RJZCkgIT09IC0xCn07Cgp2YXIgc2V0Q29sdW1uU2VxID0gZnVuY3Rpb24gKG1hcFNlcSkgewogICAgY29sdW1uU2VxID0gbWFwU2VxCn0KCnZhciBzaWduYWwgPSBzaWduYWwgfHwge307CgpzaWduYWwuYWN0aW9uc191dGlscyA9IChmdW5jdGlvbigpIHsKICAgIHZhciBhY3Rpb25fbGlzdF90YWJsZTsKICAgIHZhciBjdXJyZW50X2NyZWF0ZV9idDsKICAgIHZhciBhZGhvY192YWxpZGF0ZWRfdGFibGU7CgogICAgdmFyIHNldF9hY3Rpb25fY3JlYXRlX21vZGFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCcpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAkKHRoaXMpCiAgICAgICAgICAgICAgICAuZmluZCgnI2NvbmZpZycpLnZhbCgnJykuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCcjdHlwZScpLnZhbCgnJykuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCcjbWVldGluZ0VsZW1lbnQnKS52YWwoJycpLmVuZCgpCiAgICAgICAgICAgICAgICAuZmluZCgnLmFzc2lnbmVkVG9WYWx1ZScpLnZhbCgnJykudHJpZ2dlcignY2hhbmdlJykuZW5kKCkKICAgICAgICAgICAgICAgIC5maW5kKCcuYXNzaWduZWRUb1ZhbHVlJykuZW1wdHkoKS5lbmQoKQogICAgICAgICAgICAgICAgLmZpbmQoImlucHV0W3R5cGU9dGV4dF0sdGV4dGFyZWEiKS52YWwoJycpCiAgICAgICAgICAgICAgICAuZW5kKCk7CgogICAgICAgICAgICAkKCcjY3JlYXRlQWN0aW9uTW9kYWwgLnNlbGVjdDItc2VsZWN0aW9uX19yZW5kZXJlZCcpLmhvdmVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQXR0cigndGl0bGUnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgIH0pOwoKICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgY2xlYXJfZWRpdF9lcnJvcnMoKTsKICAgICAgICAgICAgJCh0aGlzKQogICAgICAgICAgICAgICAgLmZpbmQoImlucHV0W3R5cGU9dGV4dF0sdGV4dGFyZWEsc2VsZWN0IikKICAgICAgICAgICAgICAgIC52YWwoJycpCiAgICAgICAgICAgICAgICAuZW5kKCkKICAgICAgICB9KTsKCiAgICAgICAgJCgnI2VkaXRBY3Rpb25Nb2RhbCcpLm9uKCdoaWRkZW4uYnMubW9kYWwnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBjbGVhcl9lZGl0X3NpZ25hbCgpOwogICAgICAgICAgICAkKHRoaXMpCiAgICAgICAgICAgICAgICAuZmluZCgiaW5wdXRbdHlwZT10ZXh0XSx0ZXh0YXJlYSxzZWxlY3QiKQogICAgICAgICAgICAgICAgLnZhbCgnJykKICAgICAgICAgICAgICAgIC5lbmQoKQogICAgICAgIH0pOwoKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmFjdGlvbi1jcmVhdGUnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIHZhciBzcmNFbGUgPSAkKGV2dC50YXJnZXQpOwogICAgICAgICAgICBjdXJyZW50X2NyZWF0ZV9idCA9IHNyY0VsZTsKICAgICAgICAgICAgdmFyIGFsZXJ0SWQgPSBhbGVydElkOwogICAgICAgICAgICBpZiAodHlwZW9mIChzcmNFbGUuYXR0cignYWxlcnQtaWQnKSkgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICBhbGVydElkID0gc3JjRWxlLmF0dHIoJ2FsZXJ0LWlkJykKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY3JlYXRlQWN0aW9uTW9kYWwgPSAkKCcjY3JlYXRlQWN0aW9uTW9kYWwnKTsKICAgICAgICAgICAgdmFyIGNyZWF0ZUFjdGlvbkJ1dHRvbiA9ICQoIiNjcmVhdGUtYWN0aW9uLWJ0biIpOwogICAgICAgICAgICBjcmVhdGVBY3Rpb25Nb2RhbC5maW5kKCcuaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKTsKCiAgICAgICAgICAgIC8vU2V0IHRoZSBhbGVydElkIGluIHRoZSBoaWRkZW4gZmllbGQgb2YgdGhlIG1vZGFsLgogICAgICAgICAgICBpZiAodHlwZW9mIGFsZXJ0SWQgIT0gInVuZGVmaW5lZCIgJiYgYWxlcnRJZCAhPSAnJykgewogICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwuZmluZCgiLmFsZXJ0SWQiKS52YWwoYWxlcnRJZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNyZWF0ZUFjdGlvbk1vZGFsLmZpbmQoJyNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKCk7CiAgICAgICAgICAgIGNyZWF0ZUFjdGlvbkJ1dHRvbi5hdHRyKCJkaXNhYmxlZCIsIGZhbHNlKTsKICAgICAgICAgICAgY2xlYXJfZXJyb3JzKCk7CiAgICAgICAgICAgICQoJy5hY3Rpb24tdHlwZS1saXN0JykucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICAkKCcubWVldGluZy1saXN0JykuYWRkQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgICAgICBjcmVhdGVBY3Rpb25Nb2RhbC5tb2RhbCh7fSk7CgogICAgICAgICAgICAvL0V2ZW50IGJpbmQgd2hlbiB0aGUgc2F2ZS9jcmVhdGUgYnV0dG9uIGlzIGNsaWNrCiAgICAgICAgICAgIC8vIGtlZCBpbiB0aGUgYWN0aW9uIGV2ZW50IG1vZGFsLgogICAgICAgICAgICBjcmVhdGVBY3Rpb25CdXR0b24udW5iaW5kKCdjbGljaycpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB2YXIgYWxlcnRJZCA9ICQoZXZlbnQudGFyZ2V0KS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uTW9kYWxJZCA9ICQoIiNjcmVhdGVBY3Rpb25Nb2RhbCAjdGVtcEZvcm0iKTsKICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICAgICAgICAgIHVybDogJy9zaWduYWwvYWN0aW9uL3NhdmUnLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGdldEFjdGlvbkRldGFpbHMoYWN0aW9uTW9kYWxJZCksCiAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZQogICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2Vycm9ycygpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSAiPGRpdiBjbGFzcz0nYWxlcnQgYWxlcnQtZGFuZ2VyJz4iOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgcmVzcG9uc2UuZGF0YS5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2VPYmogPSByZXNwb25zZS5kYXRhW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9IGVycm9yTWVzc2FnZU9iajsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICc8L2JyPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIjwvZGl2PiI7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCAubW9kYWwtYm9keScpLnByZXBlbmQoZXJyb3JNc2cpOwogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVBY3Rpb25CdXR0b24uYXR0cigiZGlzYWJsZWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uTW9kYWwubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9jcmVhdGVfYnQucGFyZW50c1VudGlsKCJ0ZCIpLmZpbmQoJy5kZWZhdWx0LXZhbHVlJykuaHRtbChyZXNwb25zZS5hY3Rpb25Db3VudCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCA9PT0gIkNhc2UgRGV0YWlsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFsZXJ0SWQgIT0gInVuZGVmaW5lZCIgJiYgYWxlcnRJZCAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGV0YWlsX3RhYmxlICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbF90YWJsZS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21lZXRpbmctdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaWduYWxBY3Rpdml0eVRhYmxlJykuRGF0YVRhYmxlKCkuYWpheC5yZWxvYWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy9SZWZyZXNoIHRoZSBhY3Rpdml0eSB0YWJsZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuQ0FTRV9ERVRBSUwgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuRVZFTlRfREVUQUlMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbkxhYmVsID09IEFQUExJQ0FUSU9OX0xBQkVMLlNJR05BTF9NQU5BR0VNRU5UKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLm1lZXRpbmdfdXRpbHMucmVsb2FkX21lZXRpbmdfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJfZXJyb3JzKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yTXNnID0gIjxkaXYgY2xhc3M9J2FsZXJ0IGFsZXJ0LWRhbmdlcic+IjsKICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAiRXJyb3Igb2NjdXJlZCB3aGlsZSBzYXZpbmcgQWN0aW9uLiI7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gIjwvZGl2PiI7CiAgICAgICAgICAgICAgICAgICAgJCgnI2NyZWF0ZUFjdGlvbk1vZGFsIC5tb2RhbC1ib2R5JykucHJlcGVuZChlcnJvck1zZyk7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlQWN0aW9uQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgfTsKCiAgICB2YXIgZ2V0QWN0aW9uRGV0YWlscyA9IGZ1bmN0aW9uKG1vZGFsSWQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY29uZmlnIjogbW9kYWxJZC5maW5kKCIjY29uZmlnIikudmFsKCksCiAgICAgICAgICAgICJ0eXBlIjogbW9kYWxJZC5maW5kKCIjdHlwZSIpLnZhbCgpLAogICAgICAgICAgICAiYXNzaWduZWRUb1ZhbHVlIjogbW9kYWxJZC5maW5kKCIjYXNzaWduZWRUbyIpLnZhbCgpLAogICAgICAgICAgICAiZHVlRGF0ZSI6IG1vZGFsSWQuZmluZCgiI2R1ZURhdGUiKS52YWwoKSwKICAgICAgICAgICAgImRldGFpbHMiOiBtb2RhbElkLmZpbmQoIiNkZXRhaWxzIikudmFsKCksCiAgICAgICAgICAgICJjb21tZW50cyI6IG1vZGFsSWQuZmluZCgiI2NvbW1lbnRzIikudmFsKCksCiAgICAgICAgICAgICJhbGVydElkIjogbW9kYWxJZC5maW5kKCIjYWxlcnRJZCIpLnZhbCgpLAogICAgICAgICAgICAiYXBwVHlwZSI6IG1vZGFsSWQuZmluZCgiI2FwcFR5cGUiKS52YWwoKSwKICAgICAgICAgICAgImV4ZUNvbmZpZ0lkIjogbW9kYWxJZC5maW5kKCIjZXhlQ29uZmlnSWQiKS52YWwoKSwKICAgICAgICAgICAgIm1lZXRpbmdJZCI6IG1vZGFsSWQuZmluZCgiI21lZXRpbmdFbGVtZW50IikudmFsKCksCiAgICAgICAgICAgICJhY3Rpb25TdGF0dXMiOiBtb2RhbElkLmZpbmQoIiNhY3Rpb25TdGF0dXMiKS52YWwoKSwKICAgICAgICAgICAgImFjdGlvbklkIjogbW9kYWxJZC5maW5kKCIjYWN0aW9uSWQiKS52YWwoKQogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNsZWFyX2Vycm9ycyA9IGZ1bmN0aW9uKCkgewogICAgICAgICQoJyNjcmVhdGVBY3Rpb25Nb2RhbCAubW9kYWwtYm9keSAuYWxlcnQnKS5yZW1vdmUoKQogICAgfTsKCiAgICB2YXIgY2xlYXJfZWRpdF9lcnJvcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsIC5tb2RhbC1ib2R5IC5hbGVydCcpLnJlbW92ZSgpCiAgICB9OwogICAgdmFyIGNsZWFyX2VkaXRfc2lnbmFsID0gZnVuY3Rpb24gKCkgewogICAgICAgICQoJyNlZGl0QWN0aW9uTW9kYWwgLm1vZGFsLWJvZHkgLmFsZXJ0JykucmVtb3ZlKCkKICAgIH07CgovL1NpbmdsZSBhbmQgQWdncmVnYXRlIEFjdGlvbiBsaXN0IGRhdGEKICAgIHZhciBzZXRfYWN0aW9uX2xpc3RfbW9kYWwgPSBmdW5jdGlvbihjb21wKSB7CiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5saXN0LWFjdGlvbicsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgY29tcC5tb2RhbCgndG9nZ2xlJywgJCh0aGlzKSk7CiAgICAgICAgfSk7CiAgICAgICAgY29tcC5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbihldnQpIHsKICAgICAgICAgICAgdmFyIHNyY0VsZSA9IGV2dC5yZWxhdGVkVGFyZ2V0OwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9ICQoc3JjRWxlKS5hdHRyKCdkYXRhLWlkJyk7CiAgICAgICAgICAgIHZhciBhcHBUeXBlID0gJCgiI2NyZWF0ZUFjdGlvbk1vZGFsICN0ZW1wRm9ybSIpLmZpbmQoIiNhcHBUeXBlIikudmFsKCk7CiAgICAgICAgICAgIHZhciBhY3Rpb25VcmwgPSAiL3NpZ25hbC9hY3Rpb24vbGlzdEJ5QWxlcnQ/YWxlcnRJZD0iICsgYWxlcnRJZCArIiZhcHBUeXBlPSIgKyBhcHBUeXBlOwogICAgICAgICAgICBhY3Rpb25fbGlzdF90YWJsZSA9ICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICAgICAgICAgZGVzdHJveSA6IHRydWUsCiAgICAgICAgICAgICAgICAibGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZuRHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLmVkaXQtYWN0aW9uLWxpbmsnKS5jbGljayhmdW5jdGlvbihldnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9ICIvc2lnbmFsL2FjdGlvbi9nZXRCeUlkP2lkPSIgKyAkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hY3Rpb25fdHlwZXMgPSBhY3Rpb25fc2VsZWN0X3ZhbHVlcy50eXBlczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWN0aW9uX2NvbmZpZ3MgPSBhY3Rpb25fc2VsZWN0X3ZhbHVlcy5jb25maWdzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hbGxfc3RhdHVzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMuYWxsU3RhdHVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hbGVydElkID0gYWxlcnRJZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWN0aW9uU3RhdHVzID0ge25hbWU6IGRhdGEuYWN0aW9uU3RhdHVzfTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbF9jb250ZW50ID0gc2lnbmFsLnV0aWxzLnJlbmRlcignYWN0aW9uX2VkaXRvcicsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyJykuaHRtbChodG1sX2NvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyICNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBkYXRhLmR1ZURhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmtleWRvd24ocHJldmVudEVudGVyS2V5U3VibWl0KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHVlRGF0ZSA9IG1vbWVudChkYXRhLmR1ZURhdGUsICJERC1NTU0tWVlZWSIpLmZvcm1hdChERUZBVUxUX0RBVEVfRk9STUFUKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lcicpLmZpbmQoJyNkdWUtZGF0ZS1waWNrZXInKS5maW5kKCcjZHVlRGF0ZScpLnZhbChkdWVEYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdG9yLWNvbnRhaW5lcicpLmZpbmQoJyNhcHBUeXBlJykudmFsKGFwcFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbl9lZGl0b3IgPSAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0QWN0aW9uTW9kYWwgPSAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuYXNzaWduZWRUb1ZhbHVlJykudmFsKG51bGwpLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1tb2RhbCcpLm1vZGFsKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoe30pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjY2FuY2VsLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjdXBkYXRlLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLmFjdGlvbi1jcmVhdGUnKS5hdHRyKCdkYXRhLWlkJywgYWxlcnRJZCk7CiAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMuc2V0X2FjdGlvbl9jcmVhdGVfbW9kYWwoKTsKICAgICAgICAgICAgICAgICAgICAkKCcjZHVlLWRhdGUtcGlja2VyJykuZGF0ZXBpY2tlcigpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6IGFjdGlvblVybCwKICAgICAgICAgICAgICAgICAgICBjYWNoZTpmYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZGF0YVNyYyI6ICIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInNlYXJjaGluZyI6IHRydWUsCiAgICAgICAgICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAogICAgICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAgICAgIm9MYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICAgICAic1Byb2Nlc3NpbmciOiAnPGRpdiBjbGFzcz0iZ3JpZC1sb2FkaW5nIj48aW1nIHNyYz0iL3NpZ25hbC9hc3NldHMvc3Bpbm5lci5naWYiIHdpZHRoPSIzMCIgYWxpZ249Im1pZGRsZSIgLz48L2Rpdj4nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogNSwKICAgICAgICAgICAgICAgICJhTGVuZ3RoTWVudSI6IFtbNSwgMTAsIDIwLCAtMV0sIFs1LCAxMCwgMjAsICJBbGwiXV0sCiAgICAgICAgICAgICAgICAiYW9Db2x1bW5zIjogWwogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxhIGhyZWY9JyMnIGNsYXNzPSdlZGl0LWFjdGlvbi1saW5rJyBkYXRhLWlkPSciICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cuaWQgKyAiJz4iICsgcm93LmlkICsgIjxhPiIKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAidHlwZSIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbmZpZyIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImRldGFpbHMiLAogICAgICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjoiY29sLW1pbi0yMDAiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJkdWVEYXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ImNvbC1taW4tMTAwIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXNzaWduZWRUbyIsCiAgICAgICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiJjb2wtbWluLTEwMCIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgIm1EYXRhIiA6ICJhY3Rpb25TdGF0dXMiCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjb21wbGV0ZWREYXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ImNvbC1taW4tMTUwIiwKICAgICAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSxyb3cpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5jb21wbGV0ZWREYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgc2Nyb2xsWDogdHJ1ZSwKICAgICAgICAgICAgICAgIGNvbHVtbkRlZnM6IFt7CiAgICAgICAgICAgICAgICAgICAgInRhcmdldHMiOiAnX2FsbCcsCiAgICAgICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0pCiAgICAgICAgfSk7CgogICAgICAgIGNvbXAub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgICAgY29tcC5maW5kKCIjYWN0aW9uLXRhYmxlIikuZW1wdHkoKTsKICAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGFjdGlvbl9saXN0X3RhYmxlCiAgICB9OwogICAgdmFyIHNldEVkaXRNb2RhbFZhbHVlcyA9IGZ1bmN0aW9uIChlZGl0QWN0aW9uTW9kYWwsIGRhdGEpIHsKICAgICAgICB2YXIgYWN0aW9uVHlwZSA9IGRhdGEudHlwZU9iai5pZDsKICAgICAgICB2YXIgbWVldGluZ0lkID0gZGF0YS5tZWV0aW5nSWQ7CiAgICAgICAgdmFyIG9wdGlvbiA9IG5ldyBPcHRpb24oZGF0YS5hc3NpZ25lZFRvT2JqLmZ1bGxOYW1lLCBkYXRhLmFzc2lnbmVkVG9PYmouaWQsIHRydWUsIHRydWUpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjYXNzaWduZWRUbyIpLmFwcGVuZChvcHRpb24pLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICAgIGlmKCFtZWV0aW5nSWQpIHsKICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiN0eXBlIikudmFsKGFjdGlvblR5cGUpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNtZWV0aW5nRWxlbWVudCIpLnZhbChtZWV0aW5nSWQpOwogICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI21lZXRpbmdWYWx1ZSIpLnZhbChtZWV0aW5nSWQpOwogICAgICAgIH0KICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiLnN0YXR1cy1pY29uIikucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjY29uZmlnIikudmFsKGRhdGEuY29uZmlnT2JqLmlkKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2FjdGlvbklkIikudmFsKGRhdGEuaWQpOwogICAgICAgIHZhciBkdWVEYXRlID0gbW9tZW50KGRhdGEuZHVlRGF0ZSwgREVGQVVMVF9EQVRFX0ZPUk1BVCkuZm9ybWF0KERFRkFVTFRfREFURV9GT1JNQVQpOwogICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCIjZHVlLWRhdGUtcGlja2VyIikuZGF0ZXBpY2tlcih7CiAgICAgICAgICAgIGRhdGU6ICQoIiNkdWUtZGF0ZS1waWNrZXIiKS52YWwoKSA/IG5ldyBEYXRlKCQoIiNkdWUtZGF0ZS1waWNrZXIiKS52YWwoKSkgOiBudWxsLAogICAgICAgICAgICBtb21lbnRDb25maWc6IHsKICAgICAgICAgICAgICAgIGN1bHR1cmU6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICBmb3JtYXQ6IERFRkFVTFRfREFURV9ESVNQTEFZX0ZPUk1BVAogICAgICAgICAgICB9CiAgICAgICAgfSkua2V5cHJlc3MocHJldmVudEVudGVyS2V5U3VibWl0KTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2R1ZURhdGUiKS52YWwoZHVlRGF0ZSk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoIiNjb21tZW50cyIpLnZhbChkYXRhLmNvbW1lbnRzKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2RldGFpbHMiKS52YWwoZGF0YS5kZXRhaWxzKTsKICAgICAgICBlZGl0QWN0aW9uTW9kYWwuZmluZCgiI2FjdGlvblN0YXR1cyIpLnZhbChkYXRhLmFjdGlvblN0YXR1cyk7CiAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoJy5hY3Rpb24tdmFsdWUnKS50cmlnZ2VyKCdjaGFuZ2UnKTsKICAgIH07CiAgICB2YXIgaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsID0gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdmFyIGFjdGlvbl9saXN0X3RhYmxlID0gJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpOwogICAgICAgIGFjdGlvbl9saXN0X3RhYmxlLmFqYXgucmVsb2FkKCk7CiAgICAgICAgJCgnI2FjdGlvbi1lZGl0LW1vZGFsJykubW9kYWwoJ2hpZGUnKQogICAgfTsKCiAgICB2YXIgaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlID0gZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgaWYgKCFldnQuaGFuZGxlZCkgewogICAgICAgICAgICBldnQuaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgIHZhciBqc29uID0gJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyIGZvcm0jYWN0aW9uLWVkaXRvci1mb3JtJykuc2VyaWFsaXplKCkgKyAiJmFwcFR5cGU9IiArICQoIiNhcHBUeXBlIikudmFsKCkgKyAiJmV4ZUNvbmZpZ0lkPSIgKyAkKCIjZXhlQ29uZmlnSWQiKS52YWwoKTsKCiAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICB1cmw6ICcvc2lnbmFsL2FjdGlvbi91cGRhdGVBY3Rpb24nLAogICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgICBkYXRhOiBqc29uLAogICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLAogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2VkaXRfZXJyb3JzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1zZyA9ICI8ZGl2IGNsYXNzPSdhbGVydCBhbGVydC1kYW5nZXInPiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNZXNzYWdlT2JqID0gcmVzcG9uc2UuZGF0YVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSBlcnJvck1lc3NhZ2VPYmo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAnPC9icj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnICs9ICI8L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwgLm1vZGFsLWJvZHknKS5wcmVwZW5kKGVycm9yTXNnKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25fbGlzdF90YWJsZSA9ICQoJyNhY3Rpb24tdGFibGUnKS5EYXRhVGFibGUoKQogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25fbGlzdF90YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vUmVmcmVzaCB0aGUgYWN0aXZpdHkgdGFibGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuQ0FTRV9ERVRBSUwgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuRVZFTlRfREVUQUlMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWN0aXZpdGllc191dGlscy5yZWxvYWRfYWN0aXZpdHlfdGFibGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKS5tb2RhbCgnaGlkZScpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9CiAgICAvL0FkLWhvYyBhbGVydCBhY3Rpb24gbGlzdCBkYXRhCiAgICB2YXIgaW5pdF9hY3Rpb25fdGFibGUgPSBmdW5jdGlvbiAodGFibGVfaWQsIGFwcFR5cGUpIHsKCiAgICAgICAgdmFyIGRhdGFVcmwgPSAiL3NpZ25hbC9hY3Rpb24vbGlzdEJ5QWxlcnQ/YWxlcnRJZD0iICsgYWxlcnRJZCArIiZhcHBUeXBlPSIgKyBhcHBUeXBlOwogICAgICAgIGFkaG9jX3ZhbGlkYXRlZF90YWJsZSA9ICQodGFibGVfaWQpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgIC8vInNQYWdpbmF0aW9uVHlwZSI6ICJib290c3RyYXAiLAoKICAgICAgICAgICAgImxhbmd1YWdlIjogewogICAgICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZm5EcmF3Q2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICQoJy5lZGl0LWFjdGlvbi1saW5rJykuY2xpY2soZnVuY3Rpb24oZXZ0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9ICIvc2lnbmFsL2FjdGlvbi9nZXRCeUlkP2lkPSIgKyAkKHRoaXMpLmF0dHIoJ2RhdGEtaWQnKQogICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZihhcHBUeXBlID09ICJTaWduYWwgTWFuYWdlbWVudCIgfHwgYXBwVHlwZSA9PSAiVG9waWMiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdEFjdGlvbk1vZGFsID0gJCgnI2VkaXRBY3Rpb25Nb2RhbCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0RWRpdE1vZGFsVmFsdWVzKGVkaXRBY3Rpb25Nb2RhbCwgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoe30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEFjdGlvbk1vZGFsLmZpbmQoJy51cGRhdGUtYWN0aW9uJykudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25Nb2RhbElkID0gJCgiI2VkaXRBY3Rpb25Nb2RhbCAjdGVtcEZvcm0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcubWVldGluZy1kZWNpZGVyJykudmFsKCkgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9ICcvc2lnbmFsL2FjdGlvbi91cGRhdGVNZWV0aW5nQWN0aW9uJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAnL3NpZ25hbC9hY3Rpb24vdXBkYXRlQWN0aW9uJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBnZXRBY3Rpb25EZXRhaWxzKGFjdGlvbk1vZGFsSWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luYzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJfZWRpdF9zaWduYWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JNc2cgPSAiPGRpdiBjbGFzcz0nYWxlcnQgYWxlcnQtZGFuZ2VyJz4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2VPYmogPSByZXNwb25zZS5kYXRhW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cgKz0gZXJyb3JNZXNzYWdlT2JqOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAnPC9icj4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1zZyArPSAiPC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjZWRpdEFjdGlvbk1vZGFsIC5tb2RhbC1ib2R5JykucHJlcGVuZChlcnJvck1zZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi10YWJsZScpLkRhdGFUYWJsZSgpLmFqYXgucmVsb2FkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI21lZXRpbmctdGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1JlZnJlc2ggdGhlIGFjdGl2aXR5IHRhYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGFwcGxpY2F0aW9uTGFiZWwgIT0gJ3VuZGVmaW5lZCcgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuQ0FTRV9ERVRBSUwgJiYgYXBwbGljYXRpb25MYWJlbCAhPT0gQVBQTElDQVRJT05fTEFCRUwuRVZFTlRfREVUQUlMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5hY3Rpdml0aWVzX3V0aWxzLnJlbG9hZF9hY3Rpdml0eV90YWJsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0QWN0aW9uTW9kYWwubW9kYWwoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWN0aW9uX3R5cGVzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMudHlwZXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvbl9jb25maWdzID0gYWN0aW9uX3NlbGVjdF92YWx1ZXMuY29uZmlnczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWxsX3N0YXR1cyA9IGFjdGlvbl9zZWxlY3RfdmFsdWVzLmFsbFN0YXR1czsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWxlcnRJZCA9IGFsZXJ0SWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFjdGlvblN0YXR1cyA9IHtuYW1lOiBkYXRhLmFjdGlvblN0YXR1c307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbF9jb250ZW50ID0gc2lnbmFsLnV0aWxzLnJlbmRlcignYWN0aW9uX2VkaXRvcicsIGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbl9lZGl0b3IgPSAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9lZGl0b3IuaHRtbChodG1sX2NvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGlvbi1lZGl0b3ItY29udGFpbmVyICNkdWUtZGF0ZS1waWNrZXInKS5kYXRlcGlja2VyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBkYXRhLmR1ZURhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9tZW50Q29uZmlnOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1bHR1cmU6IHVzZXJMb2NhbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR6OiB1c2VyVGltZVpvbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogREVGQVVMVF9EQVRFX0RJU1BMQVlfRk9STUFUCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkua2V5ZG93bihwcmV2ZW50RW50ZXJLZXlTdWJtaXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uX2VkaXRvci5maW5kKCcjZHVlLWRhdGUtcGlja2VyJykuZmluZCgnI2R1ZURhdGUnKS52YWwoZGF0YS5kdWVEYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbl9lZGl0b3IuZmluZCgnI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlZGl0QWN0aW9uTW9kYWwgPSAkKCcjYWN0aW9uLWVkaXQtbW9kYWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5maW5kKCcuaWQtZWxlbWVudCcpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRBY3Rpb25Nb2RhbC5tb2RhbCh7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjYWN0aW9uLWVkaXRvci1jb250YWluZXInKS5maW5kKCcjYXBwVHlwZScpLnZhbChhcHBUeXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjY2FuY2VsLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfY2FuY2VsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNhY3Rpb24tZWRpdC1tb2RhbCAjdXBkYXRlLWJ0JykuY2xpY2soaGFuZGxlX2FjdGlvbl9lZGl0b3JfdXBkYXRlKQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CiAgICAgICAgICAgICAgICAkKCcuYWN0aW9uLWNyZWF0ZScpLmF0dHIoJ2RhdGEtaWQnLCBhbGVydElkKQogICAgICAgICAgICAgICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMuc2V0X2FjdGlvbl9jcmVhdGVfbW9kYWwoKQogICAgICAgICAgICAgICAgJCgnI2R1ZS1kYXRlLXBpY2tlcicpLmRhdGVwaWNrZXIoKQogICAgICAgICAgICB9LAogICAgICAgICAgICAiYWpheCI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiBkYXRhVXJsLAogICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLAogICAgICAgICAgICAgICAgZGF0YVNyYzogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2VhcmNoaW5nOiB0cnVlLAogICAgICAgICAgICBkb206ICdCZnJ0aXAnLAogICAgICAgICAgICBidXR0b25zOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ05ldyBBY3Rpb24nLAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2J0bi1wcmltYXJ5IGFjdGlvbi1jcmVhdGUnLAogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCBlLCBkdCwgbm9kZSwgY29uZmlnICkgewogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgYWFTb3J0aW5nOiBbWzAsICJkZXNjIl1dLAogICAgICAgICAgICAiYkxlbmd0aENoYW5nZSI6IHRydWUsCiAgICAgICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDEwLAogICAgICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyMCwgNTAsIC0xXSwgWzEwLCAyMCwgNTAsICJBbGwiXV0sCiAgICAgICAgICAgICJhb0NvbHVtbnMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImlkIiwKICAgICAgICAgICAgICAgICAgICBtUmVuZGVyOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI8YSBocmVmPScjJyBjbGFzcz0nZWRpdC1hY3Rpb24tbGluaycgZGF0YS1pZD0nIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cuaWQgKyAiJz4iICsgcm93LmlkICsgIjxhPiIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAiIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAidHlwZSIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCc+IiArIGVzY2FwZUhUTUwocm93LnR5cGUpICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbmZpZyIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCc+IiArIGVzY2FwZUhUTUwocm93LmNvbmZpZykgKyAiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiZGV0YWlscyIsCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCc+IiArIGVzY2FwZUhUTUwocm93LmRldGFpbHMpICsgIjwvc3Bhbj4iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImR1ZURhdGUiLAogICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShyb3cuYWN0aW9uU3RhdHVzID09PSAnQ2xvc2VkJyAmJiByb3cuYWN0aW9uU3RhdHVzID09PSAnRGVsZXRlZCcpICYmIHJvdy5wYXNzRHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxkaXYgY2xhc3M9J2Nsb3NlZCc+IiArIHJvdy5kdWVEYXRlICsgIjwvZGl2PiIKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPGRpdj4iICsgcm93LmR1ZURhdGUgKyAiPC9kaXY+IgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibURhdGEiOiAiYXNzaWduZWRUbyIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlc2NhcGVIVE1MKHJvdy5hc3NpZ25lZFRvKQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJjb2wtbWluLTE1MCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogIiIsCiAgICAgICAgICAgICAgICAgICAgbVJlbmRlcjogZnVuY3Rpb24oZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3cuYWN0aW9uU3RhdHVzCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogIiIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm1EYXRhIjogImNvbXBsZXRlZERhdGUiLAogICAgICAgICAgICAgICAgICAgIG1SZW5kZXI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUscm93KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5jb21wbGV0ZWREYXRlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImNvbC1taW4tMTUwIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICBzY3JvbGxYIDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGFkaG9jX3ZhbGlkYXRlZF90YWJsZS5idXR0b24oKS5kaXNhYmxlKCk7CiAgICAgICAgcmV0dXJuIGFkaG9jX3ZhbGlkYXRlZF90YWJsZQogICAgfTsKCiAgICB2YXIgYnVpbGRfYWN0aW9uX3JlbmRlciA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICB2YXIgYWN0aW9uX2Ryb3BfZG93bl9odG1sID0gc2lnbmFsLnV0aWxzLnJlbmRlcigiYWN0aW9uX2Ryb3BfZG93biIsIGRhdGEpOwogICAgICAgIHJldHVybiBhY3Rpb25fZHJvcF9kb3duX2h0bWwKICAgIH07CiAgICB2YXIgcmVsb2FkX2FjdGlvbl90YWJsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodHlwZW9mIGFkaG9jX3ZhbGlkYXRlZF90YWJsZSAhPSAidW5kZWZpbmVkIiAmJiBhZGhvY192YWxpZGF0ZWRfdGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICBhZGhvY192YWxpZGF0ZWRfdGFibGUuYWpheC5yZWxvYWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIHJlbG9hZCB0aGUgYWN0aXZpdHkgdGFibGUuIFBsZWFzZSByZWZyZXNoIHRoZSBwYWdlLiIpCiAgICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gewogICAgICAgIHNldF9hY3Rpb25fbGlzdF9tb2RhbDogc2V0X2FjdGlvbl9saXN0X21vZGFsLAogICAgICAgIHNldF9hY3Rpb25fY3JlYXRlX21vZGFsOiBzZXRfYWN0aW9uX2NyZWF0ZV9tb2RhbCwKICAgICAgICBidWlsZF9hY3Rpb25fcmVuZGVyOiBidWlsZF9hY3Rpb25fcmVuZGVyLAogICAgICAgIGluaXRfYWN0aW9uX3RhYmxlOiBpbml0X2FjdGlvbl90YWJsZSwKICAgICAgICByZWxvYWRfYWN0aW9uX3RhYmxlIDogcmVsb2FkX2FjdGlvbl90YWJsZSwKICAgICAgICBoYW5kbGVfYWN0aW9uX2VkaXRvcl9jYW5jZWw6IGhhbmRsZV9hY3Rpb25fZWRpdG9yX2NhbmNlbCwKICAgICAgICBoYW5kbGVfYWN0aW9uX2VkaXRvcl91cGRhdGU6IGhhbmRsZV9hY3Rpb25fZWRpdG9yX3VwZGF0ZSwKICAgICAgICBjbGVhcl9lZGl0X2Vycm9yczogY2xlYXJfZWRpdF9lcnJvcnMKICAgIH0KfSkoKTsKCnZhciBzaWduYWwgPSBzaWduYWwgfHwge30KCnNpZ25hbC5hY3Rpdml0aWVzX3V0aWxzID0gKGZ1bmN0aW9uKCkgewogICAgdmFyIGFjdGl2aXR5X3RhYmxlOwogICAgdmFyIHNvcnRpbmdDb3VudCA9IDM7CgogICAgdmFyIGluaXRfYWN0aXZpdGllc190YWJsZSA9IGZ1bmN0aW9uKHRhYmxlLCB1cmwsIGFwcFR5cGUpIHsKICAgICAgICB2YXIgY29sdW1ucyA9IGNyZWF0ZV9hY3Rpdml0eV9jb2x1bW5fZGF0YShhcHBUeXBlKTsKICAgICAgICBhY3Rpdml0eV90YWJsZSA9ICQodGFibGUpLkRhdGFUYWJsZSh7CiAgICAgICAgICAgICJzUGFnaW5hdGlvblR5cGUiOiAiYm9vdHN0cmFwIiwKCiAgICAgICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgICAgICJ1cmwiOiAiLi4vYXNzZXRzL2kxOG4vZGF0YVRhYmxlc18iICsgdXNlckxvY2FsZSArICIuanNvbiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgICAgICB9LAogICAgICAgICAgICBmbkRyYXdDYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJCgnYVtocmVmPSIjYWN0aXZpdGllcyJdJykub24oInNob3duLmJzLnRhYiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnI2FjdGl2aXRpZXNUYWJsZScpLkRhdGFUYWJsZSgpLmFqYXgudXJsKGdldEFjdGl2aXR5VXJsKCkpLmxvYWQoKTsKICAgICAgICAgICAgICAgICAgICBhZGRHcmlkU2hvcnRjdXRzKCcjYWN0aXZpdGllc1RhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlR3JpZFNob3J0Y3V0cygnI2FsZXJ0c0RldGFpbHNUYWJsZScpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUdyaWRTaG9ydGN1dHMoJyNhcmNoaXZlZEFsZXJ0c1RhYmxlJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgImFhU29ydGluZyI6IFtbc29ydGluZ0NvdW50LCAiZGVzYyJdXSwKICAgICAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICAgICAiaURpc3BsYXlMZW5ndGgiOiAxMCwKICAgICAgICAgICAgImJBdXRvV2lkdGgiOiBmYWxzZSwKICAgICAgICAgICAgImFvQ29sdW1ucyI6IGNvbHVtbnMsCiAgICAgICAgICAgICJzY3JvbGxYIjogdHJ1ZSwKICAgICAgICAgICAgInNjcm9sbFkiOiJjYWxjKDEwMHZoIC0gMzAxcHgpIiwKICAgICAgICAgICAgImF1dG9XaWR0aCI6dHJ1ZSwKICAgICAgICAgICAgY29sdW1uRGVmczogW3sKICAgICAgICAgICAgICAgICJ0YXJnZXRzIjogJ19hbGwnLAogICAgICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICAgICAgfV0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gYWN0aXZpdHlfdGFibGU7CiAgICB9OwoKICAgIHZhciBjcmVhdGVfYWN0aXZpdHlfY29sdW1uX2RhdGEgPSBmdW5jdGlvbihhcHBUeXBlKSB7CiAgICAgICAgdmFyIGFvQ29sdW1ucyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInR5cGUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbihkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICBpZihyb3cudHlwZT09J1BFQ0Rpc3NvY2lhdGVkJyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUEVDIERpc3NvY2lhdGVkJwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihyb3cudHlwZT09J1BFQ0Fzc29jaWF0ZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnUEVDIEFzc29jaWF0ZWQnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMuYnJlYWtJdChyb3cudHlwZSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZGV0YWlscyIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJvdy5kZXRhaWxzID0gcm93LmRldGFpbHMucmVwbGFjZSgvPGJyPi9nLCdcbicpCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5qdXN0aWZpY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiPHNwYW4gY2xhc3M9J3dvcmQtd3JhcC1icmVhay13b3JkJz4iK2VzY2FwZUhUTUwocm93LmRldGFpbHMpICsgIiAtLSB3aXRoIEp1c3RpZmljYXRpb24gJyIgKyBlc2NhcGVIVE1MKHJvdy5qdXN0aWZpY2F0aW9uKSArICInIisiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlc2NyaXB0aW9uVGV4dCA9IHByb2Nlc3NfZGVzY3JpcHRpb24ocm93LmRldGFpbHMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPSd3b3JkLXdyYXAtYnJlYWstd29yZCBjZWxsLWJyZWFrJz4iK2Rlc2NyaXB0aW9uVGV4dCsiPC9zcGFuPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0yMDAgY29sLW1heC0zMDAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwZXJmb3JtZWRCeSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICBpZihyb3cucGVyZm9ybWVkQnlEZXB0ICYmIHJvdy5wZXJmb3JtZWRCeURlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwocm93LnBlcmZvcm1lZEJ5ICsgIiAoIiArIHJvdy5wZXJmb3JtZWRCeURlcHQgKyAiKSIpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm93LnBlcmZvcm1lZEJ5CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aW1lc3RhbXAiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbihkYXRhLCB0eXBlLCBmdWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfQogICAgICAgIF07CiAgICAgICAgaWYoYXBwVHlwZSA9PSAnU2luZ2xlIENhc2UgQWxlcnQnKSB7CiAgICAgICAgICAgIGFvQ29sdW1ucy5zcGxpY2UoMCwwLHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJjYXNlTnVtYmVyIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDIsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3VzcGVjdCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMjAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgzLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImV2ZW50TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg1LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImN1cnJlbnRBc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyQXNzaWdubWVudAogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICYmIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSByb3cuY3VycmVudEFzc2lnbm1lbnQgKyAiICgiICsgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCArICIpIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gKHJvdy5jdXJyZW50QXNzaWdubWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwoY3VyckFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvcnRpbmdDb3VudCA9IDcKICAgICAgICB9ZWxzZSBpZihhcHBUeXBlID09ICdMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCcpIHsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgwLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImFydGljbGVJZCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgyLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInNlYXJjaFN0cmluZyIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTAwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgzLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogInByb2R1Y3ROYW1lIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0yMDAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDQsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZXZlbnROYW1lIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDYsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY3VycmVudEFzc2lnbm1lbnQiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJBc3NpZ25tZW50CiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgJiYgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCAhPSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyQXNzaWdubWVudCA9IHJvdy5jdXJyZW50QXNzaWdubWVudCArICIgKCIgKyByb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICsgIikiCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSAocm93LmN1cnJlbnRBc3NpZ25tZW50KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXNjYXBlSFRNTChjdXJyQXNzaWdubWVudCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc29ydGluZ0NvdW50ID0gOAogICAgICAgIH0gZWxzZSBpZiAoYXBwVHlwZSA9PSAnQWdncmVnYXRlIENhc2UgQWxlcnQnIHx8IGFwcFR5cGUgPT0gJ0VWREFTIEFsZXJ0JykgewogICAgICAgICAgICBhb0NvbHVtbnMuc3BsaWNlKDEsMCx7CiAgICAgICAgICAgICAgICAibURhdGEiOiAic3VzcGVjdCIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSgyLDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImV2ZW50TmFtZSIsCiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ2NvbC1taW4tMTUwJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYW9Db2x1bW5zLnNwbGljZSg0LDAsewogICAgICAgICAgICAgICAgIm1EYXRhIjogImN1cnJlbnRBc3NpZ25tZW50IiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjdXJyQXNzaWdubWVudAogICAgICAgICAgICAgICAgICAgIGlmIChyb3cuY3VycmVudEFzc2lnbm1lbnREZXB0ICYmIHJvdy5jdXJyZW50QXNzaWdubWVudERlcHQgIT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VyckFzc2lnbm1lbnQgPSByb3cuY3VycmVudEFzc2lnbm1lbnQgKyAiICgiICsgcm93LmN1cnJlbnRBc3NpZ25tZW50RGVwdCArICIpIgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJBc3NpZ25tZW50ID0gKHJvdy5jdXJyZW50QXNzaWdubWVudCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVzY2FwZUhUTUwoY3VyckFzc2lnbm1lbnQpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCcKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNvcnRpbmdDb3VudCA9IDYKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFvQ29sdW1ucwogICAgfTsKCiAgICB2YXIgcmVsb2FkX2FjdGl2aXR5X3RhYmxlID0gZnVuY3Rpb24oKSB7CgogICAgICAgIGlmICh0eXBlb2YgYWN0aXZpdHlfdGFibGUgIT0gInVuZGVmaW5lZCIgJiYgYWN0aXZpdHlfdGFibGUgIT0gbnVsbCkgewogICAgICAgICAgICBhY3Rpdml0eV90YWJsZS5hamF4LnJlbG9hZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJVbmFibGUgdG8gcmVsb2FkIHRoZSBhY3Rpdml0eSB0YWJsZS4gUGxlYXNlIHJlZnJlc2ggdGhlIHBhZ2UuIikKICAgICAgICB9CgogICAgfTsKCiAgICB2YXIgcHJvY2Vzc19kZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKGRlc2NyaXB0aW9uU3RyKSB7CiAgICAgICAgaWYgKHR5cGVvZiBkZXNjcmlwdGlvblN0ciAhPSAidW5kZWZpbmVkIiAmJiBkZXNjcmlwdGlvblN0ciAhPSBudWxsKSB7CiAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbnMgPSBkZXNjcmlwdGlvblN0ci5zcGxpdCgnfCcpOwogICAgICAgICAgICAvL3ZhciBmb3JtYXR0ZWRTdHJpbmcgPSAnJwogICAgICAgICAgICB2YXIgZm9ybWF0dGVkU3RyaW5nID0gIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4PGRlc2NyaXB0aW9ucy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uc1tpbmRleF07CiAgICAgICAgICAgICAgICB2YXIgZGVzY1NwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICBkZXNjU3Bhbi5pbm5lckhUTUwgPSBlc2NhcGVIVE1MKGRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgICAgIGRlc2NTcGFuLmlubmVySFRNTCA9IGRlc2NTcGFuLmlubmVySFRNTC5yZXBsYWNlKC9cbi9nLCAnPGJyPicpCiAgICAgICAgICAgICAgICBmb3JtYXR0ZWRTdHJpbmcuYXBwZW5kQ2hpbGQoZGVzY1NwYW4pOwogICAgICAgICAgICAgICAgZm9ybWF0dGVkU3RyaW5nLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRTdHJpbmcuaW5uZXJIVE1MOwogICAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgICBpbml0X2FjdGl2aXRpZXNfdGFibGUgOiBpbml0X2FjdGl2aXRpZXNfdGFibGUsCiAgICAgICAgcHJvY2Vzc19kZXNjcmlwdGlvbiA6IHByb2Nlc3NfZGVzY3JpcHRpb24sCiAgICAgICAgcmVsb2FkX2FjdGl2aXR5X3RhYmxlIDogcmVsb2FkX2FjdGl2aXR5X3RhYmxlCiAgICB9Cn0pKCk7CgpmdW5jdGlvbiBnZXRBY3Rpdml0eVVybCgpIHsKICAgIGlmIChhcHBsaWNhdGlvbk5hbWUgPT09IEFMRVJUX0NPTkZJR19UWVBFLkxJVEVSQVRVUkVfU0VBUkNIX0FMRVJUKSB7CiAgICAgICAgcmV0dXJuIGFsZXJ0QWN0aXZpdGllczsKICAgIH0gZWxzZSBpZiAoYXBwbGljYXRpb25OYW1lID09PSBBTEVSVF9DT05GSUdfVFlQRS5TSUdOQUxfTUFOQUdFTUVOVCkgewogICAgICAgIHJldHVybiBhY3Rpdml0eVVybDsKICAgIH0KICAgIHJldHVybiBhbGVydEFjdGl2aXRpZXNVcmwgKyAnP2V4ZWN1dGVkSWRMaXN0PScgKyBleGVjdXRlZElkTGlzdCArICImYXBwVHlwZT0iICsgYXBwbGljYXRpb25OYW1lCgp9CgoKdmFyIHNpZ25hbCA9IHNpZ25hbCB8fCB7fTsKdmFyIGV4aXN0aW5nUm93cyA9IFtdOwoKc2lnbmFsLmNvbW1vblRhZyA9IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgb3BlbkNvbW1vbkFsZXJ0VGFnTW9kYWwgPSBmdW5jdGlvbiAobW9kdWxlLCBkb21haW4sIHRhZ3MpIHsKICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmVkaXRBbGVydFRhZ3MnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgIHZhciBwYXJlbnRfcm93ID0gJChldmVudC50YXJnZXQpLmNsb3Nlc3QoJ3RyJyk7CiAgICAgICAgICAgIHZhciBpbmRleCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5pbmRleCgpOwogICAgICAgICAgICB2YXIgcm93T2JqZWN0ID0gdGFibGUucm93cyhpbmRleCkuZGF0YSgpWzBdOwogICAgICAgICAgICB2YXIgYWxlcnRJZCA9IHJvd09iamVjdC5pZDsKICAgICAgICAgICAgdmFyIGNvbW1vblRhZ01vZGFsT2JqID0gJCgnI2NvbW1vblRhZ01vZGFsJyk7CiAgICAgICAgICAgIGZpbGxBbGVydFRhZ3MoY29tbW9uVGFnTW9kYWxPYmosIGZpbGxDb21tb25UYWdVcmwsIG1vZHVsZSwgZG9tYWluLCB0YWdzLCBhbGVydElkKTsKICAgICAgICAgICAgY29tbW9uVGFnTW9kYWxPYmoubW9kYWwoJ3Nob3cnKTsKICAgICAgICB9KTsKICAgIH07CiAgICByZXR1cm4gewogICAgICAgIG9wZW5Db21tb25BbGVydFRhZ01vZGFsOiBvcGVuQ29tbW9uQWxlcnRUYWdNb2RhbAogICAgfQp9KSgpOwoKdmFyIGZpbGxBbGVydFRhZ3MgPSBmdW5jdGlvbiAodGFnTW9kYWwsIGZpbGxDb21tb25UYWdVcmwsIG1vZHVsZSwgZG9tYWluLCB0YWdzLCBhbGVydElkKSB7CiAgICB2YXIgZGF0YVVybCA9IGZpbGxDb21tb25UYWdVcmwgKyAiLyIrbW9kdWxlKyI/ZG9tYWluPSIrZG9tYWluICsgIiZhbGVydElkPSIrYWxlcnRJZDsKICAgIGNhdGVnb3J5TW9kYWxUYWJsZSA9ICQoIiNjYXRlZ29yeU1vZGFsVGFibGUiKS5EYXRhVGFibGUoewogICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgIH0sCiAgICAgICAgImNyZWF0ZWRSb3ciOiBmdW5jdGlvbiAoIHJvdywgZGF0YSwgaW5kZXggKSB7CiAgICAgICAgICAgIHZhciB0YWdzRW5hYmxlZCA9IG5vbkNvbmZpZ3VyZWRFbmFibGVkICE9ICJ0cnVlIiA/IGZhbHNlIDogdHJ1ZTsKICAgICAgICAgICAgdmFyIGNhdGVnb3JpZXMgPSBbXTsKICAgICAgICAgICAgdGFncy5mb3JFYWNoKGZ1bmN0aW9uIChtYXApIHsKICAgICAgICAgICAgICAgIGlmKG1hcC5wYXJlbnRJZCA9PTAgfHwgbWFwLnBhcmVudElkID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWVzLnB1c2goe2lkOiBtYXAuaWQsIHRleHQ6IG1hcC50ZXh0fSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCdzZWxlY3QnLCByb3cpLmVxKDApLnNlbGVjdDIoewogICAgICAgICAgICAgICAgdGFnczogdGFnc0VuYWJsZWQsCiAgICAgICAgICAgICAgICBkYXRhOiBjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICJTZWxlY3QgQ2F0ZWdvcnkiCiAgICAgICAgICAgIH0pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihvYmopIHsKCiAgICAgICAgICAgICAgICB2YXIgc3VidGFnc0VuYWJsZWQgPSBub25Db25maWd1cmVkRW5hYmxlZCAhPSAidHJ1ZSIgPyBmYWxzZSA6IHRydWU7CiAgICAgICAgICAgICAgICB2YXIgc3ViY2F0ZWdvcmllcyA9IFtdOwogICAgICAgICAgICAgICAgdGFncy5mb3JFYWNoKGZ1bmN0aW9uIChtYXApIHsKICAgICAgICAgICAgICAgICAgICBpZihtYXAucGFyZW50SWQgPT0gb2JqLmN1cnJlbnRUYXJnZXQudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViY2F0ZWdvcmllcy5wdXNoKHtpZDogbWFwLmlkLCB0ZXh0OiBtYXAudGV4dH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmKGRhdGEuYWN0aW9uID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAkKCdzZWxlY3QnLCByb3cpLmVxKDEpLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gaWYgbm8gc3ViY2F0ZWdvcnkgY29uZmlndXJlIHRoZW4gY2FuIG5vdCBhZGQgb24gZmx5IHN1YmNhdGVnb3J5CiAgICAgICAgICAgICAgICBpZihzdWJjYXRlZ29yaWVzLmxlbmd0aCA8PSAwKXsKICAgICAgICAgICAgICAgICAgICBzdWJ0YWdzRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgc3VidGFnc0VuYWJsZWQgPSAoc3VidGFnc0VuYWJsZWQgJiYgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJCgnc2VsZWN0Jywgcm93KS5lcSgxKS5zZWxlY3QyKHsKICAgICAgICAgICAgICAgICAgICB0YWdzOiBzdWJ0YWdzRW5hYmxlZCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBzdWJjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAiU2VsZWN0IFN1YiBDYXRlZ29yeSIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KS50cmlnZ2VyKCdjaGFuZ2UnKTsKCiAgICAgICAgICAgIGlmKGRhdGEuYWN0aW9uICE9IDEpIHsKICAgICAgICAgICAgICAgICQoJ2lucHV0Jywgcm93KS5jbG9zZXN0KCd0cicpLmZpbmQoIjppbnB1dCIpLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZihkYXRhLnN1YmNhdGVnb3J5Lmxlbmd0aCA8PSAwKQogICAgICAgICAgICAgICAgICAgICQoJ2lucHV0Jywgcm93KS5jbG9zZXN0KCd0cicpLmZpbmQoIjppbnB1dFtjbGFzcz1zZWxlY3QyLXNlYXJjaF9fZmllbGRdIikuYXR0cigicGxhY2Vob2xkZXIiLCAiIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICQoIi5lZGl0LXJvdyIsIHJvdykudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciBpc0Rpc2FibGVkID0gJCh0aGlzKS5jbG9zZXN0KCd0cicpLmZpbmQoIjppbnB1dDpub3QoOmZpcnN0KSIpLmF0dHIoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuZmluZCgiOmlucHV0Om5vdCg6Zmlyc3QpIikuYXR0cignZGlzYWJsZWQnLCAhaXNEaXNhYmxlZCk7CiAgICAgICAgICAgICAgICBpZihpc0Rpc2FibGVkICYmIGRhdGEuc3ViY2F0ZWdvcnkubGVuZ3RoIDw9IDApCiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCd0cicpLmZpbmQoIjppbnB1dFtjbGFzcz1zZWxlY3QyLXNlYXJjaF9fZmllbGRdIikuYXR0cigicGxhY2Vob2xkZXIiLCAiU2VsZWN0IFN1YiBDYXRlZ29yeSIpOwogICAgICAgICAgICAgICAgZWxzZSBpZihpc0Rpc2FibGVkICYmIGRhdGEuc3ViY2F0ZWdvcnkubGVuZ3RoID4gMCkKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuZmluZCgiOmlucHV0W2NsYXNzPXNlbGVjdDItc2VhcmNoX19maWVsZF0iKS5hdHRyKCJwbGFjZWhvbGRlciIsICIiKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYoIWlzRGlzYWJsZWQgJiYgZGF0YS5zdWJjYXRlZ29yeS5sZW5ndGggPD0gMCkKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuZmluZCgiOmlucHV0W2NsYXNzPXNlbGVjdDItc2VhcmNoX19maWVsZF0iKS5hdHRyKCJwbGFjZWhvbGRlciIsICIiKTsKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJCgiLmRlbGV0ZS1yb3ciLCByb3cpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBjYXRlZ29yeU1vZGFsVGFibGUKICAgICAgICAgICAgICAgICAgICAucm93KCAkKHRoaXMpLnBhcmVudHMoJ3RyJykgKQogICAgICAgICAgICAgICAgICAgIC5yZW1vdmUoKQogICAgICAgICAgICAgICAgICAgIC5kcmF3KCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJCgiLnVwLXJvdyIsIHJvdykudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGNvbnN0ICRyb3cgPSAkKHRoaXMpLnBhcmVudHMoJ3RyJyk7CiAgICAgICAgICAgICAgICBpZiAoJHJvdy5pbmRleCgpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHJvdy5wcmV2KCkuYmVmb3JlKCRyb3cuZ2V0KDApKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkKCIuZG93bi1yb3ciLCByb3cpLnVuYmluZCgpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBjb25zdCAkcm93ID0gJCh0aGlzKS5wYXJlbnRzKCd0cicpOwogICAgICAgICAgICAgICAgJHJvdy5uZXh0KCkuYWZ0ZXIoJHJvdy5nZXQoMCkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfSwKICAgICAgICByb3dDYWxsYmFjazogZnVuY3Rpb24oIHJvdywgZGF0YSwgaW5kZXggKSB7CiAgICAgICAgICAgIGlmIChkYXRhWydwcml2YXRlJ10gPT0gdHJ1ZSAmJiBkYXRhWydwcml2YXRlQWNjZXNzJ10gIT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgJChyb3cpLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgaW5pdENvbXBsZXRlOiBmdW5jdGlvbihzZXR0aW5ncywganNvbil7CiAgICAgICAgICAgIGV4aXN0aW5nUm93cyA9IFtdOwogICAgICAgICAgICBjYXRlZ29yeU1vZGFsVGFibGUucm93cygpLmV2ZXJ5KGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KXsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZGF0YSgpOwogICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3cgPSB7Y2F0ZWdvcnk6IHZhbHVlLmNhdGVnb3J5LCBzdWJjYXRlZ29yeTogdmFsdWUuc3ViY2F0ZWdvcnksIGFsZXJ0OiB2YWx1ZS5hbGVydCwgcHJpdmF0ZTogdmFsdWUucHJpdmF0ZSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQnk6IHZhbHVlLmNyZWF0ZWRCeSwgY3JlYXRlZERhdGU6IHZhbHVlLmNyZWF0ZWREYXRlLCBwcmlvcml0eTogdmFsdWUucHJpb3JpdHksIHVwZGF0ZWREYXRlSW5pdDogdmFsdWUudXBkYXRlZERhdGVJbml0LAogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRCeUluaXQ6IHZhbHVlLnVwZGF0ZWRCeUluaXR9OwogICAgICAgICAgICAgICAgaWYoY3VycmVudFJvdy5jYXRlZ29yeS5pZCAhPSAwKQogICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nUm93cy5wdXNoKGN1cnJlbnRSb3cpOwogICAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgICJhamF4IjogewogICAgICAgICAgICAidXJsIjogZGF0YVVybCwKICAgICAgICAgICAgImRhdGFTcmMiOiAiIgogICAgICAgIH0sCiAgICAgICAgc2VhcmNoaW5nOiB0cnVlLAogICAgICAgICJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKICAgICAgICAicGFnaW5nIjogICBmYWxzZSwKICAgICAgICAib3JkZXJpbmciOiBmYWxzZSwKICAgICAgICAic2VhcmNoaW5nIjogZmFsc2UsCiAgICAgICAgImluZm8iOiBmYWxzZSwKICAgICAgICAiYkRlc3Ryb3kiOiB0cnVlLAogICAgICAgIHN0YXRlU2F2ZTogdHJ1ZSwKICAgICAgICAic2Nyb2xsWSI6ICAgICAgICAiMzUwcHgiLAogICAgICAgICJzY3JvbGxDb2xsYXBzZSI6IHRydWUsCiAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImNhdGVnb3J5IiwKICAgICAgICAgICAgICAgICJ3aWR0aCI6ICIyNSUiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdC1jZW50ZXInLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPHNlbGVjdCBuYW1lPSJzZWxlY3RGaWVsZCIgaWQ9ImR5bmFtaWNTZWxlY3RGaWVsZENhdGVnb3J5IiBjbGFzcz0iZHluYW1pY1NlbGVjdEZpZWxkQ2F0ZWdvcnkgZm9ybS1jb250cm9sIj4nOwogICAgICAgICAgICAgICAgICAgIGlmKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiBzZWxlY3RlZD0ic2VsZWN0ZWQiIHZhbHVlPSInICsgZGF0YS5pZCArICciPicgKyBkYXRhLm5hbWUgKyAnPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPC9zZWxlY3Q+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaHRtbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInN1YmNhdGVnb3J5IiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnZHQtY2VudGVyJywKICAgICAgICAgICAgICAgICJ3aWR0aCI6ICIzNSUiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CgogICAgICAgICAgICAgICAgICAgIHZhciBodG1sID0gJzxzZWxlY3QgbmFtZT0ic2VsZWN0RmllbGQiIGlkPSJkeW5hbWljU2VsZWN0RmllbGRTdWJDYXRlZ29yeSIgbXVsdGlwbGU9Im11bHRpcGxlIiBjbGFzcz0iZHluYW1pY1NlbGVjdEZpZWxkU3ViQ2F0ZWdvcnkgZm9ybS1jb250cm9sIj4nOwogICAgICAgICAgICAgICAgICAgIHJvdy5zdWJjYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnPG9wdGlvbiBzZWxlY3RlZD0ic2VsZWN0ZWQiIHZhbHVlPSInK29iai5pZCsnIj4nK29iai5uYW1lKyc8L29wdGlvbj4nOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGh0bWwgKz0gJzwvc2VsZWN0Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGh0bWwKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydCIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogImp1c3RpZmljYXRpb24tY2VsbCBkYXRhVGFibGVDb2x1bW5DZW50ZXIgdGV4dC1jZW50ZXIiLAogICAgICAgICAgICAgICAgIndpZHRoIjogIjE1JSIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZCA9IHJvdy5hbGVydCA9PSB0cnVlID8gImNoZWNrZWQiOiAiIjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImFsZXJ0LWNoZWNrLWJveCIgJyArIGNoZWNrZWQgKycgZGF0YS1pZD0nICsgcm93LmFsZXJ0ICsgJyAvPic7CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicHJpdmF0ZSIsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiMTIlIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjaGVja2VkID0gcm93LnByaXZhdGUgPT0gdHJ1ZSA/ICJjaGVja2VkIjogIiI7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJwcml2YXRlLWNoZWNrLWJveCIgJyArIGNoZWNrZWQgICsnIGRhdGEtaWQ9JyArIHJvdy5wcml2YXRlICsgJyAvPic7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdkdC1jZW50ZXIgZGF0YVRhYmxlQ29sdW1uQ2VudGVyIHRleHQtY2VudGVyJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYWN0aW9uIiwKICAgICAgICAgICAgICAgICJ3aWR0aCI6ICIxMyUiLAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICJ0ZC1hY3Rpb24iLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YSA9PT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGkgY2xhc3M9ImZhIGZhLXRyYXNoLW8gZGVsZXRlLXJvdyB0YWctYWN0aW9uIGJsdWUtMSI+PC9pPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRldGFpbHMgPSAnPGI+Q3JlYXRlZCBCeTo8L2I+ICcrcm93LmNyZWF0ZWRCeSArJzxoci8+IDxiPkNyZWF0ZWQgRGF0ZTo8L2I+ICcrcm93LmNyZWF0ZWREYXRlICsnPGhyLz4gPGI+TGFzdCBNb2RpZmllZCBCeTo8L2I+ICcrcm93LnVwZGF0ZWRCeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyc8aHIvPiA8Yj5MYXN0IE1vZGlmaWVkIERhdGU6PC9iPiAnK3Jvdy51cGRhdGVkRGF0ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8aSBpZD0idGFnLXBvcHVwIiBjbGFzcz0iZmEgZmEtaW5mbyBwb3BvdmVyTWVzc2FnZSB0YWctYWN0aW9uIGJsdWUtMSIgdGl0bGU9IkRldGFpbHMiIGRhdGEtY29udGVudD0iJyArIGRldGFpbHMgKyAnIj48L2k+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8aSBjbGFzcz0iZmEgZmEtcGVuY2lsIGVkaXQtcm93IHRhZy1hY3Rpb24gYmx1ZS0xIiA+PC9pPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPGkgY2xhc3M9ImZhIGZhLXRyYXNoLW8gZGVsZXRlLXJvdyB0YWctYWN0aW9uIGJsdWUtMSI+PC9pPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICB9XQogICAgfSk7CiAgICAkKCAiI2NhdGVnb3J5TW9kYWxUYWJsZSIgKS5zb3J0YWJsZSh7CiAgICAgICAgaXRlbXM6ICd0cjpub3QoOmZpcnN0KScsCiAgICAgICAgY3Vyc29yOiAnbW92ZScsCiAgICAgICAgb3BhY2l0eTogMC42LAogICAgICAgIHNjcm9sbFNwZWVkOiA0MCwKICAgICAgICBjYW5jZWw6ICJ0aGVhZCIsCiAgICAgICAgY29udGFpbm1lbnQgOiAicGFyZW50IgogICAgfSk7CgogICAgaWYocHJpdmF0ZUVuYWJsZWQgIT0gInRydWUiKSB7CiAgICAgICAgY2F0ZWdvcnlNb2RhbFRhYmxlLmNvbHVtbigzKS52aXNpYmxlKGZhbHNlKTsKICAgIH1lbHNlewogICAgICAgIGNhdGVnb3J5TW9kYWxUYWJsZS5jb2x1bW4oMykudmlzaWJsZSh0cnVlKTsKICAgIH0KICAgICQoJyNjYXRlZ29yeU1vZGFsVGFibGUnKS5vbignbW91c2VvdmVyJywgJ3RyJywgZnVuY3Rpb24gKCkgewogICAgICAgICQoJy5wb3BvdmVyTWVzc2FnZScpLnBvcG92ZXIoewogICAgICAgICAgICBwbGFjZW1lbnQ6ICdsZWZ0JywKICAgICAgICAgICAgdHJpZ2dlcjogJ2hvdmVyIGZvY3VzJywKICAgICAgICAgICAgdmlld3BvcnQ6ICdib2R5JywKICAgICAgICAgICAgaHRtbDogdHJ1ZQogICAgICAgIH0pOwogICAgfSk7CgogICAgJCgiI2FkZC1yb3ciKS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxhc3RSb3cgPSBjYXRlZ29yeU1vZGFsVGFibGUucm93KCc6bGFzdCcpLmRhdGEoKTsKICAgICAgICB2YXIgbGFzdFJvd0NhdGVnb3J5ID0gJCgnI2NhdGVnb3J5TW9kYWxUYWJsZUJvZHkgdHI6bGFzdCcpLmZpbmQoInRkIHNlbGVjdC5keW5hbWljU2VsZWN0RmllbGRDYXRlZ29yeSIpLnZhbCgpOwogICAgICAgIGlmKGxhc3RSb3dDYXRlZ29yeSAhPSAwKSB7CiAgICAgICAgICAgIGNhdGVnb3J5TW9kYWxUYWJsZS5yb3cuYWRkKHsKICAgICAgICAgICAgICAgICJjYXRlZ29yeSI6IHtpZDogMCwgbmFtZTogIlNlbGVjdCBDYXRlZ29yeSJ9LAogICAgICAgICAgICAgICAgInN1YmNhdGVnb3J5IjogW10sCiAgICAgICAgICAgICAgICAiYWxlcnQiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJwcml2YXRlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiYWN0aW9uIjogMSwKICAgICAgICAgICAgICAgICJwcmlvcml0eSI6IDk5OTksCiAgICAgICAgICAgICAgICAibmV3IjogdHJ1ZQogICAgICAgICAgICB9KS5kcmF3KGZhbHNlKTsKICAgICAgICAgICAgdmFyICRzY3JvbGxCb2R5ID0gJChjYXRlZ29yeU1vZGFsVGFibGUudGFibGUoKS5ub2RlKCkpLnBhcmVudCgpOwogICAgICAgICAgICAkc2Nyb2xsQm9keS5zY3JvbGxUb3AoJHNjcm9sbEJvZHkuZ2V0KDApLnNjcm9sbEhlaWdodCk7CiAgICAgICAgfQogICAgICAgICQoJyNjYXRlZ29yeU1vZGFsVGFibGVCb2R5IHRyOmxhc3Qgc2VsZWN0JykuZXEoMCkuZm9jdXMoKTsKICAgIH0pOwoKICAgICQoIi5hZGRUYWdzIikudW5iaW5kKCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuZXdSb3dzID0gW107CiAgICAgICAgdmFyIGNvdW50ID0gMTsKICAgICAgICAkKCcjY2F0ZWdvcnlNb2RhbFRhYmxlQm9keSB0cicpLmVhY2goZnVuY3Rpb24oKXsKICAgICAgICAgICAgdmFyIHRoID0gJCh0aGlzKTsKICAgICAgICAgICAgdmFyIGNhdGVnb3J5SWQgPSAkKHRoKS5maW5kKCJ0ZCBzZWxlY3QuZHluYW1pY1NlbGVjdEZpZWxkQ2F0ZWdvcnkiKS52YWwoKTsKICAgICAgICAgICAgdmFyIGNhdGVnb3J5VGV4dCA9ICQodGgpLmZpbmQoInRkIHNlbGVjdC5keW5hbWljU2VsZWN0RmllbGRDYXRlZ29yeSBvcHRpb246c2VsZWN0ZWQiKS50ZXh0KCk7CiAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IHtpZDogY2F0ZWdvcnlJZCwgbmFtZTogY2F0ZWdvcnlUZXh0fTsKICAgICAgICAgICAgdmFyIHN1YmNhdGVnb3JpZXMgPSBbXTsKICAgICAgICAgICAgJCh0aCkuZmluZCgidGQgc2VsZWN0LmR5bmFtaWNTZWxlY3RGaWVsZFN1YkNhdGVnb3J5IG9wdGlvbjpzZWxlY3RlZCIpLmVhY2goZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHN1YmNhdGVnb3JpZXMucHVzaCh7aWQ6ICQodGhpcykudmFsKCksIG5hbWU6JCh0aGlzKS50ZXh0KCl9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBhbGVydCA9ICQodGgpLmZpbmQoInRkIGlucHV0LmFsZXJ0LWNoZWNrLWJveCIpLmlzKCI6Y2hlY2tlZCIpOwogICAgICAgICAgICB2YXIgcHJpdmF0ZSA9ICQodGgpLmZpbmQoInRkIGlucHV0LnByaXZhdGUtY2hlY2stYm94IikuaXMoIjpjaGVja2VkIik7CiAgICAgICAgICAgIHZhciBjdXJyZW50Um93ID0ge2NhdGVnb3J5OiBjYXRlZ29yeSwgc3ViY2F0ZWdvcnk6IHN1YmNhdGVnb3JpZXMsIGFsZXJ0OiBhbGVydCwgcHJpdmF0ZTogcHJpdmF0ZSwgcHJpb3JpdHk6IGNvdW50fTsKICAgICAgICAgICAgaWYoY3VycmVudFJvdy5jYXRlZ29yeS5uYW1lICE9ICdTZWxlY3QgQ2F0ZWdvcnknICYmIGN1cnJlbnRSb3cuY2F0ZWdvcnkubmFtZSAhPSAnJykgewogICAgICAgICAgICAgICAgbmV3Um93cy5wdXNoKGN1cnJlbnRSb3cpOwogICAgICAgICAgICAgICAgY291bnQgPSBjb3VudCArIDE7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGRhdGEgPSB7CiAgICAgICAgICAgIG5ld1Jvd3M6IEpTT04uc3RyaW5naWZ5KG5ld1Jvd3MpLAogICAgICAgICAgICBleGlzdGluZ1Jvd3M6IEpTT04uc3RyaW5naWZ5KGV4aXN0aW5nUm93cyksCiAgICAgICAgICAgIGFsZXJ0SWQ6IGFsZXJ0SWQsCiAgICAgICAgICAgIHR5cGU6IGRvbWFpbgogICAgICAgIH07CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiBzYXZlQ29tbW9uVGFnc1VybCwKICAgICAgICAgICAgdHlwZTogIlBPU1QiLAogICAgICAgICAgICBhc3luYzpmYWxzZSwKICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZGF0YSksCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCcsCiAgICAgICAgICAgIGRhdGFUeXBlOiAianNvbiIsCiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgICAgICAgICB0YWJsZS5hamF4LnJlbG9hZCgpCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIGNhdGVnb3J5TW9kYWxUYWJsZQp9OwoKCgoKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb24vcnhfY29tbW9uLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY2FzZURyaWxsRG93bi9jYXNlRHJpbGxEb3duCi8vPSByZXF1aXJlIGFwcC9wdnMvYWxlcnRDb21tZW50cy9hbGVydENvbW1lbnRzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2FsZXJ0X3V0aWxzCi8vPSByZXF1aXJlIGFwcC9wdnMvYWxlcnRzX3Jldmlldy9hbGVydF9yZXZpZXcKLy89IHJlcXVpcmUgYXBwL3B2cy9hY3Rpb25zL2FjdGlvbnMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9hY3Rpdml0eS9hY3Rpdml0aWVzLmpzCi8vPSByZXF1aXJlIGFwcC9wdnMvY29tbW9uL3J4X2xpc3RfdXRpbHMuanMKLy89IHJlcXVpcmUgYXBwL3B2cy9jb21tb25fdGFnLmpzCgoKREFURV9GTVRfVFogPSAiWVlZWS1NTS1ERCI7CnZhciB0YWJsZTsKdmFyIGFjdGl2aXRpZXNfdGFibGU7CnZhciBhcHBsaWNhdGlvbk5hbWUgPSAiTGl0ZXJhdHVyZSBTZWFyY2ggQWxlcnQiOwp2YXIgYXBwbGljYXRpb25MYWJlbCA9ICJMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCI7CnZhciB0YWdzID0gW107CgokKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7CiAgICBhc3NpZ25lZFRvRGF0YSA9IFtdOwogICAgdmFyIHByZWZpeCA9ICJsc2FfIjsKCiAgICAkKCJhW2RhdGEtdG9nZ2xlPVwidGFiXCJdIikub24oInNob3duLmJzLnRhYiIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLmNvbHVtbnMuYWRqdXN0KCk7CiAgICAgICAgJCgnI2FjdGl2aXRpZXNUYWJsZScpLkRhdGFUYWJsZSgpLmNvbHVtbnMuYWRqdXN0KCk7CiAgICB9KTsKICAgICQoJ2FbaHJlZj0iI2RldGFpbHMiXScpLm9uKCJzaG93bi5icy50YWIiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKS5jb2x1bW5zLmFkanVzdCgpOwogICAgICAgIGFkZEdyaWRTaG9ydGN1dHMoJyNhbGVydHNEZXRhaWxzVGFibGUnKTsKICAgICAgICByZW1vdmVHcmlkU2hvcnRjdXRzKCcjYWN0aXZpdGllc1RhYmxlJyk7CiAgICB9KTsKICAgIHZhciBnZW5BcnRpY2xlTGluayA9IGZ1bmN0aW9uIChhcnRpY2xlSWQsIHRpdGxlLCBsaXRJZCkgewogICAgICAgIHJldHVybiAnPGEgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJhcnRpY2xlVGl0bGUiIGRhdGEtYXJ0aWNsZUlkID0gIicgKyBhcnRpY2xlSWQgKyAnIiBkYXRhLWxpdElkID0gIicgKyBsaXRJZCArICciIGhyZWY9IicgKyBwdWJNZWRVcmwgKyBhcnRpY2xlSWQgKyAnIj4nICsgdGl0bGUgKyAnPC9hPic7CiAgICB9OwoKICAgICQoJyNhY3Rpdml0eV90YWInKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFhY3Rpdml0aWVzX3RhYmxlKSB7CiAgICAgICAgICAgIGFjdGl2aXRpZXNfdGFibGUgPSBzaWduYWwuYWN0aXZpdGllc191dGlscy5pbml0X2FjdGl2aXRpZXNfdGFibGUoJCgiI2FjdGl2aXRpZXNUYWJsZSIpLCBhbGVydEFjdGl2aXRpZXMsIGFwcGxpY2F0aW9uTmFtZSk7CiAgICAgICAgfQogICAgfSk7CgogICAgZmV0Y2hUYWdzKCk7CgogICAgJCh3aW5kb3cpLm9uKCdiZWZvcmV1bmxvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiBkaXNjYXJkVGVtcENoYW5nZXNVcmwsCiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcKICAgICAgICB9KQogICAgfSk7CgoKICAgIHZhciBjaGVja2VkSWRMaXN0ID0gW107CiAgICB2YXIgY2hlY2tlZFJvd0xpc3QgPSBbXTsKICAgIHNpZ25hbC5maWVsZE1hbmFnZW1lbnQucG9wdWxhdGVDb2x1bW5MaXN0KGdyaWRDb2x1bW5zVmlld1VybCwgZ3JpZENvbHVtbnNWaWV3VXBkYXRlVXJsKTsKICAgIHNpZ25hbC5hY3Rpb25zX3V0aWxzLnNldF9hY3Rpb25fY3JlYXRlX21vZGFsKCQoJyNhY3Rpb24tY3JlYXRlLW1vZGFsJykpOwogICAgc2lnbmFsLmFjdGlvbnNfdXRpbHMuc2V0X2FjdGlvbl9saXN0X21vZGFsKCQoJyNhY3Rpb24tbW9kYWwnKSk7CiAgICBzaWduYWwuY29tbW9uVGFnLm9wZW5Db21tb25BbGVydFRhZ01vZGFsKCJQVlMiLCJMaXRlcmF0dXJlIiwgdGFncyk7CiAgICBzaWduYWwuYWxlcnRSZXZpZXcub3BlbkFsZXJ0Q29tbWVudE1vZGFsKCJMaXRlcmF0dXJlIFNlYXJjaCBBbGVydCIsIGFwcGxpY2F0aW9uTmFtZSwgYXBwbGljYXRpb25MYWJlbCwgY2hlY2tlZElkTGlzdCwgY2hlY2tlZFJvd0xpc3QpOwogICAgc2lnbmFsLmFsZXJ0UmV2aWV3LnNob3dBdHRhY2htZW50TW9kYWwoKTsKICAgIGJpbmRBYnN0cmFjdFZpZXcoKTsKCiAgICB0YWJsZSA9ICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoewogICAgICAgICJsYW5ndWFnZSI6IHsKICAgICAgICAgICAgInVybCI6ICIuLi9hc3NldHMvaTE4bi9kYXRhVGFibGVzXyIgKyB1c2VyTG9jYWxlICsgIi5qc29uIgogICAgICAgIH0sCiAgICAgICAgc3RhdGVTYXZlOiB0cnVlLAogICAgICAgIGZuRHJhd0NhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuYXBpKCkuc3RhdGUuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKCAkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLnByb3AoImNoZWNrZWQiKSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBzaG93QWJzdHJhY3REZXRhaWxzVmlldygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFnRWxsaXBzaXMoKTsKICAgICAgICAgICAgY29sRWxsaXBzaXMoKTsKICAgICAgICAgICAgd2ViVWlQb3BJbml0KCk7CiAgICAgICAgICAgIGlmICghJCh0YWJsZS50YWJsZSgpLmJvZHkoKSkuaGFzQ2xhc3MoJ2RldGFpbHNUYWJsZUJvZHknKSkgewogICAgICAgICAgICAgICAgJCh0YWJsZS50YWJsZSgpLmJvZHkoKSkuYWRkQ2xhc3MoJ2RldGFpbHNUYWJsZUJvZHknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbnRlcktleUFsZXJ0RGV0YWlsKCk7CiAgICAgICAgICAgIGNsb3NlUG9wdXBPblNjcm9sbCgpOwogICAgICAgIH0sCiAgICAgICAgZm5Jbml0Q29tcGxldGU6IGZ1bmN0aW9uIChzZXR0aW5ncywganNvbikgewogICAgICAgICAgICBzaWduYWwuYWxlcnRSZXZpZXcuYmluZEdyaWREeW5hbWljRmlsdGVycyhqc29uLmZpbHRlcnMsIHByZWZpeCwganNvbi5jb25maWdJZCk7CiAgICAgICAgICAgIGFzc2lnbmVkVG9EYXRhID0gW107CiAgICAgICAgICAgIHNpZ25hbC5hbGVydFJldmlldy5lbmFibGVNZW51VG9vbHRpcHMoKTsKICAgICAgICAgICAgc2lnbmFsLmFsZXJ0UmV2aWV3LmRpc2FibGVUb29sdGlwcygpOwogICAgICAgICAgICBhZGRHcmlkU2hvcnRjdXRzKCcjYWxlcnRzRGV0YWlsc1RhYmxlJyk7CiAgICAgICAgfSwKCiAgICAgICAgImFqYXgiOiB7CiAgICAgICAgICAgICJ1cmwiOiBsaXN0Q29uZmlnVXJsLAogICAgICAgICAgICAiZGF0YVNyYyI6ICJhYURhdGEiLAogICAgICAgICAgICAiY2FjaGUiOiBmYWxzZQogICAgICAgIH0sCiAgICAgICAgImJMZW5ndGhDaGFuZ2UiOiB0cnVlLAogICAgICAgICJiUHJvY2Vzc2luZyI6IHRydWUsCiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKICAgICAgICAiY29sUmVvcmRlciI6IHsKICAgICAgICAgICAgInJlYWx0aW1lIjogZmFsc2UKICAgICAgICB9LAogICAgICAgICJvTGFuZ3VhZ2UiOiB7CiAgICAgICAgICAgICJzUHJvY2Vzc2luZyI6ICc8ZGl2IGNsYXNzPSJncmlkLWxvYWRpbmciPjxpbWcgc3JjPSIvc2lnbmFsL2Fzc2V0cy9zcGlubmVyLmdpZiIgd2lkdGg9IjMwIiBhbGlnbj0ibWlkZGxlIiAvPjwvZGl2PicsCiAgICAgICAgICAgICJzWmVyb1JlY29yZHMiOiAiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUiLCAic0VtcHR5VGFibGUiOiAiTm8gZGF0YSBhdmFpbGFibGUgaW4gdGFibGUgIgogICAgICAgIH0sCiAgICAgICAgImFMZW5ndGhNZW51IjogW1s1MCwgMTAwLCAyMDBdLCBbNTAsIDEwMCwgMjAwXV0sCiAgICAgICAgInBhZ2luYXRpb24iOiB0cnVlLAogICAgICAgICJpVG90YWxEaXNwbGF5UmVjb3JkcyI6ICI1MCIsCiAgICAgICAgImFvQ29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInNlbGVjdGVkIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGlucHV0IGNsYXNzPSJleGVjQ29uZmlnSWQiIGlkPSJleGVjQ29uZmlnSWQiIHR5cGU9ImhpZGRlbiIgdmFsdWU9IicgKyByb3cuZXhlY0NvbmZpZ0lkICsgJyIgLz4nICsKICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz0iYWxlcnRDb25maWdJZCIgaWQ9ImFsZXJ0Q29uZmlnSWQiIHR5cGU9ImhpZGRlbiIgdmFsdWU9IicgKyByb3cuYWxlcnRDb25maWdJZCArICciIC8+JyArCiAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0iZ3JpZC1yb3ctY2hlY2siPjxpbnB1dCBkYXRhLXRvZ2dsZT0idG9vbHRpcCIgdGl0bGU9InJvdyBjaGVjayIgZGF0YS10aXRsZT0iZGF0YSBjaGVjayIgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJhbGVydC1jaGVjay1ib3ggZWRpdG9yLWFjdGl2ZSBjb3B5LXNlbGVjdCIgZGF0YS1pZD0nICsgcm93LmlkICsgJyAvPjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnJywKICAgICAgICAgICAgICAgICJvcmRlcmFibGUiOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZHJvcGRvd24iLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbkJ1dHRvbiA9ICc8ZGl2IHN0eWxlPSJkaXNwbGF5OiBibG9jazsiIGNsYXNzPSJidG4tZ3JvdXAgZHJvcGRvd24gZGF0YVRhYmxlSGlkZUNlbGxDb250ZW50IiBhbGlnbj0iY2VudGVyIj4gXAogICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0iZHJvcGRvd24tdG9nZ2xlIiBkYXRhLXRvZ2dsZT0iZHJvcGRvd24iIHRhYmluZGV4PSIwIj4gXAogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyO2ZvbnQtc2l6ZTogMTI1JTsiIGNsYXNzPSJnbHlwaGljb24gZ2x5cGhpY29uLW9wdGlvbi12ZXJ0aWNhbCI+PC9zcGFuPjxzcGFuIGNsYXNzPSJzci1vbmx5Ij5Ub2dnbGUgRHJvcGRvd248L3NwYW4+IFwKICAgICAgICAgICAgICAgICAgICAgICAgPC9hPiAnOwoKICAgICAgICAgICAgICAgICAgICBpZihyb3cuY29tbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gICc8aSBjbGFzcz0ibWRpIG1kaS1jaGF0IGJsdWUtMiBmb250LTEzIHBvcy1hYiBjb21tZW50IiB0aXRsZT0iJyArICQuaTE4bi5fKCdjb21tZW50QXZhaWxhYmxlJykgKyAnIj48L2k+JzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKHJvdy5pc0F0dGFjaG1lbnQgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24gKz0gJyA8aSBjbGFzcz0ibWRpIG1kaS1hdHRhY2htZW50IGJsdWUtMSBmb250LTEzIHBvcy1hYiBhdHRhY2giIHRpdGxlPSInICsgJC5pMThuLl8oJ2F0dGFjaG1lbnRBdmFpbGFibGUnKSArICciPjwvaT4nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8dWwgY2xhc3M9ImRyb3Bkb3duLW1lbnUgbWVudS1jb3N5IiByb2xlPSJtZW51Ij48bGkgcm9sZT0icHJlc2VudGF0aW9uIj48YSB0YWJpbmRleD0iMCIgY2xhc3M9InJldmlldy1yb3ctaWNvbiBjb21tZW50LWljb24gIiBkYXRhLWluZm89InJvdyI+PHNwYW4gY2xhc3M9ImZhIGZhLWNvbW1lbnQgbS1yLTEwIj48L3NwYW4+JyArICQuaTE4bi5fKCdjb250ZXh0TWVudS5jb21tZW50cycpICsgJzwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uICs9ICc8bGkgcm9sZT0icHJlc2VudGF0aW9uIj48YSB0YWJpbmRleD0iMCIgY2xhc3M9InJldmlldy1yb3ctaWNvbiBzaG93LWF0dGFjaG1lbnQtaWNvbiIgZGF0YS1maWVsZD0iYXR0YWNobWVudCIgZGF0YS1pZD0iJyArIHJvdy5pZCArICciIGRhdGEtY29udHJvbGxlcj0ibGl0ZXJhdHVyZUFsZXJ0Ij48c3BhbiBjbGFzcz0iZmEgZmEtZmlsZSBtLXItMTAiPjwvc3Bhbj4nICsgJC5pMThuLl8oJ2NvbnRleHRNZW51LmF0dGFjaG1lbnQnKSArICc8L2E+PC9saT4nOwogICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbiArPSAnPC91bD48L2Rpdj4nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25CdXR0b247CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiB0cnVlLAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ImRyb3BEb3duIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAicHJpb3JpdHkiLAogICAgICAgICAgICAgICAgImFUYXJnZXRzIjogWyJwcmlvcml0eSJdLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25hbC51dGlscy5yZW5kZXIoJ3ByaW9yaXR5JywgewogICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eVZhbHVlOiByb3cucHJpb3JpdHkudmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5Q2xhc3M6IHJvdy5wcmlvcml0eS5pY29uQ2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUHJpb3JpdHlDaGFuZ2VBbGxvd2VkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTI1IHByaW9yaXR5UGFyZW50JywKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYWN0aW9ucyIsCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbmFsLmFjdGlvbnNfdXRpbHMuYnVpbGRfYWN0aW9uX3JlbmRlcihyb3cpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTUwIHRleHQtY2VudGVyJywKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiYXJ0aWNsZUlkIiwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xMDAnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydFRhZ3MiLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRhZ3NFbGVtZW50ID0gc2lnbmFsLmFsZXJ0c191dGlscy5nZXRfdGFnc19lbGVtZW50KHJvdy5hbGVydFRhZ3MpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YWdzRWxlbWVudAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1heC0zMDAgcG9zLXJlbCcsCiAgICAgICAgICAgICAgICAib3JkZXJhYmxlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2FsZXJ0VGFncycpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhbGVydE5hbWUiLAogICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6ICdjb2wtbWluLTE1MCBjZWxsLWJyZWFrJywKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnYWxlcnROYW1lJyksCiAgICAgICAgICAgICAgICAibVJlbmRlciI6IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCByb3cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29sRWxlbWVudCA9ICc8ZGl2IGNsYXNzPSJjb2wtY29udGFpbmVyIj48ZGl2IGNsYXNzPSJjb2wtaGVpZ2h0Ij4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gcm93LmFsZXJ0TmFtZTsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICc8YSB0YWJpbmRleD0iMCIgdGl0bGU9IicgKyAkLmkxOG4uXygnYXBwTGFiZWwudmlld0FsbCcpICsgJyIgY2xhc3M9Imljby1kb3RzIHZpZXctYWxsIiBtb3JlLWRhdGE9IicgKyByb3cuYWxlcnROYW1lICsgJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJ0aXRsZSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1taW4tMTAwIGNvbC1tYXgtMzAwJywKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygndGl0bGUnKSwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjb2xFbGVtZW50ID0gJzxkaXYgY2xhc3M9ImNvbC1jb250YWluZXIiPjxkaXYgY2xhc3M9ImNvbC1oZWlnaHQiPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCs9Z2VuQXJ0aWNsZUxpbmsocm93LmFydGljbGVJZCwgcm93LnRpdGxlLCByb3cuaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzxhIHRhYmluZGV4PSIwIiB0aXRsZT0iJyArICQuaTE4bi5fKCdhcHBMYWJlbC52aWV3QWxsJykgKyAnIiBjbGFzcz0iaWNvLWRvdHMgdmlldy1hbGwiIG1vcmUtZGF0YT0iJytlc2NhcGVIVE1MKHJvdy50aXRsZSkrJyI+PGkgY2xhc3M9Im1kaSBtZGktZG90cy1ob3Jpem9udGFsIGZvbnQtMjAgYmx1ZS0xIj4gPC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIGNvbEVsZW1lbnQgKz0gJzwvZGl2PjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogImF1dGhvcnMiLAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWluLTEwMCBjb2wtbWF4LTMwMCcsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2F1dGhvcnMnKSwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHZhciBjb2xFbGVtZW50ID0gJzxkaXYgY2xhc3M9ImNvbC1jb250YWluZXIiPjxkaXYgY2xhc3M9ImNvbC1oZWlnaHQiPic7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCs9cm93LmF1dGhvcnM7CiAgICAgICAgICAgICAgICAgICAgY29sRWxlbWVudCArPSAnPGEgdGFiaW5kZXg9IjAiIHRpdGxlPSInICsgJC5pMThuLl8oJ2FwcExhYmVsLnZpZXdBbGwnKSArICciIGNsYXNzPSJpY28tZG90cyB2aWV3LWFsbCIgbW9yZS1kYXRhPSInK3Jvdy5hdXRob3JzKyciPjxpIGNsYXNzPSJtZGkgbWRpLWRvdHMtaG9yaXpvbnRhbCBmb250LTIwIGJsdWUtMSI+IDwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICBjb2xFbGVtZW50ICs9ICc8L2Rpdj48L2Rpdj4nOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbEVsZW1lbnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm1EYXRhIjogInB1YmxpY2F0aW9uRGF0ZSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1taW4tMTAwJywKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygncHVibGljYXRpb25EYXRlJykKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICdzaWduYWwnLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNpZ25hbEFuZFRvcGljcyA9ICcnOwogICAgICAgICAgICAgICAgICAgICQuZWFjaChyb3cuc2lnbmFsLCBmdW5jdGlvbihpLCBvYmopewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gc2lnbmFsRGV0YWlsVXJsICsgJz9pZD0nICsgb2JqWydzaWduYWxJZCddOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkKCcjaGFzU2lnbmFsTWFuYWdlbWVudEFjY2VzcycpLnZhbCgpID09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsQW5kVG9waWNzID0gc2lnbmFsQW5kVG9waWNzICsgJzxzcGFuIGNsYXNzPSJjbGljayI+PGEgIGNsYXNzPSJjZWxsLWJyZWFrIiBocmVmPSInICsgdXJsICsgJyI+JyArIGVzY2FwZUhUTUwob2JqWyduYW1lJ10pICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWxBbmRUb3BpY3MgPSBzaWduYWxBbmRUb3BpY3MgKyAnPHNwYW4gY2xhc3M9ImNsaWNrIHNpZ25hbFN1bW1hcnlBdXRoIj48YSAgY2xhc3M9ImNlbGwtYnJlYWsiIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSI+JyArIGVzY2FwZUhUTUwob2JqWyduYW1lJ10pICsgJzwvYT48L3NwYW4+Jm5ic3A7JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbEFuZFRvcGljcyA9IHNpZ25hbEFuZFRvcGljcyArICIsIgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmKHNpZ25hbEFuZFRvcGljcy5sZW5ndGggPiAxKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXY+JyArIHNpZ25hbEFuZFRvcGljcy5zdWJzdHJpbmcoMCwgc2lnbmFsQW5kVG9waWNzLmxlbmd0aCAtIDEpICsgJzwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJy0nOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOiAnY29sLW1pbi0xNTAgY29sLW1heC0yMDAgc2lnbmFsSW5mb3JtYXRpb24nLAogICAgICAgICAgICAgICAgIm9yZGVyYWJsZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdzaWduYWwnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiY3VycmVudERpc3Bvc2l0aW9uIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwudXRpbHMucmVuZGVyKCdkaXNwb3NpdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZERpc3Bvc2l0aW9uOiBkaXNwb3NpdGlvbkluY29taW5nT3V0Z29pbmdNYXBbcm93LmRpc3Bvc2l0aW9uXSwKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudERpc3Bvc2l0aW9uOiByb3cuZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNlSnVzdGlmaWNhdGlvbjogZm9yY2VKdXN0aWZpY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBpc1Jldmlld2VkOnJvdy5pc1Jldmlld2VkLAogICAgICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkYXRpb25TdGF0ZUFjaGlldmVkOiByb3cuaXNWYWxpZGF0aW9uU3RhdGVBY2hpZXZlZAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnY3VycmVudERpc3Bvc2l0aW9uJyksCiAgICAgICAgICAgICAgICAiY2xhc3MiOiAnY29sLW1heC0yNTAgZGlzcG9zaXRpb25BY3Rpb24nCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJhc3NpZ25lZFRvIiwKICAgICAgICAgICAgICAgICJtUmVuZGVyIjogZnVuY3Rpb24gKGRhdGEsIHR5cGUsIHJvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYWwubGlzdF91dGlscy5hc3NpZ25lZF90b19jb21wKHJvdy5pZCwgcm93LmFzc2lnbmVkVG8pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImNsYXNzTmFtZSI6ICdjb2wtbWluLTEwMCBjb2wtbWF4LTE1MCBhc3NpZ25lZFRvJywKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygnYXNzaWduZWRUbycpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJtRGF0YSI6ICJwcm9kdWN0TmFtZSIsCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1taW4tMTUwIGNvbC1tYXgtMjAwJywKICAgICAgICAgICAgICAgICJ2aXNpYmxlIjogc2lnbmFsLmZpZWxkTWFuYWdlbWVudC52aXNpYmxlQ29sdW1ucygncHJvZHVjdE5hbWUnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZXZlbnROYW1lIiwKICAgICAgICAgICAgICAgICJjbGFzc05hbWUiOiAnY29sLW1pbi0xNTAgY29sLW1heC0yMDAnLAogICAgICAgICAgICAgICAgInZpc2libGUiOiBzaWduYWwuZmllbGRNYW5hZ2VtZW50LnZpc2libGVDb2x1bW5zKCdldmVudE5hbWUnKQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibURhdGEiOiAiZGlzcG9zaXRpb24iLAogICAgICAgICAgICAgICAgIm1SZW5kZXIiOiBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgcm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdy5kaXNwb3NpdGlvbjsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAiY2xhc3NOYW1lIjogJ2NvbC1tYXgtMjUwIGN1cnJlbnREaXNwb3NpdGlvbicsCiAgICAgICAgICAgICAgICAidmlzaWJsZSI6IHNpZ25hbC5maWVsZE1hbmFnZW1lbnQudmlzaWJsZUNvbHVtbnMoJ2Rpc3Bvc2l0aW9uJykKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgInJlc3BvbnNpdmUiOiB0cnVlLAogICAgICAgICJkb20iOiAnbHJ0aXAnLAogICAgICAgIHNjcm9sbFg6IHRydWUsCiAgICAgICAgc2Nyb2xsWTogIjY1dmgiLAogICAgICAgICJyb3dDYWxsYmFjayI6IGZ1bmN0aW9uIChyb3csIGRhdGEsIGluZGV4KSB7CiAgICAgICAgICAgIC8vQmluZCBBc3NpZ25lZFRvIFNlbGVjdCBCb3gKICAgICAgICAgICAgc2lnbmFsLnVzZXJfZ3JvdXBfdXRpbHMuYmluZF9hc3NpZ25Ub190b19ncmlkX3JvdygkKHJvdyksIHNlYXJjaFVzZXJHcm91cExpc3RVcmwsIHsKICAgICAgICAgICAgICAgIG5hbWU6IGRhdGEuYXNzaWduZWRUby5mdWxsTmFtZSwKICAgICAgICAgICAgICAgIGlkOiBkYXRhLmFzc2lnbmVkVG8uaWQKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBjb2x1bW5EZWZzOiBbewogICAgICAgICAgICAidGFyZ2V0cyI6ICdfYWxsJywKICAgICAgICAgICAgInJlbmRlciI6ICQuZm4uZGF0YVRhYmxlLnJlbmRlci50ZXh0KCkKICAgICAgICB9XQogICAgfSk7CgogICAgdmFyIGluaXRfZmlsdGVyID0gZnVuY3Rpb24gKGRhdGFfdGFibGUpIHsKICAgICAgICB5YWRjZi5pbml0KGRhdGFfdGFibGUsIFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogNCwKICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogNSwKICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICBzdHlsZV9jbGFzczogImhpZGRlbiIsCiAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDYsCiAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDcsCiAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDgsCiAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDksCiAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDEwLAogICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb2x1bW5fbnVtYmVyOiAxMywKICAgICAgICAgICAgICAgIGZpbHRlcl90eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICBmaWx0ZXJfcmVzZXRfYnV0dG9uX3RleHQ6IGZhbHNlLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlbGF5OiA2MDAsCiAgICAgICAgICAgICAgICBmaWx0ZXJfZGVmYXVsdF9sYWJlbDogJycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29sdW1uX251bWJlcjogMTQsCiAgICAgICAgICAgICAgICBmaWx0ZXJfdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgZmlsdGVyX3Jlc2V0X2J1dHRvbl90ZXh0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWxheTogNjAwLAogICAgICAgICAgICAgICAgZmlsdGVyX2RlZmF1bHRfbGFiZWw6ICcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbHVtbl9udW1iZXI6IDE1LAogICAgICAgICAgICAgICAgZmlsdGVyX3R5cGU6ICJ0ZXh0IiwKICAgICAgICAgICAgICAgIGZpbHRlcl9yZXNldF9idXR0b25fdGV4dDogZmFsc2UsCiAgICAgICAgICAgICAgICBmaWx0ZXJfZGVsYXk6IDYwMCwKICAgICAgICAgICAgICAgIGZpbHRlcl9kZWZhdWx0X2xhYmVsOiAnJwogICAgICAgICAgICB9CiAgICAgICAgXSk7CiAgICAgICAgJCgnLnlhZGNmLWZpbHRlci13cmFwcGVyJykuaGlkZSgpOwogICAgICAgIHNpZ25hbC5maWVsZE1hbmFnZW1lbnQuaW5pdCgkKCcjYWxlcnRzRGV0YWlsc1RhYmxlJykuRGF0YVRhYmxlKCksICcjYWxlcnRzRGV0YWlsc1RhYmxlJywgNCk7CiAgICAgICAgJCgiI3RvZ2dsZS1jb2x1bW4tZmlsdGVycyIpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGVsZSA9ICQoJy55YWRjZi1maWx0ZXItd3JhcHBlcicpOwogICAgICAgICAgICB2YXIgaW5wdXRFbGUgPSAkKCcueWFkY2YtZmlsdGVyJyk7CiAgICAgICAgICAgIGlmIChlbGUuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgIGVsZS5oaWRlKCk7CiAgICAgICAgICAgICAgICBpbnB1dEVsZS52YWwoJycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWxlLnNob3coKTsKICAgICAgICAgICAgICAgIGlucHV0RWxlLmZpcnN0KCkuZm9jdXMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhX3RhYmxlLmNvbHVtbnMuYWRqdXN0KCkuZml4ZWRDb2x1bW5zKCkucmVsYXlvdXQoKQogICAgICAgIH0pOwogICAgfTsKICAgIHNpZ25hbC51c2VyX2dyb3VwX3V0aWxzLmJpbmRfYXNzaWduVG9fc2VsZWN0aW9uKGFzc2lnblRvR3JvdXBVcmwsIHRhYmxlKTsKICAgIGluaXRfZmlsdGVyKHRhYmxlKTsKCiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmFydGljbGVUaXRsZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZhciBsaXRlcmF0dXJlSWQgPSAkKHRoaXMpLmRhdGEoImxpdGlkIik7CiAgICAgICAgdmFyIGFydGljbGVJZCA9ICQodGhpcykuZGF0YSgiYXJ0aWNsZWlkIik7CiAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgdXJsOiB1cGRhdGVBdXRvUm91dGVEaXNwb3NpdGlvblVybCwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgJ2xpdGVyYXR1cmVBbGVydC5pZCc6IGxpdGVyYXR1cmVJZAogICAgICAgICAgICB9LAogICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICBzaWduYWwudXRpbHMucG9zdFVybChwdWJNZWRVcmwgKyBhcnRpY2xlSWQsIHsKICAgICAgICAgICAgICAgICAgICBhcnRpY2xlSWQ6IGFydGljbGVJZAogICAgICAgICAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cykgewogICAgICAgICAgICAgICAgICAgICQoJyNhbGVydHNEZXRhaWxzVGFibGUnKS5EYXRhVGFibGUoKS5hamF4LnJlbG9hZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiU29tZSBlcnJvciBvY2N1cmVkIHdoaWxlIHVwZGF0aW5nIEF1dG9Sb3V0ZSBEaXNwb3NpdGlvbiIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAkKCcuZXhwb3J0X2ljb25fc2lnbmFsIGEnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGZvcm1hdCA9ICQodGhpcykuZGF0YSgnZm9ybWF0Jyk7CiAgICAgICAgdmFyIHRhYmxlID0gJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpOwogICAgICAgIHZhciBpZExpc3QgPSBbXTsKICAgICAgICAkLmVhY2godGFibGUucm93cyh7ZmlsdGVyOiAnYXBwbGllZCd9KS5kYXRhKCksIGZ1bmN0aW9uIChpZHgsIHZhbCkgewogICAgICAgICAgICBpZExpc3QucHVzaCh2YWwuc2lnbmFsSWQpCiAgICAgICAgfSk7CiAgICAgICAgdmFyIGV4cG9ydFVybCA9IFZBTElEQVRFRC5leHBvcnRSZXBvcnRVcmwgKyAiP291dHB1dEZvcm1hdD0iICsgZm9ybWF0ICsgIiZpZExpc3Q9IiArIGlkTGlzdDsKICAgICAgICAkKHRoaXMpLmF0dHIoJ2hyZWYnLCBleHBvcnRVcmwpOwogICAgfSk7CgogICAgLy8gYWRkZWQgYnkgQW1yZW5kcmEgS3VtYXIsIGJ1Zy9QVlMtNDcyMCBzdGFydAogICAgJCgndWwjZXhwb3J0VHlwZXMgbGkgYScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZmlsdGVyX3BhcmFtcyA9ICIiOwogICAgICAgIHZhciAkc2VsZWN0ZWRSb3dzID0gJCgnLmNvcHktc2VsZWN0OmNoZWNrZWQnKTsKICAgICAgICB2YXIgaWRMaXN0ID0gW107CiAgICAgICAgaWYgKCRzZWxlY3RlZFJvd3MubGVuZ3RoKSB7CiAgICAgICAgICAgICQuZWFjaCgkc2VsZWN0ZWRSb3dzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZExpc3QucHVzaCh0YWJsZS5yb3coJCh0aGlzKS5jbG9zZXN0KCd0cicpKS5kYXRhKCkuaWQpOwogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkLmVhY2godGFibGUucm93cyh7ZmlsdGVyOiAnYXBwbGllZCd9KS5kYXRhKCksIGZ1bmN0aW9uIChpZHgsIHZhbCkgewogICAgICAgICAgICAgICAgaWRMaXN0LnB1c2godmFsLmlkKQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgJCgnI2FsZXJ0c0RldGFpbHNUYWJsZScpLkRhdGFUYWJsZSgpLmNvbHVtbnMoKS5ldmVyeSggZnVuY3Rpb24gKCkKICAgICAgICB7CiAgICAgICAgICAgIGlmKHRoaXMuc2VhcmNoKCkgIT09ICIiKSB7CiAgICAgICAgICAgICAgICBmaWx0ZXJfcGFyYW1zID0gZmlsdGVyX3BhcmFtcyArICImIit0aGlzLmRhdGFTcmMoKSArICI9IiArIHRoaXMuc2VhcmNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB2YXIgdXJsID0gJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJyYnKVswXSArICImaWRMaXN0PSIgKyBpZExpc3QgKyAiJmlzQWJzdHJhY3RFbmFibGVkPSIgKyAkKCcjZGV0YWlsZWQtdmlldy1jaGVja2JveCcpLnByb3AoImNoZWNrZWQiKTsKICAgICAgICAkKHRoaXMpLmF0dHIoJ2hyZWYnLCB1cmwrZmlsdGVyX3BhcmFtcyk7CiAgICB9KTsKICAgIC8vIGFkZGVkIGJ5IEFtcmVuZHJhIEt1bWFyLCBidWcvUFZTLTQ3MjAgZW5kCn0pOwoKdmFyIGZvcm1hdCA9IGZ1bmN0aW9uIChkKSB7CiAgICB2YXIgcmVzdWx0ZWRPYmogPSB7CiAgICAgICAgYXJ0aWNsZUFic3RyYWN0OiBkLmFydGljbGVBYnN0cmFjdAogICAgfTsKICAgIGh0bWwgPSBzaWduYWwudXRpbHMucmVuZGVyKCJsaXRlcmF0dXJlX2RldGFpbHNfY2hpbGRfdmlldyIsIHJlc3VsdGVkT2JqKTsKICAgIHJldHVybiBodG1sOwp9OwoKZnVuY3Rpb24gYmluZEFzc2lnblRvU2VsZWN0aW9uKHNlYXJjaFVzZXJHcm91cExpc3RVcmwsIGFzc2lnblRvR3JvdXBVcmwsIHRhYmxlKSB7CiAgICAkKCIuYXNzaWduZWRUb1NlbGVjdCIpLmVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICBzaWduYWwudXNlcl9ncm91cF91dGlscy5iaW5kX2Fzc2lnbl90bygkKHRoaXMpLCBzZWFyY2hVc2VyR3JvdXBMaXN0VXJsLCBhc3NpZ25lZFRvRGF0YVtpXSk7CiAgICB9KTsKICAgIHNpZ25hbC51c2VyX2dyb3VwX3V0aWxzLmJpbmRfYXNzaWduVG9fc2VsZWN0aW9uKGFzc2lnblRvR3JvdXBVcmwsIHRhYmxlKTsKfQoKZnVuY3Rpb24gYmluZEFic3RyYWN0VmlldygpIHsKICAgIHZhciBkZXRhaWxlZFZpZXdDaGVja2JveCA9ICQoJyNkZXRhaWxlZC12aWV3LWNoZWNrYm94Jyk7CiAgICBkZXRhaWxlZFZpZXdDaGVja2JveC5vbigiY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCQodGhpcykucHJvcCgiY2hlY2tlZCIpID09IHRydWUpIHsKICAgICAgICAgICAgc2hvd0Fic3RyYWN0RGV0YWlsc1ZpZXcoKQogICAgICAgICAgICBhZGRBYnN0cmFjdChkZXRhaWxlZFZpZXdDaGVja2JveCkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoaWRlQWJzdHJhY3REZXRhaWxzVmlldygpCiAgICAgICAgICAgIHJlbW92ZUFic3RyYWN0KCkKICAgICAgICB9CiAgICB9KTsKfQoKZnVuY3Rpb24gc2hvd0Fic3RyYWN0RGV0YWlsc1ZpZXcoKSB7CiAgICB0YWJsZS5yb3dzKCkuZXZlcnkoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciByb3cgPSB0aGlzOwogICAgICAgIHJvdy5jaGlsZChmb3JtYXQocm93LmRhdGEoKSkscm93Lm5vZGUoKS5jbGFzc05hbWUpLnNob3coKTsKICAgIH0pOwp9CgpmdW5jdGlvbiBoaWRlQWJzdHJhY3REZXRhaWxzVmlldygpIHsKICAgIHRhYmxlLnJvd3MoKS5ldmVyeShmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5jaGlsZCgpLmhpZGUoKTsKICAgIH0pOwp9CgokKGRvY3VtZW50KS5vbignY2xpY2snLCAnaW5wdXQjc2VsZWN0LWFsbCcsIGZ1bmN0aW9uICgpIHsKICAgICQoIi5jb3B5LXNlbGVjdCIpLnByb3AoJ2NoZWNrZWQnLCB0aGlzLmNoZWNrZWQpOwp9KTsKCmZ1bmN0aW9uIGFkZEFic3RyYWN0KGRldGFpbGVkVmlld0NoZWNrYm94KXsKICAgICQoJyNleHBvcnRUeXBlcycpLmZpbmQoJ2EnKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICQodGhpcykuYXR0cignaHJlZicsICQodGhpcykuYXR0cignaHJlZicpICsgIiZpc0Fic3RyYWN0RW5hYmxlZD0iICsgZGV0YWlsZWRWaWV3Q2hlY2tib3gucHJvcCgiY2hlY2tlZCIpKTsKICAgIH0pOwp9CgpmdW5jdGlvbiByZW1vdmVBYnN0cmFjdCgpewogICAgJCgnI2V4cG9ydFR5cGVzJykuZmluZCgnYScpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgJCh0aGlzKS5hdHRyKCdocmVmJywkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgiJmlzQWJzdHJhY3RFbmFibGVkIilbMF0pOwogICAgfSk7Cn0KCiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuc2lnbmFsU3VtbWFyeUF1dGgnLCBmdW5jdGlvbiAoZXZ0KSB7CiAgICAkLk5vdGlmaWNhdGlvbi5ub3RpZnkoJ3dhcm5pbmcnLCd0b3AgcmlnaHQnLCAiV2FybmluZyIsICJZb3UgZG9uJ3QgaGF2ZSBhY2Nlc3MgdG8gdmlldyBzaWduYWwgc3VtbWFyeSIsIHthdXRvSGlkZURlbGF5OiAyMDAwfSk7Cn0pOwoKdmFyIGZldGNoVGFncyA9IGZ1bmN0aW9uICgpIHsKICAgICQuYWpheCh7CiAgICAgICAgdXJsOiBmZXRjaENvbW1vblRhZ3NVcmwsCiAgICAgICAgYXN5bmM6ZmFsc2UsCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICByZXN1bHQuY29tbW9uVGFnTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKG1hcCl7CiAgICAgICAgICAgICAgICB0YWdzLnB1c2goewogICAgICAgICAgICAgICAgICAgIGlkOiBtYXAuaWQsCiAgICAgICAgICAgICAgICAgICAgdGV4dDogbWFwLnRleHQsCiAgICAgICAgICAgICAgICAgICAgcGFyZW50SWQ6IG1hcC5wYXJlbnRJZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwp9OwoK</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="119578796" offset="0" length="16384" />
        <PacketInfo time="119578828" offset="16384" length="16384" />
        <PacketInfo time="119578828" offset="32768" length="524" />
      </TcpPackets>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>